<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Customize — VLTX</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Geist+Mono:wght@300;400;500;600;700&family=Geist:wght@300;400;500;600;700;800;900&family=Syne:wght@700;800&family=Outfit:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&family=DM+Sans:wght@300;400;500;600&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
<style>
/* ════════════════════════════════════
   VLTX CUSTOMIZE — DESIGN SYSTEM
════════════════════════════════════ */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;overflow:hidden;}
:root{
  --bg:#07070b;
  --bg1:#0b0b10;
  --bg2:#101016;
  --bg3:#15151c;
  --line:rgba(255,255,255,.05);
  --line2:rgba(255,255,255,.082);
  --txt:#d6d6e4;
  --txt2:#686878;
  --txt3:#3c3c52;
  --acc:#c084fc;
  --acc-dim:rgba(192,132,252,.11);
  --acc-border:rgba(192,132,252,.2);
  --acc2:#38bdf8;
  --red:#fb7185;
  --green:#4ade80;
  --gold:#fbbf24;
  --nav:178px;
  --panel:316px;
  --mono:'Geist Mono',monospace;
  --sans:'Geist',system-ui,sans-serif;
  --mut:rgba(255,255,255,.22);
}
body{background:var(--bg);color:var(--txt);font-family:var(--sans);font-size:13px;display:flex;flex-direction:column;line-height:1.5;}
body::after{content:'';position:fixed;inset:0;pointer-events:none;z-index:9999;opacity:.018;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='g'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23g)'/%3E%3C/svg%3E");
  background-size:160px 160px;}

/* ── scrollbars ── */
::-webkit-scrollbar{width:3px;height:3px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,.09);border-radius:3px;}

/* ════════════════════════════════════
   TOPBAR
════════════════════════════════════ */
.topbar{
  height:46px;flex-shrink:0;display:flex;align-items:center;gap:8px;
  padding:0 12px;border-bottom:1px solid var(--line);
  background:rgba(8,8,9,.98);backdrop-filter:blur(20px);
  position:relative;z-index:100;
}
.tlogo{
  font-family:var(--mono);font-weight:800;font-size:.84rem;
  color:#fff;text-decoration:none;letter-spacing:.06em;
  display:flex;align-items:center;gap:5px;text-transform:uppercase;
}
.tlogo-dot{width:5px;height:5px;border-radius:1px;background:var(--acc);transform:rotate(45deg);box-shadow:0 0 6px var(--acc);}
.tdiv{width:1px;height:16px;background:var(--line);flex-shrink:0;}
.tpath{font-size:.68rem;color:var(--txt3);font-family:var(--mono);letter-spacing:.03em;}
.tpath em{color:rgba(192,132,252,.5);font-style:normal;}
/* status */
.tstatus{display:flex;align-items:center;gap:5px;padding:3px 8px;border-radius:4px;background:rgba(255,255,255,.03);border:1px solid var(--line);}
.tstatus-dot{width:5px;height:5px;border-radius:50%;flex-shrink:0;}
.tstatus-dot.warn{background:var(--gold);box-shadow:0 0 5px var(--gold);}
.tstatus-dot.ok{background:var(--green);box-shadow:0 0 5px var(--green);animation:dotPulse 2.2s ease infinite;}
@keyframes dotPulse{0%,100%{opacity:1}50%{opacity:.4}}
.tstatus-txt{font-size:.62rem;color:var(--txt3);font-family:var(--mono);}
.tsp{flex:1;}
/* buttons */
.tbtn{
  padding:5px 11px;border-radius:5px;font-size:.71rem;font-weight:500;
  background:transparent;border:1px solid var(--line2);color:var(--txt2);
  cursor:pointer;font-family:var(--sans);transition:all .13s;
  display:inline-flex;align-items:center;gap:4px;white-space:nowrap;
}
.tbtn:hover{background:rgba(255,255,255,.05);color:var(--txt);border-color:rgba(255,255,255,.13);}
.tbtn.ghost{background:transparent;}
.tbtn.sm{padding:4px 9px;font-size:.66rem;}
.tsave{
  padding:6px 14px;border-radius:6px;font-size:.74rem;font-weight:600;
  background:var(--acc);color:#fff;border:none;cursor:pointer;
  font-family:var(--sans);transition:all .16s;
  box-shadow:0 0 16px rgba(168,85,247,.3);
  display:inline-flex;align-items:center;gap:5px;
}
.tsave:hover{background:#a855f7;box-shadow:0 0 20px rgba(192,132,252,.4);transform:translateY(-1px);}

/* ════════════════════════════════════
   LAYOUT
════════════════════════════════════ */
.main{flex:1;display:flex;overflow:hidden;}

/* ════════════════════════════════════
   SIDENAV
════════════════════════════════════ */
.snav{
  width:var(--nav);flex-shrink:0;overflow-y:auto;
  background:var(--bg1);border-right:1px solid var(--line);
  display:flex;flex-direction:column;padding:6px 5px 20px;gap:1px;
}
.sg{
  font-size:.52rem;font-weight:700;letter-spacing:.13em;text-transform:uppercase;
  color:rgba(192,132,252,.35);padding:12px 9px 4px;margin-top:4px;
  font-family:var(--mono);border-top:1px solid var(--line);
}
.sg:first-child{border-top:none;margin-top:0;padding-top:6px;}
.sg:first-child{margin-top:0;padding-top:5px;}
.ni{
  display:flex;align-items:center;gap:6px;padding:6.5px 8px;border-radius:5px;
  font-size:.77rem;color:var(--txt2);cursor:pointer;
  transition:color .12s,background .12s,border-color .12s;
  border:1px solid transparent;position:relative;user-select:none;
}
.ni:hover{color:var(--txt);background:rgba(255,255,255,.035);}
.ni.on{color:#f0f0ff;background:rgba(192,132,252,.09);border-color:rgba(192,132,252,.18);}
.ni.on::before{content:'';position:absolute;left:-5px;top:22%;bottom:22%;width:2.5px;background:var(--acc);border-radius:0 3px 3px 0;}
.ni-ico{font-size:.68rem;width:13px;text-align:center;flex-shrink:0;opacity:.65;}
.ni.on .ni-ico{opacity:1;}
.ni-dot{width:4px;height:4px;border-radius:50%;background:rgba(255,255,255,.08);flex-shrink:0;margin-left:auto;transition:all .2s;}
.ni.on .ni-dot{background:var(--acc);box-shadow:0 0 5px var(--acc);}
.ni-badge{
  font-size:.47rem;padding:1.5px 5px;border-radius:2px;margin-left:auto;
  font-weight:800;letter-spacing:.06em;font-family:var(--mono);
  background:rgba(192,132,252,.1);color:rgba(192,132,252,.8);text-transform:uppercase;
}
.ni-badge.warn{background:rgba(251,191,36,.1);color:rgba(251,191,36,.85);}
.ni-badge.hot{background:rgba(251,113,133,.1);color:rgba(251,113,133,.8);}
/* koraz highlight nav item */
.ni.koraz-nav{
  background:linear-gradient(90deg,rgba(192,132,252,.1),transparent);
  border-left:2px solid rgba(192,132,252,.45);
  padding-left:6px;color:#c084fc;font-weight:600;font-family:var(--mono);font-size:.7rem;
}
.ni.koraz-nav:hover{background:linear-gradient(90deg,rgba(192,132,252,.16),transparent);}

/* ════════════════════════════════════
   PREVIEW PANEL
════════════════════════════════════ */
.prev{flex:1;display:flex;flex-direction:column;overflow:hidden;background:var(--bg);position:relative;}
.prev::before{
  content:'';position:absolute;inset:0;pointer-events:none;z-index:0;
  background-image:
    linear-gradient(rgba(255,255,255,.018) 1px,transparent 1px),
    linear-gradient(90deg,rgba(255,255,255,.018) 1px,transparent 1px);
  background-size:24px 24px;
}
.prevtop{
  position:relative;z-index:2;padding:6px 11px;
  background:rgba(5,5,8,.96);backdrop-filter:blur(16px);
  border-bottom:1px solid var(--line);
  display:flex;align-items:center;gap:7px;flex-shrink:0;
}
.pdots{display:flex;gap:4px;}
.pdot{width:8px;height:8px;border-radius:50%;}
.purl{
  flex:1;background:rgba(255,255,255,.035);border:1px solid var(--line);
  padding:4px 9px;border-radius:5px;font-size:.64rem;
  color:var(--txt3);font-family:var(--mono);
}
.prev-device-toggle{
  display:flex;gap:2px;background:rgba(255,255,255,.04);
  border:1px solid var(--line);border-radius:5px;padding:2px;
}
.pdt-btn{
  padding:3px 8px;border-radius:3px;font-size:.62rem;
  cursor:pointer;color:var(--txt3);background:transparent;
  border:none;transition:all .12s;font-family:var(--sans);
}
.pdt-btn.on{background:rgba(168,85,247,.2);color:#fff;}
.prevscroll{
  flex:1;overflow-y:auto;display:flex;align-items:flex-start;
  justify-content:center;padding:26px 14px 60px;position:relative;z-index:1;
}

/* ════════════════════════════════════
   PREVIEW CARD (faithfully mirrors profile.html)
════════════════════════════════════ */
@property --spin{syntax:'<angle>';inherits:false;initial-value:0deg;}
#pc{
  width:100%;max-width:370px;border-radius:20px;overflow:hidden;
  background:rgba(14,14,22,.96);backdrop-filter:blur(28px);
  color:#f0f0fa;font-family:'Outfit',sans-serif;
  position:relative;transition:max-width .22s,border-radius .22s;
  border:1px solid rgba(255,255,255,.07);
  box-shadow:0 24px 60px rgba(0,0,0,.8),0 0 0 1px rgba(255,255,255,.04);
}
#pc::before{
  content:'';position:absolute;inset:-1px;border-radius:21px;z-index:-1;
  background:conic-gradient(from var(--spin),transparent 55%,rgba(168,85,247,.7) 68%,rgba(34,211,238,.4) 80%,transparent 90%);
  animation:spinBorder 4s linear infinite;
}
@keyframes spinBorder{to{--spin:360deg;}}
#pc.desktop-view{max-width:480px;}

/* bg layers */
.pc-bg-video,.pc-bg-img-el{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;z-index:0;pointer-events:none;}
.pc-bg-overlay{position:absolute;inset:0;z-index:1;pointer-events:none;}
#pc>*:not(.pc-bg-video):not(.pc-bg-img-el):not(.pc-bg-overlay){position:relative;z-index:2;}

/* avatar */
.pc-av-wrap{width:84px;height:84px;margin:24px auto 0;position:relative;animation:avFloat 3.5s ease-in-out infinite;}
@keyframes avFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}
.pc-avatar{
  width:80px;height:80px;border-radius:50%;overflow:hidden;cursor:pointer;
  background:linear-gradient(135deg,rgba(168,85,247,.4),rgba(34,211,238,.2));
  display:flex;align-items:center;justify-content:center;font-size:2.1rem;
  border:2.5px solid rgba(168,85,247,.55);
  box-shadow:0 0 0 4px rgba(168,85,247,.08),0 0 28px rgba(168,85,247,.28);
  transition:transform .2s,box-shadow .2s;
}
.pc-avatar:hover{transform:scale(1.06) rotate(-3deg);}
.pc-avatar img{width:100%;height:100%;object-fit:cover;}
.pc-online{
  position:absolute;bottom:1px;right:1px;width:14px;height:14px;
  border-radius:50%;background:#22c55e;
  border:2px solid rgba(14,14,22,.96);
  box-shadow:0 0 8px rgba(34,197,94,.6);
  animation:onPulse 2.5s ease-in-out infinite;
}
@keyframes onPulse{0%,100%{box-shadow:0 0 5px rgba(34,197,94,.4)}50%{box-shadow:0 0 14px rgba(34,197,94,.9)}}

/* badges */
#pcBadgeRow{display:flex;justify-content:center;gap:4px;padding:5px 0 1px;flex-wrap:wrap;}

/* body */
.pc-body{padding:8px 14px 14px;}
.pc-name-row{text-align:center;margin-bottom:3px;}
.pc-username{
  font-family:'Syne',sans-serif;font-size:1.3rem;font-weight:800;
  letter-spacing:-.025em;display:inline-block;
  background:linear-gradient(135deg,#fff 15%,#a855f7 55%,#22d3ee 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  background-size:200%;animation:nameShimmer 3.5s ease-in-out infinite;
}
@keyframes nameShimmer{0%,100%{background-position:0%}50%{background-position:100%}}
.pc-pronouns{
  display:inline-block;background:rgba(168,85,247,.1);
  border:1px solid rgba(168,85,247,.22);color:#c084fc;
  font-size:.57rem;font-weight:700;letter-spacing:.06em;text-transform:uppercase;
  padding:1.5px 6px;border-radius:100px;margin-left:4px;vertical-align:middle;
}
.pc-status{
  display:inline-flex;align-items:center;gap:3px;
  background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.07);
  color:rgba(255,255,255,.45);font-size:.61rem;
  padding:2px 7px;border-radius:100px;
}
#statusBr{display:none;}
.pc-tags{display:flex;gap:4px;flex-wrap:wrap;justify-content:center;margin:5px 0 7px;}
.pc-tag{font-size:.64rem;color:rgba(255,255,255,.35);background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.055);padding:2px 8px;border-radius:100px;}
.pc-bio{text-align:center;font-size:.82rem;color:rgba(255,255,255,.4);line-height:1.65;margin-bottom:10px;min-height:36px;display:flex;align-items:center;justify-content:center;}
.tw{}.caret{display:inline-block;width:2px;height:.75em;background:#a855f7;margin-left:1.5px;vertical-align:text-bottom;animation:blink .75s step-end infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0}}

/* skills/open to */
.pc-role{font-size:.67rem;color:rgba(255,255,255,.35);background:rgba(255,255,255,.035);border:1px solid rgba(255,255,255,.055);padding:2px 9px;border-radius:100px;}
.pc-open-chip{font-size:.59rem;font-weight:700;padding:2px 7px;border-radius:100px;background:rgba(34,197,94,.09);border:1px solid rgba(34,197,94,.18);color:#86efac;}
.pc-skill-chip{font-size:.64rem;font-weight:600;padding:2px 8px;border-radius:100px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08);color:#d4d4e8;}

/* project */
.pc-project{background:rgba(255,255,255,.025);border:1px solid rgba(255,255,255,.065);border-radius:9px;padding:9px 11px;margin-bottom:8px;}
.pc-proj-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:2px;}
.pc-proj-status{font-size:.59rem;font-weight:700;color:#a855f7;letter-spacing:.02em;}
.pc-proj-label{font-size:.52rem;color:rgba(255,255,255,.28);text-transform:uppercase;letter-spacing:.05em;}
.pc-proj-name{font-size:.83rem;font-weight:700;margin-bottom:1.5px;}
.pc-proj-desc{font-size:.67rem;color:rgba(255,255,255,.38);}

/* github graph */
#pcGithubGraph{margin-bottom:9px;}
#pcGithubGraph .gh-label{font-size:.56rem;color:rgba(255,255,255,.22);margin-bottom:4px;font-family:'Space Mono',monospace;}

/* discord activity / lanyard */
.pc-activity{display:flex;align-items:center;gap:8px;background:rgba(88,101,242,.07);border:1px solid rgba(88,101,242,.16);border-radius:8px;padding:7px 10px;margin-bottom:8px;}
.pc-act-icon{font-size:1.1rem;flex-shrink:0;}
.pc-act-name{font-size:.74rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.pc-act-sub{font-size:.61rem;color:#8b9df7;margin-top:1px;}
.pc-act-dot{width:6px;height:6px;border-radius:50%;background:#22c55e;box-shadow:0 0 5px rgba(34,197,94,.6);animation:onPulse 2s ease-in-out infinite;flex-shrink:0;}

/* spotify */
.pc-now-playing{background:rgba(30,215,96,.05);border:1px solid rgba(30,215,96,.12);border-radius:9px;padding:8px 10px;display:flex;align-items:center;gap:8px;margin-bottom:8px;}
.pc-np-bars{display:flex;align-items:flex-end;gap:1.5px;flex-shrink:0;}
.pc-np-bar{width:2.5px;background:#1ed760;border-radius:2px;animation:barBounce 1s ease-in-out infinite;}
.pc-np-bar:nth-child(1){height:7px;animation-delay:0s}.pc-np-bar:nth-child(2){height:12px;animation-delay:.16s}.pc-np-bar:nth-child(3){height:9px;animation-delay:.3s}.pc-np-bar:nth-child(4){height:14px;animation-delay:.1s}
@keyframes barBounce{0%,100%{transform:scaleY(.25)}50%{transform:scaleY(1)}}
.pc-np-info{flex:1;min-width:0;}
.pc-np-title{font-size:.74rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.pc-np-sub{font-size:.6rem;color:#1ed760;margin-top:1px;}

/* music player */
.pc-music{background:rgba(255,255,255,.035);border:1px solid rgba(255,255,255,.065);border-radius:9px;padding:8px 10px;display:flex;align-items:center;gap:8px;margin-bottom:8px;position:relative;overflow:hidden;}
.pc-prog-bg{position:absolute;bottom:0;left:0;height:2px;width:100%;background:rgba(255,255,255,.05);}
.pc-prog{position:absolute;bottom:0;left:0;height:2px;width:38%;background:linear-gradient(90deg,#a855f7,#22d3ee);}
.pc-album{width:34px;height:34px;border-radius:6px;background:linear-gradient(135deg,#2d1060,#0c2a50);display:flex;align-items:center;justify-content:center;font-size:.85rem;flex-shrink:0;}
.pc-minfo{flex:1;min-width:0;}
.pc-mtitle{font-size:.74rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.pc-martist{font-size:.61rem;color:rgba(255,255,255,.38);margin-top:1px;}
.pc-mcontrols{display:flex;gap:3px;align-items:center;}
.pc-mbtn{width:22px;height:22px;border-radius:50%;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.65rem;background:rgba(255,255,255,.07);color:#fff;transition:transform .12s;}
.pc-mbtn:hover{transform:scale(1.12);}
.pc-mbtn.play{background:#a855f7 !important;width:28px;height:28px;font-size:.75rem;}

/* discord badge */
.pc-dc-badge{display:inline-flex;align-items:center;gap:5px;background:rgba(88,101,242,.09);border:1px solid rgba(88,101,242,.22);color:#8b9df7;font-size:.64rem;font-weight:600;padding:3px 9px;border-radius:100px;margin-bottom:8px;}
.pc-dc-status-dot{width:6px;height:6px;border-radius:50%;display:inline-block;}

/* stats bar */
.pc-stats{display:flex;gap:0;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.055);border-radius:8px;overflow:hidden;margin-bottom:8px;}
.pc-stat{flex:1;padding:7px 4px;text-align:center;background:rgba(10,10,18,.85);}
.pc-stat+.pc-stat{border-left:1px solid rgba(255,255,255,.05);}
.pc-snum{font-family:'Syne',sans-serif;font-size:.86rem;font-weight:800;color:#a855f7;}
.pc-slabel{font-size:.5rem;color:rgba(255,255,255,.26);margin-top:1px;text-transform:uppercase;letter-spacing:.04em;}

/* socials */
.pc-socials{display:flex;flex-wrap:wrap;gap:5px;justify-content:center;margin-bottom:8px;}
.pc-soc{
  display:flex;align-items:center;justify-content:center;width:38px;height:38px;
  border-radius:8px;background:rgba(255,255,255,.045);border:1px solid rgba(255,255,255,.07);
  transition:transform .14s,border-color .14s;text-decoration:none;position:relative;
}
.pc-soc:hover{transform:translateY(-2px) scale(1.07);}
.pc-soc img{width:17px;height:17px;object-fit:contain;border-radius:3px;}
.pc-soc .pc-tip{position:absolute;bottom:calc(100%+4px);left:50%;transform:translateX(-50%);background:rgba(8,8,12,.98);border:1px solid rgba(255,255,255,.08);color:#f0f0fa;font-size:.57rem;font-weight:600;padding:3px 6px;border-radius:4px;white-space:nowrap;opacity:0;pointer-events:none;transition:opacity .12s;}
.pc-soc:hover .pc-tip{opacity:1;}

/* link buttons */
.pc-link-btn{display:flex;align-items:center;gap:7px;width:100%;padding:8px 11px;border-radius:8px;background:rgba(255,255,255,.045);border:1px solid rgba(255,255,255,.07);color:#f0f0fa;font-size:.77rem;font-weight:600;text-decoration:none;transition:background .13s,transform .13s;margin-bottom:4px;}
.pc-link-btn:hover{background:rgba(255,255,255,.08);transform:translateY(-1px);}
.pc-link-btn img{width:15px;height:15px;object-fit:contain;border-radius:3px;}

/* footer */
.pc-foot{padding:8px 14px;border-top:1px solid rgba(255,255,255,.04);display:flex;align-items:center;justify-content:space-between;}
.pc-credit{font-size:.6rem;color:rgba(255,255,255,.2);text-decoration:none;}
.pc-credit:hover{color:#a855f7;}

/* ════════════════════════════════════
   PANELS
════════════════════════════════════ */
.panel{
  width:var(--panel);flex-shrink:0;
  background:var(--bg1);border-left:1px solid var(--line);
  overflow-y:auto;display:none;flex-direction:column;
}
.panel.on{display:flex;}

/* panel header */
.ph{
  padding:10px 13px 9px;border-bottom:1px solid var(--line);flex-shrink:0;
  display:flex;align-items:center;gap:7px;
  font-size:.74rem;font-weight:700;letter-spacing:.01em;text-transform:uppercase;
  position:sticky;top:0;background:var(--bg1);z-index:10;
  font-family:var(--mono);color:var(--txt);
}
.ph-ico{font-size:.72rem;opacity:.6;}
.ph-sub{font-size:.6rem;color:var(--txt3);font-weight:400;margin-left:auto;font-family:var(--mono);}

/* panel row */
.prow{padding:11px 13px;border-bottom:1px solid rgba(255,255,255,.022);}
.prow:last-child{border-bottom:none;}

/* label */
.plabel{font-size:.65rem;color:var(--txt2);margin-bottom:5px;display:flex;align-items:center;gap:5px;line-height:1.4;letter-spacing:.01em;}
.plabel span{color:var(--txt3);font-size:.6rem;}

/* note box */
.pnote{font-size:.67rem;line-height:1.55;padding:7px 9px;border-radius:5px;}
.pnote.green{background:rgba(34,197,94,.05);border:1px solid rgba(34,197,94,.14);color:rgba(134,239,172,.85);}
.pnote.blue{background:rgba(59,130,246,.05);border:1px solid rgba(59,130,246,.14);color:rgba(147,197,253,.85);}
.pnote.warn{background:rgba(245,158,11,.05);border:1px solid rgba(245,158,11,.14);color:rgba(252,211,77,.85);}
.pnote.info{background:rgba(255,255,255,.03);border:1px solid var(--line);color:var(--txt3);}

/* form elements */
input[type=text],input[type=url],input[type=email],input[type=datetime-local],select,textarea{
  width:100%;background:var(--bg2);border:1px solid var(--line2);
  border-radius:5px;padding:6px 8px;font-size:.75rem;
  color:var(--txt);font-family:var(--sans);outline:none;
  transition:border-color .14s,box-shadow .14s;-webkit-appearance:none;
}
input:focus,select:focus,textarea:focus{border-color:rgba(192,132,252,.4);box-shadow:0 0 0 2px rgba(192,132,252,.07);}
input::placeholder,textarea::placeholder{color:var(--txt3);}
select{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%234a4a5e' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 8px center;}
textarea{resize:vertical;min-height:68px;line-height:1.55;}
input[type=range]{-webkit-appearance:none;width:100%;height:3px;border-radius:2px;background:rgba(255,255,255,.07);outline:none;cursor:pointer;border:none;padding:0;}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:12px;height:12px;border-radius:50%;background:var(--acc);cursor:pointer;box-shadow:0 0 5px rgba(168,85,247,.35);}
input[type=color]{width:27px;height:27px;padding:2px;border:1px solid var(--line2);border-radius:4px;background:var(--bg2);cursor:pointer;flex-shrink:0;}
input[type=color]::-webkit-color-swatch-wrapper{padding:0;}
input[type=color]::-webkit-color-swatch{border:none;border-radius:2px;}

/* toggle */
.tog{display:flex;align-items:center;gap:7px;cursor:pointer;user-select:none;}
.tog-sw{width:28px;height:15px;background:rgba(255,255,255,.07);border-radius:100px;position:relative;transition:background .14s;flex-shrink:0;}
.tog-sw.on{background:var(--acc);}
.tog-sw::after{content:'';position:absolute;top:2px;left:2px;width:11px;height:11px;background:#fff;border-radius:50%;transition:left .14s;box-shadow:0 1px 2px rgba(0,0,0,.3);}
.tog-sw.on::after{left:15px;}
.tog-label{font-size:.75rem;}

/* color row */
.crow{display:flex;gap:5px;align-items:center;}
.crow input[type=text]{flex:1;}

/* chip presets */
.color-chips{display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;}
.cchip{width:18px;height:18px;border-radius:4px;cursor:pointer;border:1.5px solid transparent;transition:transform .12s,border-color .12s;flex-shrink:0;}
.cchip:hover,.cchip.on{border-color:#fff;transform:scale(1.18);}

/* option cards */
.opt-grid{display:grid;gap:4px;}
.opt-grid.c2{grid-template-columns:1fr 1fr;}
.opt-grid.c3{grid-template-columns:1fr 1fr 1fr;}
.opt{
  border:1px solid var(--line2);border-radius:6px;padding:7px 5px;
  cursor:pointer;transition:all .14s;text-align:center;
  font-size:.64rem;color:var(--txt2);background:var(--bg2);
}
.opt:hover{border-color:rgba(192,132,252,.25);color:var(--txt);}
.opt.on{border-color:rgba(192,132,252,.4);background:rgba(192,132,252,.1);color:#f0e8ff;}
.opt-prev{height:30px;border-radius:4px;margin-bottom:3px;background:rgba(255,255,255,.035);display:flex;align-items:center;justify-content:center;font-size:.52rem;color:rgba(255,255,255,.28);}

/* action buttons */
.paction{
  width:100%;padding:7.5px;border-radius:6px;border:1px solid var(--line2);
  background:var(--bg2);color:var(--txt2);font-size:.75rem;font-weight:500;
  cursor:pointer;font-family:var(--sans);transition:all .13s;
  display:flex;align-items:center;justify-content:center;gap:5px;
}
.paction:hover{background:rgba(255,255,255,.05);color:var(--txt);border-color:rgba(255,255,255,.12);}
.paction.acc{background:var(--acc-dim);border-color:var(--acc-border);color:#c084fc;}
.paction.acc:hover{background:rgba(168,85,247,.2);}

/* row helpers */
.row2{display:flex;gap:6px;}
.row2>*{flex:1;}

/* badge grid */
.badge-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:4px;}
.badge-opt{border:1px solid var(--line2);border-radius:6px;padding:7px 3px;cursor:pointer;text-align:center;font-size:1rem;transition:all .14s;background:var(--bg2);}
.badge-opt:hover{border-color:rgba(168,85,247,.3);transform:scale(1.05);}
.badge-opt.sel{border-color:var(--acc);background:var(--acc-dim);}

/* ring grid */
.ring-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:4px;}
.ring-card{border:1px solid var(--line2);border-radius:6px;padding:7px 4px;cursor:pointer;text-align:center;font-size:.62rem;color:var(--txt2);transition:all .14s;background:var(--bg2);}
.ring-card:hover{border-color:rgba(168,85,247,.28);color:var(--txt);}
.ring-card.sel{border-color:var(--acc);background:var(--acc-dim);color:#fff;}
.ring-prev{width:24px;height:24px;border-radius:50%;margin:0 auto 4px;background:rgba(168,85,247,.18);display:flex;align-items:center;justify-content:center;}

/* link items */
.link-list{display:flex;flex-direction:column;gap:3px;margin-bottom:7px;}
.link-item{background:var(--bg2);border:1px solid var(--line);border-radius:6px;padding:6px 8px;display:flex;align-items:center;gap:6px;}
.li-ico{width:24px;height:24px;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:.72rem;background:rgba(255,255,255,.04);overflow:hidden;flex-shrink:0;}
.li-ico img{width:100%;height:100%;object-fit:contain;}
.li-info{flex:1;min-width:0;}
.li-name{font-size:.74rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.li-url{font-size:.6rem;color:var(--txt3);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.li-rm{background:none;border:none;color:var(--txt3);cursor:pointer;font-size:.8rem;padding:2px 4px;border-radius:3px;transition:color .12s;}
.li-rm:hover{color:var(--red);}
.add-form{background:var(--bg2);border:1px solid var(--line2);border-radius:7px;padding:9px;display:none;flex-direction:column;gap:6px;}
.add-form.on{display:flex;}

/* theme gallery */
.theme-gallery{display:grid;grid-template-columns:1fr 1fr;gap:5px;}
.theme-card{border:1px solid var(--line2);border-radius:8px;overflow:hidden;cursor:pointer;transition:all .16s;position:relative;}
.theme-card:hover{transform:scale(1.02);border-color:rgba(168,85,247,.3);}
.theme-card.active{border-color:var(--acc);box-shadow:0 0 14px rgba(168,85,247,.2);}
.theme-preview{height:56px;position:relative;overflow:hidden;}
.theme-preview-av{width:18px;height:18px;border-radius:50%;position:absolute;bottom:7px;left:8px;border:1.5px solid rgba(255,255,255,.25);}
.theme-preview-name{position:absolute;bottom:9px;left:30px;font-size:.53rem;font-weight:700;color:rgba(255,255,255,.88);}
.theme-preview-status{position:absolute;bottom:1px;left:8px;font-size:.45rem;color:rgba(255,255,255,.4);}
.theme-label{padding:5px 8px;display:flex;align-items:center;justify-content:space-between;}
.theme-name{font-size:.66rem;font-weight:600;}
.theme-tag{font-size:.52rem;color:var(--txt3);background:rgba(255,255,255,.04);padding:1px 4px;border-radius:3px;}
.theme-apply-badge{position:absolute;top:4px;right:4px;font-size:.44rem;font-weight:800;letter-spacing:.05em;background:var(--acc);color:#fff;padding:1.5px 5px;border-radius:3px;display:none;text-transform:uppercase;}
.theme-card.active .theme-apply-badge{display:block;}

/* koraz hero preset card */
.koraz-hero{
  border:1px solid rgba(168,85,247,.28);border-radius:8px;
  background:linear-gradient(135deg,rgba(168,85,247,.1),rgba(34,211,238,.04));
  padding:11px 13px;margin-bottom:8px;cursor:pointer;transition:all .16s;
  position:relative;overflow:hidden;
}
.koraz-hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 80% 40%,rgba(168,85,247,.08),transparent 68%);pointer-events:none;}
.koraz-hero:hover{border-color:rgba(168,85,247,.45);background:linear-gradient(135deg,rgba(168,85,247,.16),rgba(34,211,238,.07));}
.koraz-hero h3{font-size:.8rem;font-weight:700;color:#c084fc;margin-bottom:2px;}
.koraz-hero p{font-size:.65rem;color:var(--txt3);line-height:1.55;}
.koraz-hero-badge{position:absolute;top:9px;right:9px;font-size:.48rem;font-weight:800;letter-spacing:.06em;background:var(--acc);color:#fff;padding:2px 6px;border-radius:3px;text-transform:uppercase;}

/* gradient builder */
.grad-preview{height:26px;border-radius:5px;margin-bottom:7px;transition:background .2s;}
.grad-presets{display:flex;gap:4px;flex-wrap:wrap;margin-bottom:8px;}
.grad-preset{width:26px;height:26px;border-radius:4px;cursor:pointer;border:2px solid transparent;transition:all .12px;flex-shrink:0;}
.grad-preset:hover,.grad-preset.on{border-color:#fff;transform:scale(1.12);}

/* bg drop zone */
.bg-drop{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  min-height:80px;border:1.5px dashed rgba(255,255,255,.1);border-radius:7px;
  background:rgba(255,255,255,.02);cursor:pointer;transition:all .16s;text-align:center;gap:4px;padding:12px;
}
.bg-drop:hover{border-color:rgba(168,85,247,.38);background:rgba(168,85,247,.03);}
.bg-drop.drag-over{border-color:var(--acc);background:rgba(168,85,247,.06);}
.drop-ico{font-size:1.1rem;opacity:.4;}
.drop-text{font-size:.71rem;color:var(--txt2);font-weight:500;}
.drop-sub{font-size:.58rem;color:var(--txt3);}

.bg-cur{display:flex;align-items:center;gap:8px;background:var(--bg2);border:1px solid var(--line);border-radius:7px;padding:7px 10px;}
.bg-thumb{width:44px;height:33px;border-radius:4px;overflow:hidden;background:var(--bg3);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:.9rem;}
.bg-thumb img,.bg-thumb video{width:100%;height:100%;object-fit:cover;}
.bg-info{flex:1;min-width:0;}
.bg-fname{font-size:.74rem;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.bg-ftype{font-size:.6rem;color:var(--txt3);margin-top:1px;}
.bg-rm-btn{padding:4px 7px;border-radius:4px;background:rgba(244,63,94,.09);border:1px solid rgba(244,63,94,.18);color:#fb7185;font-size:.67rem;font-weight:600;cursor:pointer;transition:all .12s;white-space:nowrap;}
.bg-rm-btn:hover{background:rgba(244,63,94,.18);}

/* music track list */
.track-list{display:flex;flex-direction:column;gap:3px;margin-bottom:7px;}
.track-item{background:var(--bg2);border:1px solid var(--line);border-radius:6px;padding:6px 8px;display:flex;align-items:center;gap:7px;cursor:grab;}
.tr-num{font-size:.58rem;color:var(--txt3);width:13px;text-align:center;flex-shrink:0;font-family:var(--mono);}
.tr-info{flex:1;min-width:0;}
.tr-name{font-size:.74rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.tr-url{font-size:.59rem;color:var(--txt3);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.tr-rm{background:none;border:none;color:var(--txt3);cursor:pointer;font-size:.78rem;padding:2px 4px;border-radius:3px;transition:color .12s;}
.tr-rm:hover{color:var(--red);}

/* discord box */
.dc-box{background:rgba(88,101,242,.07);border:1px solid rgba(88,101,242,.2);border-radius:8px;padding:9px 11px;display:flex;align-items:center;gap:9px;}
.dc-info{flex:1;min-width:0;}
.dc-name{font-size:.77rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.dc-sub{font-size:.61rem;color:var(--txt3);}
.dc-btn{padding:5px 10px;border-radius:5px;font-size:.69rem;font-weight:700;border:none;cursor:pointer;font-family:var(--sans);background:rgba(88,101,242,.65);color:#fff;transition:opacity .14s;white-space:nowrap;}
.dc-btn:hover{opacity:.82;}
.dc-btn.connected{background:rgba(34,197,94,.14);color:#22c55e;border:1px solid rgba(34,197,94,.26);}

/* skill bars */
.sbar{display:flex;flex-direction:column;gap:3px;margin-bottom:7px;}
.sbar-item{background:var(--bg2);border:1px solid var(--line);border-radius:6px;padding:6px 8px;display:flex;align-items:center;gap:7px;}
.sbar-name{font-size:.74rem;flex:1;}
.sbar-pct{font-size:.68rem;color:var(--acc);font-weight:700;font-family:var(--mono);}
.sbar-track{width:55px;height:3px;background:rgba(255,255,255,.07);border-radius:100px;overflow:hidden;flex-shrink:0;}
.sbar-fill{height:100%;background:linear-gradient(90deg,var(--acc),var(--acc2));border-radius:100px;}

/* timeline */
.tl-list{display:flex;flex-direction:column;gap:3px;}
.tl-item{display:flex;align-items:flex-start;gap:7px;background:var(--bg2);border:1px solid var(--line);border-radius:6px;padding:7px 9px;}
.tl-ico{font-size:.95rem;flex-shrink:0;}
.tl-ev{font-size:.74rem;font-weight:600;}
.tl-date{font-size:.61rem;color:var(--txt3);}
.tl-rm{background:none;border:none;color:var(--txt3);cursor:pointer;font-size:.8rem;margin-left:auto;padding:1px 3px;}
.tl-rm:hover{color:var(--red);}

/* upload progress */
.uprog{height:2px;border-radius:1px;background:rgba(255,255,255,.05);margin-top:5px;overflow:hidden;display:none;}
.uprog.on{display:block;}
.uprog-bar{height:100%;width:0%;background:linear-gradient(90deg,var(--acc),var(--acc2));transition:width .3s;}

/* sticker grid */
.sticker-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:4px;}
.sticker-opt{border:1px solid var(--line2);border-radius:5px;padding:5px;cursor:pointer;text-align:center;font-size:1.2rem;transition:all .13px;background:var(--bg2);}
.sticker-opt:hover{border-color:rgba(168,85,247,.28);transform:scale(1.08);}
.sticker-opt.active{border-color:var(--acc);background:var(--acc-dim);}

/* particles extra */
.fx-grid{display:grid;grid-template-columns:1fr 1fr;gap:4px;}
.fx-card{border:1px solid var(--line2);border-radius:7px;padding:8px 6px;cursor:pointer;text-align:center;font-size:.62rem;color:var(--txt2);background:var(--bg2);transition:all .14s;}
.fx-card .fx-ico{font-size:1.3rem;margin-bottom:3px;}
.fx-card:hover{border-color:rgba(168,85,247,.28);color:var(--txt);}
.fx-card.on{border-color:var(--acc);background:var(--acc-dim);color:#fff;}

/* custom css panel */
.css-editor{font-family:var(--mono);font-size:.72rem;background:var(--bg);border:1px solid var(--line2);border-radius:6px;padding:8px;min-height:180px;color:var(--txt);resize:vertical;}

/* publish modal */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.85);backdrop-filter:blur(18px);z-index:500;display:none;align-items:center;justify-content:center;padding:20px;}
.modal-overlay.on{display:flex;}
.modal{background:var(--bg1);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:26px;max-width:360px;width:100%;text-align:center;}
.modal h2{font-family:'Syne',sans-serif;font-size:1.2rem;font-weight:800;margin-bottom:5px;}
.modal p{color:var(--txt2);font-size:.79rem;line-height:1.57;margin-bottom:13px;}
.modal input{margin-bottom:8px;}
.modal-url{font-family:var(--mono);font-size:.74rem;background:var(--acc-dim);border:1px solid var(--acc-border);border-radius:6px;padding:8px 11px;color:#c084fc;text-align:center;cursor:pointer;user-select:all;margin-bottom:6px;}
.modal-acts{display:flex;gap:5px;margin-top:10px;justify-content:center;flex-wrap:wrap;}

/* toast */
.toast{
  position:fixed;bottom:16px;left:50%;transform:translateX(-50%) translateY(56px);
  background:rgba(8,8,12,.97);backdrop-filter:blur(18px);
  border:1px solid rgba(168,85,247,.22);color:var(--txt);
  padding:7px 14px;border-radius:7px;font-size:.75rem;font-weight:500;
  transition:transform .28s cubic-bezier(.16,1,.3,1),opacity .28s;
  z-index:9999;pointer-events:none;opacity:0;white-space:nowrap;
}
.toast.on{transform:translateX(-50%) translateY(0);opacity:1;}

/* quick-link shortcuts in panels */
.qlinks{display:flex;gap:4px;flex-wrap:wrap;}
.qlink{font-size:.64rem;padding:3px 7px;border-radius:4px;background:rgba(255,255,255,.04);border:1px solid var(--line);color:var(--txt2);cursor:pointer;transition:all .12s;}
.qlink:hover{background:rgba(255,255,255,.08);color:var(--txt);}

/* skill chip in panels */
.skill-tag{display:inline-flex;align-items:center;gap:4px;font-size:.67rem;padding:3px 8px 3px 9px;border-radius:100px;background:var(--acc-dim);border:1px solid var(--acc-border);color:#c084fc;}
.skill-rm{background:none;border:none;color:rgba(168,85,247,.4);cursor:pointer;font-size:.76rem;padding:0 1px;line-height:1;}
.skill-rm:hover{color:var(--red);}

/* bgfx / aurora / plasma */
.bfx-grid{display:grid;grid-template-columns:1fr 1fr;gap:5px;}
.bfx-card{border:1px solid var(--line2);border-radius:8px;overflow:hidden;cursor:pointer;transition:all .16px;position:relative;}
.bfx-card:hover{border-color:rgba(168,85,247,.3);}
.bfx-card.on{border-color:var(--acc);box-shadow:0 0 12px rgba(168,85,247,.18);}
.bfx-prev{height:48px;border-radius:5px 5px 0 0;}
.bfx-lbl{padding:5px 7px;font-size:.62rem;font-weight:600;}

/* gradient for pc bg aurora (preview) */
#bgAurora{position:absolute;inset:0;z-index:0;pointer-events:none;opacity:.55;background:radial-gradient(ellipse at 20% 50%,#a855f720,transparent 50%),radial-gradient(ellipse at 80% 20%,#22d3ee18,transparent 50%),radial-gradient(ellipse at 60% 80%,#f43f5e10,transparent 50%);animation:auroraAnim 8s ease-in-out infinite;}
@keyframes auroraAnim{0%,100%{transform:scale(1) rotate(0deg)}50%{transform:scale(1.05) rotate(2deg)}}

/* canvas particles overlay in preview */
#pcCanvas{position:absolute;inset:0;z-index:1;pointer-events:none;}

/* border gradient on pc */
#pc.border-grad{background:rgba(14,14,22,.96) padding-box,linear-gradient(135deg,var(--acc),var(--acc2)) border-box;border-color:transparent;}

/* skill-bars in preview */
.sbar-preview{margin-bottom:10px;}
.sb-row{display:flex;align-items:center;gap:7px;margin-bottom:5px;}
.sb-lbl{font-size:.65rem;font-weight:600;min-width:55px;}
.sb-track-p{flex:1;height:3px;background:rgba(255,255,255,.07);border-radius:100px;overflow:hidden;}
.sb-fill-p{height:100%;border-radius:100px;background:linear-gradient(90deg,var(--acc),var(--acc2));}

/* cursor fx overlay in preview */
#pcCursorDot{position:absolute;width:8px;height:8px;border-radius:50%;background:var(--acc);pointer-events:none;z-index:20;transform:translate(-50%,-50%);box-shadow:0 0 8px var(--acc);transition:transform .08s;}
#pcCursorRing{position:absolute;width:22px;height:22px;border-radius:50%;border:1.5px solid var(--acc);pointer-events:none;z-index:19;transform:translate(-50%,-50%);transition:all .12s;}

/* scan lines overlay */
#pcScanLines{position:absolute;inset:0;z-index:15;pointer-events:none;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.07) 2px,rgba(0,0,0,.07) 4px);display:none;}

/* ── zoom range slider ── */
#previewZoom{accent-color:var(--acc);}
#previewZoom::-webkit-slider-thumb{-webkit-appearance:none;width:10px;height:10px;border-radius:50%;background:var(--acc);cursor:pointer;}
#previewZoom::-moz-range-thumb{width:10px;height:10px;border-radius:50%;background:var(--acc);cursor:pointer;border:none;}

/* ── link drag ── */
.link-item{transition:border-color .12s,opacity .15s;}
.link-item:hover{border-color:rgba(192,132,252,.2) !important;}

/* ── countdown timer preview ── */
#ctPreviewTimer{display:flex;justify-content:center;gap:4px;flex-wrap:wrap;align-items:center;}

/* ════════════════════════════════════
   GLOBAL @keyframes
════════════════════════════════════ */
@keyframes aSpin{to{transform:rotate(360deg);}}
@keyframes aSpinRev{to{transform:rotate(-360deg);}}
</style>
</head>
<body>

<div class="topbar">
  <a class="tlogo" href="/"><div class="tlogo-dot"></div>VLTX</a>
  <div class="tdiv"></div>
  <span class="tpath"><em>// </em>customize</span>
  <div class="tdiv"></div>
  <div class="tstatus">
    <div class="tstatus-dot warn" id="topbarDot"></div>
    <span class="tstatus-txt" id="topbarInfo">unsaved</span>
  </div>
  <span class="tsp"></span>
  <button class="tbtn ghost sm" id="undoBtn" onclick="undoState()" title="Undo (Ctrl+Z)" style="opacity:.4;cursor:not-allowed">↶</button>
  <button class="tbtn ghost sm" id="redoBtn" onclick="redoState()" title="Redo (Ctrl+Y)" style="opacity:.4;cursor:not-allowed">↷</button>
  <button class="tbtn ghost sm" onclick="resetProfile()">↺ reset</button>
  <button class="tbtn ghost sm" onclick="previewFullscreen()">⎋ preview</button>
  <button class="tsave" onclick="showPublish()">↑ publish</button>
</div>

<div class="main">
  <!-- SIDENAV -->
  <div class="snav">
    <!-- Search bar -->
    <div style="padding:6px 5px 4px;position:sticky;top:0;background:var(--bg1);z-index:10;border-bottom:1px solid var(--line);">
      <div style="position:relative;">
        <span style="position:absolute;left:8px;top:50%;transform:translateY(-50%);font-size:.65rem;color:var(--txt3);pointer-events:none;">⌕</span>
        <input id="navSearch" type="text" placeholder="Search panels..." oninput="filterNav(this.value)"
          style="width:100%;padding:5px 8px 5px 22px;background:rgba(255,255,255,.04);border:1px solid var(--line2);border-radius:5px;color:var(--txt);font-family:var(--mono);font-size:.65rem;outline:none;transition:border-color .15s;"
          onfocus="this.style.borderColor='rgba(192,132,252,.35)'" onblur="this.style.borderColor=''">
      </div>
    </div>
    <div class="sg">identity</div>
    <div class="ni on" onclick="nav(this,'s-identity')"><span class="ni-ico">◈</span>Profile<div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-bio')"><span class="ni-ico">≡</span>Bio & Tags<div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-skills')"><span class="ni-ico">◇</span>Skills & Work<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-badges')"><span class="ni-ico">◆</span>Badges<div class="ni-dot"></div></div>
    <div class="sg">design</div>
    <div class="ni koraz-nav" onclick="nav(this,'s-themes')"><span class="ni-ico">★</span>JS Presets<span class="ni-badge warn">1-click</span></div>
    <div class="ni" onclick="nav(this,'s-themes')"><span class="ni-ico">◉</span>Themes<span class="ni-badge">hot</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-theme')"><span class="ni-ico">◈</span>Colors<div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-gradient')"><span class="ni-ico">◇</span>Gradient<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-effects')"><span class="ni-ico">✦</span>Effects<div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-bgfx')"><span class="ni-ico">▣</span>BG Effects<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-animations')"><span class="ni-ico">◈</span>Animations<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-layout')"><span class="ni-ico">▣</span>Layout<div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-cardskin')"><span class="ni-ico">◆</span>Card Skin<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-banner-style')"><span class="ni-ico">▬</span>Banner Style<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-type-scale')"><span class="ni-ico">Aa</span>Type Scale<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-link-style')"><span class="ni-ico">◇</span>Link Buttons<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-bg-pattern')"><span class="ni-ico">▣</span>BG Pattern<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="sg">media</div>
    <div class="ni" onclick="nav(this,'s-avatar')"><span class="ni-ico">◇</span>Avatar<div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-background')"><span class="ni-ico">▣</span>Background<div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-music')"><span class="ni-ico">♪</span>Music<div class="ni-dot"></div></div>
    <div class="sg">integrations</div>
    <div class="ni" onclick="nav(this,'s-links')"><span class="ni-ico">◇</span>Social Links<div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-discord')"><span class="ni-ico">◈</span>Discord<div class="ni-dot" id="discordNavDot"></div></div>
    <div class="ni" onclick="nav(this,'s-github')"><span class="ni-ico">◇</span>GitHub<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-spotify')"><span class="ni-ico">♪</span>Spotify<div class="ni-dot"></div></div>
    <div class="sg">extra</div>
    <div class="ni" onclick="nav(this,'s-skillbars')"><span class="ni-ico">◇</span>Skill Bars<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-timeline')"><span class="ni-ico">≡</span>Timeline<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-quote')"><span class="ni-ico">≡</span>Quote<div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-reactions')"><span class="ni-ico">◆</span>Reactions<div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-marquee')"><span class="ni-ico">▸</span>Marquee<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-particles-extra')"><span class="ni-ico">✦</span>Particles+<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-card-fx')"><span class="ni-ico">◆</span>Card FX<span class="ni-badge">hot</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-avatar-fx')"><span class="ni-ico">◇</span>Avatar FX<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-typography')"><span class="ni-ico">≡</span>Typography FX<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-socials-style')"><span class="ni-ico">◇</span>Socials Style<div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-tags-style')"><span class="ni-ico">◆</span>Tags & Bio<div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-widgets')"><span class="ni-ico">□</span>Widgets<span class="ni-badge">hot</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-music-style')"><span class="ni-ico">♪</span>Music Style<div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-page-anim')"><span class="ni-ico">◈</span>Page Anim<div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-audio-viz')"><span class="ni-ico">♫</span>Audio Viz<span class="ni-badge hot">hot</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-3d')"><span class="ni-ico">◈</span>3D Effects<span class="ni-badge hot">hot</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-text-fx')"><span class="ni-ico">≡</span>Text FX+<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-glass')"><span class="ni-ico">◇</span>Glass & Blur<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-neon')"><span class="ni-ico">✦</span>Neon Signs<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-embeds')"><span class="ni-ico">□</span>Embeds<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-videobg')"><span class="ni-ico">▣</span>Video BG<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-profile-card')"><span class="ni-ico">◆</span>Profile Card+<span class="ni-badge hot">hot</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-sound')"><span class="ni-ico">♪</span>Sound FX<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-gallery')"><span class="ni-ico">▣</span>Gallery<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-password')"><span class="ni-ico">◈</span>Privacy<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-seo')"><span class="ni-ico">◇</span>SEO & Meta<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-analytics-cfg')"><span class="ni-ico">◆</span>Analytics+<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-countdown')"><span class="ni-ico">⏱</span>Countdown<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-qr')"><span class="ni-ico">◼</span>QR Code<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="sg">advanced</div>
    <div class="ni" onclick="nav(this,'s-shortcuts')"><span class="ni-ico">⌨</span>Shortcuts<div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-export')"><span class="ni-ico">↓</span>Export/Import<span class="ni-badge warn">pro</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-borders')"><span class="ni-ico">◇</span>Borders & Glow<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-stickers')"><span class="ni-ico">◆</span>Stickers<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-cursor')"><span class="ni-ico">◈</span>Cursor FX<span class="ni-badge">new</span><div class="ni-dot"></div></div>
    <div class="ni" onclick="nav(this,'s-css')"><span class="ni-ico">&#60;/&#62;</span>Custom CSS<span class="ni-badge warn">pro</span><div class="ni-dot"></div></div>
  </div>

  <!-- ══════ PREVIEW ══════ -->
  <div class="prev">
    <div class="prevtop">
      <div class="pdots">
        <div class="pdot" style="background:#ff5f56"></div>
        <div class="pdot" style="background:#ffbd2e"></div>
        <div class="pdot" style="background:#27c93f"></div>
      </div>
      <div class="purl" id="previewUrl">vltx-adoe.onrender.com/yourname</div>
      <div class="prev-device-toggle">
        <button class="pdt-btn on" id="pdtMobile" onclick="setDevice('mobile')">📱</button>
        <button class="pdt-btn" id="pdtDesktop" onclick="setDevice('desktop')">🖥</button>
      </div>
      <div style="display:flex;align-items:center;gap:4px;margin-left:4px;background:rgba(255,255,255,.04);border:1px solid var(--line);border-radius:5px;padding:2px 6px;">
        <span style="font-size:.6rem;color:var(--txt3);font-family:var(--mono);">zoom</span>
        <input type="range" id="previewZoom" min="50" max="130" value="100" oninput="setPreviewZoom(this.value)"
          style="width:55px;height:3px;appearance:none;-webkit-appearance:none;background:rgba(255,255,255,.12);border-radius:10px;outline:none;cursor:pointer;">
        <span id="previewZoomVal" style="font-size:.6rem;color:var(--txt3);font-family:var(--mono);min-width:30px;">100%</span>
      </div>
      <button class="tbtn ghost sm" onclick="document.querySelectorAll('.ni').forEach(n=>n.classList.remove('on'));document.querySelectorAll('.panel').forEach(p=>p.classList.remove('on'));document.getElementById('s-shortcuts').classList.add('on');" title="Keyboard shortcuts ?" style="font-size:.8rem;padding:3px 7px;">?</button>
    </div>
    <div class="prevscroll">
      <div id="pc">
        <video class="pc-bg-video" id="bgVideo" autoplay muted loop playsinline style="display:none;opacity:.4"></video>
        <img class="pc-bg-img-el" id="bgImgEl" style="display:none;opacity:.4">
        <div class="pc-bg-overlay" id="bgOverlay"></div>
        <div class="pc-bg-noise" id="bgNoise" style="display:none"></div>

        <div class="pc-av-wrap" id="pcAvWrap">
          <div class="pc-avatar" id="pcAvatar" onclick="document.getElementById('avatarFileInput').click()" title="Click to upload avatar">👾</div>
          <div class="pc-online" id="pcOnlineDot"></div>
        </div>

        <!-- Badges row -->
        <div id="pcBadgeRow" style="display:flex;justify-content:center;gap:4px;padding:6px 0 2px;flex-wrap:wrap;"></div>

        <div class="pc-body">
          <div class="pc-name-row">
            <span class="pc-username" id="pcUsername">yourname</span>
            <span id="pcVerified" style="display:none;font-size:.9rem;margin-left:4px" title="Verified">✅</span>
            <span class="pc-pronouns" id="pcPronouns" style="display:none"></span>
            <br id="statusBr" style="display:none">
            <span class="pc-status" id="pcStatus" style="display:none"></span>
          </div>
          <div class="pc-tags" id="pcTags"></div>

          <!-- Role line -->
          <div id="pcRoleRow" style="display:none;text-align:center;margin-bottom:8px">
            <span class="pc-role" id="pcRole"></span>
          </div>

          <!-- Open To badges -->
          <div id="pcOpenToRow" style="display:none;justify-content:center;gap:4px;flex-wrap:wrap;margin-bottom:10px"></div>

          <div class="pc-bio"><div><span class="tw" id="pcBio"></span><span class="caret"></span></div></div>

          <!-- Skills chips -->
          <div id="pcSkillsRow" style="display:none;flex-wrap:wrap;gap:5px;justify-content:center;margin-bottom:12px;padding:0 4px"></div>

          <!-- Current project card -->
          <div class="pc-project" id="pcProject" style="display:none">
            <div class="pc-proj-top">
              <span class="pc-proj-status" id="pcProjStatus">🔨 Building</span>
              <span class="pc-proj-label">current project</span>
            </div>
            <div class="pc-proj-name" id="pcProjName">Project Name</div>
            <div class="pc-proj-desc" id="pcProjDesc"></div>
          </div>

          <!-- GitHub Contribution Graph -->
          <div id="pcGithubGraph" style="display:none;margin-bottom:12px">
            <div style="font-size:.62rem;color:var(--mut);text-align:center;margin-bottom:5px">GitHub Activity</div>
            <canvas id="ghCanvas" width="340" height="52" style="width:100%;border-radius:6px;opacity:.85"></canvas>
          </div>

          <!-- Lanyard Activity -->
          <div class="pc-activity" id="pcActivity" style="display:none">
            <div class="pc-act-icon" id="pcActIcon">🎮</div>
            <div class="pc-act-info">
              <div class="pc-act-name" id="pcActName">Playing something</div>
              <div class="pc-act-sub" id="pcActSub">via Discord</div>
            </div>
            <div class="pc-act-dot"></div>
          </div>

          <div class="pc-now-playing" id="pcNowPlaying" style="display:none">
            <div class="pc-np-bars"><div class="pc-np-bar"></div><div class="pc-np-bar"></div><div class="pc-np-bar"></div><div class="pc-np-bar"></div></div>
            <div class="pc-np-info">
              <div class="pc-np-title" id="pcNpTitle">Not listening to anything</div>
              <div class="pc-np-sub">Spotify</div>
            </div>
          </div>

          <div class="pc-music" id="pcMusic" style="display:none">
            <div class="pc-prog-bg"><div class="pc-prog" id="pcProg"></div></div>
            <div class="pc-album" id="pcAlbum">🎵</div>
            <div class="pc-minfo">
              <div class="pc-mtitle" id="pcMtitle">No track loaded</div>
              <div class="pc-martist" id="pcMartist">Upload an MP3</div>
            </div>
            <div class="pc-mcontrols">
              <button class="pc-mbtn" onclick="prevTr()">⏮</button>
              <button class="pc-mbtn play" id="pcPlayBtn" onclick="togglePlay()">▶</button>
              <button class="pc-mbtn" onclick="nextTr()">⏭</button>
            </div>
          </div>

          <div class="pc-dc-badge" id="pcDcBadge" style="display:none">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="#5865F2"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/></svg>
            <span class="pc-dc-status-dot" id="pcDcStatusDot" style="background:#22c55e"></span>
            <span id="pcDcText">Discord</span>
          </div>

          <!-- DISCORD SERVER WIDGET PREVIEW -->
          <div id="pcDiscordServerWidget" style="display:none;align-items:center;gap:10px;background:linear-gradient(135deg,rgba(88,101,242,.1),rgba(88,101,242,.04));border:1px solid rgba(88,101,242,.22);border-radius:14px;padding:10px 12px;margin-bottom:10px;position:relative;overflow:hidden">
            <div style="position:absolute;top:6px;right:10px;font-size:.42rem;font-weight:800;letter-spacing:.14em;color:rgba(165,180,252,.2);font-family:'Space Mono',monospace">Discord</div>
            <div id="pcDswIcon" style="width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,#5865f2,#7289da);display:flex;align-items:center;justify-content:center;flex-shrink:0;overflow:hidden;box-shadow:0 3px 10px rgba(88,101,242,.3)">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="#fff"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/></svg>
            </div>
            <div style="flex:1;min-width:0">
              <div id="pcDswName" style="font-size:.76rem;font-weight:700;color:#e2e8f0;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">Discord Server</div>
              <div style="font-size:.6rem;color:#6b7280;display:flex;align-items:center;gap:4px">
                <div style="width:6px;height:6px;border-radius:50%;background:#22c55e;box-shadow:0 0 5px rgba(34,197,94,.7)"></div>
                <span id="pcDswOnline">—</span> Online &nbsp;·&nbsp; <span id="pcDswMembers">—</span> Members
              </div>
            </div>
            <a id="pcDswJoin" href="#" style="flex-shrink:0;padding:5px 12px;border-radius:7px;background:#57f287;color:#000;font-weight:800;font-size:.66rem;text-decoration:none;box-shadow:0 3px 10px rgba(87,242,135,.25)">Join</a>
          </div>

          <div class="pc-stats" id="pcStatsRow">
            <div class="pc-stat"><div class="pc-snum" id="pcViews">—</div><div class="pc-slabel">views</div></div>
            <div class="pc-stat"><div class="pc-snum" id="pcFollowers">—</div><div class="pc-slabel">followers</div></div>
            <div class="pc-stat"><div class="pc-snum" id="pcClicks">—</div><div class="pc-slabel">clicks</div></div>
          </div>

          <div class="pc-socials" id="pcSocials"></div>
          <div id="pcLinkBtns"></div>
        </div>
        <div class="pc-foot">
          <a href="/" class="pc-credit">⚡ vltx-adoe.onrender.com</a>
          <span style="font-size:.64rem;color:var(--mut)">📊 live stats</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ══════════════════════════════════════
       PANELS
  ══════════════════════════════════════ -->

  <!-- IDENTITY -->
  <div class="panel on" id="s-identity">
    <div class="ph">👤 Profile Info <span class="ph-sub">identity</span></div>
    <div class="prow">
      <div class="plabel">Username <span>your URL slug</span></div>
      <input type="text" id="iUsername" placeholder="yourname" oninput="syncUsername()" maxlength="30">
    </div>
    <div class="prow">
      <div class="plabel">Display Name <span>shown on card</span></div>
      <input type="text" id="iDisplayName" placeholder="Your Name" oninput="syncDisplayName()">
    </div>
    <div class="prow">
      <div class="plabel">Pronouns</div>
      <input type="text" id="iPronouns" placeholder="he/him · she/her · they/them" oninput="syncPronouns()">
    </div>
    <div class="prow">
      <div class="plabel">Status Badge</div>
      <select id="iStatus" onchange="syncStatus()">
        <option value="">None</option>
        <option value="🟢 Online">🟢 Online</option>
        <option value="🔴 Do Not Disturb">🔴 Do Not Disturb</option>
        <option value="🌙 AFK">🌙 AFK</option>
        <option value="🎮 Gaming">🎮 Gaming</option>
        <option value="🎵 Listening">🎵 Listening</option>
        <option value="🎨 Creating">🎨 Creating</option>
        <option value="😴 Sleeping">😴 Sleeping</option>
        <option value="💀 Touch grass">💀 Touch grass</option>
        <option value="☕ Coffee time">☕ Coffee time</option>
        <option value="🔥 On fire">🔥 On fire</option>
        <option value="custom">✏️ Custom...</option>
      </select>
      <input type="text" id="iStatusCustom" placeholder="Custom status..." oninput="syncStatusCustom()" style="margin-top:6px;display:none">
    </div>
    <div class="prow">
      <div class="plabel">Location <span>shown below name</span></div>
      <input type="text" id="iLocation" placeholder="🌍 Earth" oninput="syncLocation()" maxlength="40">
    </div>
    <div class="prow">
      <div class="plabel">Website URL <span>optional</span></div>
      <input type="url" id="iWebsite" placeholder="https://yoursite.com" oninput="syncWebsite()">
    </div>
    <div class="prow">
      <div class="pnote green">✅ Views, followers &amp; link clicks are tracked by VLTX servers. They're real numbers — nobody can fake them.</div>
    </div>
  </div>

  <!-- BIO -->
  <div class="panel" id="s-bio">
    <div class="ph">✏️ Bio & Tags</div>
    <div class="prow">
      <div class="plabel">Typewriter Phrases <span>one per line</span></div>
      <textarea id="iBio" rows="5" placeholder="full time lurker. part time god.&#10;i make stuff sometimes.&#10;your fave's fave 🌙" oninput="syncBio()"></textarea>
      <div style="font-size:.68rem;color:var(--mut);margin-top:4px">Each line cycles with a typewriter effect.</div>
    </div>
    <div class="prow">
      <div class="plabel">Tags <span>comma separated</span></div>
      <input type="text" id="iTags" placeholder="🌙 nocturnal, 🎮 gamer, 🔪 menace" oninput="syncTags()">
    </div>
    <div class="prow">
      <div class="plabel">Typewriter Speed</div>
      <select id="iTwSpeed" onchange="syncTwSpeed()">
        <option value="fast">⚡ Fast</option>
        <option value="normal" selected>Normal</option>
        <option value="slow">🐢 Slow</option>
        <option value="dramatic">🎭 Dramatic</option>
      </select>
    </div>
  </div>

  <!-- SKILLS & WORK -->
  <div class="panel" id="s-skills">
    <div class="ph">Skills & Work <span class="ph-sub">what you do</span></div>

    <!-- SKILL CHIPS -->
    <div class="prow">
      <div class="plabel">Skills / Tech Stack <span>shown as chips</span></div>
      <div style="display:flex;gap:6px;margin-bottom:8px;flex-wrap:wrap" id="skillChipPreview"></div>
      <div style="display:flex;gap:6px;margin-bottom:6px">
        <input type="text" id="iSkillInput" placeholder="React, Python, Design..." style="flex:1" onkeydown="if(event.key==='Enter')addSkill()">
        <button class="tbtn acc sm" onclick="addSkill()">+ Add</button>
      </div>
      <div class="plabel" style="margin-bottom:6px">Quick Add</div>
      <div style="display:flex;gap:4px;flex-wrap:wrap" id="skillQuickAdd">
        <button class="tbtn ghost sm" onclick="addSkillDirect('JS')">JS</button>
        <button class="tbtn ghost sm" onclick="addSkillDirect('Python')">Python</button>
        <button class="tbtn ghost sm" onclick="addSkillDirect('React')">React</button>
        <button class="tbtn ghost sm" onclick="addSkillDirect('Rust')">Rust</button>
        <button class="tbtn ghost sm" onclick="addSkillDirect('Go')">Go</button>
        <button class="tbtn ghost sm" onclick="addSkillDirect('C++')">C++</button>
        <button class="tbtn ghost sm" onclick="addSkillDirect('TypeScript')">TS</button>
        <button class="tbtn ghost sm" onclick="addSkillDirect('Node.js')">Node</button>
        <button class="tbtn ghost sm" onclick="addSkillDirect('Vue')">Vue</button>
        <button class="tbtn ghost sm" onclick="addSkillDirect('Next.js')">Next</button>
        <button class="tbtn ghost sm" onclick="addSkillDirect('Docker')">Docker</button>
        <button class="tbtn ghost sm" onclick="addSkillDirect('Figma')">Figma</button>
        <button class="tbtn ghost sm" onclick="addSkillDirect('SQL')">SQL</button>
        <button class="tbtn ghost sm" onclick="addSkillDirect('Git')">Git</button>
        <button class="tbtn ghost sm" onclick="addSkillDirect('Linux')">Linux</button>
        <button class="tbtn ghost sm" onclick="addSkillDirect('Blender')">Blender</button>
        <button class="tbtn ghost sm" onclick="addSkillDirect('Unity')">Unity</button>
        <button class="tbtn ghost sm" onclick="addSkillDirect('Photoshop')">PS</button>
      </div>
    </div>

    <!-- CURRENT PROJECT -->
    <div class="prow">
      <div class="plabel">Current Project <span>pinned on card</span></div>
      <input type="text" id="iProjectName" placeholder="Project name..." oninput="syncProject()" maxlength="40">
      <input type="text" id="iProjectDesc" placeholder="Short description..." oninput="syncProject()" maxlength="80" style="margin-top:6px">
      <input type="url" id="iProjectUrl" placeholder="https://github.com/you/project" oninput="syncProject()" style="margin-top:6px">
      <div style="display:flex;gap:6px;margin-top:6px;flex-wrap:wrap">
        <select id="iProjectStatus" onchange="syncProject()" style="flex:1">
          <option value="🔨 Building">🔨 Building</option>
          <option value="🚀 Shipped">🚀 Shipped</option>
          <option value="🧪 Testing">🧪 Testing</option>
          <option value="💡 Ideating">💡 Ideating</option>
          <option value="🔥 In Dev">🔥 In Dev</option>
          <option value="🎯 Planning">🎯 Planning</option>
          <option value="⏸ Paused">⏸ Paused</option>
        </select>
      </div>
    </div>

    <!-- WHAT I DO ROLE -->
    <div class="prow">
      <div class="plabel">Role / Occupation <span>shown under name</span></div>
      <input type="text" id="iRole" placeholder="Full Stack Dev · Designer · Student" oninput="syncRole()" maxlength="60">
    </div>

    <!-- AVAILABILITY -->
    <div class="prow">
      <div class="plabel">Open To</div>
      <div style="display:flex;gap:5px;flex-wrap:wrap" id="openToList">
        <label class="skill-check"><input type="checkbox" onchange="syncOpenTo()"> Freelance</label>
        <label class="skill-check"><input type="checkbox" onchange="syncOpenTo()"> Full-time</label>
        <label class="skill-check"><input type="checkbox" onchange="syncOpenTo()"> Collab</label>
        <label class="skill-check"><input type="checkbox" onchange="syncOpenTo()"> Mentoring</label>
        <label class="skill-check"><input type="checkbox" onchange="syncOpenTo()"> Commissions</label>
      </div>
    </div>

    <!-- GITHUB USERNAME -->
    <div class="prow">
      <div class="plabel">GitHub Username <span>for contrib graph</span></div>
      <div style="display:flex;gap:7px">
        <input type="text" id="iGithubUser" placeholder="yourhandle" oninput="syncGithub()" style="flex:1" maxlength="40">
        <button class="tbtn ghost sm" onclick="previewGithub()">Preview</button>
      </div>
      <div class="tog" style="margin-top:8px" onclick="toggleGithubGraph()"><div class="tog-sw" id="togGithubGraph"></div><span class="tog-label">Show contribution graph</span></div>
    </div>
  </div>

  <!-- BADGES -->
  <div class="panel" id="s-badges">
    <div class="ph">🏅 Profile Badges <span class="ph-sub">flex on 'em</span></div>
    <div class="prow">
      <div class="plabel">Select Badges</div>
      <div class="badge-grid" id="badgeGrid">
        <div class="badge-opt" data-badge="🔥" onclick="toggleBadge(this)" title="On Fire">🔥</div>
        <div class="badge-opt" data-badge="💎" onclick="toggleBadge(this)" title="Diamond">💎</div>
        <div class="badge-opt" data-badge="⭐" onclick="toggleBadge(this)" title="Star">⭐</div>
        <div class="badge-opt" data-badge="👑" onclick="toggleBadge(this)" title="Crown">👑</div>
        <div class="badge-opt" data-badge="🎖️" onclick="toggleBadge(this)" title="Medal">🎖️</div>
        <div class="badge-opt" data-badge="⚡" onclick="toggleBadge(this)" title="OG">⚡</div>
        <div class="badge-opt" data-badge="🎯" onclick="toggleBadge(this)" title="Verified">🎯</div>
        <div class="badge-opt" data-badge="🌙" onclick="toggleBadge(this)" title="Night Owl">🌙</div>
        <div class="badge-opt" data-badge="🎨" onclick="toggleBadge(this)" title="Creator">🎨</div>
        <div class="badge-opt" data-badge="🤖" onclick="toggleBadge(this)" title="Dev">🤖</div>
        <div class="badge-opt" data-badge="🎮" onclick="toggleBadge(this)" title="Gamer">🎮</div>
        <div class="badge-opt" data-badge="🐺" onclick="toggleBadge(this)" title="Lone Wolf">🐺</div>
        <div class="badge-opt" data-badge="🍀" onclick="toggleBadge(this)" title="Lucky">🍀</div>
        <div class="badge-opt" data-badge="🧠" onclick="toggleBadge(this)" title="Big Brain">🧠</div>
        <div class="badge-opt" data-badge="🩸" onclick="toggleBadge(this)" title="Blood Moon">🩸</div>
        <div class="badge-opt" data-badge="💀" onclick="toggleBadge(this)" title="Skull">💀</div>
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Custom Badge</div>
      <div style="display:flex;gap:7px;">
        <input type="text" id="iCustomBadge" placeholder="🎃 or text" maxlength="8" style="flex:1">
        <button class="tbtn acc sm" onclick="addCustomBadge()">Add</button>
      </div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleVerifiedBadge()"><div class="tog-sw" id="togVerified"></div><span class="tog-label">Verified ✅ checkmark</span></div>
    </div>
  </div>

  <!-- AVATAR -->
  <div class="panel" id="s-avatar">
    <div class="ph">🖼️ Avatar</div>
    <div class="prow">
      <div class="plabel">Upload Photo</div>
      <label class="upload-btn" for="avatarFileInput">📁 JPG / PNG / GIF / WebP</label>
      <input type="file" id="avatarFileInput" accept="image/*" style="display:none" onchange="uploadAvatar(this)">
      <div class="upload-preview" id="avatarPreview"><div class="uname">No photo</div></div>
      <div class="up-progress" id="avatarProg"><div class="up-bar" id="avatarBar"></div></div>
    </div>
    <div class="prow">
      <div class="plabel">Emoji Fallback <span>if no photo</span></div>
      <input type="text" id="iEmoji" placeholder="👾" maxlength="4" oninput="syncEmoji()">
    </div>
    <div class="prow">
      <div class="plabel">Avatar Shape</div>
      <select id="iAvatarShape" onchange="syncAvatarShape()">
        <option value="circle">● Circle</option>
        <option value="squircle">⬛ Squircle</option>
        <option value="square">▪ Square</option>
        <option value="hexagon">⬡ Hexagon</option>
        <option value="star">★ Star</option>
      </select>
    </div>
    <div class="prow">
      <div class="plabel">Avatar Size <span id="avSizeVal">76px</span></div>
      <input type="range" min="48" max="110" value="76" id="iAvSize" oninput="syncAvSize()">
    </div>
    <div class="prow">
      <div class="plabel">Border Style</div>
      <div class="ring-grid">
        <div class="ring-card sel" data-ring="solid" onclick="setRingStyle(this,'solid')">
          <div class="ring-preview" style="border:3px solid #7c3aed;">🟣</div>
          <div class="ring-label">Solid</div>
        </div>
        <div class="ring-card" data-ring="glow" onclick="setRingStyle(this,'glow')">
          <div class="ring-preview" style="border:2px solid #7c3aed;box-shadow:0 0 8px #7c3aed;">✨</div>
          <div class="ring-label">Glow</div>
        </div>
        <div class="ring-card" data-ring="gradient" onclick="setRingStyle(this,'gradient')">
          <div class="ring-preview" style="background:linear-gradient(#050508,#050508) padding-box, linear-gradient(135deg,#7c3aed,#06b6d4) border-box;border:2px solid transparent;">🌈</div>
          <div class="ring-label">Gradient</div>
        </div>
        <div class="ring-card" data-ring="animated" onclick="setRingStyle(this,'animated')">
          <div class="ring-preview" style="border:2px dashed #7c3aed;animation:aSpin 4s linear infinite;">⚡</div>
          <div class="ring-label">Spin</div>
        </div>
        <div class="ring-card" data-ring="rainbow" onclick="setRingStyle(this,'rainbow')">
          <div class="ring-preview" style="border:2px solid red;">🌊</div>
          <div class="ring-label">Rainbow</div>
        </div>
        <div class="ring-card" data-ring="none" onclick="setRingStyle(this,'none')">
          <div class="ring-preview">✕</div>
          <div class="ring-label">None</div>
        </div>
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Border Color</div>
      <div class="with-color">
        <input type="text" id="iAvBorderColor" value="#7c3aed" oninput="syncAvBorderColor()">
        <input type="color" id="iAvBorderPick" value="#7c3aed" oninput="syncAvBorderPick()">
      </div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleOnline()"><div class="tog-sw on" id="togOnline"></div><span class="tog-label">Show online indicator</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleAvatarFloat()"><div class="tog-sw on" id="togFloat"></div><span class="tog-label">Floating animation</span></div>
    </div>
  </div>

  <!-- BACKGROUND — THE BIG ONE -->
  <div class="panel" id="s-background">
    <div class="ph">🌌 Background <span class="ph-sub">your world</span></div>

    <!-- UPLOAD DROP ZONE -->
    <div class="prow">
      <div class="plabel">Upload Background <span>image · video · gif</span></div>
      <label class="bg-drop-zone" for="bgFileInput" id="bgDropZone">
        <div class="bg-drop-icon" id="bgDropIcon">
          <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="color:rgba(255,255,255,.2)"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        </div>
        <div class="bg-drop-text" id="bgDropText">Drop your file here or click to browse</div>
        <div class="bg-drop-sub">JPG · PNG · GIF · MP4 · WebM · MOV · up to 200MB</div>
      </label>
      <input type="file" id="bgFileInput" accept="image/*,video/*" style="display:none" onchange="uploadBg(this)">
    </div>

    <!-- CURRENT FILE PREVIEW + INFO -->
    <div class="prow" id="bgCurrentRow" style="display:none">
      <div class="plabel">Current Background</div>
      <div class="bg-current" id="bgCurrentPreview">
        <div class="bg-cur-media" id="bgCurMedia"></div>
        <div class="bg-cur-info">
          <div class="bg-cur-name" id="bgCurName">—</div>
          <div class="bg-cur-type" id="bgCurType">—</div>
        </div>
        <button class="bg-cur-remove" onclick="clearBg()" title="Remove">✕</button>
      </div>
      <div class="up-progress" id="bgProg"><div class="up-bar" id="bgBar"></div></div>
    </div>

    <!-- UPLOAD PROGRESS (shown while uploading) -->
    <div class="prow" id="bgUploadStatus" style="display:none">
      <div class="bg-uploading">
        <div class="bg-upload-spinner"></div>
        <div>
          <div style="font-size:.82rem;font-weight:600" id="bgUploadLabel">Uploading...</div>
          <div style="font-size:.68rem;color:var(--mut);margin-top:2px" id="bgUploadSub">Please wait</div>
        </div>
      </div>
      <div class="up-progress show" style="margin-top:8px"><div class="up-bar" id="bgBarMain" style="width:0%"></div></div>
    </div>

    <!-- CONTROLS -->
    <div class="prow">
      <div class="plabel">Background Opacity <span id="bgOpacityVal">40%</span></div>
      <input type="range" min="5" max="100" value="40" id="iBgOpacity" oninput="syncBgOpacity()">
    </div>
    <div class="prow">
      <div class="plabel">Blur Amount <span id="bgBlurVal">0px</span></div>
      <input type="range" min="0" max="30" value="0" id="iBgBlur" oninput="syncBgBlur()">
    </div>
    <div class="prow">
      <div class="plabel">Zoom / Scale <span id="bgScaleVal">100%</span></div>
      <input type="range" min="90" max="150" value="100" id="iBgScale" oninput="syncBgScale()">
    </div>
    <div class="prow">
      <div class="plabel">Brightness <span id="bgBrightVal">100%</span></div>
      <input type="range" min="20" max="180" value="100" id="iBgBright" oninput="syncBgBright()">
    </div>
    <div class="prow">
      <div class="plabel">Saturation <span id="bgSatVal">100%</span></div>
      <input type="range" min="0" max="200" value="100" id="iBgSat" oninput="syncBgSat()">
    </div>

    <!-- COLOR TINT OVERLAY -->
    <div class="prow">
      <div class="plabel">Color Tint Overlay</div>
      <div style="display:flex;gap:6px;margin-bottom:6px;flex-wrap:wrap" id="tintChips"></div>
      <div class="with-color" style="margin-bottom:6px">
        <input type="text" id="iBgTint" placeholder="#7c3aed or none" oninput="syncBgTint()">
        <input type="color" id="iBgTintPick" value="#7c3aed" oninput="syncBgTintPick()">
      </div>
      <div class="plabel" style="margin-top:4px">Tint Strength <span id="bgTintStrVal">0%</span></div>
      <input type="range" min="0" max="85" value="0" id="iBgTintStr" oninput="syncBgTintStr()">
    </div>

    <!-- BLEND MODE -->
    <div class="prow">
      <div class="plabel">Blend Mode</div>
      <select id="iBgBlend" onchange="syncBgBlend()">
        <option value="normal">Normal</option>
        <option value="multiply">Multiply</option>
        <option value="screen">Screen</option>
        <option value="overlay">Overlay</option>
        <option value="color-dodge">Color Dodge</option>
        <option value="color-burn">Color Burn</option>
        <option value="hard-light">Hard Light</option>
        <option value="soft-light">Soft Light</option>
        <option value="difference">Difference</option>
        <option value="luminosity">Luminosity</option>
      </select>
    </div>

    <!-- FALLBACK COLOR -->
    <div class="prow">
      <div class="plabel">Fallback Color <span>when no file</span></div>
      <div class="with-color">
        <input type="text" id="iBgColor" value="#030308" oninput="syncBgColor()">
        <input type="color" id="iBgColorPick" value="#030308" oninput="syncBgColorPick()">
      </div>
    </div>

    <!-- POSITION -->
    <div class="prow">
      <div class="plabel">Position</div>
      <div class="bg-position-grid" id="bgPositionGrid">
        <div class="bg-pos-btn" data-pos="top left" onclick="setBgPos(this,'top left')">↖</div>
        <div class="bg-pos-btn" data-pos="top center" onclick="setBgPos(this,'top center')">↑</div>
        <div class="bg-pos-btn" data-pos="top right" onclick="setBgPos(this,'top right')">↗</div>
        <div class="bg-pos-btn" data-pos="center left" onclick="setBgPos(this,'center left')">←</div>
        <div class="bg-pos-btn sel" data-pos="center center" onclick="setBgPos(this,'center center')">●</div>
        <div class="bg-pos-btn" data-pos="center right" onclick="setBgPos(this,'center right')">→</div>
        <div class="bg-pos-btn" data-pos="bottom left" onclick="setBgPos(this,'bottom left')">↙</div>
        <div class="bg-pos-btn" data-pos="bottom center" onclick="setBgPos(this,'bottom center')">↓</div>
        <div class="bg-pos-btn" data-pos="bottom right" onclick="setBgPos(this,'bottom right')">↘</div>
      </div>
    </div>

    <!-- AESTHETIC PRESETS -->
    <div class="prow">
      <div class="plabel">Aesthetic Overlay Preset</div>
      <div class="ae-grid" id="aestheticGrid">
        <div class="ae-card sel" data-ae="none" style="background:linear-gradient(135deg,#050508,#0d0d1a)" onclick="applyAesthetic('none',this)"><div class="ae-label">None</div></div>
        <div class="ae-card" data-ae="void" style="background:#000" onclick="applyAesthetic('void',this)"><div class="ae-label">Void</div></div>
        <div class="ae-card" data-ae="purple-haze" style="background:linear-gradient(135deg,#1a0533,#2d0060)" onclick="applyAesthetic('purple-haze',this)"><div class="ae-label">Purple Haze</div></div>
        <div class="ae-card" data-ae="ocean" style="background:linear-gradient(135deg,#001220,#003366,#00b4d8)" onclick="applyAesthetic('ocean',this)"><div class="ae-label">Deep Ocean</div></div>
        <div class="ae-card" data-ae="sunset" style="background:linear-gradient(135deg,#1a0a00,#b03000,#ff6b35)" onclick="applyAesthetic('sunset',this)"><div class="ae-label">Sunset</div></div>
        <div class="ae-card" data-ae="matrix" style="background:linear-gradient(135deg,#000,#001400)" onclick="applyAesthetic('matrix',this)"><div class="ae-label">Matrix</div></div>
        <div class="ae-card" data-ae="rose" style="background:linear-gradient(135deg,#0f000a,#4d0019,#ff2d6b)" onclick="applyAesthetic('rose',this)"><div class="ae-label">Rose</div></div>
        <div class="ae-card" data-ae="midnight" style="background:linear-gradient(135deg,#010116,#08082a)" onclick="applyAesthetic('midnight',this)"><div class="ae-label">Midnight</div></div>
        <div class="ae-card" data-ae="gold" style="background:linear-gradient(135deg,#1a1000,#c9971c)" onclick="applyAesthetic('gold',this)"><div class="ae-label">Gold Rush</div></div>
        <div class="ae-card" data-ae="cherry" style="background:linear-gradient(135deg,#120004,#e91e63)" onclick="applyAesthetic('cherry',this)"><div class="ae-label">Cherry</div></div>
        <div class="ae-card" data-ae="ice" style="background:linear-gradient(135deg,#001428,#00d4ff,#a8edff)" onclick="applyAesthetic('ice',this)"><div class="ae-label">Arctic Ice</div></div>
        <div class="ae-card" data-ae="lava" style="background:linear-gradient(135deg,#1a0000,#8b0000,#ff4500)" onclick="applyAesthetic('lava',this)"><div class="ae-label">Lava</div></div>
        <div class="ae-card" data-ae="neon" style="background:linear-gradient(135deg,#000,#001a33,#003366)" onclick="applyAesthetic('neon',this)"><div class="ae-label">Neon City</div></div>
        <div class="ae-card" data-ae="sakura" style="background:linear-gradient(135deg,#1a000d,#4a0022,#ff69b4)" onclick="applyAesthetic('sakura',this)"><div class="ae-label">Sakura</div></div>
        <div class="ae-card" data-ae="forest" style="background:linear-gradient(135deg,#000d00,#0a2200,#1a4d00)" onclick="applyAesthetic('forest',this)"><div class="ae-label">Dark Forest</div></div>
      </div>
    </div>

    <!-- VIDEO SPECIFIC -->
    <div class="prow" id="bgVideoControls" style="display:none">
      <div class="plabel" style="margin-bottom:8px;color:var(--acc)">🎬 Video Settings</div>
      <div class="tog" style="margin-bottom:8px" onclick="toggleBgVideoLoop()"><div class="tog-sw on" id="togBgLoop"></div><span class="tog-label">Loop video</span></div>
      <div class="tog" style="margin-bottom:8px" onclick="toggleBgVideoMute()"><div class="tog-sw on" id="togBgMute"></div><span class="tog-label">Mute video</span></div>
      <div class="plabel" style="margin-top:4px">Playback Speed <span id="bgSpeedVal">1×</span></div>
      <input type="range" min="25" max="200" value="100" id="iBgSpeed" oninput="syncBgSpeed()">
    </div>
  </div>

  <!-- MUSIC -->
  <div class="panel" id="s-music">
    <div class="ph">🎵 Music Player</div>
    <div class="prow">
      <div class="plabel">Upload Tracks <span>multiple OK</span></div>
      <label class="upload-btn" for="musicFileInput">🎵 MP3 / AAC / OGG</label>
      <input type="file" id="musicFileInput" accept="audio/*" multiple style="display:none" onchange="uploadMusic(this)">
      <div class="up-progress" id="musicProg"><div class="up-bar" id="musicBar"></div></div>
    </div>
    <div class="prow">
      <div class="plabel">Track List <span>click to edit cover art</span></div>
      <div id="trackList" style="font-size:.78rem;color:var(--mut)">No tracks yet.</div>
    </div>
    <!-- Hidden cover art upload trigger -->
    <input type="file" id="coverArtInput" accept="image/*" style="display:none" onchange="uploadCoverArt(this)">
    <div class="prow" id="coverArtRow" style="display:none">
      <div class="plabel" id="coverArtLabel">Cover Art <span id="coverTrackName"></span></div>
      <label class="upload-btn" for="coverArtInput" style="border-style:dashed">🖼 Upload cover art (JPG/PNG)</label>
      <div style="margin-top:6px;display:none;align-items:center;gap:8px;" id="coverArtPreviewRow">
        <img id="coverArtPreview" style="width:48px;height:48px;border-radius:8px;object-fit:cover;border:1px solid var(--brd)" src="" alt="">
        <div>
          <div style="font-size:.75rem;font-weight:600" id="coverArtPreviewName"></div>
          <button onclick="removeCoverArt()" style="margin-top:3px;background:rgba(244,63,94,.1);border:1px solid rgba(244,63,94,.25);color:#fb7185;border-radius:5px;padding:2px 8px;cursor:pointer;font-size:.65rem">✕ Remove</button>
        </div>
      </div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleMusic()"><div class="tog-sw" id="togMusic"></div><span class="tog-label">Show player</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleAutoplay()"><div class="tog-sw" id="togAutoplay"></div><span class="tog-label">Autoplay on load</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Player Style</div>
      <select id="iMusicStyle" onchange="syncMusicStyle()">
        <option value="default">Default compact</option>
        <option value="spotify">Spotify-style bars</option>
        <option value="vinyl">Vinyl spinning record</option>
      </select>
    </div>
  </div>

  <!-- THEME -->
  <div class="panel" id="s-theme">
    <div class="ph">🎨 Theme & Colors</div>
    <div class="prow">
      <div class="plabel">Preset</div>
      <select id="iPreset" onchange="applyPreset()">
        <option value="">Custom</option>
        <option value="purple">💜 Purple Haze</option>
        <option value="cyan">🩵 Cyan Storm</option>
        <option value="rose">🌹 Rose Gold</option>
        <option value="green">💚 Matrix Green</option>
        <option value="orange">🔥 Solar Flare</option>
        <option value="midnight">🌑 Midnight Blue</option>
        <option value="mono">⬜ Monochrome</option>
        <option value="blood">🩸 Blood Moon</option>
        <option value="gold">🌟 Gold Rush</option>
        <option value="teal">🌊 Deep Teal</option>
        <option value="pink">🌸 Cotton Candy</option>
        <option value="neon">🌐 Neon City</option>
        <option value="sakura">🌸 Sakura Night</option>
      </select>
    </div>
    <div class="prow">
      <div class="plabel">Accent Color</div>
      <div class="color-chips" id="accentChips" style="margin-bottom:7px"></div>
      <div class="with-color">
        <input type="text" id="iAccent" value="#a855f7" oninput="syncAccent()">
        <input type="color" id="iAccentPick" value="#a855f7" oninput="syncAccentPick()">
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Secondary Color</div>
      <div class="with-color">
        <input type="text" id="iAccent2" value="#22d3ee" oninput="syncAccent2()">
        <input type="color" id="iAccent2Pick" value="#22d3ee" oninput="syncAccent2Pick()">
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Card Background</div>
      <div class="with-color">
        <input type="text" id="iCardBg" value="#0f0f1a" oninput="syncCardBg()">
        <input type="color" id="iCardBgPick" value="#0f0f1a" oninput="syncCardBgPick()">
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Card Blur <span id="blurVal">28px</span></div>
      <input type="range" min="0" max="60" value="28" id="iBlur" oninput="syncBlur()">
    </div>
    <div class="prow">
      <div class="plabel">Card Opacity <span id="cardOpacityVal">92%</span></div>
      <input type="range" min="10" max="100" value="92" id="iCardOpacity" oninput="syncCardOpacity()">
    </div>
    <div class="prow">
      <div class="plabel">Border Glow <span id="glowIntVal">45%</span></div>
      <input type="range" min="0" max="100" value="45" id="iGlowInt" oninput="syncGlowInt()">
    </div>
    <div class="prow">
      <div class="plabel">Font</div>
      <select id="iFont" onchange="syncFont()">
        <option value="outfit">Outfit (default)</option>
        <option value="syne">Syne (bold/techy)</option>
        <option value="mono">Space Mono (hacker)</option>
        <option value="dm">DM Sans (clean)</option>
        <option value="orbitron">Orbitron (cyber)</option>
        <option value="serif">Georgia (classic)</option>
      </select>
      <div class="font-preview" id="fontPreview">The quick brown fox</div>
    </div>
    <div class="prow">
      <div class="plabel">Text Color</div>
      <div class="with-color">
        <input type="text" id="iTextColor" value="#f0f0fa" oninput="syncTextColor()">
        <input type="color" id="iTextColorPick" value="#f0f0fa" oninput="syncTextColorPick()">
      </div>
    </div>
  </div>

  <!-- GRADIENT -->
  <div class="panel" id="s-gradient">
    <div class="ph">🌈 Gradient Builder <span class="ph-sub">username glow</span></div>
    <div class="prow">
      <div class="plabel">Username Gradient</div>
      <div id="gradPreview" style="height:36px;border-radius:7px;background:linear-gradient(135deg,#fff 20%,#a855f7 60%,#22d3ee);margin-bottom:8px;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-weight:800;font-size:.9rem;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">Your Name</div>
      <div class="row2" style="margin-bottom:6px;">
        <div>
          <div style="font-size:.68rem;color:var(--mut);margin-bottom:4px">Start</div>
          <div class="with-color">
            <input type="text" id="iGradStart" value="#ffffff" oninput="syncGradient()">
            <input type="color" id="iGradStartPick" value="#ffffff" oninput="syncGradStartPick()">
          </div>
        </div>
        <div>
          <div style="font-size:.68rem;color:var(--mut);margin-bottom:4px">Mid</div>
          <div class="with-color">
            <input type="text" id="iGradMid" value="#a855f7" oninput="syncGradient()">
            <input type="color" id="iGradMidPick" value="#a855f7" oninput="syncGradMidPick()">
          </div>
        </div>
      </div>
      <div>
        <div style="font-size:.68rem;color:var(--mut);margin-bottom:4px">End</div>
        <div class="with-color">
          <input type="text" id="iGradEnd" value="#22d3ee" oninput="syncGradient()">
          <input type="color" id="iGradEndPick" value="#22d3ee" oninput="syncGradEndPick()">
        </div>
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Gradient Direction</div>
      <select id="iGradDir" onchange="syncGradient()">
        <option value="135deg">↘ Diagonal</option>
        <option value="90deg">→ Horizontal</option>
        <option value="180deg">↓ Vertical</option>
        <option value="45deg">↗ Anti-diagonal</option>
      </select>
    </div>
    <div class="prow">
      <div class="plabel">Quick Combos</div>
      <div class="color-chips" id="gradChips"></div>
    </div>
    <div class="prow">
      <div class="plabel">Card Border Gradient</div>
      <div class="tog" onclick="toggleBorderGrad()"><div class="tog-sw" id="togBorderGrad"></div><span class="tog-label">Rainbow animated border</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Background Gradient Overlay</div>
      <div class="tog" onclick="toggleBgGrad()"><div class="tog-sw" id="togBgGrad"></div><span class="tog-label">Show gradient mesh on card</span></div>
    </div>
  </div>

  <!-- EFFECTS -->
  <div class="panel" id="s-effects">
    <div class="ph">✨ Effects</div>
    <div class="prow">
      <div class="plabel">Particle Effect</div>
      <select id="iParticle" onchange="syncParticle()">
        <option value="network">🕸 Network (default)</option>
        <option value="snow">❄️ Snow</option>
        <option value="fireflies">🌟 Fireflies</option>
        <option value="matrix">🟩 Matrix Rain</option>
        <option value="bubbles">🫧 Bubbles</option>
        <option value="stars">⭐ Shooting Stars</option>
        <option value="rain">🌧 Rain</option>
        <option value="sakura">🌸 Sakura Petals</option>
        <option value="dust">✨ Golden Dust</option>
        <option value="none">None</option>
      </select>
    </div>
    <div class="prow">
      <div class="plabel">Cursor Style</div>
      <select id="iCursor" onchange="syncCursor()">
        <option value="dot">● Dot + Ring</option>
        <option value="crosshair">✛ Crosshair</option>
        <option value="star">★ Star burst</option>
        <option value="ripple">◎ Ripple</option>
        <option value="trail">💫 Sparkle Trail</option>
        <option value="blade">🔪 Blade</option>
        <option value="none">Default</option>
      </select>
    </div>
    <div class="prow"><div class="tog" onclick="toggle('symbolRain','togSymbols')"><div class="tog-sw on" id="togSymbols"></div><span class="tog-label">Falling symbols</span></div></div>
    <div class="prow"><div class="tog" onclick="toggle('cardTilt','togTilt')"><div class="tog-sw on" id="togTilt"></div><span class="tog-label">3D card tilt on hover</span></div></div>
    <div class="prow"><div class="tog" onclick="toggle('glow','togGlow')"><div class="tog-sw on" id="togGlow"></div><span class="tog-label">Spinning border glow</span></div></div>
    <div class="prow"><div class="tog" onclick="toggle('clickSparks','togSparks')"><div class="tog-sw on" id="togSparks"></div><span class="tog-label">Click spark particles</span></div></div>
    <div class="prow"><div class="tog" onclick="toggle('avatarGlow','togAvGlow')"><div class="tog-sw on" id="togAvGlow"></div><span class="tog-label">Avatar glow pulse</span></div></div>
    <div class="prow"><div class="tog" onclick="toggle('cardEntrance','togEntrance')"><div class="tog-sw on" id="togEntrance"></div><span class="tog-label">Card entrance animation</span></div></div>
    <div class="prow"><div class="tog" onclick="toggle('scrollReveal','togScroll')"><div class="tog-sw on" id="togScroll"></div><span class="tog-label">Scroll reveal sections</span></div></div>
    <div class="prow"><div class="tog" onclick="toggle('glitchName','togGlitch')"><div class="tog-sw" id="togGlitch"></div><span class="tog-label">Glitch effect on name</span></div></div>
  </div>

  <!-- ANIMATIONS -->
  <div class="panel" id="s-animations">
    <div class="ph">⚡ Animations <span class="ph-sub">NEW</span></div>
    <div class="prow">
      <div class="plabel">Page Load Animation</div>
      <select id="iPageAnim" onchange="syncPageAnim()">
        <option value="fade-up">↑ Fade Up</option>
        <option value="slide-in">→ Slide In</option>
        <option value="scale-pop">💥 Scale Pop</option>
        <option value="glitch-in">⚡ Glitch In</option>
        <option value="flip">🔄 Flip</option>
        <option value="none">None</option>
      </select>
    </div>
    <div class="prow">
      <div class="plabel">Username Animation</div>
      <select id="iNameAnim" onchange="syncNameAnim()">
        <option value="shimmer">✨ Shimmer (default)</option>
        <option value="glitch">⚡ Glitch flicker</option>
        <option value="rainbow">🌈 Rainbow cycle</option>
        <option value="pulse">💓 Pulse glow</option>
        <option value="wave">〰️ Wave bounce</option>
        <option value="shake">💥 Shake</option>
        <option value="shuffle">🔀 Shuffle (Matrix decode)</option>
        <option value="fuzzy">📡 Fuzzy glitch</option>
        <option value="none">Static</option>
      </select>
    </div>
    <div class="prow">
      <div class="plabel">Link Hover Effect</div>
      <select id="iLinkHover" onchange="syncLinkHover()">
        <option value="lift">↑ Lift + glow</option>
        <option value="fill">█ Fill slide</option>
        <option value="border">□ Border trace</option>
        <option value="shake">〜 Shake</option>
        <option value="none">None</option>
      </select>
    </div>
    <div class="prow">
      <div class="plabel">Avatar Hover Effect</div>
      <select id="iAvHover" onchange="syncAvHover()">
        <option value="tilt-spin">↻ Tilt + spin</option>
        <option value="zoom">🔍 Zoom</option>
        <option value="glow">✨ Glow burst</option>
        <option value="shake">〜 Shake</option>
        <option value="none">None</option>
      </select>
    </div>
    <div class="prow">
      <div class="plabel">Animation Speed</div>
      <select id="iAnimSpeed" onchange="syncAnimSpeed()">
        <option value=".5">⚡ Fast</option>
        <option value="1" selected>Normal</option>
        <option value="1.5">Slow</option>
        <option value="2">Very Slow</option>
      </select>
    </div>
  </div>

  <!-- LAYOUT -->
  <div class="panel" id="s-layout">
    <div class="ph">📐 Layout</div>
    <div class="prow">
      <div class="plabel">Social Links Display</div>
      <div class="link-style-grid">
        <div class="ls-card sel" id="ls-icons" onclick="setLinkStyle('icons')">
          <div class="ls-preview" style="background:rgba(255,255,255,.06);gap:3px;display:flex;align-items:center;justify-content:center;">
            <div style="width:14px;height:14px;border-radius:3px;background:rgba(255,255,255,.2)"></div>
            <div style="width:14px;height:14px;border-radius:3px;background:rgba(255,255,255,.2)"></div>
            <div style="width:14px;height:14px;border-radius:3px;background:rgba(255,255,255,.2)"></div>
          </div>
          Icon grid
        </div>
        <div class="ls-card" id="ls-buttons" onclick="setLinkStyle('buttons')">
          <div class="ls-preview" style="background:rgba(124,58,237,.15);border-radius:5px;display:flex;align-items:center;padding:0 6px;font-size:.58rem;color:#a78bfa">Link button</div>
          Pill buttons
        </div>
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Card Max Width <span id="cardWidthVal">390px</span></div>
      <input type="range" min="280" max="520" value="390" id="iCardWidth" oninput="syncCardWidth()">
    </div>
    <div class="prow">
      <div class="plabel">Card Border Radius <span id="cardRadiusVal">22px</span></div>
      <input type="range" min="0" max="40" value="22" id="iCardRadius" oninput="syncCardRadius()">
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleStats()"><div class="tog-sw on" id="togStats"></div><span class="tog-label">Show stats row</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('showFooter','togFooter')"><div class="tog-sw on" id="togFooter"></div><span class="tog-label">Show VLTX footer</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Section Spacing <span id="spacingVal">normal</span></div>
      <select id="iSpacing" onchange="syncSpacing()">
        <option value="compact">Compact</option>
        <option value="normal" selected>Normal</option>
        <option value="relaxed">Relaxed</option>
      </select>
    </div>
  </div>

  <!-- BG EFFECTS -->
  <div class="panel" id="s-bgfx">
    <div class="ph">✨ Background Effects <span class="ph-sub">aurora · plasma · more</span></div>
    <div class="prow">
      <div class="plabel">Background Effect</div>
      <div class="layout-grid">
        <div class="layout-card sel" id="bgfx-none" onclick="setBgEffect('none',this)">
          <div class="layout-preview" style="background:linear-gradient(135deg,#030308,#0d0220)"></div>
          <div class="layout-label">None</div>
        </div>
        <div class="layout-card" id="bgfx-aurora" onclick="setBgEffect('aurora',this)">
          <div class="layout-preview" style="background:linear-gradient(135deg,rgba(168,85,247,.3),rgba(34,211,238,.2),rgba(16,185,129,.15))"></div>
          <div class="layout-label">🌌 Aurora</div>
        </div>
        <div class="layout-card" id="bgfx-plasma" onclick="setBgEffect('plasma',this)">
          <div class="layout-preview" style="background:linear-gradient(135deg,rgba(244,63,94,.2),rgba(168,85,247,.3),rgba(34,211,238,.2))"></div>
          <div class="layout-label">⚡ Plasma</div>
        </div>
        <div class="layout-card" id="bgfx-mesh" onclick="setBgEffect('mesh',this)">
          <div class="layout-preview" style="background:radial-gradient(circle at 30% 50%,rgba(168,85,247,.3),transparent 60%),radial-gradient(circle at 70% 50%,rgba(34,211,238,.2),transparent 60%)"></div>
          <div class="layout-label">🌈 Gradient Mesh</div>
        </div>
      </div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleSpotlight()"><div class="tog-sw" id="togSpotlight"></div><span class="tog-label">🔦 Spotlight cursor effect</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('scanlines','togScanlines')"><div class="tog-sw" id="togScanlines"></div><span class="tog-label">📺 CRT scanlines overlay</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('neonScanline','togNeonScan')"><div class="tog-sw" id="togNeonScan"></div><span class="tog-label">⚡ Neon scanline sweep</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Cursor Effect</div>
      <select id="iCursorFx" onchange="syncCursorFx()">
        <option value="dot">● Glowing dot (default)</option>
        <option value="ring">○ Ring</option>
        <option value="cross">✛ Crosshair</option>
        <option value="glow">✦ Soft glow</option>
        <option value="spotlight">🔦 Spotlight (follows mouse)</option>
        <option value="none">Hidden</option>
      </select>
    </div>
  </div>

  <!-- CARD SKIN -->
  <div class="panel" id="s-cardskin">
    <div class="ph">🎨 Card Skin <span class="ph-sub">appearance &amp; layout</span></div>
    <div class="prow">
      <div class="plabel">Card Style</div>
      <div class="layout-grid">
        <div class="layout-card sel" id="skin-default" onclick="setCardSkin('',this)">
          <div class="layout-preview" style="background:rgba(15,15,26,.92);border:1px solid rgba(168,85,247,.2)"></div>
          <div class="layout-label">Default</div>
        </div>
        <div class="layout-card" id="skin-frosted" onclick="setCardSkin('frosted',this)">
          <div class="layout-preview" style="background:rgba(255,255,255,.06);backdrop-filter:blur(20px)"></div>
          <div class="layout-label">🧊 Frosted Glass</div>
        </div>
        <div class="layout-card" id="skin-solid" onclick="setCardSkin('solid',this)">
          <div class="layout-preview" style="background:#0d0d1a"></div>
          <div class="layout-label">◼ Solid Dark</div>
        </div>
        <div class="layout-card" id="skin-neon" onclick="setCardSkin('neon',this)">
          <div class="layout-preview" style="background:rgba(15,15,26,.92);border:1px solid #a855f7;box-shadow:0 0 15px rgba(168,85,247,.3)"></div>
          <div class="layout-label">🌟 Neon Border</div>
        </div>
        <div class="layout-card" id="skin-terminal" onclick="setCardSkin('terminal',this)">
          <div class="layout-preview" style="background:#010d01;border:1px solid rgba(0,255,65,.15);font-family:monospace;font-size:.36rem;color:rgba(0,255,65,.4);display:flex;align-items:center;justify-content:center">&gt; _</div>
          <div class="layout-label">▪ Terminal</div>
        </div>
        <div class="layout-card" id="skin-paper" onclick="setCardSkin('paper',this)">
          <div class="layout-preview" style="background:linear-gradient(160deg,#f7f3ea,#ede8d8);border:1px solid rgba(0,0,0,.1)"></div>
          <div class="layout-label">📄 Paper</div>
        </div>
        <div class="layout-card" id="skin-chalk" onclick="setCardSkin('chalk',this)">
          <div class="layout-preview" style="background:#1c1e2e;border:2px solid rgba(255,255,255,.65);border-radius:3px"></div>
          <div class="layout-label">🖊 Chalk</div>
        </div>
        <div class="layout-card" id="skin-brutal" onclick="setCardSkin('brutal',this)">
          <div class="layout-preview" style="background:#0a0a0a;border:2px solid #fff;border-radius:0"></div>
          <div class="layout-label">⬛ Brutal</div>
        </div>
        <div class="layout-card" id="skin-grain" onclick="setCardSkin('grain',this)">
          <div class="layout-preview" style="background:rgba(12,12,20,.96);opacity:.9;background-image:url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Cfilter id=%22n%22%3E%3CfeTurbulence type=%22fractalNoise%22 baseFrequency=%220.75%22/%3E%3C/filter%3E%3Crect width=%22100%25%22 height=%22100%25%22 filter=%22url(%23n)%22 opacity=%220.07%22/%3E%3C/svg%3E');background-size:100px 100px"></div>
          <div class="layout-label">▒ Film Grain</div>
        </div>
        <div class="layout-card" id="skin-ink" onclick="setCardSkin('ink',this)">
          <div class="layout-preview" style="background:#060606;border:1px solid rgba(255,255,255,.04)"></div>
          <div class="layout-label">✒ Pure Ink</div>
        </div>
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Card Layout</div>
      <select id="iCardLayout" onchange="syncCardLayout()">
        <option value="">Standard (with banner)</option>
        <option value="modern">Modern (no banner, centered)</option>
        <option value="wide">Wide (600px max)</option>
      </select>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleMonoIcons()"><div class="tog-sw" id="togMonoIcons"></div><span class="tog-label">◐ Monochrome icons (greyscale)</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('animTitle','togAnimTitle')"><div class="tog-sw" id="togAnimTitle"></div><span class="tog-label">✨ Animated browser tab title</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('showViewsBadge','togViewsBadge')"><div class="tog-sw on" id="togViewsBadge"></div><span class="tog-label">👁 Show view count on banner</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('showVolume','togVolume')"><div class="tog-sw" id="togVolume"></div><span class="tog-label">🔊 Show volume control on player</span></div>
    </div>
  </div>

  <!-- BANNER STYLE -->
  <div class="panel" id="s-banner-style">
    <div class="ph">▬ Banner Style</div>
    <div class="prow">
      <div class="plabel">Banner Height <span id="bannerHVal">148px</span></div>
      <input type="range" min="60" max="280" value="148" id="iBannerH" oninput="syncBannerH()">
    </div>
    <div class="prow">
      <div class="plabel">Banner Fill</div>
      <div class="opt-grid c2">
        <div class="opt on" id="bfill-stars" onclick="setBannerFill('stars',this)"><div class="opt-prev" style="font-size:.6rem;opacity:.5">✦ · ★</div>Stars (default)</div>
        <div class="opt" id="bfill-solid" onclick="setBannerFill('solid',this)"><div class="opt-prev" style="background:var(--acc-dim)"></div>Solid Color</div>
        <div class="opt" id="bfill-gradient" onclick="setBannerFill('gradient',this)"><div class="opt-prev" style="background:linear-gradient(120deg,rgba(192,132,252,.35),rgba(56,189,248,.2))"></div>Gradient</div>
        <div class="opt" id="bfill-mesh" onclick="setBannerFill('mesh',this)"><div class="opt-prev" style="background:radial-gradient(circle at 25% 50%,rgba(192,132,252,.3),transparent 50%),radial-gradient(circle at 75% 50%,rgba(56,189,248,.25),transparent 50%)"></div>Mesh</div>
        <div class="opt" id="bfill-noise" onclick="setBannerFill('noise',this)"><div class="opt-prev" style="font-size:.55rem;opacity:.4;letter-spacing:.04em">▒▒▒</div>Noise</div>
        <div class="opt" id="bfill-none" onclick="setBannerFill('none',this)"><div class="opt-prev" style="font-size:.55rem;opacity:.3">—</div>No Banner</div>
      </div>
    </div>
    <div class="prow" id="bannerColorRow">
      <div class="plabel">Banner Color</div>
      <div class="crow">
        <input type="text" id="iBannerColor" value="#0d0220" oninput="syncBannerColor()" style="font-family:var(--mono)">
        <input type="color" id="iBannerColorPick" value="#0d0220" oninput="document.getElementById('iBannerColor').value=this.value;syncBannerColor()">
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Banner Overlay Text <span>optional</span></div>
      <input type="text" id="iBannerText" placeholder="e.g. ★ your slogan here ★" oninput="syncBannerText()" maxlength="60">
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleBannerTicker()"><div class="tog-sw" id="togBannerTicker"></div><span class="tog-label">▸ Scrolling ticker strip</span></div>
      <input type="text" id="iBannerTicker" placeholder="scrolling text..." oninput="syncBannerTicker()" maxlength="120" style="margin-top:7px">
    </div>
    <div class="prow">
      <div class="plabel">Banner Particle Density <span id="bannerParticleVal">normal</span></div>
      <select id="iBannerParticle" onchange="syncBannerParticle()">
        <option value="sparse">Sparse</option>
        <option value="normal" selected>Normal</option>
        <option value="dense">Dense</option>
        <option value="storm">Storm</option>
      </select>
    </div>
  </div>

  <!-- TYPE SCALE -->
  <div class="panel" id="s-type-scale">
    <div class="ph">Aa Type Scale</div>
    <div class="prow">
      <div class="plabel">Name Size <span id="nameSzVal">1.3rem</span></div>
      <input type="range" min="0.9" max="2.6" step="0.05" value="1.3" id="iNameSz" oninput="syncNameSz()">
    </div>
    <div class="prow">
      <div class="plabel">Name Weight</div>
      <div class="opt-grid c3">
        <div class="opt" id="nw-400" onclick="setNameWeight('400',this)">Regular</div>
        <div class="opt" id="nw-600" onclick="setNameWeight('600',this)">Semi</div>
        <div class="opt" id="nw-700" onclick="setNameWeight('700',this)">Bold</div>
        <div class="opt on" id="nw-800" onclick="setNameWeight('800',this)">XBold</div>
        <div class="opt" id="nw-900" onclick="setNameWeight('900',this)">Black</div>
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Name Letter Spacing</div>
      <div class="opt-grid c3">
        <div class="opt" id="ls-xtight" onclick="setNameSpacing('-0.06em',this)">X-Tight</div>
        <div class="opt on" id="ls-tight" onclick="setNameSpacing('-0.025em',this)">Tight</div>
        <div class="opt" id="ls-normal" onclick="setNameSpacing('0',this)">Normal</div>
        <div class="opt" id="ls-wide" onclick="setNameSpacing('0.06em',this)">Wide</div>
        <div class="opt" id="ls-xwide" onclick="setNameSpacing('0.14em',this)">X-Wide</div>
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Name Case</div>
      <div class="opt-grid c3">
        <div class="opt on" id="nc-none" onclick="setNameCase('none',this)">Normal</div>
        <div class="opt" id="nc-upper" onclick="setNameCase('uppercase',this)">UPPER</div>
        <div class="opt" id="nc-lower" onclick="setNameCase('lowercase',this)">lower</div>
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Bio Size <span id="bioSzVal">0.9rem</span></div>
      <input type="range" min="0.65" max="1.2" step="0.02" value="0.9" id="iBioSz" oninput="syncBioSz()">
    </div>
    <div class="prow">
      <div class="plabel">Bio Alignment</div>
      <div class="opt-grid c3">
        <div class="opt" id="ba-left" onclick="setBioAlign('left',this)">← Left</div>
        <div class="opt on" id="ba-center" onclick="setBioAlign('center',this)">· Center</div>
        <div class="opt" id="ba-right" onclick="setBioAlign('right',this)">Right →</div>
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Tag Size <span id="tagSzVal">0.72rem</span></div>
      <input type="range" min="0.5" max="1.0" step="0.02" value="0.72" id="iTagSz" oninput="syncTagSz()">
    </div>
    <div class="prow">
      <div class="plabel">Social Icon Size <span id="socIconSzVal">38px</span></div>
      <input type="range" min="24" max="60" value="38" id="iSocIconSz" oninput="syncSocIconSz()">
    </div>
  </div>

  <!-- LINK BUTTON STYLE -->
  <div class="panel" id="s-link-style">
    <div class="ph">◇ Link Buttons</div>
    <div class="prow">
      <div class="plabel">Button Shape</div>
      <div class="opt-grid c3">
        <div class="opt on" id="lbs-pill" onclick="setLinkBtnShape('pill',this)"><div class="opt-prev" style="background:rgba(255,255,255,.06);border-radius:100px;margin:2px 10px;height:14px"></div>Pill</div>
        <div class="opt" id="lbs-rounded" onclick="setLinkBtnShape('rounded',this)"><div class="opt-prev" style="background:rgba(255,255,255,.06);border-radius:8px;margin:2px 8px;height:14px"></div>Rounded</div>
        <div class="opt" id="lbs-sharp" onclick="setLinkBtnShape('sharp',this)"><div class="opt-prev" style="background:rgba(255,255,255,.06);border-radius:2px;margin:2px 8px;height:14px"></div>Sharp</div>
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Button Fill</div>
      <div class="opt-grid c2">
        <div class="opt on" id="lbf-ghost" onclick="setLinkBtnFill('ghost',this)"><div class="opt-prev" style="border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.03);font-size:.46rem;color:rgba(255,255,255,.25)">ghost</div>Ghost</div>
        <div class="opt" id="lbf-accent" onclick="setLinkBtnFill('accent',this)"><div class="opt-prev" style="background:rgba(192,132,252,.14);border:1px solid rgba(192,132,252,.28);font-size:.46rem;color:rgba(192,132,252,.7)">accent</div>Accent</div>
        <div class="opt" id="lbf-solid" onclick="setLinkBtnFill('solid',this)"><div class="opt-prev" style="background:rgba(255,255,255,.08);font-size:.46rem;color:rgba(255,255,255,.4)">solid</div>Solid</div>
        <div class="opt" id="lbf-outline" onclick="setLinkBtnFill('outline',this)"><div class="opt-prev" style="border:1.5px solid rgba(255,255,255,.3);background:transparent;font-size:.46rem;color:rgba(255,255,255,.4)">outline</div>Outline</div>
      </div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleLinkArrow()"><div class="tog-sw on" id="togLinkArrow"></div><span class="tog-label">→ Show arrow / chevron</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleLinkIcons()"><div class="tog-sw on" id="togLinkIcons"></div><span class="tog-label">🖼 Show favicons</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Hover Effect</div>
      <select id="iLinkHover" onchange="syncLinkHover()">
        <option value="lift" selected>↑ Lift</option>
        <option value="glow">✦ Glow</option>
        <option value="fill">█ Fill slide</option>
        <option value="border">□ Border trace</option>
        <option value="none">None</option>
      </select>
    </div>
    <div class="prow">
      <div class="plabel">Custom Button Color <span>leave blank for accent</span></div>
      <div class="crow">
        <input type="text" id="iLinkBtnClr" placeholder="inherit" oninput="syncLinkBtnClr()" style="font-family:var(--mono)">
        <input type="color" id="iLinkBtnClrPick" value="#c084fc" oninput="document.getElementById('iLinkBtnClr').value=this.value;syncLinkBtnClr()">
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Button Height <span id="lbhVal">38px</span></div>
      <input type="range" min="28" max="58" value="38" id="iLinkBtnH" oninput="syncLinkBtnH()">
    </div>
  </div>

  <!-- BG PATTERN -->
  <div class="panel" id="s-bg-pattern">
    <div class="ph">▣ BG Pattern</div>
    <div class="prow">
      <div class="plabel">Pattern</div>
      <div class="opt-grid c2">
        <div class="opt on" id="pat-none" onclick="setBgPattern('none',this)"><div class="opt-prev">—</div>None</div>
        <div class="opt" id="pat-dots" onclick="setBgPattern('dots',this)"><div class="opt-prev" style="background-image:radial-gradient(rgba(255,255,255,.2) 1px,transparent 1px);background-size:12px 12px">·&nbsp;·&nbsp;·</div>Dots</div>
        <div class="opt" id="pat-grid" onclick="setBgPattern('grid',this)"><div class="opt-prev" style="background-image:linear-gradient(rgba(255,255,255,.08) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.08) 1px,transparent 1px);background-size:14px 14px">+</div>Grid</div>
        <div class="opt" id="pat-hlines" onclick="setBgPattern('hlines',this)"><div class="opt-prev" style="background:repeating-linear-gradient(0deg,transparent,transparent 9px,rgba(255,255,255,.06) 9px,rgba(255,255,255,.06) 10px)">≡</div>H Lines</div>
        <div class="opt" id="pat-diagonal" onclick="setBgPattern('diagonal',this)"><div class="opt-prev" style="background:repeating-linear-gradient(45deg,transparent,transparent 7px,rgba(255,255,255,.05) 7px,rgba(255,255,255,.05) 8px)">▨</div>Diagonal</div>
        <div class="opt" id="pat-grain" onclick="setBgPattern('grain',this)"><div class="opt-prev" style="font-size:.6rem;opacity:.5">▒▒</div>Film Grain</div>
        <div class="opt" id="pat-hex" onclick="setBgPattern('hex',this)"><div class="opt-prev" style="font-size:.6rem;opacity:.4">⬡⬡</div>Hexagons</div>
        <div class="opt" id="pat-cross" onclick="setBgPattern('cross',this)"><div class="opt-prev" style="background-image:linear-gradient(rgba(255,255,255,.05) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.05) 1px,transparent 1px),radial-gradient(rgba(255,255,255,.08) 1px,transparent 1px);background-size:20px 20px,20px 20px,20px 20px;background-position:0 0,0 0,10px 10px">✦</div>Cross+Dot</div>
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Opacity <span id="bgPatOpVal">25%</span></div>
      <input type="range" min="3" max="100" value="25" id="iBgPatOp" oninput="syncBgPatOp()">
    </div>
    <div class="prow">
      <div class="plabel">Scale <span id="bgPatScaleVal">1×</span></div>
      <input type="range" min="0.3" max="5" step="0.1" value="1" id="iBgPatScale" oninput="syncBgPatScale()">
    </div>
    <div class="prow">
      <div class="plabel">Color</div>
      <div class="crow">
        <input type="text" id="iBgPatColor" value="#ffffff" oninput="syncBgPatColor()" style="font-family:var(--mono)">
        <input type="color" id="iBgPatColorPick" value="#ffffff" oninput="document.getElementById('iBgPatColor').value=this.value;syncBgPatColor()">
      </div>
    </div>
  </div>

  <!-- GITHUB -->
  <div class="panel" id="s-github">
    <div class="ph">💻 GitHub <span class="ph-sub">contribution graph</span></div>
    <div class="prow">
      <div class="plabel">GitHub Username</div>
      <div style="display:flex;gap:7px">
        <input type="text" id="iGithubUser2" placeholder="e.g. torvalds" oninput="syncGithubUser()" style="flex:1;font-family:'Space Mono',monospace;font-size:.78rem;">
        <button class="tbtn acc sm" onclick="previewGitHub()">Preview</button>
      </div>
      <div style="margin-top:5px;font-size:.64rem;color:var(--mut)">Shows a contribution heatmap calendar with your public GitHub stats.</div>
    </div>
    <div id="githubPreviewBox" style="display:none;margin-top:8px">
      <div style="background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.07);border-radius:10px;padding:12px">
        <div style="font-size:.72rem;color:var(--mut);margin-bottom:6px">Preview:</div>
        <div id="ghPreviewContrib" style="display:flex;gap:2px;overflow:hidden;flex-wrap:wrap"></div>
        <div id="ghPreviewStats" style="margin-top:8px;font-size:.66rem;color:var(--mut)"></div>
      </div>
    </div>
    <div class="prow" style="margin-top:8px">
      <div class="pnote">
        <strong style="color:#e2e8f0">GitHub widget requires public repos.</strong> The graph shows your contribution history using the public GitHub contributions API.
      </div>
    </div>
  </div>

  <!-- SOCIAL LINKS -->
  <div class="panel" id="s-links">
    <div class="ph">🔗 Social Links</div>
    <div class="prow">
      <div style="font-size:.72rem;color:var(--mut);margin-bottom:8px">Add your socials. Drag to reorder (coming soon).</div>
      <div class="link-list" id="linkList"></div>
      <button class="upload-btn" onclick="showAddLink()" style="border-style:solid;margin-bottom:8px">＋ Add Link</button>
      <div class="add-link-form" id="addLinkForm">
        <div class="plabel">Label</div>
        <input type="text" id="alLabel" placeholder="Discord, Twitter, GitHub...">
        <div class="plabel">URL</div>
        <input type="url" id="alUrl" placeholder="https://">
        <div class="al-row">
          <button class="tbtn acc" onclick="addLink()">Add</button>
          <button class="tbtn ghost" onclick="hideAddLink()">Cancel</button>
        </div>
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Quick Add</div>
      <div style="display:flex;gap:5px;flex-wrap:wrap;">
        <button class="tbtn ghost sm" onclick="quickAdd('Twitter','https://twitter.com/')">𝕏</button>
        <button class="tbtn ghost sm" onclick="quickAdd('Discord','https://discord.gg/')">Discord</button>
        <button class="tbtn ghost sm" onclick="quickAdd('GitHub','https://github.com/')">GitHub</button>
        <button class="tbtn ghost sm" onclick="quickAdd('Instagram','https://instagram.com/')">Insta</button>
        <button class="tbtn ghost sm" onclick="quickAdd('TikTok','https://tiktok.com/@')">TikTok</button>
        <button class="tbtn ghost sm" onclick="quickAdd('YouTube','https://youtube.com/')">YT</button>
        <button class="tbtn ghost sm" onclick="quickAdd('Twitch','https://twitch.tv/')">Twitch</button>
        <button class="tbtn ghost sm" onclick="quickAdd('Steam','https://store.steampowered.com/')">Steam</button>
      </div>
    </div>
  </div>

  <!-- THEMES -->
  <div class="panel" id="s-themes">
    <div class="ph">⬡ Profile Themes <span class="ph-sub">one click style</span></div>
    <div class="prow">
      <!-- JS PRESETS HERO -->
      <div style="margin-bottom:14px">
        <div style="font-size:.6rem;font-weight:700;text-transform:uppercase;letter-spacing:.12em;color:rgba(255,255,255,.2);margin-bottom:10px;display:flex;align-items:center;gap:6px">
          <div style="flex:1;height:1px;background:rgba(255,255,255,.05)"></div>
          JS Presets — 1-click complete looks
          <div style="flex:1;height:1px;background:rgba(255,255,255,.05)"></div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px">

          <!-- KORAZ JS PRESET -->
          <div onclick="applyKorazPreset()" style="cursor:pointer;border-radius:12px;overflow:hidden;border:1px solid rgba(168,85,247,.3);transition:all .18s;background:rgba(5,3,12,.8);position:relative" onmouseover="this.style.borderColor='rgba(168,85,247,.7)';this.style.transform='translateY(-2px)';this.style.boxShadow='0 8px 24px rgba(168,85,247,.25)'" onmouseout="this.style.borderColor='rgba(168,85,247,.3)';this.style.transform='';this.style.boxShadow=''">
            <div style="position:absolute;top:7px;right:8px;font-size:.48rem;background:rgba(168,85,247,.8);color:#fff;padding:2px 6px;border-radius:3px;font-weight:800;letter-spacing:.06em;text-transform:uppercase">featured</div>
            <div style="height:70px;background:linear-gradient(135deg,#04040a,#080812);position:relative;overflow:hidden">
              <div style="position:absolute;inset:0;background:radial-gradient(ellipse at 70% 30%,rgba(168,85,247,.2),transparent 60%)"></div>
              <div style="position:absolute;inset:0;opacity:.35;background:repeating-linear-gradient(0deg,rgba(168,85,247,.04) 0,transparent 2px,transparent 6px),repeating-linear-gradient(90deg,rgba(168,85,247,.03) 0,transparent 2px,transparent 6px)"></div>
              <div style="position:absolute;bottom:10px;left:10px">
                <div style="width:30px;height:30px;border-radius:50%;background:linear-gradient(135deg,rgba(168,85,247,.4),rgba(34,211,238,.2));border:1.5px solid rgba(168,85,247,.5);display:flex;align-items:center;justify-content:center;font-size:.8rem;box-shadow:0 0 10px rgba(168,85,247,.4)">🐱</div>
              </div>
              <div style="position:absolute;bottom:14px;left:48px">
                <div style="font-size:.65rem;font-weight:800;background:linear-gradient(135deg,#fff,#a855f7,#22d3ee);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;font-family:'Syne',sans-serif">Koraz</div>
                <div style="font-size:.44rem;color:rgba(168,85,247,.5);margin-top:1px">Unity Dev · Developer @ LAR</div>
              </div>
            </div>
            <div style="padding:8px 10px">
              <div style="font-size:.7rem;font-weight:700;color:#c084fc;margin-bottom:2px">KORAZ PRESET</div>
              <div style="font-size:.58rem;color:rgba(255,255,255,.3);line-height:1.5">Purple glass · particles · shimmer name · icon links · glow border</div>
            </div>
          </div>

          <!-- JOE JS PRESET -->
          <div onclick="applyJoePreset()" style="cursor:pointer;border-radius:12px;overflow:hidden;border:1px solid rgba(88,101,242,.3);transition:all .18s;background:rgba(3,3,14,.8);position:relative" onmouseover="this.style.borderColor='rgba(88,101,242,.7)';this.style.transform='translateY(-2px)';this.style.boxShadow='0 8px 24px rgba(88,101,242,.25)'" onmouseout="this.style.borderColor='rgba(88,101,242,.3)';this.style.transform='';this.style.boxShadow=''">
            <div style="height:70px;background:linear-gradient(135deg,#04040e,#0a0a18);position:relative;overflow:hidden">
              <div style="position:absolute;inset:0;background:repeating-linear-gradient(0deg,rgba(255,255,255,.018) 0,transparent 2px,transparent 4px)"></div>
              <div style="position:absolute;bottom:10px;left:10px">
                <div style="width:30px;height:30px;border-radius:50%;background:conic-gradient(#f43f5e,#f97316,#eab308,#22c55e,#06b6d4,#a855f7,#f43f5e);padding:2px;display:flex;align-items:center;justify-content:center;box-shadow:0 0 10px rgba(168,85,247,.5)">
                  <div style="width:24px;height:24px;border-radius:50%;background:#0a0a18;display:flex;align-items:center;justify-content:center;font-size:.55rem;font-weight:800;color:#fff;font-family:'Space Mono',monospace">&lt;J&gt;</div>
                </div>
              </div>
              <div style="position:absolute;bottom:14px;left:48px">
                <div style="font-size:.65rem;font-weight:800;color:#fff;font-family:'Syne',sans-serif">Joe</div>
                <div style="font-size:.44rem;color:rgba(255,255,255,.35);margin-top:1px">200K Installs · rainbow border</div>
              </div>
              <div style="position:absolute;top:7px;right:8px;display:flex;gap:3px">
                <div style="width:5px;height:5px;border-radius:50%;background:#f43f5e"></div>
                <div style="width:5px;height:5px;border-radius:50%;background:#22c55e"></div>
                <div style="width:5px;height:5px;border-radius:50%;background:#06b6d4"></div>
              </div>
            </div>
            <div style="padding:8px 10px">
              <div style="font-size:.7rem;font-weight:700;color:#8b9df7;margin-bottom:2px">JOE PRESET</div>
              <div style="font-size:.58rem;color:rgba(255,255,255,.3);line-height:1.5">Rainbow border · frosted glass · Syne font · Discord widget</div>
            </div>
          </div>

        </div>
      </div>

      <div class="theme-gallery" id="themeGallery">

        <!-- KORAZ (guns.lol/koraz exact) -->
        <div class="theme-card" id="theme-koraz" onclick="applyProfileTheme('koraz')" style="grid-column:span 2">
          <div class="theme-preview" style="background:linear-gradient(135deg,#08080f,#0f0f1a);height:72px;">
            <div style="position:absolute;inset:0;background:radial-gradient(ellipse at 70% 30%,rgba(168,85,247,.2),transparent 60%)"></div>
            <div style="position:absolute;top:0;right:0;left:0;height:100%;overflow:hidden;opacity:.3">
              <canvas id="korazMiniCanvas" width="280" height="72" style="width:100%;height:100%"></canvas>
            </div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,rgba(168,85,247,.5),rgba(34,211,238,.3));border-color:rgba(168,85,247,.6);box-shadow:0 0 10px rgba(168,85,247,.4)"></div>
            <div class="theme-preview-name" style="background:linear-gradient(135deg,#fff,#a855f7,#22d3ee);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;font-family:'Syne',sans-serif;">koraz</div>
            <div class="theme-preview-status" style="color:rgba(168,85,247,.6)">★ guns.lol/koraz aesthetic</div>
          </div>
          <div class="theme-label" style="background:rgba(168,85,247,.07)">
            <span class="theme-name" style="color:#c084fc">KORAZ</span>
            <span class="theme-tag" style="background:rgba(168,85,247,.12);color:#a855f7">featured</span>
          </div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- DARK DEV (guns.lol style) -->
        <div class="theme-card" id="theme-darkdev" onclick="applyProfileTheme('darkdev')">
          <div class="theme-preview" style="background:#080808;border-bottom:1px solid rgba(255,255,255,.06)">
            <div style="position:absolute;inset:0;background:radial-gradient(ellipse at 50% -20%,rgba(255,255,255,.04),transparent 70%)"></div>
            <div style="position:absolute;top:8px;right:8px;font-size:.42rem;color:rgba(255,255,255,.2);font-family:'Space Mono',monospace;letter-spacing:.06em">DEV</div>
            <div class="theme-preview-av" style="background:#1a1a1a;border:1.5px solid rgba(255,255,255,.15);"></div>
            <div class="theme-preview-name" style="color:rgba(255,255,255,.9);font-weight:700;">z3n0</div>
            <div class="theme-preview-status" style="color:rgba(255,255,255,.3);font-size:.42rem;">full stack dev</div>
          </div>
          <div class="theme-label">
            <span class="theme-name">DARK DEV</span>
            <span class="theme-tag">minimal</span>
          </div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- DEV / HACKER -->
        <div class="theme-card" id="theme-dev" onclick="applyProfileTheme('dev')">
          <div class="theme-preview" style="background:linear-gradient(135deg,#050810,#0a0f1a,#0d1526)">
            <div style="position:absolute;inset:0;background:repeating-linear-gradient(0deg,rgba(0,255,65,.03) 0px,transparent 2px,transparent 4px);"></div>
            <div style="position:absolute;top:6px;left:0;right:0;text-align:center;font-family:'Space Mono',monospace;font-size:.45rem;color:rgba(0,255,65,.5);">&gt; init_profile.exe</div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#00ff41,#00b4d8);"></div>
            <div class="theme-preview-name" style="color:#00ff41;font-family:'Space Mono',monospace;">dev@void</div>
            <div class="theme-preview-status" style="color:rgba(0,255,65,.4);">● ONLINE</div>
          </div>
          <div class="theme-label">
            <span class="theme-name">HACKER</span>
            <span class="theme-tag">terminal</span>
          </div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- VOID -->
        <div class="theme-card" id="theme-void" onclick="applyProfileTheme('void')">
          <div class="theme-preview" style="background:#000;border-bottom:1px solid rgba(124,58,237,.2)">
            <div style="position:absolute;top:8px;right:8px;width:4px;height:4px;background:#7c3aed;border-radius:50%;box-shadow:0 0 8px #7c3aed"></div>
            <div style="position:absolute;top:14px;right:20px;width:2px;height:2px;background:#06b6d4;border-radius:50%"></div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#7c3aed,#4c1d95);border-color:rgba(124,58,237,.5)"></div>
            <div class="theme-preview-name" style="background:linear-gradient(90deg,#a78bfa,#7c3aed);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">void</div>
          </div>
          <div class="theme-label">
            <span class="theme-name">VOID PURPLE</span>
            <span class="theme-tag">dark</span>
          </div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- BLOOD -->
        <div class="theme-card" id="theme-blood" onclick="applyProfileTheme('blood')">
          <div class="theme-preview" style="background:linear-gradient(180deg,#0d0005,#1a0009)">
            <div style="position:absolute;inset:0;background:radial-gradient(ellipse at 50% 0%,rgba(244,63,94,.12),transparent 70%)"></div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#f43f5e,#9f1239);border-color:rgba(244,63,94,.5)"></div>
            <div class="theme-preview-name" style="color:#f43f5e;">blood</div>
          </div>
          <div class="theme-label">
            <span class="theme-name">BLOOD MOON</span>
            <span class="theme-tag">red</span>
          </div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- ICE -->
        <div class="theme-card" id="theme-ice" onclick="applyProfileTheme('ice')">
          <div class="theme-preview" style="background:linear-gradient(135deg,#00070f,#001428,#002244)">
            <div style="position:absolute;inset:0;background:radial-gradient(ellipse at 80% 20%,rgba(0,212,255,.1),transparent 60%)"></div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#00d4ff,#0066cc);border-color:rgba(0,212,255,.5)"></div>
            <div class="theme-preview-name" style="color:#00d4ff;">arctic</div>
          </div>
          <div class="theme-label">
            <span class="theme-name">ARCTIC ICE</span>
            <span class="theme-tag">blue</span>
          </div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- GOLD -->
        <div class="theme-card" id="theme-gold" onclick="applyProfileTheme('gold')">
          <div class="theme-preview" style="background:linear-gradient(135deg,#0d0900,#1a1000,#2d1d00)">
            <div style="position:absolute;inset:0;background:radial-gradient(ellipse at 30% 70%,rgba(201,151,28,.1),transparent 60%)"></div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#f59e0b,#d97706);border-color:rgba(245,158,11,.5)"></div>
            <div class="theme-preview-name" style="color:#f59e0b;">gold</div>
          </div>
          <div class="theme-label">
            <span class="theme-name">GOLD RUSH</span>
            <span class="theme-tag">luxury</span>
          </div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- SAKURA -->
        <div class="theme-card" id="theme-sakura" onclick="applyProfileTheme('sakura')">
          <div class="theme-preview" style="background:linear-gradient(135deg,#0f0009,#1a000d,#2d0018)">
            <div style="position:absolute;inset:0;background:radial-gradient(ellipse at 50% 50%,rgba(255,105,180,.1),transparent 70%)"></div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#ff69b4,#c2185b);border-color:rgba(255,105,180,.5)"></div>
            <div class="theme-preview-name" style="color:#ff69b4;">sakura</div>
          </div>
          <div class="theme-label">
            <span class="theme-name">SAKURA NIGHT</span>
            <span class="theme-tag">pink</span>
          </div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- MATRIX -->
        <div class="theme-card" id="theme-matrix" onclick="applyProfileTheme('matrix')">
          <div class="theme-preview" style="background:#000">
            <div style="position:absolute;inset:0;background:repeating-linear-gradient(90deg,rgba(0,255,0,.03) 0px,transparent 1px,transparent 8px)"></div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#00ff00,#00aa00);border-color:rgba(0,255,0,.5)"></div>
            <div class="theme-preview-name" style="color:#00ff00;font-family:'Space Mono',monospace;">neo</div>
          </div>
          <div class="theme-label">
            <span class="theme-name">MATRIX</span>
            <span class="theme-tag">green</span>
          </div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- NEON -->
        <div class="theme-card" id="theme-neon" onclick="applyProfileTheme('neon')">
          <div class="theme-preview" style="background:linear-gradient(135deg,#000,#001122)">
            <div style="position:absolute;inset:0;background:radial-gradient(ellipse at 0% 100%,rgba(255,0,128,.1),transparent 50%),radial-gradient(ellipse at 100% 0%,rgba(0,255,255,.1),transparent 50%)"></div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#ff0080,#00ffff);border-color:rgba(255,0,128,.5)"></div>
            <div class="theme-preview-name" style="background:linear-gradient(90deg,#ff0080,#00ffff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">cyber</div>
          </div>
          <div class="theme-label">
            <span class="theme-name">NEON CITY</span>
            <span class="theme-tag">cyberpunk</span>
          </div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- VAPORWAVE -->
        <div class="theme-card" id="theme-vaporwave" onclick="applyProfileTheme('vaporwave')">
          <div class="theme-preview" style="background:linear-gradient(135deg,#1a0033,#0d1a33)">
            <div style="position:absolute;inset:0;background:repeating-linear-gradient(0deg,rgba(255,0,200,.05) 0px,transparent 2px,transparent 20px)"></div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#ff00cc,#3333ff);border-color:rgba(255,0,200,.5)"></div>
            <div class="theme-preview-name" style="color:#ff71ce;font-family:'Space Mono',monospace">ａｅｓ</div>
          </div>
          <div class="theme-label">
            <span class="theme-name">VAPORWAVE</span>
            <span class="theme-tag">retro</span>
          </div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- AURORA -->
        <div class="theme-card" id="theme-aurora" onclick="applyProfileTheme('aurora')">
          <div class="theme-preview" style="background:linear-gradient(135deg,#001a0d,#001533)">
            <div style="position:absolute;inset:0;background:radial-gradient(ellipse at 30% 60%,rgba(0,255,128,.12),transparent 60%),radial-gradient(ellipse at 70% 30%,rgba(0,200,255,.1),transparent 60%)"></div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#00ff80,#00ccff);border-color:rgba(0,255,128,.5)"></div>
            <div class="theme-preview-name" style="color:#00ff80;">sky</div>
          </div>
          <div class="theme-label">
            <span class="theme-name">AURORA</span>
            <span class="theme-tag">northern lights</span>
          </div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- BLOOD MOON -->
        <div class="theme-card" id="theme-blood" onclick="applyProfileTheme('blood')">
          <div class="theme-preview" style="background:linear-gradient(135deg,#0d0000,#1a0505)">
            <div style="position:absolute;inset:0;background:radial-gradient(ellipse at 80% 20%,rgba(180,0,0,.15),transparent 60%)"></div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#dc2626,#7f1d1d);border-color:rgba(220,38,38,.5)"></div>
            <div class="theme-preview-name" style="color:#ef4444;">dark</div>
          </div>
          <div class="theme-label">
            <span class="theme-name">BLOOD MOON</span>
            <span class="theme-tag">dark red</span>
          </div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- GOLD -->
        <div class="theme-card" id="theme-gold" onclick="applyProfileTheme('gold')">
          <div class="theme-preview" style="background:linear-gradient(135deg,#0d0800,#1a1000)">
            <div style="position:absolute;inset:0;background:radial-gradient(ellipse at 50% 50%,rgba(255,180,0,.1),transparent 70%)"></div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#fbbf24,#92400e);border-color:rgba(251,191,36,.5)"></div>
            <div class="theme-preview-name" style="color:#fbbf24;">luxe</div>
          </div>
          <div class="theme-label">
            <span class="theme-name">GOLD LUXE</span>
            <span class="theme-tag">luxury</span>
          </div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- ICE -->
        <div class="theme-card" id="theme-ice" onclick="applyProfileTheme('ice')">
          <div class="theme-preview" style="background:linear-gradient(135deg,#000d1a,#001a2e)">
            <div style="position:absolute;inset:0;background:radial-gradient(ellipse at 50% 50%,rgba(147,210,255,.08),transparent 70%)"></div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#93c5fd,#bfdbfe);border-color:rgba(147,197,253,.5)"></div>
            <div class="theme-preview-name" style="color:#bfdbfe;">ice</div>
          </div>
          <div class="theme-label">
            <span class="theme-name">ICE COLD</span>
            <span class="theme-tag">frost</span>
          </div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- VOID -->
        <div class="theme-card" id="theme-void" onclick="applyProfileTheme('void')">
          <div class="theme-preview" style="background:#000">
            <div style="position:absolute;inset:0;background:radial-gradient(ellipse at 50% 50%,rgba(80,0,180,.06),transparent 70%)"></div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#4b0082,#1a0033);border-color:rgba(75,0,130,.5)"></div>
            <div class="theme-preview-name" style="color:rgba(255,255,255,.3);">void</div>
          </div>
          <div class="theme-label">
            <span class="theme-name">THE VOID</span>
            <span class="theme-tag">minimal dark</span>
          </div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- SUNSET -->
        <div class="theme-card" id="theme-sunset" onclick="applyProfileTheme('sunset')">
          <div class="theme-preview" style="background:linear-gradient(180deg,#0d0010,#1a0820)">
            <div style="position:absolute;inset:0;background:linear-gradient(180deg,rgba(255,100,0,.08),rgba(255,0,100,.08))"></div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#f97316,#ec4899);border-color:rgba(249,115,22,.5)"></div>
            <div class="theme-preview-name" style="background:linear-gradient(90deg,#f97316,#ec4899);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">sun</div>
          </div>
          <div class="theme-label">
            <span class="theme-name">SUNSET</span>
            <span class="theme-tag">warm</span>
          </div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- Y2K CORE -->
        <div class="theme-card" id="theme-y2k" onclick="applyProfileTheme('y2k')">
          <div class="theme-preview" style="background:linear-gradient(135deg,#0a0012,#120020)">
            <div style="position:absolute;inset:0;background:radial-gradient(ellipse at 60% 30%,rgba(255,0,230,.1),transparent 55%)"></div>
            <div style="position:absolute;top:4px;right:6px;font-family:monospace;font-size:.36rem;color:rgba(255,100,220,.5);letter-spacing:.06em">Y2K</div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#ff00dc,#9900ff);border-color:rgba(255,0,220,.6)"></div>
            <div class="theme-preview-name" style="background:linear-gradient(90deg,#ff69d0,#bf00ff,#ff69d0);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-size:200%;animation:nameShimmer 2s linear infinite">xoxo</div>
            <div class="theme-preview-status" style="color:rgba(255,105,180,.45);font-size:.36rem">✦ 2k aesthetic ✦</div>
          </div>
          <div class="theme-label"><span class="theme-name">Y2K CORE</span><span class="theme-tag">bubblegum</span></div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- BRUTALIST -->
        <div class="theme-card" id="theme-brutalist" onclick="applyProfileTheme('brutalist')">
          <div class="theme-preview" style="background:#0c0c0c;border-bottom:2px solid #fff">
            <div style="position:absolute;top:4px;left:5px;font-family:monospace;font-size:.36rem;color:rgba(255,255,255,.4);letter-spacing:.1em">RAW.UNFILTERED</div>
            <div class="theme-preview-av" style="background:#fff;border-radius:0;border:2px solid #fff"></div>
            <div class="theme-preview-name" style="color:#fff;font-family:monospace;font-weight:800;letter-spacing:.1em;font-size:.48rem">BRUTAL</div>
          </div>
          <div class="theme-label"><span class="theme-name">BRUTALIST</span><span class="theme-tag">raw</span></div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- FOREST -->
        <div class="theme-card" id="theme-forest" onclick="applyProfileTheme('forest')">
          <div class="theme-preview" style="background:linear-gradient(180deg,#020d06,#061408)">
            <div style="position:absolute;inset:0;background:radial-gradient(ellipse at 50% 80%,rgba(34,197,94,.08),transparent 65%)"></div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#16a34a,#052e16);border-color:rgba(34,197,94,.45)"></div>
            <div class="theme-preview-name" style="color:#4ade80">deep</div>
            <div class="theme-preview-status" style="color:rgba(74,222,128,.4);font-size:.36rem">◉ alive</div>
          </div>
          <div class="theme-label"><span class="theme-name">FOREST</span><span class="theme-tag">organic</span></div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- SYNTHWAVE -->
        <div class="theme-card" id="theme-synthwave" onclick="applyProfileTheme('synthwave')">
          <div class="theme-preview" style="background:linear-gradient(180deg,#0a0014,#14002a)">
            <div style="position:absolute;bottom:0;left:0;right:0;height:38%;background:repeating-linear-gradient(90deg,transparent,transparent 8px,rgba(255,0,200,.06) 8px,rgba(255,0,200,.06) 9px)"></div>
            <div style="position:absolute;inset:0;background:radial-gradient(ellipse at 50% -15%,rgba(255,140,0,.14),transparent 55%)"></div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#ff6ec7,#ff3d00);border-color:rgba(255,110,199,.55)"></div>
            <div class="theme-preview-name" style="background:linear-gradient(90deg,#ff6ec7,#ff3d00);-webkit-background-clip:text;-webkit-text-fill-color:transparent">retro</div>
          </div>
          <div class="theme-label"><span class="theme-name">SYNTHWAVE</span><span class="theme-tag">retrowave</span></div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- OBSIDIAN -->
        <div class="theme-card" id="theme-obsidian" onclick="applyProfileTheme('obsidian')">
          <div class="theme-preview" style="background:#000">
            <div style="position:absolute;inset:0;background:repeating-linear-gradient(135deg,rgba(255,255,255,.007) 0px,rgba(255,255,255,.007) 1px,transparent 1px,transparent 16px)"></div>
            <div style="position:absolute;inset:0;background:radial-gradient(ellipse at 40% 40%,rgba(99,102,241,.05),transparent 55%)"></div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#312e81,#1e1b4b);border-color:rgba(99,102,241,.4)"></div>
            <div class="theme-preview-name" style="color:rgba(255,255,255,.65);letter-spacing:.1em;font-size:.42rem;font-family:monospace">OBSIDIAN</div>
          </div>
          <div class="theme-label"><span class="theme-name">OBSIDIAN</span><span class="theme-tag">refined dark</span></div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- RUST -->
        <div class="theme-card" id="theme-rust" onclick="applyProfileTheme('rust')">
          <div class="theme-preview" style="background:linear-gradient(135deg,#0d0600,#1a0a00)">
            <div style="position:absolute;inset:0;background:radial-gradient(ellipse at 30% 60%,rgba(180,80,10,.1),transparent 55%)"></div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#b45309,#78350f);border-color:rgba(180,83,9,.5)"></div>
            <div class="theme-preview-name" style="color:#fb923c">burn</div>
            <div class="theme-preview-status" style="color:rgba(251,146,60,.4);font-size:.36rem">◈ oxidized</div>
          </div>
          <div class="theme-label"><span class="theme-name">RUST</span><span class="theme-tag">burnt orange</span></div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

        <!-- CLEAN LIGHT -->
        <div class="theme-card" id="theme-light" onclick="applyProfileTheme('light')">
          <div class="theme-preview" style="background:#f0eeff;border-bottom:1px solid rgba(0,0,0,.06)">
            <div style="position:absolute;inset:0;background:radial-gradient(ellipse at 50% 50%,rgba(99,102,241,.08),transparent 70%)"></div>
            <div class="theme-preview-av" style="background:linear-gradient(135deg,#6366f1,#8b5cf6);border-color:rgba(99,102,241,.5)"></div>
            <div class="theme-preview-name" style="color:#1e1b4b;-webkit-text-fill-color:#1e1b4b;background:none">light</div>
            <div class="theme-preview-status" style="color:rgba(30,27,75,.35);font-size:.36rem">clean slate</div>
          </div>
          <div class="theme-label"><span class="theme-name">CLEAN LIGHT</span><span class="theme-tag">minimal</span></div>
          <div class="theme-apply-badge">ACTIVE</div>
        </div>

      </div>
    </div>
  </div>

  <!-- DISCORD -->
  <div class="panel" id="s-discord">
    <div class="ph">⬡ Discord <span class="ph-sub">oauth + server widget</span></div>

    <!-- OAuth Connect Card -->
    <div class="prow">
      <div class="dc-oauth-card" id="dcOAuthCard">
        <div class="dc-oauth-icon">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="#5865F2"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/></svg>
        </div>
        <div class="dc-oauth-text">
          <div class="dc-oauth-title" id="dcOAuthTitle">Link Discord Account</div>
          <div class="dc-oauth-sub" id="dcOAuthSub">Sync your real pfp, username &amp; status via OAuth</div>
        </div>
        <button class="dc-oauth-btn" id="dcOAuthBtn" onclick="initDiscordOAuth()">Connect</button>
      </div>
    </div>

    <!-- Connected live card — shows after OAuth -->
    <div id="dcLiveCard" style="display:none" class="prow">
      <div class="dc-live-card">
        <div class="dc-live-avatar-wrap">
          <img id="dcLiveAvatar" class="dc-live-avatar" src="" alt="">
          <div class="dc-live-status-dot" id="dcLiveStatusDot"></div>
        </div>
        <div class="dc-live-info">
          <div class="dc-live-name" id="dcLiveName">—</div>
          <div class="dc-live-tag" id="dcLiveTag"></div>
          <div class="dc-live-status" id="dcLiveStatusText">connected via OAuth</div>
        </div>
        <button class="tbtn ghost sm" onclick="disconnectDiscord()" style="flex-shrink:0;font-size:.6rem">Disconnect</button>
      </div>
    </div>

    <div class="prow">
      <div class="plabel">Display Username <span>shown on badge</span></div>
      <input type="text" id="iDiscordUser" placeholder="auto-fills after connecting" oninput="syncDiscordUser()" style="font-family:'Space Mono',monospace;font-size:.78rem;">
    </div>

    <div class="prow">
      <div class="plabel">User ID <span style="font-family:'Space Mono',monospace;font-size:.6rem;color:rgba(6,182,212,.6)">auto-fills from OAuth</span></div>
      <input type="text" id="iDiscordId" placeholder="auto-fills after connecting" oninput="syncDiscordId()" maxlength="20" style="font-family:'Space Mono',monospace;font-size:.78rem;">
      <div style="margin-top:5px;font-size:.6rem;color:var(--mut);font-family:'Space Mono',monospace;line-height:1.6">
        Or manually: Discord → Settings → Advanced → Developer Mode → Right-click yourself → Copy User ID
      </div>
    </div>

    <div class="prow">
      <div class="plabel">Status <span>shown on profile badge</span></div>
      <select id="iDiscordStatus" onchange="syncDiscordStatus()">
        <option value="online">● Online</option>
        <option value="idle">◑ Idle</option>
        <option value="dnd">○ Do Not Disturb</option>
        <option value="offline">◌ Offline</option>
      </select>
    </div>

    <div class="prow">
      <div class="plabel">Server Invite URL <span>for the badge link</span></div>
      <input type="url" id="iDiscordUrl" placeholder="https://discord.gg/yourserver" oninput="syncDiscordUrl()" style="font-family:'Space Mono',monospace;font-size:.76rem;">
    </div>

    <!-- SERVER WIDGET (guns.lol/joe style) -->
    <div style="margin:8px 16px 0;padding:11px 13px;background:rgba(88,101,242,.07);border:1px solid rgba(88,101,242,.2);border-radius:10px;">
      <div style="font-size:.62rem;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:#8b9df7;margin-bottom:10px;display:flex;align-items:center;gap:6px;">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="#5865f2"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/></svg>
        Server Widget
        <span style="font-size:.55rem;color:rgba(139,157,247,.5);font-weight:400;font-family:'Space Mono',monospace">// shows on profile like guns.lol/joe</span>
      </div>
      <div style="margin-bottom:8px">
        <div class="plabel">Server Name</div>
        <input type="text" id="iDiscordServerName" placeholder="My Server" oninput="syncDiscordServer()" style="font-family:'Space Mono',monospace;font-size:.76rem;">
      </div>
      <div style="margin-bottom:8px">
        <div class="plabel">Invite URL <span>green Join button</span></div>
        <input type="url" id="iDiscordServerInvite" placeholder="https://discord.gg/abc123" oninput="syncDiscordServer()" style="font-family:'Space Mono',monospace;font-size:.76rem;">
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-bottom:8px">
        <div>
          <div class="plabel">Guild ID <span>live member count</span></div>
          <input type="text" id="iDiscordServerId" placeholder="1234567890123456" oninput="syncDiscordServer()" maxlength="20" style="font-family:'Space Mono',monospace;font-size:.72rem;">
        </div>
        <div>
          <div class="plabel">Server Icon URL</div>
          <input type="url" id="iDiscordServerIcon" placeholder="https://cdn.discordapp.com/..." oninput="syncDiscordServer()" style="font-family:'Space Mono',monospace;font-size:.72rem;">
        </div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-bottom:4px">
        <div>
          <div class="plabel">Online Count <span>fallback</span></div>
          <input type="text" id="iDiscordOnline" placeholder="292" oninput="syncDiscordServer()" style="font-family:'Space Mono',monospace;font-size:.76rem;">
        </div>
        <div>
          <div class="plabel">Member Count</div>
          <input type="text" id="iDiscordMembers" placeholder="4,348" oninput="syncDiscordServer()" style="font-family:'Space Mono',monospace;font-size:.76rem;">
        </div>
      </div>
      <div style="font-size:.58rem;color:rgba(139,157,247,.4);font-family:'Space Mono',monospace;line-height:1.65;margin-top:4px">
        Live online count pulls from Discord widget API if Guild ID is set.<br>
        Requires: Server Settings → Enable Community → Widget → Enable Widget.
      </div>
    </div>

    <div class="prow" style="margin-top:10px"><div class="tog" onclick="toggleDcServerWidget()"><div class="tog-sw on" id="togDcServerWidget"></div><span class="tog-label">Show server widget on profile</span></div></div>
    <div class="prow"><div class="tog" onclick="toggleDcBadge()"><div class="tog-sw on" id="togDcBadge"></div><span class="tog-label">Show Discord badge on card</span></div></div>
    <div class="prow"><div class="tog" onclick="toggleDcSocial()"><div class="tog-sw on" id="togDcSocial"></div><span class="tog-label">Add Discord to social links</span></div></div>
    <div class="prow"><div class="tog" onclick="toggleDcPfpSync()"><div class="tog-sw" id="togDcPfpSync"></div><span class="tog-label">Use Discord PFP as avatar</span></div></div>
  </div>

  <!-- SPOTIFY -->
  <div class="panel" id="s-spotify">
    <div class="ph">🎧 Spotify</div>
    <div class="prow">
      <div class="pnote yellow">Shows what you're listening to in real-time. Requires Spotify backend.</div>
    </div>
    <div class="prow">
      <div class="plabel">Spotify Username</div>
      <input type="text" id="iSpotifyUser" placeholder="your_spotify_username" oninput="syncSpotify()">
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleSpotify()"><div class="tog-sw" id="togSpotify"></div><span class="tog-label">Show Now Playing widget</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Fallback Text <span>when not playing</span></div>
      <input type="text" id="iSpotifyFallback" placeholder="vibing to the void 🎵" oninput="syncSpotifyFallback()">
    </div>
  </div>


  <!-- BORDERS & GLOW PANEL -->
  <div class="panel" id="s-borders">
    <div class="ph">✦ Borders &amp; Glow <span class="ph-sub">effects</span></div>
    <div class="prow">
      <div class="plabel">Border Style</div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-top:4px">
        <div class="border-style-card sel" id="bs-solid" onclick="setBorderStyle(this,'solid')">
          <div style="height:24px;border:2px solid #7c3aed;border-radius:5px;margin-bottom:4px"></div>
          <div style="font-size:.65rem;text-align:center;color:var(--mut)">Solid</div>
        </div>
        <div class="border-style-card" id="bs-glow" onclick="setBorderStyle(this,'glow')">
          <div style="height:24px;border:2px solid #7c3aed;box-shadow:0 0 10px #7c3aed;border-radius:5px;margin-bottom:4px"></div>
          <div style="font-size:.65rem;text-align:center;color:var(--mut)">Glow</div>
        </div>
        <div class="border-style-card" id="bs-rainbow" onclick="setBorderStyle(this,'rainbow')">
          <div style="height:24px;border:2px solid transparent;background:linear-gradient(#0b0b12,#0b0b12) padding-box,linear-gradient(90deg,#f00,#ff0,#0f0,#0ff,#00f,#f0f,#f00) border-box;border-radius:5px;margin-bottom:4px"></div>
          <div style="font-size:.65rem;text-align:center;color:var(--mut)">Rainbow</div>
        </div>
        <div class="border-style-card" id="bs-fire" onclick="setBorderStyle(this,'fire')">
          <div style="height:24px;border:2px solid transparent;background:linear-gradient(#0b0b12,#0b0b12) padding-box,linear-gradient(90deg,#ff4500,#ff8c00,#ffd700,#ff4500) border-box;border-radius:5px;margin-bottom:4px"></div>
          <div style="font-size:.65rem;text-align:center;color:var(--mut)">Fire</div>
        </div>
        <div class="border-style-card" id="bs-electric" onclick="setBorderStyle(this,'electric')">
          <div style="height:24px;border:2px solid transparent;background:linear-gradient(#0b0b12,#0b0b12) padding-box,linear-gradient(90deg,#00ffff,#ffffff,#00ffff) border-box;border-radius:5px;margin-bottom:4px"></div>
          <div style="font-size:.65rem;text-align:center;color:var(--mut)">Electric</div>
        </div>
        <div class="border-style-card" id="bs-none" onclick="setBorderStyle(this,'none')">
          <div style="height:24px;border:2px solid rgba(255,255,255,.1);border-radius:5px;margin-bottom:4px"></div>
          <div style="font-size:.65rem;text-align:center;color:var(--mut)">None</div>
        </div>
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Card Glow Intensity</div>
      <input type="range" id="iGlowInt" min="0" max="100" value="45" oninput="syncGlowInt()">
      <div style="text-align:right;font-size:.7rem;color:var(--mut)" id="glowIntVal">45%</div>
    </div>
    <div class="prow">
      <div class="plabel">Glow Color</div>
      <div style="display:flex;gap:6px;align-items:center">
        <input type="text" id="iGlowColor" value="#7c3aed" oninput="syncGlowColor()" style="flex:1">
        <input type="color" id="iGlowColorPick" value="#7c3aed" oninput="syncGlowColorPick()" style="width:36px;height:36px;border:none;background:none;cursor:pointer;border-radius:6px">
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Avatar Ring Style</div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:5px;margin-top:4px">
        <div class="ring-card sel" onclick="setRingStyle(this,'solid')" style="border:2px solid var(--brd);border-radius:7px;padding:6px;cursor:pointer;text-align:center;font-size:.65rem;color:var(--mut);transition:all .18s">
          <div style="width:24px;height:24px;border-radius:50%;border:2px solid #7c3aed;margin:0 auto 3px"></div>Solid
        </div>
        <div class="ring-card" onclick="setRingStyle(this,'glow')" style="border:2px solid var(--brd);border-radius:7px;padding:6px;cursor:pointer;text-align:center;font-size:.65rem;color:var(--mut);transition:all .18s">
          <div style="width:24px;height:24px;border-radius:50%;border:2px solid #7c3aed;box-shadow:0 0 10px #7c3aed;margin:0 auto 3px"></div>Glow
        </div>
        <div class="ring-card" onclick="setRingStyle(this,'rainbow')" style="border:2px solid var(--brd);border-radius:7px;padding:6px;cursor:pointer;text-align:center;font-size:.65rem;color:var(--mut);transition:all .18s">
          <div style="width:24px;height:24px;border-radius:50%;border:2px solid transparent;background:linear-gradient(#0b0b12,#0b0b12) padding-box,linear-gradient(45deg,#f00,#ff0,#0f0,#0ff,#00f,#f0f,#f00) border-box;margin:0 auto 3px"></div>Rainbow
        </div>
        <div class="ring-card" onclick="setRingStyle(this,'animated')" style="border:2px solid var(--brd);border-radius:7px;padding:6px;cursor:pointer;text-align:center;font-size:.65rem;color:var(--mut);transition:all .18s">
          <div style="width:24px;height:24px;border-radius:50%;border:2px dashed #7c3aed;margin:0 auto 3px"></div>Spin
        </div>
        <div class="ring-card" onclick="setRingStyle(this,'none')" style="border:2px solid var(--brd);border-radius:7px;padding:6px;cursor:pointer;text-align:center;font-size:.65rem;color:var(--mut);transition:all .18s">
          <div style="width:24px;height:24px;border-radius:50%;border:2px solid rgba(255,255,255,.1);margin:0 auto 3px"></div>None
        </div>
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Name Text Shadow</div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:5px">
        <button class="tbtn ghost sm" onclick="setNameShadow('none')">None</button>
        <button class="tbtn ghost sm" onclick="setNameShadow('soft')">Soft</button>
        <button class="tbtn ghost sm" onclick="setNameShadow('neon')">🔆 Neon</button>
        <button class="tbtn ghost sm" onclick="setNameShadow('fire')">🔥 Fire</button>
        <button class="tbtn ghost sm" onclick="setNameShadow('ice')">❄️ Ice</button>
        <button class="tbtn ghost sm" onclick="setNameShadow('gold')">✨ Gold</button>
      </div>
    </div>
  </div>

  <!-- STICKERS PANEL -->
  <div class="panel" id="s-stickers">
    <div class="ph">🎨 Stickers <span class="ph-sub">decorate your card</span></div>
    <div class="prow">
      <div class="plabel">Add Sticker</div>
      <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:6px;margin-top:4px" id="stickerPicker">
        <div class="sticker-opt" onclick="addSticker('🔥')">🔥</div>
        <div class="sticker-opt" onclick="addSticker('⚡')">⚡</div>
        <div class="sticker-opt" onclick="addSticker('✨')">✨</div>
        <div class="sticker-opt" onclick="addSticker('🌙')">🌙</div>
        <div class="sticker-opt" onclick="addSticker('💀')">💀</div>
        <div class="sticker-opt" onclick="addSticker('🎮')">🎮</div>
        <div class="sticker-opt" onclick="addSticker('🌸')">🌸</div>
        <div class="sticker-opt" onclick="addSticker('👾')">👾</div>
        <div class="sticker-opt" onclick="addSticker('🎵')">🎵</div>
        <div class="sticker-opt" onclick="addSticker('💫')">💫</div>
        <div class="sticker-opt" onclick="addSticker('🦋')">🦋</div>
        <div class="sticker-opt" onclick="addSticker('🌊')">🌊</div>
        <div class="sticker-opt" onclick="addSticker('⭐')">⭐</div>
        <div class="sticker-opt" onclick="addSticker('🔮')">🔮</div>
        <div class="sticker-opt" onclick="addSticker('💜')">💜</div>
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Custom Sticker Emoji</div>
      <div style="display:flex;gap:6px">
        <input type="text" id="iCustomSticker" placeholder="any emoji..." style="flex:1;font-size:1.2rem">
        <button class="tbtn acc sm" onclick="addSticker(document.getElementById('iCustomSticker').value)">Add</button>
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Active Stickers</div>
      <div id="activeStickersList" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:6px;min-height:30px">
        <span style="font-size:.72rem;color:var(--mut)">No stickers yet — add some above!</span>
      </div>
      <button class="tbtn ghost sm" style="margin-top:8px" onclick="clearStickers()">🗑 Clear All</button>
    </div>
    <div class="prow">
      <div class="pnote">Stickers float around your card as animated decorations ✨</div>
    </div>
  </div>

  <!-- CURSOR FX PANEL -->
  <div class="panel" id="s-cursor">
    <div class="ph">🖱 Cursor FX <span class="ph-sub">effects</span></div>
    <div class="prow">
      <div class="plabel">Cursor Style</div>
      <select id="iCursorStyle" onchange="syncCursorStyle()">
        <option value="dot">● Dot</option>
        <option value="ring">○ Ring</option>
        <option value="crosshair">+ Crosshair</option>
        <option value="star">★ Star</option>
        <option value="heart">♥ Heart</option>
        <option value="none">Hidden</option>
      </select>
    </div>
    <div class="prow">
      <div class="plabel">Cursor Color</div>
      <div style="display:flex;gap:6px;align-items:center">
        <input type="text" id="iCursorColor" value="#a855f7" oninput="syncCursorColor()" style="flex:1">
        <input type="color" id="iCursorColorPick" value="#a855f7" oninput="syncCursorColorPick()" style="width:36px;height:36px;border:none;background:none;cursor:pointer;border-radius:6px">
      </div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleClickSparks()"><div class="tog-sw on" id="togClickSparks"></div><span class="tog-label">Click spark effects</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Spark Style</div>
      <select id="iSparkStyle" onchange="syncSparkStyle()">
        <option value="sparks">✨ Sparks</option>
        <option value="hearts">💜 Hearts</option>
        <option value="stars">⭐ Stars</option>
        <option value="bubbles">🫧 Bubbles</option>
        <option value="fire">🔥 Fire</option>
      </select>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleTrail()"><div class="tog-sw on" id="togTrail"></div><span class="tog-label">Cursor trail</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Trail Style</div>
      <select id="iTrailStyle" onchange="syncTrailStyle()">
        <option value="fade">Fade dots</option>
        <option value="rainbow">Rainbow</option>
        <option value="stars">Stars</option>
        <option value="sparkle">Sparkle</option>
      </select>
    </div>
  </div>

  <!-- CUSTOM CSS PANEL -->
  <div class="panel" id="s-css">
    <div class="ph">⚙ Custom CSS <span class="ph-sub" style="color:#f59e0b">pro</span></div>
    <div class="prow">
      <div class="pnote yellow">Write raw CSS that gets injected directly into your profile. Target any element. Full power.</div>
    </div>
    <div class="prow">
      <div class="plabel">CSS Editor</div>
      <textarea id="iCustomCss" rows="16" placeholder="/* write any CSS here */" oninput="syncCustomCss()" style="font-family:'Space Mono',monospace;font-size:.72rem;line-height:1.7;resize:vertical;min-height:240px;background:var(--sur3);color:#a78bfa;border-color:rgba(124,58,237,.25)"></textarea>
    </div>
    <div style="padding:0 16px 8px;display:flex;gap:6px">
      <button class="tbtn acc sm" onclick="syncCustomCss();showToast('✅ CSS applied!')">▶ Apply</button>
      <button class="tbtn ghost sm" onclick="document.getElementById('iCustomCss').value='';syncCustomCss();showToast('CSS cleared')">🗑 Clear</button>
    </div>
    <div class="prow">
      <div class="plabel" style="margin-bottom:6px">CSS Snippets <span style="color:var(--txt3);font-size:.6rem">click to insert</span></div>
      <div style="display:flex;flex-direction:column;gap:5px">
        <button class="tbtn ghost sm" style="text-align:left;justify-content:flex-start" onclick="insertCssSnippet('glass')">💎 Frosted Glass Card</button>
        <button class="tbtn ghost sm" style="text-align:left;justify-content:flex-start" onclick="insertCssSnippet('rainbow_border')">🌈 Animated Rainbow Border</button>
        <button class="tbtn ghost sm" style="text-align:left;justify-content:flex-start" onclick="insertCssSnippet('bounce')">🏀 Bouncy Avatar</button>
        <button class="tbtn ghost sm" style="text-align:left;justify-content:flex-start" onclick="insertCssSnippet('shake')">💥 Shake Name on Hover</button>
        <button class="tbtn ghost sm" style="text-align:left;justify-content:flex-start" onclick="insertCssSnippet('scanlines')">📺 Scanlines Overlay</button>
        <button class="tbtn ghost sm" style="text-align:left;justify-content:flex-start" onclick="insertCssSnippet('float')">🌊 Float Everything</button>
        <button class="tbtn ghost sm" style="text-align:left;justify-content:flex-start" onclick="insertCssSnippet('neon_glow')">⚡ Neon Glow Text</button>
        <button class="tbtn ghost sm" style="text-align:left;justify-content:flex-start" onclick="insertCssSnippet('glitch_avatar')">👾 Glitch Avatar</button>
        <button class="tbtn ghost sm" style="text-align:left;justify-content:flex-start" onclick="insertCssSnippet('spin_border')">🔄 Spinning Conic Border</button>
        <button class="tbtn ghost sm" style="text-align:left;justify-content:flex-start" onclick="insertCssSnippet('matrix_text')">💚 Matrix Text Glow</button>
      </div>
    </div>
  </div>


  <!-- ══════ SKILL BARS PANEL ══════ -->
  <div class="panel" id="s-skillbars">
    <div class="ph">📊 Skill Bars <span class="ph-sub">animated fill</span></div>
    <div class="prow">
      <div class="plabel">Add Skill Bar</div>
      <div style="display:flex;gap:7px;margin-bottom:8px">
        <input type="text" id="iSkillBarName" placeholder="Skill name..." style="flex:1">
        <input type="number" id="iSkillBarLevel" placeholder="85" min="0" max="100" style="width:60px">
        <button class="tbtn acc sm" onclick="addSkillBar()">+</button>
      </div>
      <div id="skillBarList" style="display:flex;flex-direction:column;gap:6px;margin-bottom:8px">
        <div style="font-size:.72rem;color:var(--mut)">No skill bars yet.</div>
      </div>
      <div class="pnote blue">Bars animate to their percentage when the profile loads.</div>
    </div>
    <div class="prow">
      <div class="plabel">Quick Add</div>
      <div style="display:flex;gap:4px;flex-wrap:wrap">
        <button class="tbtn ghost sm" onclick="addSkillBarDirect('JavaScript',90)">JS 90%</button>
        <button class="tbtn ghost sm" onclick="addSkillBarDirect('Python',85)">Python 85%</button>
        <button class="tbtn ghost sm" onclick="addSkillBarDirect('React',80)">React 80%</button>
        <button class="tbtn ghost sm" onclick="addSkillBarDirect('Design',75)">Design 75%</button>
        <button class="tbtn ghost sm" onclick="addSkillBarDirect('TypeScript',88)">TS 88%</button>
      </div>
    </div>
  </div>

  <!-- ══════ TIMELINE PANEL ══════ -->
  <div class="panel" id="s-timeline">
    <div class="ph">📅 Timeline <span class="ph-sub">achievements</span></div>
    <div class="prow">
      <div class="plabel">Add Timeline Event</div>
      <input type="text" id="iTimelineEvent" placeholder="Got first client 🎉" style="margin-bottom:6px">
      <div class="row2" style="margin-bottom:6px">
        <input type="text" id="iTimelineDate" placeholder="Jan 2024">
        <input type="text" id="iTimelineIcon" placeholder="icon emoji" maxlength="4">
      </div>
      <input type="text" id="iTimelineDesc" placeholder="Brief description..." style="margin-bottom:8px">
      <button class="tbtn acc" onclick="addTimelineItem()" style="width:100%">+ Add Event</button>
    </div>
    <div class="prow">
      <div class="plabel">Events</div>
      <div id="timelineList" style="font-size:.78rem;color:var(--mut)">No events yet.</div>
    </div>
  </div>

  <!-- ══════ QUOTE PANEL ══════ -->
  <div class="panel" id="s-quote">
    <div class="ph">💬 Quote Section</div>
    <div class="prow">
      <div class="plabel">Quote Text</div>
      <textarea id="iQuote" rows="3" placeholder="The only way to do great work is to love what you do." oninput="syncQuote()"></textarea>
    </div>
    <div class="prow">
      <div class="plabel">Attribution</div>
      <input type="text" id="iQuoteAuthor" placeholder="Steve Jobs" oninput="syncQuote()">
    </div>
    <div class="prow">
      <div class="plabel">Inspirational Quotes</div>
      <div style="display:flex;flex-direction:column;gap:5px">
        <button class="tbtn ghost sm" style="text-align:left;font-size:.68rem" onclick="setQuote('The only way to do great work is to love what you do.','Steve Jobs')">Steve Jobs</button>
        <button class="tbtn ghost sm" style="text-align:left;font-size:.68rem" onclick="setQuote('Stay hungry, stay foolish.','Steve Jobs')">Stay Hungry</button>
        <button class="tbtn ghost sm" style="text-align:left;font-size:.68rem" onclick="setQuote('Code is poetry.','WordPress')">Code is Poetry</button>
        <button class="tbtn ghost sm" style="text-align:left;font-size:.68rem" onclick="setQuote('Build things. Break things. Learn things.','')">Build Things</button>
      </div>
    </div>
  </div>

  <!-- ══════ REACTIONS PANEL ══════ -->
  <div class="panel" id="s-reactions">
    <div class="ph">⚡ Reaction System</div>
    <div class="prow">
      <div class="tog" onclick="toggleReactions()"><div class="tog-sw on" id="togReactions"></div><span class="tog-label">Show reaction bar</span></div>
    </div>
    <div class="prow">
      <div class="pnote green">Visitors can react to your profile with emojis. Reactions are tracked per session and saved locally.</div>
    </div>
    <div class="prow">
      <div class="plabel">Floating Emoji Reactions</div>
      <div class="tog" onclick="toggleFloatingEmoji()"><div class="tog-sw" id="togFloatingEmoji"></div><span class="tog-label">Floating emoji from clicks</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Confetti on Load</div>
      <div class="tog" onclick="toggleConfetti()"><div class="tog-sw on" id="togConfetti"></div><span class="tog-label">Confetti burst on page load</span></div>
    </div>
  </div>

  <!-- ══════ WEATHER PANEL ══════ -->
  <div class="panel" id="s-weather">
    <div class="ph">🌤 Weather Widget</div>
    <div class="prow">
      <div class="pnote blue">Shows live weather for your location. Powered by wttr.in — no API key needed.</div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleWeather()"><div class="tog-sw" id="togWeather"></div><span class="tog-label">Show weather widget</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Location (set in Profile tab)</div>
      <div style="font-size:.72rem;color:var(--mut)">Weather is pulled from the location you set in the Profile panel. Make sure to enter a city name like "Tokyo" or "New York".</div>
    </div>
  </div>

  <!-- ══════ VISITOR MAP PANEL ══════ -->
  <div class="panel" id="s-visitor">
    <div class="ph">🌍 Visitor Map</div>
    <div class="prow">
      <div class="tog" onclick="toggleVisitorMap()"><div class="tog-sw" id="togVisitorMap"></div><span class="tog-label">Show visitor origin map</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleVisitorCounter()"><div class="tog-sw on" id="togVisitorCounter"></div><span class="tog-label">Show visitor counter with flags</span></div>
    </div>
    <div class="prow">
      <div class="pnote">The map shows an animated dot-grid visualization of where your visitors come from. Animated in real-time.</div>
    </div>
    <div class="prow">
      <div class="plabel">Currently Available for Work</div>
      <div class="tog" onclick="toggleAvailable()"><div class="tog-sw" id="togAvailable"></div><span class="tog-label">Show "Available" indicator</span></div>
    </div>
  </div>

  <!-- ══════ MARQUEE & ANIMATED TEXT PANEL ══════ -->
  <div class="panel" id="s-marquee">
    <div class="ph">✍️ Marquee & Text <span class="ph-sub">animated</span></div>
    <div class="prow">
      <div class="plabel">Banner Marquee Text <span>scrolls across banner</span></div>
      <input type="text" id="iBannerMarquee" placeholder="building the future 🚀 design is thinking made visual ✦" oninput="syncBannerMarquee()">
    </div>
    <div class="prow">
      <div class="plabel">Song Lyrics Ticker <span>below banner</span></div>
      <input type="text" id="iLyricsTicker" placeholder="Paste your fave lyrics here... 🎵" oninput="syncLyricsTicker()">
    </div>
    <div class="prow">
      <div class="plabel">Banner Watermark Text</div>
      <input type="text" id="iBannerText" placeholder="VLTX.LOL" oninput="syncBannerText()" maxlength="20">
    </div>
    <div class="prow">
      <div class="plabel">Animated Logo/Watermark</div>
      <div class="tog" onclick="toggleAnimLogo()"><div class="tog-sw on" id="togAnimLogo"></div><span class="tog-label">Show animated VLTX watermark</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Neon Scanline Effect</div>
      <div class="tog" onclick="toggleNeonScanline()"><div class="tog-sw" id="togNeonScanline"></div><span class="tog-label">Moving neon scanline</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Scanline Overlay (CRT)</div>
      <div class="tog" onclick="toggleScanlines()"><div class="tog-sw" id="togScanlines"></div><span class="tog-label">CRT scanlines overlay</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Animated Gradient Mesh</div>
      <div class="tog" onclick="toggle('bgGrad','togBgGrad')"><div class="tog-sw" id="togBgGrad"></div><span class="tog-label">Floating gradient mesh behind card</span></div>
    </div>
  </div>

  <!-- ══════ PARTICLES EXTRA PANEL ══════ -->
  <div class="panel" id="s-particles-extra">
    <div class="ph">🌧 Particles+ <span class="ph-sub">insane effects</span></div>
    <div class="prow">
      <div class="plabel">Matrix Rain (green characters)</div>
      <div class="tog" onclick="toggleMatrixRain()"><div class="tog-sw" id="togMatrixRain"></div><span class="tog-label">Matrix rain effect</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Snow / Rain Particles</div>
      <div class="tog" onclick="toggleSnowRain()"><div class="tog-sw" id="togSnowRain"></div><span class="tog-label">Snow/rain particles</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Floating Emoji Effect</div>
      <input type="text" id="iFloatingEmoji" placeholder="🔥,✨,💀 (comma separated)" oninput="syncFloatingEmoji()">
      <div class="tog" style="margin-top:8px" onclick="toggleFloatingEmojiEffect()"><div class="tog-sw" id="togFloatingEmojiEffect"></div><span class="tog-label">Enable floating emoji</span></div>
    </div>
    <div class="prow">
      <div class="pnote yellow">⚠️ Using multiple heavy particle effects may impact performance.</div>
    </div>
  </div>

</div><!-- end .main -->


  <!-- ══════ CARD FX PANEL ══════ -->
  <div class="panel" id="s-card-fx">
    <div class="ph">💎 Card FX <span class="ph-sub">next level</span></div>

    <!-- CARD SKIN EXTENDED -->
    <div class="prow">
      <div class="plabel">Card Skin</div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px">
        <div class="ls-card sel" id="cskin-default" onclick="setCardSkinEx('default',this)">
          <div class="ls-preview" style="background:rgba(15,15,26,.92);border:1px solid rgba(168,85,247,.2)"></div>Default
        </div>
        <div class="ls-card" id="cskin-glass" onclick="setCardSkinEx('glass',this)">
          <div class="ls-preview" style="background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.2)"></div>Glass
        </div>
        <div class="ls-card" id="cskin-void" onclick="setCardSkinEx('void',this)">
          <div class="ls-preview" style="background:#000;border:1px solid rgba(255,255,255,.06)"></div>Void
        </div>
        <div class="ls-card" id="cskin-retro" onclick="setCardSkinEx('retro',this)">
          <div class="ls-preview" style="background:#0a0a12;border:2px solid rgba(255,255,0,.3)"></div>Retro
        </div>
        <div class="ls-card" id="cskin-neon-green" onclick="setCardSkinEx('neon-green',this)">
          <div class="ls-preview" style="border:2px solid #00ff88;box-shadow:0 0 12px #00ff8855"></div>Neon 🟢
        </div>
        <div class="ls-card" id="cskin-neon-pink" onclick="setCardSkinEx('neon-pink',this)">
          <div class="ls-preview" style="border:2px solid #ff0080;box-shadow:0 0 12px #ff008055"></div>Neon 🩷
        </div>
        <div class="ls-card" id="cskin-neon-blue" onclick="setCardSkinEx('neon-blue',this)">
          <div class="ls-preview" style="border:2px solid #00d4ff;box-shadow:0 0 12px #00d4ff55"></div>Neon 🔵
        </div>
        <div class="ls-card" id="cskin-neon-gold" onclick="setCardSkinEx('neon-gold',this)">
          <div class="ls-preview" style="border:2px solid #fbbf24;box-shadow:0 0 12px #fbbf2455"></div>Neon 🟡
        </div>
        <div class="ls-card" id="cskin-holo" onclick="setCardSkinEx('holo',this)">
          <div class="ls-preview" style="background:conic-gradient(#ff0080,#00ffff,#00ff80,#ffff00,#ff0080)"></div>Holographic
        </div>
      </div>
    </div>

    <!-- BORDER ANIMATION -->
    <div class="prow">
      <div class="plabel">Border Animation</div>
      <select id="iBorderAnim" onchange="syncBorderAnim()">
        <option value="">None (default spin)</option>
        <option value="pulse">💓 Pulse Glow</option>
        <option value="rainbow">🌈 Rainbow Cycle</option>
      </select>
    </div>

    <!-- CARD SHAPE -->
    <div class="prow">
      <div class="plabel">Card Shape</div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px">
        <div class="ls-card sel" id="cshape-default" onclick="setCardShape('default',this)">
          <div class="ls-preview" style="border:2px solid rgba(255,255,255,.2);border-radius:12px"></div>Default
        </div>
        <div class="ls-card" id="cshape-sharp" onclick="setCardShape('sharp',this)">
          <div class="ls-preview" style="border:2px solid rgba(255,255,255,.2);border-radius:0"></div>Sharp
        </div>
        <div class="ls-card" id="cshape-pill" onclick="setCardShape('pill',this)">
          <div class="ls-preview" style="border:2px solid rgba(255,255,255,.2);border-radius:40px"></div>Pill
        </div>
        <div class="ls-card" id="cshape-notch" onclick="setCardShape('notch',this)">
          <div class="ls-preview" style="border:2px solid rgba(255,255,255,.2);clip-path:polygon(0 0,calc(100% - 10px) 0,100% 10px,100% 100%,10px 100%,0 calc(100% - 10px))"></div>Notch
        </div>
      </div>
    </div>

    <!-- 3D TILT -->
    <div class="prow">
      <div class="tog" onclick="toggleTilt3d()"><div class="tog-sw on" id="togTilt3d"></div><span class="tog-label">3D card tilt on hover</span></div>
    </div>
    <div class="prow" id="tiltAmountRow">
      <div class="plabel">Tilt intensity <span id="tiltAmountVal">8°</span></div>
      <input type="range" min="2" max="20" value="8" id="iTiltAmount" oninput="syncTiltAmount()">
    </div>

    <!-- BANNER STYLE -->
    <div class="prow">
      <div class="plabel">Banner Height</div>
      <select id="iBannerStyle" onchange="syncBannerStyle()">
        <option value="">Normal (148px)</option>
        <option value="minimal">Minimal (80px)</option>
        <option value="tall">Tall (220px)</option>
        <option value="zero">Hidden (0px)</option>
      </select>
    </div>
    <div class="prow">
      <div class="plabel">Banner Color Override</div>
      <select id="iBannerColor" onchange="syncBannerColor()">
        <option value="">Default (canvas animation)</option>
        <option value="gradient">Accent Gradient</option>
        <option value="solid">Solid Accent</option>
        <option value="dark">Pure Black</option>
      </select>
    </div>

    <!-- BACKGROUND PATTERN -->
    <div class="prow">
      <div class="plabel">Background Pattern</div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px">
        <div class="ls-card sel" id="bgpat-none" onclick="setBgPattern('none',this)">
          <div class="ls-preview" style="background:#030308"></div>None
        </div>
        <div class="ls-card" id="bgpat-grid" onclick="setBgPattern('grid',this)">
          <div class="ls-preview" style="background:#030308;background-image:linear-gradient(rgba(168,85,247,.15) 1px,transparent 1px),linear-gradient(90deg,rgba(168,85,247,.15) 1px,transparent 1px);background-size:12px 12px"></div>Grid
        </div>
        <div class="ls-card" id="bgpat-dots" onclick="setBgPattern('dots',this)">
          <div class="ls-preview" style="background:#030308;background-image:radial-gradient(rgba(168,85,247,.4) 1px,transparent 1px);background-size:8px 8px"></div>Dots
        </div>
      </div>
    </div>

    <!-- HOLOGRAPHIC -->
    <div class="prow">
      <div class="tog" onclick="toggleHoloCard()"><div class="tog-sw" id="togHoloCard"></div><span class="tog-label">Holographic border effect</span></div>
    </div>

    <!-- FOOTER BADGE -->
    <div class="prow">
      <div class="tog" onclick="toggleFooterBadge()"><div class="tog-sw on" id="togFooterBadge"></div><span class="tog-label">Styled footer badge</span></div>
    </div>
  </div>

  <!-- ══════ AVATAR FX PANEL ══════ -->
  <div class="panel" id="s-avatar-fx">
    <div class="ph">🖼 Avatar FX <span class="ph-sub">make it pop</span></div>

    <!-- AVATAR FRAME -->
    <div class="prow">
      <div class="plabel">Avatar Frame</div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px">
        <div class="ls-card sel" id="avframe-none" onclick="setAvFrame('none',this)">
          <div class="ls-preview" style="border:2px solid rgba(255,255,255,.2)"></div>None
        </div>
        <div class="ls-card" id="avframe-fire" onclick="setAvFrame('fire',this)">
          <div class="ls-preview" style="border:2px solid #f97316;box-shadow:0 0 10px rgba(249,115,22,.7)"></div>🔥 Fire
        </div>
        <div class="ls-card" id="avframe-ice" onclick="setAvFrame('ice',this)">
          <div class="ls-preview" style="border:2px solid #93c5fd;box-shadow:0 0 10px rgba(147,197,253,.7)"></div>🧊 Ice
        </div>
        <div class="ls-card" id="avframe-holo" onclick="setAvFrame('holo',this)">
          <div class="ls-preview" style="background:conic-gradient(#ff0080,#00ffff,#00ff80,#ffff00,#ff0080)"></div>🌈 Holo
        </div>
        <div class="ls-card" id="avframe-rainbow" onclick="setAvFrame('rainbow',this)">
          <div class="ls-preview" style="border:2px dashed #a855f7"></div>⚡ Spin
        </div>
        <div class="ls-card" id="avframe-double" onclick="setAvFrame('double',this)">
          <div class="ls-preview" style="border:2px solid #7c3aed;outline:2px solid #06b6d4;outline-offset:3px"></div>⭕ Double
        </div>
        <div class="ls-card" id="avframe-dashed" onclick="setAvFrame('dashed',this)">
          <div class="ls-preview" style="border:2px dashed rgba(255,255,255,.4)"></div>- - Dashed
        </div>
      </div>
    </div>

    <!-- AVATAR PHOTO FILTER -->
    <div class="prow">
      <div class="plabel">Photo Filter</div>
      <select id="iAvFilter" onchange="syncAvFilter()">
        <option value="">None</option>
        <option value="gray">⬛ Grayscale</option>
        <option value="sepia">🟤 Sepia</option>
        <option value="hue">🌈 Hue Rotate</option>
        <option value="glow">✨ Glow Drop Shadow</option>
        <option value="vintage">🎞 Vintage</option>
      </select>
    </div>
  </div>

  <!-- ══════ TYPOGRAPHY FX PANEL ══════ -->
  <div class="panel" id="s-typography">
    <div class="ph">✍️ Typography FX <span class="ph-sub">name effects</span></div>

    <!-- USERNAME SHADOW PRESET -->
    <div class="prow">
      <div class="plabel">Name Shadow Preset</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px">
        <div class="ls-card sel" id="nshadow-none" onclick="setNameShadow('none',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:.75rem;font-weight:800;color:#fff">Aa</div>Default
        </div>
        <div class="ls-card" id="nshadow-neon" onclick="setNameShadow('neon',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:.75rem;font-weight:800;color:#a855f7;text-shadow:0 0 10px #a855f7,0 0 20px #a855f7">Aa</div>Neon Glow
        </div>
        <div class="ls-card" id="nshadow-retro" onclick="setNameShadow('retro',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:.75rem;font-weight:800;color:#fff;text-shadow:2px 2px 0 rgba(168,85,247,.5)">Aa</div>Retro 3D
        </div>
        <div class="ls-card" id="nshadow-glow3" onclick="setNameShadow('glow3',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:.75rem;font-weight:800;color:#fff;text-shadow:0 0 6px #fff,0 0 14px #a855f7">Aa</div>Triple Glow
        </div>
        <div class="ls-card" id="nshadow-chroma" onclick="setNameShadow('chroma',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:.75rem;font-weight:800;color:#fff;text-shadow:-2px 0 #f43f5e,2px 0 #06b6d4">Aa</div>Chromatic
        </div>
      </div>
    </div>

    <!-- USERNAME SIZE -->
    <div class="prow">
      <div class="plabel">Username Size <span id="unSizeVal">1.72rem</span></div>
      <input type="range" min="1" max="3" step="0.1" value="1.72" id="iUnSize" oninput="syncUnSize()">
    </div>

    <!-- USERNAME LETTER SPACING -->
    <div class="prow">
      <div class="plabel">Letter Spacing <span id="unSpaceVal">-0.025em</span></div>
      <input type="range" min="-5" max="20" step="1" value="-2" id="iUnLetterSpace" oninput="syncUnLetterSpace()">
    </div>
  </div>

  <!-- ══════ SOCIALS STYLE PANEL ══════ -->
  <div class="panel" id="s-socials-style">
    <div class="ph">🔗 Socials Style</div>

    <!-- ICON STYLE -->
    <div class="prow">
      <div class="plabel">Icon Shape</div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px">
        <div class="ls-card sel" id="socshape-circle" onclick="setSocIconStyle('circle',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center"><div style="width:26px;height:26px;border-radius:50%;border:2px solid rgba(255,255,255,.3)"></div></div>Circle
        </div>
        <div class="ls-card" id="socshape-square" onclick="setSocIconStyle('square',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center"><div style="width:26px;height:26px;border-radius:8px;border:2px solid rgba(255,255,255,.3)"></div></div>Square
        </div>
        <div class="ls-card" id="socshape-sharp" onclick="setSocIconStyle('sharp',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center"><div style="width:26px;height:26px;border-radius:0;border:2px solid rgba(255,255,255,.3)"></div></div>Sharp
        </div>
        <div class="ls-card" id="socshape-pill" onclick="setSocIconStyle('pill',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center"><div style="width:36px;height:22px;border-radius:100px;border:2px solid rgba(255,255,255,.3)"></div></div>Pill
        </div>
        <div class="ls-card" id="socshape-large" onclick="setSocIconStyle('large',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center"><div style="width:32px;height:32px;border-radius:50%;border:2px solid rgba(255,255,255,.3)"></div></div>Large
        </div>
        <div class="ls-card" id="socshape-small" onclick="setSocIconStyle('small',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center"><div style="width:20px;height:20px;border-radius:50%;border:2px solid rgba(255,255,255,.3)"></div></div>Small
        </div>
      </div>
    </div>

    <!-- LINK BUTTON STYLE -->
    <div class="prow">
      <div class="plabel">Link Button Style</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px">
        <div class="ls-card sel" id="lstyle-default" onclick="setLinkStylePreset('default',this)">
          <div class="ls-preview" style="border:1px solid rgba(255,255,255,.2);border-radius:8px"></div>Default
        </div>
        <div class="ls-card" id="lstyle-fill" onclick="setLinkStylePreset('fill',this)">
          <div class="ls-preview" style="background:linear-gradient(135deg,#7c3aed,#06b6d4);border-radius:8px"></div>Filled
        </div>
        <div class="ls-card" id="lstyle-pill" onclick="setLinkStylePreset('pill',this)">
          <div class="ls-preview" style="border:1px solid rgba(255,255,255,.2);border-radius:100px"></div>Pill
        </div>
        <div class="ls-card" id="lstyle-flat" onclick="setLinkStylePreset('flat',this)">
          <div class="ls-preview" style="border:1px solid rgba(255,255,255,.2);border-radius:0"></div>Sharp
        </div>
        <div class="ls-card" id="lstyle-shadow" onclick="setLinkStylePreset('shadow',this)">
          <div class="ls-preview" style="border:1px solid rgba(255,255,255,.2);box-shadow:3px 3px 0 rgba(168,85,247,.5)"></div>3D Shadow
        </div>
        <div class="ls-card" id="lstyle-gradient" onclick="setLinkStylePreset('gradient',this)">
          <div class="ls-preview" style="background:linear-gradient(135deg,rgba(168,85,247,.3),rgba(34,211,238,.2));border:1px solid rgba(168,85,247,.3)"></div>Gradient
        </div>
      </div>
    </div>
  </div>

  <!-- ══════ TAGS & BIO STYLE PANEL ══════ -->
  <div class="panel" id="s-tags-style">
    <div class="ph">🏷 Tags & Bio Style</div>

    <!-- TAG STYLE -->
    <div class="prow">
      <div class="plabel">Tag Style</div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px">
        <div class="ls-card sel" id="tagstyle-default" onclick="setTagStyle('default',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;gap:3px"><span style="font-size:.5rem;border:1px solid rgba(255,255,255,.2);padding:2px 5px;border-radius:100px;color:#aaa">tag</span></div>Default
        </div>
        <div class="ls-card" id="tagstyle-colored" onclick="setTagStyle('colored',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;gap:2px"><span style="font-size:.45rem;border:1px solid rgba(248,113,113,.4);padding:1px 4px;border-radius:100px;color:#f87171">a</span><span style="font-size:.45rem;border:1px solid rgba(74,222,128,.4);padding:1px 4px;border-radius:100px;color:#4ade80">b</span><span style="font-size:.45rem;border:1px solid rgba(96,165,250,.4);padding:1px 4px;border-radius:100px;color:#60a5fa">c</span></div>Colored
        </div>
        <div class="ls-card" id="tagstyle-hash" onclick="setTagStyle('hash',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center"><span style="font-size:.6rem;color:#a855f7;font-weight:700">#tag</span></div>#Hashtag
        </div>
        <div class="ls-card" id="tagstyle-dot" onclick="setTagStyle('dot',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center"><span style="font-size:.55rem;color:#aaa">• tag</span></div>• Dot
        </div>
        <div class="ls-card" id="tagstyle-pill" onclick="setTagStyle('pill',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center"><span style="font-size:.5rem;border:1px solid rgba(255,255,255,.2);padding:2px 5px;border-radius:4px;color:#aaa">tag</span></div>Pill
        </div>
        <div class="ls-card" id="tagstyle-caps" onclick="setTagStyle('caps',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center"><span style="font-size:.45rem;text-transform:uppercase;letter-spacing:.1em;border:1px solid rgba(255,255,255,.2);padding:2px 5px;border-radius:100px;color:#aaa">TAG</span></div>CAPS
        </div>
      </div>
    </div>

    <!-- BIO OPTIONS -->
    <div class="prow">
      <div class="plabel">Bio Style</div>
      <div class="tog" onclick="toggleBioGlow()"><div class="tog-sw" id="togBioGlow"></div><span class="tog-label">Bio text glow effect</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleBioItalic()"><div class="tog-sw" id="togBioItalic"></div><span class="tog-label">Italic bio text</span></div>
    </div>

    <!-- STATUS BADGE COLOR -->
    <div class="prow">
      <div class="plabel">Status Badge Color</div>
      <select id="iStatusColor" onchange="syncStatusColor()">
        <option value="">Default (white)</option>
        <option value="green">🟢 Green (Online)</option>
        <option value="yellow">🟡 Yellow (Busy)</option>
        <option value="red">🔴 Red (DND)</option>
        <option value="blue">🔵 Blue (Working)</option>
      </select>
    </div>
  </div>

  <!-- ══════ WIDGETS PANEL ══════ -->
  <div class="panel" id="s-widgets">
    <div class="ph">📦 Widgets <span class="ph-sub">extra blocks</span></div>

    <!-- NOW PLAYING TICKER -->
    <div class="prow">
      <div class="plabel">Now Playing Ticker <span>static display</span></div>
      <input type="text" id="iNpTrack" placeholder="Track name..." oninput="syncNpWidget()" maxlength="60">
      <input type="text" id="iNpArtist" placeholder="Artist name..." oninput="syncNpWidget()" style="margin-top:5px" maxlength="40">
      <div class="pnote" style="margin-top:5px">Shows a Spotify-style "Now Playing" bar. Set track + artist name to enable.</div>
    </div>

    <!-- COUNTDOWN WIDGET -->
    <div class="prow">
      <div class="plabel">Countdown Timer</div>
      <div class="tog" style="margin-bottom:8px" onclick="toggleCountdown()"><div class="tog-sw" id="togCountdown"></div><span class="tog-label">Show countdown</span></div>
      <input type="text" id="iCountdownTitle" placeholder="Countdown title..." oninput="syncCountdown()" maxlength="40" style="margin-bottom:5px">
      <input type="datetime-local" id="iCountdownDate" onchange="syncCountdown()">
      <div style="font-size:.68rem;color:var(--mut);margin-top:4px">Set a target date/time to countdown to.</div>
    </div>

    <!-- GOAL / PROGRESS WIDGET -->
    <div class="prow">
      <div class="plabel">Progress / Goal Widget</div>
      <input type="text" id="iGoalLabel" placeholder="Goal name (e.g. Followers)" oninput="syncGoal()" maxlength="40" style="margin-bottom:5px">
      <input type="text" id="iGoalSub" placeholder="Sub text (e.g. 850 / 1000)" oninput="syncGoal()" maxlength="40" style="margin-bottom:5px">
      <div class="plabel">Progress <span id="goalPctVal">0%</span></div>
      <input type="range" min="0" max="100" value="0" id="iGoalPct" oninput="syncGoalPct()">
    </div>
  </div>

  <!-- ══════ MUSIC STYLE PANEL ══════ -->
  <div class="panel" id="s-music-style">
    <div class="ph">🎵 Music Style</div>
    <div class="prow">
      <div class="plabel">Player Skin</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px">
        <div class="ls-card sel" id="pskin-default" onclick="setPlayerSkin('default',this)">
          <div class="ls-preview" style="border:1px solid rgba(255,255,255,.1);border-radius:10px"></div>Default
        </div>
        <div class="ls-card" id="pskin-minimal" onclick="setPlayerSkin('minimal',this)">
          <div class="ls-preview"></div>Minimal
        </div>
        <div class="ls-card" id="pskin-neon" onclick="setPlayerSkin('neon',this)">
          <div class="ls-preview" style="border:1px solid #a855f7;box-shadow:0 0 8px rgba(168,85,247,.3) inset;border-radius:10px"></div>Neon
        </div>
        <div class="ls-card" id="pskin-gradient" onclick="setPlayerSkin('gradient',this)">
          <div class="ls-preview" style="background:linear-gradient(135deg,rgba(168,85,247,.15),rgba(34,211,238,.08));border:1px solid rgba(168,85,247,.2);border-radius:10px"></div>Gradient
        </div>
      </div>
    </div>
  </div>

  <!-- ══════ PAGE ANIMATION PANEL ══════ -->
  <div class="panel" id="s-page-anim">
    <div class="ph">⚡ Page Animation</div>
    <div class="prow">
      <div class="plabel">Card Entry Animation</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px">
        <div class="ls-card sel" id="panim-default" onclick="setPageAnim('default',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-size:.55rem;color:#aaa">fadeUp</div>Default
        </div>
        <div class="ls-card" id="panim-slideup" onclick="setPageAnim('slideup',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-size:.9rem">⬆️</div>Slide Up
        </div>
        <div class="ls-card" id="panim-zoom" onclick="setPageAnim('zoom',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-size:.9rem">🔍</div>Zoom In
        </div>
        <div class="ls-card" id="panim-flip" onclick="setPageAnim('flip',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-size:.9rem">🔄</div>Flip
        </div>
        <div class="ls-card" id="panim-bounce" onclick="setPageAnim('bounce',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-size:.9rem">🏀</div>Bounce
        </div>
        <div class="ls-card" id="panim-none" onclick="setPageAnim('none',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-size:.55rem;color:#aaa">instant</div>None
        </div>
      </div>
    </div>
  </div>


  <!-- ══════ AUDIO VISUALIZER PANEL ══════ -->
  <div class="panel" id="s-audio-viz">
    <div class="ph">♫ Audio Visualizer <span class="ph-sub">live reactive visuals</span></div>
    <div class="prow">
      <div class="plabel">Visualizer Style</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:4px">
        <div class="ls-card sel" id="aviz-bars" onclick="setAudioViz('bars',this)">
          <div class="ls-preview" style="display:flex;align-items:flex-end;justify-content:center;gap:2px;padding-bottom:4px">
            <div style="width:4px;height:8px;background:var(--acc);border-radius:2px"></div>
            <div style="width:4px;height:16px;background:var(--acc);border-radius:2px"></div>
            <div style="width:4px;height:12px;background:var(--acc);border-radius:2px"></div>
            <div style="width:4px;height:20px;background:var(--acc);border-radius:2px"></div>
            <div style="width:4px;height:10px;background:var(--acc);border-radius:2px"></div>
          </div>Bars
        </div>
        <div class="ls-card" id="aviz-wave" onclick="setAudioViz('wave',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-size:1.1rem">〰️</div>Wave
        </div>
        <div class="ls-card" id="aviz-circle" onclick="setAudioViz('circle',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-size:1.1rem">◎</div>Circle
        </div>
        <div class="ls-card" id="aviz-mirror" onclick="setAudioViz('mirror',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-size:.6rem;color:var(--acc)">▋▏▌▐▌▏▋</div>Mirror
        </div>
        <div class="ls-card" id="aviz-dna" onclick="setAudioViz('dna',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-size:.55rem;color:var(--acc)">DNA</div>DNA Helix
        </div>
        <div class="ls-card" id="aviz-none" onclick="setAudioViz('none',this)">
          <div class="ls-preview"></div>None
        </div>
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Visualizer Color</div>
      <div style="display:flex;gap:6px">
        <input type="text" id="iVizColor" value="#a855f7" placeholder="#a855f7" oninput="syncVizColor()" style="flex:1">
        <input type="color" id="iVizColorPick" value="#a855f7" oninput="document.getElementById('iVizColor').value=this.value;syncVizColor()">
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Visualizer Height <span id="vizHeightVal">60px</span></div>
      <input type="range" min="20" max="120" value="60" id="iVizHeight" oninput="state.vizHeight=+this.value;document.getElementById('vizHeightVal').textContent=this.value+'px'">
    </div>
    <div class="prow">
      <div class="plabel">Bar Count <span id="vizBarsVal">32</span></div>
      <input type="range" min="8" max="64" value="32" id="iVizBars" oninput="state.vizBars=+this.value;document.getElementById('vizBarsVal').textContent=this.value">
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('vizReactive','togVizReactive')"><div class="tog-sw on" id="togVizReactive"></div><span class="tog-label">Reactive to music player</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('vizAlwaysOn','togVizAlways')"><div class="tog-sw" id="togVizAlways"></div><span class="tog-label">Always animate (even when idle)</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('vizGlow','togVizGlow')"><div class="tog-sw on" id="togVizGlow"></div><span class="tog-label">Glow / bloom effect</span></div>
    </div>
  </div>

  <!-- ══════ 3D EFFECTS PANEL ══════ -->
  <div class="panel" id="s-3d">
    <div class="ph">◈ 3D Effects <span class="ph-sub">depth & dimension</span></div>
    <div class="prow">
      <div class="plabel">3D Background Scene</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:4px">
        <div class="ls-card" id="bg3d-none" onclick="set3DBg('none',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-size:.6rem;color:var(--mut)">off</div>None
        </div>
        <div class="ls-card sel" id="bg3d-floating" onclick="set3DBg('floating',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-size:.8rem">🧊</div>Floating Cubes
        </div>
        <div class="ls-card" id="bg3d-orbs" onclick="set3DBg('orbs',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-size:.8rem">🔮</div>Glowing Orbs
        </div>
        <div class="ls-card" id="bg3d-grid" onclick="set3DBg('grid',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-size:.8rem">⊞</div>Grid Tunnel
        </div>
        <div class="ls-card" id="bg3d-dna" onclick="set3DBg('dna',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-size:.8rem">🧬</div>DNA Strand
        </div>
        <div class="ls-card" id="bg3d-stars3d" onclick="set3DBg('stars3d',this)">
          <div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-size:.8rem">🌌</div>3D Starfield
        </div>
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Tilt Intensity <span id="tiltValLabel">medium</span></div>
      <select id="iTiltStrength" onchange="syncTiltStrength()">
        <option value="0">Off</option>
        <option value="5">Subtle</option>
        <option value="15" selected>Medium</option>
        <option value="25">Strong</option>
        <option value="40">Extreme</option>
      </select>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('tilt3dAvatar','tog3dAvatar')"><div class="tog-sw on" id="tog3dAvatar"></div><span class="tog-label">3D tilt on avatar</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('depthShadow','togDepthShadow')"><div class="tog-sw on" id="togDepthShadow"></div><span class="tog-label">Depth shadow on scroll</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('parallaxBg','togParallax')"><div class="tog-sw on" id="togParallax"></div><span class="tog-label">Parallax background</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Card Perspective <span id="perspVal">800px</span></div>
      <input type="range" min="300" max="2000" value="800" id="iPerspective" oninput="state.perspective=+this.value+'px';document.getElementById('perspVal').textContent=this.value+'px'">
    </div>
  </div>

  <!-- ══════ TEXT FX+ PANEL ══════ -->
  <div class="panel" id="s-text-fx">
    <div class="ph">≡ Text FX+ <span class="ph-sub">advanced text effects</span></div>
    <div class="prow">
      <div class="plabel">Name Effect Override</div>
      <select id="iNameFx2" onchange="syncNameFx2()">
        <option value="">Use animation panel setting</option>
        <option value="holographic">🌈 Holographic shimmer</option>
        <option value="fire">🔥 Fire text</option>
        <option value="ice">❄️ Ice / frost</option>
        <option value="gold">✨ Liquid gold</option>
        <option value="neon-flicker">💡 Neon flicker</option>
        <option value="chrome">🪞 Chrome / mirror</option>
        <option value="rgb-split">📡 RGB split glitch</option>
        <option value="pixel">◼ Pixel / retro</option>
        <option value="outline">□ Outline only</option>
        <option value="shadow-stack">▓ Shadow stack</option>
      </select>
    </div>
    <div class="prow">
      <div class="plabel">Bio Text Style</div>
      <select id="iBioStyle" onchange="syncBioStyle()">
        <option value="normal">Normal</option>
        <option value="italic">Italic</option>
        <option value="monospace">Monospace terminal</option>
        <option value="handwriting">Handwriting</option>
        <option value="small-caps">SMALL CAPS</option>
        <option value="faded">Faded / muted</option>
      </select>
    </div>
    <div class="prow">
      <div class="plabel">Letter Spacing — Name <span id="lsNameVal">0</span></div>
      <input type="range" min="-2" max="12" value="0" step="0.5" id="iLsName" oninput="state.lsName=+this.value;document.getElementById('lsNameVal').textContent=this.value+'px'">
    </div>
    <div class="prow">
      <div class="plabel">Font Size — Name <span id="fsNameVal">28px</span></div>
      <input type="range" min="16" max="52" value="28" id="iFsName" oninput="state.fsName=+this.value;document.getElementById('fsNameVal').textContent=this.value+'px'">
    </div>
    <div class="prow">
      <div class="plabel">Tag Prefix Character</div>
      <input type="text" id="iTagPrefix" placeholder="# or @ or nothing" maxlength="3" oninput="state.tagPrefix=this.value" style="max-width:80px">
    </div>
    <div class="prow">
      <div class="plabel">Animated Cursor in Bio</div>
      <select id="iBioCursor" onchange="state.bioCursor=this.value">
        <option value="block">█ Block</option>
        <option value="line">| Line</option>
        <option value="underscore">_ Underscore</option>
        <option value="none">None</option>
      </select>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('textShadow','togTextShadow')"><div class="tog-sw" id="togTextShadow"></div><span class="tog-label">Text shadow on name</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('nameBold','togNameBold')"><div class="tog-sw on" id="togNameBold"></div><span class="tog-label">Bold username</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('tagUppercase','togTagUpper')"><div class="tog-sw" id="togTagUpper"></div><span class="tog-label">Uppercase tags</span></div>
    </div>
  </div>

  <!-- ══════ GLASS & BLUR PANEL ══════ -->
  <div class="panel" id="s-glass">
    <div class="ph">◇ Glass & Blur</div>
    <div class="prow">
      <div class="plabel">Glass Style</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:4px">
        <div class="ls-card sel" id="glass-default" onclick="setGlassStyle('default',this)">
          <div class="ls-preview" style="background:rgba(255,255,255,.05);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.1);border-radius:8px"></div>Default
        </div>
        <div class="ls-card" id="glass-ultra" onclick="setGlassStyle('ultra',this)">
          <div class="ls-preview" style="background:rgba(255,255,255,.12);backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.25);border-radius:8px"></div>Ultra Glass
        </div>
        <div class="ls-card" id="glass-dark" onclick="setGlassStyle('dark',this)">
          <div class="ls-preview" style="background:rgba(0,0,0,.6);backdrop-filter:blur(24px);border:1px solid rgba(255,255,255,.06);border-radius:8px"></div>Dark Glass
        </div>
        <div class="ls-card" id="glass-tinted" onclick="setGlassStyle('tinted',this)">
          <div class="ls-preview" style="background:rgba(168,85,247,.12);backdrop-filter:blur(16px);border:1px solid rgba(168,85,247,.3);border-radius:8px"></div>Tinted
        </div>
        <div class="ls-card" id="glass-matte" onclick="setGlassStyle('matte',this)">
          <div class="ls-preview" style="background:rgba(15,15,25,.95);border:1px solid rgba(255,255,255,.04);border-radius:8px"></div>Matte
        </div>
        <div class="ls-card" id="glass-iridescent" onclick="setGlassStyle('iridescent',this)">
          <div class="ls-preview" style="background:linear-gradient(135deg,rgba(168,85,247,.15),rgba(34,211,238,.1),rgba(255,100,200,.12));backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.2);border-radius:8px"></div>Iridescent
        </div>
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Custom Blur Amount <span id="glassBlurVal">28px</span></div>
      <input type="range" min="0" max="80" value="28" id="iGlassBlur" oninput="state.blur=+this.value;document.getElementById('glassBlurVal').textContent=this.value+'px';syncBlur()">
    </div>
    <div class="prow">
      <div class="plabel">Glass Saturation <span id="glassSatVal">100%</span></div>
      <input type="range" min="50" max="300" value="100" id="iGlassSat" oninput="state.glassSat=+this.value;document.getElementById('glassSatVal').textContent=this.value+'%'">
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('glassReflection','togReflection')"><div class="tog-sw" id="togReflection"></div><span class="tog-label">Reflection overlay</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('glassNoise','togNoise')"><div class="tog-sw on" id="togNoise"></div><span class="tog-label">Noise texture (grain)</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Inner glow color</div>
      <div style="display:flex;gap:6px">
        <input type="text" id="iGlowColor" value="#a855f7" placeholder="#a855f7" oninput="syncGlowColor();" style="flex:1">
        <input type="color" id="iGlowColorPick" value="#a855f7" oninput="document.getElementById('iGlowColor').value=this.value;syncGlowColor()">
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Glow Intensity <span id="glowIntVal">45%</span></div>
      <input type="range" min="0" max="100" value="45" id="iGlowInt2" oninput="state.glowInt=+this.value;document.getElementById('glowIntVal').textContent=this.value+'%'">
    </div>
  </div>

  <!-- ══════ NEON SIGNS PANEL ══════ -->
  <div class="panel" id="s-neon">
    <div class="ph">✦ Neon Signs <span class="ph-sub">glowing text decorations</span></div>
    <div class="prow">
      <div class="plabel">Neon Sign Text <span>shows above or below card</span></div>
      <input type="text" id="iNeonText" placeholder="e.g. OPEN 24/7 or YOUR NAME" maxlength="30" oninput="syncNeonText()">
    </div>
    <div class="prow">
      <div class="plabel">Neon Position</div>
      <select id="iNeonPos" onchange="state.neonPos=this.value">
        <option value="top">Above card</option>
        <option value="bottom">Below card</option>
        <option value="off">Hidden</option>
      </select>
    </div>
    <div class="prow">
      <div class="plabel">Neon Color</div>
      <div style="display:flex;gap:6px">
        <input type="text" id="iNeonColor" value="#ff0080" placeholder="#ff0080" oninput="syncNeonColor()" style="flex:1">
        <input type="color" id="iNeonColorPick" value="#ff0080" oninput="document.getElementById('iNeonColor').value=this.value;syncNeonColor()">
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Neon Font</div>
      <select id="iNeonFont" onchange="state.neonFont=this.value">
        <option value="orbitron">Orbitron (sci-fi)</option>
        <option value="syne">Syne (bold)</option>
        <option value="mono">Monospace</option>
        <option value="cursive">Cursive</option>
      </select>
    </div>
    <div class="prow">
      <div class="plabel">Neon Size <span id="neonSzVal">28px</span></div>
      <input type="range" min="14" max="72" value="28" id="iNeonSize" oninput="state.neonSize=+this.value;document.getElementById('neonSzVal').textContent=this.value+'px'">
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('neonFlicker','togNeonFlicker')"><div class="tog-sw on" id="togNeonFlicker"></div><span class="tog-label">Flicker animation</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('neonBuzz','togNeonBuzz')"><div class="tog-sw" id="togNeonBuzz"></div><span class="tog-label">Buzz / glitch</span></div>
    </div>
    <div class="pnote" style="margin:0 16px 10px">Preview: <span id="neonPreview" style="font-family:'Orbitron',monospace;color:#ff0080;text-shadow:0 0 8px #ff0080,0 0 20px #ff0080;font-size:.85rem">NEON SIGN</span></div>
  </div>

  <!-- ══════ EMBEDS PANEL ══════ -->
  <div class="panel" id="s-embeds">
    <div class="ph">□ Embeds <span class="ph-sub">external content blocks</span></div>

    <!-- YouTube -->
    <div class="prow">
      <div class="plabel">YouTube Embed <span>video or playlist</span></div>
      <div class="tog" style="margin-bottom:8px" onclick="toggle('showYoutube','togYoutube')"><div class="tog-sw" id="togYoutube"></div><span class="tog-label">Show YouTube embed</span></div>
      <input type="text" id="iYoutubeUrl" placeholder="https://youtu.be/dQw4w9WgXcQ" oninput="syncYoutubeEmbed()" maxlength="100">
    </div>

    <!-- Twitch -->
    <div class="prow">
      <div class="plabel">Twitch Channel</div>
      <div class="tog" style="margin-bottom:8px" onclick="toggle('showTwitch','togTwitch')"><div class="tog-sw" id="togTwitch"></div><span class="tog-label">Show Twitch status</span></div>
      <input type="text" id="iTwitchUser" placeholder="yourtwitchname" oninput="state.twitchUser=this.value" maxlength="30">
      <div style="font-size:.63rem;color:var(--txt3);margin-top:4px">Shows live badge + channel link</div>
    </div>

    <!-- Twitter/X widget -->
    <div class="prow">
      <div class="plabel">Twitter/X Profile</div>
      <div class="tog" style="margin-bottom:8px" onclick="toggle('showTwitter','togTwitterWidget')"><div class="tog-sw" id="togTwitterWidget"></div><span class="tog-label">Show follow button</span></div>
      <input type="text" id="iTwitterWidget" placeholder="@yourhandle" oninput="state.twitterWidget=this.value" maxlength="30">
    </div>

    <!-- Steam -->
    <div class="prow">
      <div class="plabel">Steam Profile</div>
      <div class="tog" style="margin-bottom:8px" onclick="toggle('showSteam','togSteam')"><div class="tog-sw" id="togSteam"></div><span class="tog-label">Show Steam mini card</span></div>
      <input type="text" id="iSteamId" placeholder="Steam profile URL or ID64" oninput="state.steamId=this.value" maxlength="80">
    </div>

    <!-- Custom iFrame -->
    <div class="prow">
      <div class="plabel">Custom iFrame <span>⚠️ advanced</span></div>
      <div class="tog" style="margin-bottom:8px" onclick="toggle('showIframe','togIframe')"><div class="tog-sw" id="togIframe"></div><span class="tog-label">Show custom embed</span></div>
      <input type="url" id="iIframeUrl" placeholder="https://..." oninput="state.iframeUrl=this.value.trim()" maxlength="200">
      <div class="prow" style="padding:4px 0 0">
        <div class="plabel">iFrame Height <span id="iframeHVal">200px</span></div>
        <input type="range" min="80" max="600" value="200" id="iIframeH" oninput="state.iframeH=+this.value;document.getElementById('iframeHVal').textContent=this.value+'px'">
      </div>
      <div class="pnote" style="margin-top:4px">Only embeds HTTPS sites. Some sites block iframes.</div>
    </div>
  </div>

  <!-- ══════ VIDEO BACKGROUND PANEL ══════ -->
  <div class="panel" id="s-videobg">
    <div class="ph">▣ Video Background</div>
    <div class="prow">
      <div class="plabel">Upload Video <span>.mp4 / .webm — max 50MB</span></div>
      <div class="up-wrap" id="vbgUpWrap" onclick="document.getElementById('vbgFile').click()" style="cursor:pointer;border:1.5px dashed rgba(255,255,255,.1);border-radius:10px;padding:20px;text-align:center">
        <div style="font-size:1.5rem">📹</div>
        <div style="font-size:.7rem;color:var(--txt3);margin-top:4px">Click to upload video background</div>
        <input type="file" id="vbgFile" accept="video/mp4,video/webm,video/quicktime" style="display:none" onchange="uploadVideoBg(this)">
      </div>
      <div class="up-progress" id="vbgProgress"><div class="up-bar" id="vbgBar"></div></div>
    </div>
    <div class="prow" id="vbgUrlRow" style="display:none">
      <div class="plabel">Or paste video URL</div>
      <input type="url" id="iVidBgUrl" placeholder="https://...mp4" oninput="syncVidBgUrl()">
    </div>
    <div class="prow">
      <div class="plabel">Overlay Darkness <span id="vbgDimVal">60%</span></div>
      <input type="range" min="0" max="95" value="60" id="iVbgDim" oninput="state.vbgDim=+this.value;document.getElementById('vbgDimVal').textContent=this.value+'%'">
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('vbgBlur','togVbgBlur')"><div class="tog-sw" id="togVbgBlur"></div><span class="tog-label">Blur video background</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('vbgGrayscale','togVbgGray')"><div class="tog-sw" id="togVbgGray"></div><span class="tog-label">Grayscale filter</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Blend Mode</div>
      <select id="iVbgBlend" onchange="state.vbgBlend=this.value">
        <option value="normal">Normal</option>
        <option value="multiply">Multiply</option>
        <option value="screen">Screen</option>
        <option value="overlay">Overlay</option>
        <option value="soft-light">Soft Light</option>
        <option value="color-dodge">Color Dodge</option>
      </select>
    </div>
    <div class="pnote">Video background plays silently and loops automatically. Keep file under 50MB for best performance.</div>
  </div>

  <!-- ══════ PROFILE CARD+ PANEL ══════ -->
  <div class="panel" id="s-profile-card">
    <div class="ph">◆ Profile Card+ <span class="ph-sub">advanced card controls</span></div>

    <!-- Pronouns pill style -->
    <div class="prow">
      <div class="plabel">Pronouns Style</div>
      <select id="iPronounsStyle" onchange="state.pronounsStyle=this.value">
        <option value="pill">Pill</option>
        <option value="slash">Slash text (he/him)</option>
        <option value="badge">Badge</option>
        <option value="hidden">Hidden</option>
      </select>
    </div>

    <!-- Second accent line under name -->
    <div class="prow">
      <div class="plabel">Subtitle / Role Tag</div>
      <input type="text" id="iSubtitle" placeholder="e.g. Full Stack Dev · he/him · 19" maxlength="50" oninput="state.subtitle=this.value">
      <div style="font-size:.63rem;color:var(--txt3);margin-top:3px">Shows in accent color under your name</div>
    </div>

    <!-- Verified checkmark -->
    <div class="prow">
      <div class="tog" onclick="toggle('showVerified','togVerifiedMain')"><div class="tog-sw" id="togVerifiedMain"></div><span class="tog-label">Verified checkmark ✓ by name</span></div>
    </div>

    <!-- Card shadow -->
    <div class="prow">
      <div class="plabel">Card Shadow Style</div>
      <select id="iCardShadow" onchange="state.cardShadow=this.value">
        <option value="default">Default glow</option>
        <option value="sharp">Sharp (no blur)</option>
        <option value="double">Double layer</option>
        <option value="colored">Colored accent shadow</option>
        <option value="none">None</option>
      </select>
    </div>

    <!-- Top banner on card -->
    <div class="prow">
      <div class="plabel">Card Banner</div>
      <div class="tog" style="margin-bottom:8px" onclick="toggle('showBanner','togCardBanner')"><div class="tog-sw" id="togCardBanner"></div><span class="tog-label">Show banner strip at top of card</span></div>
      <div style="display:flex;gap:6px;margin-bottom:6px">
        <input type="text" id="iBannerColor" value="#a855f7" placeholder="#a855f7" oninput="syncBannerColor()" style="flex:1">
        <input type="color" id="iBannerColorPick" value="#a855f7" oninput="document.getElementById('iBannerColor').value=this.value;syncBannerColor()">
      </div>
      <input type="url" id="iBannerImg" placeholder="Banner image URL (optional)" oninput="state.bannerImg=this.value.trim()">
    </div>

    <!-- Card back texture -->
    <div class="prow">
      <div class="plabel">Card Texture</div>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:5px;margin-top:4px">
        <div class="ls-card sel" id="tex-none" onclick="setCardTexture('none',this)"><div class="ls-preview"></div>None</div>
        <div class="ls-card" id="tex-noise" onclick="setCardTexture('noise',this)"><div class="ls-preview" style="background-image:url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22><filter id=%22n%22><feTurbulence type=%22fractalNoise%22 baseFrequency=%220.65%22 numOctaves=%223%22 stitchTiles=%22stitch%22/><feColorMatrix type=%22saturate%22 values=%220%22/></filter><rect width=%22100%25%22 height=%22100%25%22 filter=%22url(%23n)%22 opacity=%220.15%22/></svg>');background-size:cover;border-radius:6px"></div>Grain</div>
        <div class="ls-card" id="tex-grid" onclick="setCardTexture('grid',this)"><div class="ls-preview" style="background-image:repeating-linear-gradient(0deg,rgba(255,255,255,.04) 0px,transparent 1px,transparent 9px,rgba(255,255,255,.04) 10px),repeating-linear-gradient(90deg,rgba(255,255,255,.04) 0px,transparent 1px,transparent 9px,rgba(255,255,255,.04) 10px);border-radius:6px"></div>Grid</div>
        <div class="ls-card" id="tex-dots" onclick="setCardTexture('dots',this)"><div class="ls-preview" style="background-image:radial-gradient(rgba(255,255,255,.12) 1px,transparent 1px);background-size:8px 8px;border-radius:6px"></div>Dots</div>
        <div class="ls-card" id="tex-circuit" onclick="setCardTexture('circuit',this)"><div class="ls-preview" style="display:flex;align-items:center;justify-content:center;font-size:.55rem;color:var(--acc)">⊢⊣</div>Circuit</div>
        <div class="ls-card" id="tex-carbon" onclick="setCardTexture('carbon',this)"><div class="ls-preview" style="background:repeating-linear-gradient(45deg,rgba(255,255,255,.03) 0px,rgba(255,255,255,.03) 2px,transparent 2px,transparent 8px);border-radius:6px"></div>Carbon</div>
      </div>
    </div>

    <!-- Divider style -->
    <div class="prow">
      <div class="plabel">Section Dividers</div>
      <select id="iDivider" onchange="state.divider=this.value">
        <option value="line">Thin line</option>
        <option value="gradient">Gradient fade</option>
        <option value="dots">Dotted</option>
        <option value="none">None</option>
      </select>
    </div>
  </div>

  <!-- ══════ SOUND FX PANEL ══════ -->
  <div class="panel" id="s-sound">
    <div class="ph">♪ Sound FX <span class="ph-sub">micro interactions</span></div>
    <div class="pnote green" style="margin-bottom:10px">Sound effects play when visitors interact with your profile. All sounds are subtle and short.</div>
    <div class="prow">
      <div class="tog" onclick="toggleSoundFx()"><div class="tog-sw" id="togSoundFx"></div><span class="tog-label">Enable sound effects</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Hover Sound</div>
      <select id="iHoverSound" onchange="state.hoverSound=this.value">
        <option value="none">None</option>
        <option value="click">Soft click</option>
        <option value="tick">Tick</option>
        <option value="whoosh">Whoosh</option>
      </select>
      <button class="tbtn sm" style="margin-top:5px" onclick="testSound(document.getElementById('iHoverSound').value)">▶ Test</button>
    </div>
    <div class="prow">
      <div class="plabel">Link Click Sound</div>
      <select id="iClickSound" onchange="state.clickSound=this.value">
        <option value="pop">Pop</option>
        <option value="click">Click</option>
        <option value="boop">Boop</option>
        <option value="chime">Chime</option>
        <option value="none">None</option>
      </select>
      <button class="tbtn sm" style="margin-top:5px" onclick="testSound(document.getElementById('iClickSound').value)">▶ Test</button>
    </div>
    <div class="prow">
      <div class="plabel">Profile Load Sound</div>
      <select id="iLoadSound" onchange="state.loadSound=this.value">
        <option value="none">None</option>
        <option value="startup">Startup chime</option>
        <option value="boot">Boot beep</option>
        <option value="swipe">Swipe in</option>
      </select>
    </div>
    <div class="prow">
      <div class="plabel">Volume <span id="soundVolVal">30%</span></div>
      <input type="range" min="0" max="100" value="30" id="iSoundVol" oninput="state.soundVol=+this.value;document.getElementById('soundVolVal').textContent=this.value+'%'">
    </div>
  </div>

  <!-- ══════ GALLERY PANEL ══════ -->
  <div class="panel" id="s-gallery">
    <div class="ph">▣ Gallery <span class="ph-sub">image showcase</span></div>
    <div class="prow">
      <div class="tog" onclick="toggle('showGallery','togGallery')"><div class="tog-sw" id="togGallery"></div><span class="tog-label">Show gallery on profile</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Gallery Layout</div>
      <select id="iGalleryLayout" onchange="state.galleryLayout=this.value">
        <option value="grid">Grid (3 columns)</option>
        <option value="masonry">Masonry</option>
        <option value="scroll">Horizontal scroll</option>
        <option value="polaroid">Polaroid style</option>
        <option value="filmstrip">Film strip</option>
      </select>
    </div>
    <div class="prow">
      <div class="plabel">Add Images</div>
      <button class="tbtn acc" onclick="document.getElementById('galleryFileInput').click()">+ Upload Images</button>
      <input type="file" id="galleryFileInput" multiple accept="image/*" style="display:none" onchange="addGalleryImages(this)">
      <div style="font-size:.63rem;color:var(--txt3);margin-top:5px">Max 6 images. JPG/PNG/GIF/WebP.</div>
    </div>
    <div id="galleryPreviewGrid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:5px;margin-top:8px"></div>
    <div class="prow" style="margin-top:6px">
      <div class="plabel">Image Hover Effect</div>
      <select id="iGalleryHover" onchange="state.galleryHover=this.value">
        <option value="zoom">Zoom in</option>
        <option value="brightness">Brighten</option>
        <option value="tilt">3D tilt</option>
        <option value="overlay">Caption overlay</option>
        <option value="none">None</option>
      </select>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('galleryLightbox','togLightbox')"><div class="tog-sw on" id="togLightbox"></div><span class="tog-label">Lightbox on click</span></div>
    </div>
  </div>

  <!-- ══════ PRIVACY PANEL ══════ -->
  <div class="panel" id="s-password">
    <div class="ph">◈ Privacy & Security</div>
    <div class="prow">
      <div class="plabel">Profile Password <span>optional — lock your profile</span></div>
      <div class="tog" style="margin-bottom:8px" onclick="toggleProfileLock()"><div class="tog-sw" id="togProfileLock"></div><span class="tog-label">Require password to view</span></div>
      <input type="password" id="iProfilePw" placeholder="Set a password..." oninput="state.profilePassword=this.value" autocomplete="new-password">
      <div class="pnote" style="margin-top:6px">Password is hashed server-side. You'll need it to delete or edit your profile. <strong>Don't forget it.</strong></div>
    </div>
    <div class="prow">
      <div class="plabel">Visibility</div>
      <select id="iVisibility" onchange="state.visibility=this.value">
        <option value="public">🌍 Public — anyone can view</option>
        <option value="unlisted">🔗 Unlisted — only with direct link</option>
        <option value="private">🔒 Private — password only</option>
      </select>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('hideViewCount','togHideViews')"><div class="tog-sw" id="togHideViews"></div><span class="tog-label">Hide view count from visitors</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('noIndex','togNoIndex')"><div class="tog-sw" id="togNoIndex"></div><span class="tog-label">Exclude from search engines</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('noScreenshot','togNoScreenshot')"><div class="tog-sw" id="togNoScreenshot"></div><span class="tog-label">Anti-screenshot overlay</span></div>
    </div>
  </div>

  <!-- ══════ SEO & META PANEL ══════ -->
  <div class="panel" id="s-seo">
    <div class="ph">◇ SEO & Meta <span class="ph-sub">how your profile looks when shared</span></div>
    <div class="prow">
      <div class="plabel">OG Title <span>shows in link previews</span></div>
      <input type="text" id="iOgTitle" placeholder="e.g. John's Profile — Dev & Designer" maxlength="60" oninput="state.ogTitle=this.value">
    </div>
    <div class="prow">
      <div class="plabel">OG Description</div>
      <textarea id="iOgDesc" placeholder="Short description for Discord/Twitter/iMessage link previews..." style="resize:vertical;min-height:60px;padding:8px;border-radius:7px;background:rgba(255,255,255,.04);border:1px solid var(--line2);color:var(--txt);font-family:var(--sans);font-size:.78rem;width:100%;outline:none" maxlength="160" oninput="state.ogDesc=this.value"></textarea>
      <div style="font-size:.62rem;color:var(--txt3);text-align:right" id="ogDescCount">0/160</div>
    </div>
    <div class="prow">
      <div class="plabel">OG Image URL <span>1200×630px recommended</span></div>
      <input type="url" id="iOgImage" placeholder="https://...jpg" oninput="state.ogImage=this.value.trim()">
      <div style="font-size:.63rem;color:var(--txt3);margin-top:3px">Leave blank to use your avatar automatically</div>
    </div>
    <div class="prow">
      <div class="plabel">Theme Color <span>browser tab tint</span></div>
      <div style="display:flex;gap:6px">
        <input type="text" id="iThemeColor" value="#a855f7" placeholder="#a855f7" oninput="state.themeColor=this.value" style="flex:1">
        <input type="color" id="iThemeColorPick" value="#a855f7" oninput="document.getElementById('iThemeColor').value=this.value;state.themeColor=this.value">
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Twitter Card Type</div>
      <select id="iTwitterCard" onchange="state.twitterCard=this.value">
        <option value="summary">summary</option>
        <option value="summary_large_image" selected>summary_large_image (recommended)</option>
      </select>
    </div>
    <div id="ogPreviewBox" style="margin:8px 16px 16px;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03)">
      <div style="font-size:.6rem;color:var(--txt3);margin-bottom:6px;font-family:var(--mono)">// DISCORD EMBED PREVIEW</div>
      <div style="border-left:4px solid #a855f7;padding-left:8px">
        <div id="ogPrevSite" style="font-size:.6rem;color:var(--acc);font-family:var(--mono)">vltx-adoe.onrender.com</div>
        <div id="ogPrevTitle" style="font-size:.78rem;font-weight:600;color:var(--txt);margin:2px 0">Profile Title</div>
        <div id="ogPrevDesc" style="font-size:.68rem;color:var(--txt2)">Your description here</div>
      </div>
    </div>
  </div>

  <!-- ══════ ANALYTICS CONFIG PANEL ══════ -->
  <div class="panel" id="s-analytics-cfg">
    <div class="ph">◆ Analytics+ <span class="ph-sub">track &amp; notify</span></div>
    <div class="prow">
      <div class="plabel">Discord Webhook <span>get notified of profile views</span></div>
      <input type="url" id="iDiscordWebhook" placeholder="https://discord.com/api/webhooks/..." oninput="state.discordWebhook=this.value.trim()" style="font-size:.7rem">
      <button class="tbtn acc sm" style="margin-top:6px" onclick="saveWebhook()">💾 Save Webhook</button>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('webhookOnView','togWHView')"><div class="tog-sw on" id="togWHView"></div><span class="tog-label">Ping on every profile view</span></div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggle('webhookOnFollow','togWHFollow')"><div class="tog-sw on" id="togWHFollow"></div><span class="tog-label">Ping on new follower</span></div>
    </div>
    <div class="prow">
      <div class="plabel">View Analytics</div>
      <button class="tbtn acc sm" onclick="openAnalytics()">📊 Open Analytics Dashboard →</button>
      <div style="font-size:.63rem;color:var(--txt3);margin-top:4px">Hourly chart, top countries, referrers</div>
    </div>
    <div class="prow">
      <div class="plabel">Profile Stats on Card</div>
      <div class="tog" onclick="toggle('showViewsBadge','togViewsBadge')"><div class="tog-sw on" id="togViewsBadge"></div><span class="tog-label">Show live view counter</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Link Click Tracking</div>
      <div class="tog" onclick="toggle('trackClicks','togTrackClicks')"><div class="tog-sw on" id="togTrackClicks"></div><span class="tog-label">Track which links visitors click</span></div>
    </div>
  </div>

<!-- COUNTDOWN PANEL -->
  <div class="panel" id="s-countdown">
    <div class="ph">⏱ Countdown Widget <span class="ph-sub">add urgency</span></div>
    <div class="prow">
      <div class="tog" onclick="toggleCountdownWidget()"><div class="tog-sw" id="togCountdown"></div><span class="tog-label">Show countdown on profile</span></div>
    </div>
    <div class="prow">
      <div class="plabel">Event Label <span id="ctLabelCount">0/30</span></div>
      <input type="text" id="iCtLabel" placeholder="e.g. 🚀 Launch Day" maxlength="30" oninput="syncCountdownWidget();document.getElementById('ctLabelCount').textContent=this.value.length+'/30'">
    </div>
    <div class="prow">
      <div class="plabel">Target Date & Time</div>
      <input type="datetime-local" id="iCtDate" oninput="syncCountdownWidget()" style="font-family:var(--mono);font-size:.75rem;">
    </div>
    <div class="prow">
      <div class="plabel">Style</div>
      <div class="opt-grid c2">
        <div class="opt on" id="cts-blocks" onclick="setCtStyle('blocks',this)"><div class="opt-prev" style="font-size:.5rem;display:flex;gap:2px;justify-content:center;color:var(--acc)">00 00 00</div>Blocks</div>
        <div class="opt" id="cts-minimal" onclick="setCtStyle('minimal',this)"><div class="opt-prev" style="font-size:.5rem;color:rgba(255,255,255,.4)">12d 5h 30m</div>Minimal</div>
        <div class="opt" id="cts-flip" onclick="setCtStyle('flip',this)"><div class="opt-prev" style="font-size:.55rem;background:rgba(255,255,255,.08);border-radius:3px;padding:1px 4px">12:30</div>Flip</div>
        <div class="opt" id="cts-progress" onclick="setCtStyle('progress',this)"><div class="opt-prev" style="height:4px;background:linear-gradient(90deg,var(--acc),transparent);border-radius:100px;margin:4px 0"></div>Progress Bar</div>
      </div>
    </div>
    <div class="prow" id="ctPreviewBox" style="display:none">
      <div class="plabel">Live Preview</div>
      <div id="ctPreviewCard" style="background:rgba(192,132,252,.06);border:1px solid rgba(192,132,252,.18);border-radius:8px;padding:12px;text-align:center;">
        <div id="ctPreviewLabel" style="font-size:.62rem;color:rgba(192,132,252,.7);margin-bottom:6px;letter-spacing:.06em;text-transform:uppercase;">EVENT</div>
        <div id="ctPreviewTimer" style="font-family:var(--mono);font-size:1.1rem;color:#fff;letter-spacing:.08em;">--d --h --m --s</div>
      </div>
    </div>
    <div class="pnote" style="margin-top:8px">Shows a live countdown on your profile card. Resets to "🎉 Event passed!" when time runs out.</div>
  </div>

  <!-- QR CODE PANEL -->
  <div class="panel" id="s-qr">
    <div class="ph">◼ QR Code <span class="ph-sub">shareable profile link</span></div>
    <div class="pnote green" style="margin-bottom:10px">Generate a scannable QR code for your VLTX profile. Perfect for stream overlays, business cards, or socials.</div>
    <div class="prow">
      <div class="plabel">Profile URL</div>
      <input type="text" id="iQrUrl" placeholder="vltx-adoe.onrender.com/yourname" oninput="generateQR()" style="font-family:var(--mono);font-size:.72rem;">
      <div style="font-size:.63rem;color:var(--txt3);margin-top:3px">Auto-filled from your username. Edit if needed.</div>
    </div>
    <div class="prow">
      <div class="plabel">QR Color</div>
      <div class="crow">
        <input type="text" id="iQrColor" value="#c084fc" oninput="generateQR()" style="font-family:var(--mono);">
        <input type="color" id="iQrColorPick" value="#c084fc" oninput="document.getElementById('iQrColor').value=this.value;generateQR()">
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Size</div>
      <div class="opt-grid c3">
        <div class="opt on" id="qrs-sm" onclick="setQrSize(150,this)">Small</div>
        <div class="opt" id="qrs-md" onclick="setQrSize(200,this)">Medium</div>
        <div class="opt" id="qrs-lg" onclick="setQrSize(280,this)">Large</div>
      </div>
    </div>
    <div class="prow" style="text-align:center;">
      <canvas id="qrCanvas" width="150" height="150" style="border-radius:10px;border:2px solid var(--line2);background:#fff;max-width:100%;display:block;margin:0 auto;"></canvas>
      <div style="font-size:.63rem;color:var(--txt3);margin-top:6px" id="qrStatusText">Enter a username or URL above to generate your QR code.</div>
    </div>
    <div class="prow" style="display:flex;gap:7px;justify-content:center;">
      <button class="tbtn acc" onclick="downloadQR()">⬇ Download PNG</button>
      <button class="tbtn ghost" onclick="copyQRToClipboard()">📋 Copy</button>
    </div>
  </div>

  <!-- KEYBOARD SHORTCUTS PANEL -->
  <div class="panel" id="s-shortcuts">
    <div class="ph">⌨ Keyboard Shortcuts</div>
    <div style="display:flex;flex-direction:column;gap:4px;padding:8px 0;">
      <div style="display:flex;justify-content:space-between;align-items:center;padding:7px 9px;background:var(--bg2);border:1px solid var(--line);border-radius:6px;">
        <span style="font-size:.74rem;">Undo last change</span>
        <span style="font-family:var(--mono);font-size:.65rem;background:rgba(255,255,255,.07);padding:2px 7px;border-radius:4px;color:var(--acc);">Ctrl + Z</span>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding:7px 9px;background:var(--bg2);border:1px solid var(--line);border-radius:6px;">
        <span style="font-size:.74rem;">Redo</span>
        <span style="font-family:var(--mono);font-size:.65rem;background:rgba(255,255,255,.07);padding:2px 7px;border-radius:4px;color:var(--acc);">Ctrl + Y</span>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding:7px 9px;background:var(--bg2);border:1px solid var(--line);border-radius:6px;">
        <span style="font-size:.74rem;">Save / Publish</span>
        <span style="font-family:var(--mono);font-size:.65rem;background:rgba(255,255,255,.07);padding:2px 7px;border-radius:4px;color:var(--acc);">Ctrl + S</span>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding:7px 9px;background:var(--bg2);border:1px solid var(--line);border-radius:6px;">
        <span style="font-size:.74rem;">Search panels</span>
        <span style="font-family:var(--mono);font-size:.65rem;background:rgba(255,255,255,.07);padding:2px 7px;border-radius:4px;color:var(--acc);">Ctrl + K</span>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding:7px 9px;background:var(--bg2);border:1px solid var(--line);border-radius:6px;">
        <span style="font-size:.74rem;">Toggle mobile/desktop preview</span>
        <span style="font-family:var(--mono);font-size:.65rem;background:rgba(255,255,255,.07);padding:2px 7px;border-radius:4px;color:var(--acc);">Alt + M</span>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding:7px 9px;background:var(--bg2);border:1px solid var(--line);border-radius:6px;">
        <span style="font-size:.74rem;">Fullscreen preview</span>
        <span style="font-family:var(--mono);font-size:.65rem;background:rgba(255,255,255,.07);padding:2px 7px;border-radius:4px;color:var(--acc);">Ctrl + P</span>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding:7px 9px;background:var(--bg2);border:1px solid var(--line);border-radius:6px;">
        <span style="font-size:.74rem;">Export config</span>
        <span style="font-family:var(--mono);font-size:.65rem;background:rgba(255,255,255,.07);padding:2px 7px;border-radius:4px;color:var(--acc);">Ctrl + E</span>
      </div>
    </div>
    <div class="pnote" style="margin-top:4px">Your progress auto-saves to your browser every 30 seconds. Use the Export/Import panel to create a JSON backup.</div>
  </div>

  <!-- EXPORT / IMPORT PANEL -->
  <div class="panel" id="s-export">
    <div class="ph">↓ Export / Import <span class="ph-sub">backup &amp; restore</span></div>
    <div class="prow">
      <div class="plabel">Export Config</div>
      <div style="font-size:.72rem;color:var(--txt2);margin-bottom:8px;line-height:1.6;">Download your entire profile configuration as a JSON file. Restore it anytime or share your setup.</div>
      <button class="tbtn acc" onclick="exportConfig()" style="width:100%;justify-content:center;">⬇ Download config.json</button>
    </div>
    <div class="prow">
      <div class="plabel">Import Config</div>
      <div style="font-size:.72rem;color:var(--txt2);margin-bottom:8px;line-height:1.6;">Load a previously exported config file to restore your profile settings.</div>
      <label class="upload-btn" for="importFileInput" style="width:100%;justify-content:center;display:flex;">⬆ Import config.json</label>
      <input type="file" id="importFileInput" accept=".json,application/json" style="display:none" onchange="importConfig(this)">
      <div class="pnote" style="margin-top:5px">⚠️ This will overwrite your current settings. Export first if you want to back up.</div>
    </div>
    <div class="prow">
      <div class="plabel">Auto-Save</div>
      <div style="display:flex;align-items:center;gap:8px;padding:8px 10px;background:var(--bg2);border:1px solid var(--line);border-radius:7px;">
        <div id="autosaveDot" style="width:6px;height:6px;border-radius:50%;background:var(--green);box-shadow:0 0 5px var(--green);flex-shrink:0;animation:dotPulse 2.2s ease infinite;"></div>
        <div style="flex:1">
          <div style="font-size:.74rem;font-weight:600;">Auto-save active</div>
          <div id="autosaveTime" style="font-size:.62rem;color:var(--txt3);margin-top:1px;">Never saved</div>
        </div>
        <button class="tbtn ghost sm" onclick="autosaveNow()">Save now</button>
      </div>
    </div>
    <div class="prow">
      <div class="plabel">Undo History <span id="historyStatus" style="color:var(--txt3);font-family:var(--mono);font-size:.65rem;">0 changes</span></div>
      <div style="display:flex;gap:7px;">
        <button class="tbtn ghost sm" onclick="undoState()">↶ Undo</button>
        <button class="tbtn ghost sm" onclick="redoState()">↷ Redo</button>
        <button class="tbtn ghost sm" onclick="clearHistory()" style="margin-left:auto;color:var(--red);">🗑 Clear history</button>
      </div>
    </div>
  </div>

<!-- PUBLISH MODAL -->
<div class="modal-overlay" id="publishModal">
  <div class="modal">
    <h2>🚀 Publish Profile</h2>
    <p>Choose your username. This becomes your permanent URL.</p>
    <input type="text" id="publishUsername" placeholder="yourname" maxlength="30" style="text-align:center;font-size:1rem;padding:10px;" oninput="onPubInput()">
    <div id="publishUrlPreview" class="modal-url">vltx-adoe.onrender.com/yourname</div>
    <div class="modal-acts">
      <button class="tbtn acc" onclick="publishProfile()" id="publishBtn" style="padding:9px 24px">Publish →</button>
      <button class="tbtn ghost" onclick="hidePublish()">Cancel</button>
    </div>
    <p style="margin-top:10px;font-size:.7rem;color:var(--mut)">Stats are real and cannot be faked.</p>
  </div>
</div>

<!-- SUCCESS MODAL -->
<div class="modal-overlay" id="successModal">
  <div class="modal">
    <div style="font-size:2.6rem;margin-bottom:8px">🎉</div>
    <h2>You're live!</h2>
    <p>Your profile is published. Share this link:</p>
    <div class="modal-url" id="successUrl" onclick="copyUrl()">vltx-adoe.onrender.com/yourname</div>
    <div class="modal-acts">
      <button class="tbtn suc" onclick="copyUrl()">📋 Copy</button>
      <button class="tbtn acc" onclick="visitProfile()">Visit →</button>
      <button class="tbtn ghost" onclick="hideSuccess()">Close</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>
<audio id="audioEl" style="display:none"></audio>

<!-- BACKEND ERROR MODAL -->
<div class="modal-overlay" id="backendErrorModal">
  <div class="modal" style="max-width:440px">
    <div style="font-family:'Space Mono',monospace;color:#f43f5e;font-size:.7rem;margin-bottom:8px">// PUBLISH FAILED</div>
    <h2 style="font-size:1rem;margin-bottom:6px">Server not reachable</h2>
    <div style="font-size:.72rem;color:var(--mut);margin-bottom:12px">Error: <code id="backendErrorMsg" style="color:#f87171;font-family:'Space Mono',monospace;font-size:.68rem"></code></div>
    
    <div style="background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.07);border-radius:8px;padding:12px;margin-bottom:14px;font-size:.7rem;line-height:1.9">
      <div style="font-family:'Space Mono',monospace;color:rgba(6,182,212,.7);margin-bottom:8px;font-size:.6rem">// CHECKLIST — fix these in order:</div>
      <div>1. <strong>Domain DNS</strong> — <code style="color:#a78bfa;font-family:'Space Mono',monospace">vltx-adoe.onrender.com</code> — your Render URL to your server IP in your registrar</div>
      <div style="margin-top:4px">2. <strong>Server running</strong> — SSH in and run <code style="color:#a78bfa;font-family:'Space Mono',monospace">pm2 start server.js</code> (or your start cmd)</div>
      <div style="margin-top:4px">3. <strong>Port open</strong> — make sure port 80/443 is open in your firewall/security group</div>
      <div style="margin-top:4px">4. <strong>API route exists</strong> — your server needs <code style="color:#a78bfa;font-family:'Space Mono',monospace">POST /api/profile</code> to save &amp; return <code style="color:#a78bfa;font-family:'Space Mono',monospace">{url: "/z3n0"}</code></div>
      <div style="margin-top:4px">5. <strong>Profile route exists</strong> — your server needs <code style="color:#a78bfa;font-family:'Space Mono',monospace">GET /:username</code> to serve saved profiles</div>
    </div>
    
    <div style="background:rgba(124,58,237,.06);border:1px solid rgba(124,58,237,.2);border-radius:8px;padding:10px;font-family:'Space Mono',monospace;font-size:.6rem;color:var(--mut);line-height:1.8;margin-bottom:14px">
      <span style="color:rgba(6,182,212,.7)"># minimal Express server example:</span><br>
      app.post('/api/profile', (req,res) =&gt; {<br>
      &nbsp;&nbsp;const {username,data} = req.body;<br>
      &nbsp;&nbsp;fs.writeFileSync(`profiles/${username}.json`, JSON.stringify(data));<br>
      &nbsp;&nbsp;res.json({url: `/${username}`});<br>
      });<br>
      app.get('/:u', (req,res) =&gt; {<br>
      &nbsp;&nbsp;res.sendFile(`profiles/${req.params.u}.json`);<br>
      });
    </div>
    
    <div class="modal-acts">
      <button class="tbtn ghost" onclick="hideBackendError()">Close</button>
      <button class="tbtn acc sm" onclick="navigator.clipboard.writeText(document.getElementById('backendErrorMsg').textContent);showToast('Copied error')">Copy Error</button>
    </div>
  </div>
</div>

<script>
// ══════════════════════════════════════════════════════════════════
// STATE
// ══════════════════════════════════════════════════════════════════
const state = {
  username:'', displayName:'', pronouns:'', status:'',
  location:'', website:'',
  bioLines:['full time lurker. part time god.','i make stuff and it sometimes slaps.'],
  tags:['🌙 nocturnal','🎮 gamer','🎨 creator'],
  twSpeed:'normal',
  badges:[], showVerified:false,
  avatar:null, avatarEmoji:'👾', showOnline:true, avatarFloat:true,
  avatarShape:'circle', avBorderColor:'#7c3aed', avSize:76, avRingStyle:'solid',
  bgVideo:null, bgImage:null, bgColor:'#030308', aesthetic:'none',
  skills:[], role:'', openTo:[], projectName:'', projectDesc:'', projectUrl:'', projectStatus:'🔨 Building',
  githubUser:'', showGithubGraph:false,
  tracks:[], showMusic:false, autoplay:false, musicStyle:'default',
  accent:'#a855f7', accent2:'#22d3ee', cardBg:'#0f0f1a', blur:28,
  cardOpacity:92, glowInt:45, font:'outfit', textColor:'#f0f0fa',
  cardWidth:390, cardRadius:22,
  gradStart:'#ffffff', gradMid:'#a855f7', gradEnd:'#22d3ee', gradDir:'135deg',
  borderGrad:false, bgGrad:false,
  particle:'network', cursor:'dot',
  symbolRain:true, cardTilt:true, glow:true, clickSparks:true,
  avatarGlow:true, cardEntrance:true, scrollReveal:true, glitchName:false,
  pageAnim:'fade-up', nameAnim:'shimmer', linkHover:'lift',
  avHover:'tilt-spin', animSpeed:'1',
  linkStyle:'icons', showStats:true, showFooter:true, spacing:'normal',
  links:[],
  discordUrl:'', discordUser:'', discordUserId:'', discordStatus:'online',
  discordBadge:true, lanyardUserId:'', discordId:'',
  discordServerInvite:'', discordServerId:'', discordServerName:'', discordServerIcon:'',
  discordOnline:'', discordMembers:'', showDiscordServerWidget:true,
  spotifyUser:'', showSpotify:false, spotifyFallback:'',
  // NEW FEATURES
  bgEffect:'none',        // aurora, plasma, none
  cursorEffect:'dot',     // dot, ring, cross, glow, none, spotlight
  spotlightEffect:false,
  cardSkin:'',            // frosted, solid, neon, ''
  layout:'',              // modern, wide, ''
  monoIcons:false,
  showVolume:false,
  animTitle:false,
  showViewsBadge:true,
  githubUser:'',
};
let publishedUrl = '';

// ══════════════════════════════════════════
// NAV
// ══════════════════════════════════════════
function nav(el, panelId) {
  document.querySelectorAll('.ni').forEach(n => n.classList.remove('on'));
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('on'));
  el.classList.add('on');
  document.getElementById(panelId).classList.add('on');
}

// ══════════════════════════════════════════
// IDENTITY
// ══════════════════════════════════════════
function syncUsername() {
  state.username = document.getElementById('iUsername').value;
  document.getElementById('previewUrl').textContent = `vltx-adoe.onrender.com/${state.username || 'yourname'}`;
  const u = document.getElementById('pcUsername');
  u.textContent = state.displayName || state.username || 'yourname';
}
function syncDisplayName() {
  state.displayName = document.getElementById('iDisplayName').value;
  document.getElementById('pcUsername').textContent = state.displayName || state.username || 'yourname';
}
function syncPronouns() {
  state.pronouns = document.getElementById('iPronouns').value;
  const el = document.getElementById('pcPronouns');
  el.textContent = state.pronouns; el.style.display = state.pronouns ? '' : 'none';
}
function syncStatus() {
  const v = document.getElementById('iStatus').value;
  const cust = document.getElementById('iStatusCustom');
  cust.style.display = v === 'custom' ? '' : 'none';
  state.status = v === 'custom' ? cust.value : v;
  const el = document.getElementById('pcStatus');
  el.textContent = state.status; el.style.display = state.status ? 'inline-flex' : 'none';
  document.getElementById('statusBr').style.display = state.status ? '' : 'none';
}
function syncStatusCustom() { state.status = document.getElementById('iStatusCustom').value; document.getElementById('pcStatus').textContent = state.status; }
function syncLocation() { state.location = document.getElementById('iLocation').value; }
function syncWebsite() { state.website = document.getElementById('iWebsite').value; }
function onPubInput() {
  const v = document.getElementById('publishUsername').value.toLowerCase().replace(/[^a-z0-9_.\-]/g, '');
  document.getElementById('publishUsername').value = v;
  document.getElementById('publishUrlPreview').textContent = `vltx-adoe.onrender.com/${v || 'yourname'}`;
  state.username = v;
}

// ══════════════════════════════════════════
// DEVICE VIEW
// ══════════════════════════════════════════
function setDevice(d) {
  document.getElementById('pc').className = d === 'mobile' ? 'mobile-view' : 'desktop-view';
  document.getElementById('pdtMobile').classList.toggle('on', d === 'mobile');
  document.getElementById('pdtDesktop').classList.toggle('on', d === 'desktop');
}

// ══════════════════════════════════════════
// BADGES
// ══════════════════════════════════════════
function toggleBadge(el) {
  const badge = el.dataset.badge;
  el.classList.toggle('sel');
  if (el.classList.contains('sel')) {
    if (!state.badges.includes(badge)) state.badges.push(badge);
  } else {
    state.badges = state.badges.filter(b => b !== badge);
  }
  renderBadges();
}
function addCustomBadge() {
  const v = document.getElementById('iCustomBadge').value.trim();
  if (!v) return;
  state.badges.push(v);
  document.getElementById('iCustomBadge').value = '';
  renderBadges();
  showToast('✅ Badge added!');
}
function renderBadges() {
  const row = document.getElementById('pcBadgeRow');
  row.style.display = state.badges.length ? 'flex' : 'none';
  row.innerHTML = state.badges.map(b =>
    `<span style="font-size:1.1rem;padding:2px 5px;border-radius:6px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08);title='${b}'">${b}</span>`
  ).join('');
}

// ══════════════════════════════════════════
// TYPEWRITER
// ══════════════════════════════════════════
const twSpeeds = { fast: [30, 12, 1000], normal: [62, 30, 2400], slow: [110, 55, 3500], dramatic: [90, 40, 3800] };
let _twT = null, _twP = [], _twI = 0, _twC = 0, _twD = false;
function syncBio() {
  _twP = document.getElementById('iBio').value.split('\n').map(s => s.trim()).filter(Boolean);
  if (!_twP.length) _twP = [''];
  state.bioLines = _twP;
  clearTimeout(_twT); _twI = 0; _twC = 0; _twD = false;
  document.getElementById('pcBio').textContent = ''; _stepTW();
}
function syncTwSpeed() { state.twSpeed = document.getElementById('iTwSpeed').value; }
function _stepTW() {
  const el = document.getElementById('pcBio'); if (!_twP.length) return;
  const ph = _twP[_twI];
  const spd = twSpeeds[state.twSpeed] || twSpeeds.normal;
  if (!_twD) {
    _twC++; el.textContent = ph.slice(0, _twC);
    if (_twC >= ph.length) { _twD = true; _twT = setTimeout(_stepTW, spd[2]); }
    else _twT = setTimeout(_stepTW, spd[0]);
  } else {
    _twC--; el.textContent = ph.slice(0, _twC);
    if (_twC <= 0) { _twD = false; _twI = (_twI + 1) % _twP.length; _twT = setTimeout(_stepTW, 400); }
    else _twT = setTimeout(_stepTW, spd[1]);
  }
}
function syncTags() { state.tags = document.getElementById('iTags').value.split(',').map(s => s.trim()).filter(Boolean); renderTags(); }
function renderTags() { document.getElementById('pcTags').innerHTML = state.tags.map(t => `<span class="pc-tag">${t}</span>`).join(''); }
function syncEmoji() { state.avatarEmoji = document.getElementById('iEmoji').value || '👾'; if (!state.avatar) renderAvatar(); }

// ══════════════════════════════════════════
// AVATAR
// ══════════════════════════════════════════
function syncAvatarShape() {
  state.avatarShape = document.getElementById('iAvatarShape').value;
  const av = document.getElementById('pcAvatar');
  const radii = { circle: '50%', squircle: '22px', square: '6px', hexagon: '50%', star: '50%' };
  av.style.borderRadius = radii[state.avatarShape] || '50%';
  if (state.avatarShape === 'hexagon') { av.style.clipPath = 'polygon(50% 0%,100% 25%,100% 75%,50% 100%,0% 75%,0% 25%)'; }
  else if (state.avatarShape === 'star') { av.style.clipPath = 'polygon(50% 0%,61% 35%,98% 35%,68% 57%,79% 91%,50% 70%,21% 91%,32% 57%,2% 35%,39% 35%)'; }
  else av.style.clipPath = '';
}
function syncAvSize() {
  state.avSize = parseInt(document.getElementById('iAvSize').value);
  document.getElementById('avSizeVal').textContent = state.avSize + 'px';
  const av = document.getElementById('pcAvatar');
  const wrap = document.getElementById('pcAvWrap');
  av.style.width = av.style.height = state.avSize + 'px';
  wrap.style.width = wrap.style.height = (state.avSize + 4) + 'px';
}
function setRingStyle(el, style) {
  document.querySelectorAll('.ring-card').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
  state.avRingStyle = style;
  applyRingStyle();
}
function applyRingStyle() {
  const av = document.getElementById('pcAvatar');
  const c = state.avBorderColor;
  if (state.avRingStyle === 'none') { av.style.border = 'none'; av.style.boxShadow = ''; }
  else if (state.avRingStyle === 'solid') { av.style.border = `3px solid ${c}`; av.style.boxShadow = `0 0 0 4px ${c}22`; }
  else if (state.avRingStyle === 'glow') { av.style.border = `2px solid ${c}`; av.style.boxShadow = `0 0 16px ${c}, 0 0 30px ${c}44`; }
  else if (state.avRingStyle === 'gradient') { av.style.border = '2px solid transparent'; av.style.background = `linear-gradient(${state.cardBg}, ${state.cardBg}) padding-box, linear-gradient(135deg, ${state.accent}, ${state.accent2}) border-box`; }
  else if (state.avRingStyle === 'animated') { av.style.border = `2px dashed ${c}`; av.style.boxShadow = ''; av.style.animation = 'aSpin 4s linear infinite'; }
  else if (state.avRingStyle === 'rainbow') { av.style.border = '3px solid transparent'; av.style.backgroundImage = 'linear-gradient(#0f0f1a, #0f0f1a), linear-gradient(45deg, #ff0000, #ff7700, #ffff00, #00ff00, #0000ff, #8b00ff, #ff0000)'; av.style.backgroundClip = 'padding-box, border-box'; }
}
function syncAvBorderColor() { state.avBorderColor = document.getElementById('iAvBorderColor').value; document.getElementById('iAvBorderPick').value = state.avBorderColor; applyRingStyle(); }
function syncAvBorderPick() { const v = document.getElementById('iAvBorderPick').value; document.getElementById('iAvBorderColor').value = v; state.avBorderColor = v; applyRingStyle(); }
function toggleOnline() { state.showOnline = !state.showOnline; document.getElementById('togOnline').classList.toggle('on', state.showOnline); document.getElementById('pcOnlineDot').style.display = state.showOnline ? '' : 'none'; }
function toggleAvatarFloat() { state.avatarFloat = !state.avatarFloat; document.getElementById('togFloat').classList.toggle('on', state.avatarFloat); document.getElementById('pcAvatar').closest('.pc-av-wrap').style.animation = state.avatarFloat ? '' : 'none'; }
async function uploadAvatar(input) {
  const file = input.files[0]; if (!file) return;
  const local = URL.createObjectURL(file); state.avatar = local; renderAvatar();
  document.getElementById('avatarPreview').innerHTML = `<img src="${local}" style="width:100%;height:100%;object-fit:cover;">`;
  showProgress('avatarProg', 'avatarBar'); showToast('⬆️ Uploading...');
  const fd = new FormData(); fd.append('file', file);
  try { const r = await fetch('/api/upload/avatar', { method: 'POST', body: fd }); const d = await r.json(); if (d.url) { state.avatar = d.url; showToast('✅ Avatar uploaded!'); } }
  catch { showToast('⚠️ Avatar set locally (no server)'); }
  hideProgress('avatarProg');
}
function renderAvatar() {
  const el = document.getElementById('pcAvatar');
  if (state.avatar && /^(\/|http|blob)/.test(state.avatar)) { el.innerHTML = `<img src="${state.avatar}" style="width:100%;height:100%;object-fit:cover;">`; }
  else el.textContent = state.avatarEmoji || '👾';
}


// ══════════════════════════════════════════
// BACKGROUND — FULL SYSTEM
// ══════════════════════════════════════════
let bgState = {
  opacity: 40, blur: 0, scale: 100, brightness: 100, saturation: 100,
  tint: '', tintStr: 0, blend: 'normal', pos: 'center center',
  loopVideo: true, muteVideo: true, videoSpeed: 1
};

// Drag and drop on the drop zone
document.addEventListener('DOMContentLoaded', () => {
  const dz = document.getElementById('bgDropZone');
  if (!dz) return;
  ['dragenter','dragover'].forEach(e => dz.addEventListener(e, ev => { ev.preventDefault(); dz.classList.add('drag-over'); }));
  ['dragleave','drop'].forEach(e => dz.addEventListener(e, () => dz.classList.remove('drag-over')));
  dz.addEventListener('drop', ev => {
    ev.preventDefault();
    const file = ev.dataTransfer?.files?.[0];
    if (file) processBgFile(file);
  });
  initTintChips();
});

async function uploadBg(input) {
  const file = input.files[0]; if (!file) return;
  processBgFile(file);
  input.value = '';
}

async function processBgFile(file) {
  const isVideo = file.type.startsWith('video/');
  const isGif = file.type === 'image/gif';
  const local = URL.createObjectURL(file);
  const fname = file.name;
  const fsize = (file.size / 1024 / 1024).toFixed(1) + ' MB';
  const ftype = isVideo ? 'Video' : isGif ? 'Animated GIF' : 'Image';

  // Show in card immediately
  applyBgMedia(local, isVideo);

  // Update drop zone to show file info
  document.getElementById('bgDropText').textContent = fname;
  const subEl = document.querySelector('.bg-drop-sub');
  if (subEl) subEl.textContent = ftype + ' · ' + fsize;

  // Show current preview row
  showBgCurrentRow(local, isVideo, isGif, fname, fsize);

  // Show upload status
  document.getElementById('bgUploadStatus').style.display = '';
  document.getElementById('bgUploadLabel').textContent = 'Uploading ' + fname + '...';
  document.getElementById('bgUploadSub').textContent = fsize + ' · ' + ftype;
  animateBgBar('bgBarMain');

  // Show/hide video controls
  document.getElementById('bgVideoControls').style.display = isVideo ? '' : 'none';

  if (isVideo) {
    state.bgVideo = local; state.bgImage = null;
  } else {
    state.bgImage = local; state.bgVideo = null;
  }

  // Upload to server
  const fd = new FormData(); fd.append('file', file);
  const endpoint = isVideo ? '/api/upload/background' : '/api/upload/background';
  try {
    const r = await fetch(endpoint, { method: 'POST', body: fd });
    const d = await r.json();
    if (d.url) {
      if (isVideo) { state.bgVideo = d.url; document.getElementById('bgVideo').src = d.url; }
      else { state.bgImage = d.url; document.getElementById('bgImgEl').src = d.url; }
      showToast('✅ Background uploaded & live!');
    } else {
      showToast('⚠️ Using local preview (server error)');
    }
  } catch {
    showToast('⚠️ Using local preview — no server');
  }

  document.getElementById('bgUploadStatus').style.display = 'none';
}

function animateBgBar(barId) {
  const bar = document.getElementById(barId); if (!bar) return;
  bar.style.width = '0%'; let p = 0;
  const iv = setInterval(() => {
    p += Math.random() * 18; if (p > 90) p = 90;
    bar.style.width = p + '%';
  }, 220);
  bar._iv = iv;
  setTimeout(() => { clearInterval(iv); bar.style.width = '100%'; }, 3000);
}

function applyBgMedia(url, isVideo) {
  const vid = document.getElementById('bgVideo'), img = document.getElementById('bgImgEl');
  if (isVideo) {
    vid.src = url;
    vid.style.display = 'block';
    vid.style.mixBlendMode = bgState.blend;
    img.style.display = 'none';
    applyBgFilters(vid);
  } else {
    img.src = url;
    img.style.display = 'block';
    img.style.mixBlendMode = bgState.blend;
    vid.style.display = 'none';
    applyBgFilters(img);
  }
}

function applyBgFilters(el) {
  el.style.opacity = bgState.opacity / 100;
  el.style.filter = `blur(${bgState.blur}px) brightness(${bgState.brightness}%) saturate(${bgState.saturation}%)`;
  el.style.transform = `scale(${bgState.scale / 100})`;
  el.style.objectPosition = bgState.pos;
  el.style.mixBlendMode = bgState.blend;
}

function applyAllBgFilters() {
  const vid = document.getElementById('bgVideo');
  const img = document.getElementById('bgImgEl');
  if (vid.style.display !== 'none') applyBgFilters(vid);
  if (img.style.display !== 'none') applyBgFilters(img);
}

function showBgCurrentRow(url, isVideo, isGif, fname, fsize) {
  const row = document.getElementById('bgCurrentRow');
  row.style.display = '';
  const media = document.getElementById('bgCurMedia');
  if (isVideo) {
    media.innerHTML = `<video src="${url}" autoplay muted loop style="width:100%;height:100%;object-fit:cover;"></video>`;
  } else {
    media.innerHTML = `<img src="${url}" style="width:100%;height:100%;object-fit:cover;">`;
  }
  document.getElementById('bgCurName').textContent = fname;
  document.getElementById('bgCurType').innerHTML = `<span class="bg-type-tag ${isGif ? 'gif' : isVideo ? 'video' : 'image'}">${isGif ? '🎞 GIF' : isVideo ? '🎬 Video' : '🖼 Image'}</span> · ${fsize}`;
}

function clearBg() {
  state.bgVideo = null; state.bgImage = null;
  const vid = document.getElementById('bgVideo'), img = document.getElementById('bgImgEl');
  vid.style.display = 'none'; vid.src = '';
  img.style.display = 'none'; img.src = '';
  document.getElementById('bgCurrentRow').style.display = 'none';
  document.getElementById('bgVideoControls').style.display = 'none';
  document.getElementById('bgDropText').textContent = 'Drop your file here or click to browse';
  document.getElementById('bgFileInput').value = '';
  showToast('🗑 Background removed');
}

function syncBgOpacity() {
  bgState.opacity = parseInt(document.getElementById('iBgOpacity').value);
  document.getElementById('bgOpacityVal').textContent = bgState.opacity + '%';
  applyAllBgFilters();
}
function syncBgBlur() {
  bgState.blur = parseInt(document.getElementById('iBgBlur').value);
  document.getElementById('bgBlurVal').textContent = bgState.blur + 'px';
  applyAllBgFilters();
}
function syncBgScale() {
  bgState.scale = parseInt(document.getElementById('iBgScale').value);
  document.getElementById('bgScaleVal').textContent = bgState.scale + '%';
  applyAllBgFilters();
}
function syncBgBright() {
  bgState.brightness = parseInt(document.getElementById('iBgBright').value);
  document.getElementById('bgBrightVal').textContent = bgState.brightness + '%';
  applyAllBgFilters();
}
function syncBgSat() {
  bgState.saturation = parseInt(document.getElementById('iBgSat').value);
  document.getElementById('bgSatVal').textContent = bgState.saturation + '%';
  applyAllBgFilters();
}
function syncBgBlend() {
  bgState.blend = document.getElementById('iBgBlend').value;
  applyAllBgFilters();
}
function setBgPos(el, pos) {
  document.querySelectorAll('.bg-pos-btn').forEach(b => b.classList.remove('sel'));
  el.classList.add('sel');
  bgState.pos = pos;
  applyAllBgFilters();
}

// Tint overlay
const TINT_COLORS = ['#7c3aed','#06b6d4','#f43f5e','#22c55e','#f97316','#eab308','#ec4899','#fff','#000'];
function initTintChips() {
  const el = document.getElementById('tintChips');
  if (!el) return;
  el.innerHTML = TINT_COLORS.map(c => `<div style="width:22px;height:22px;border-radius:5px;background:${c};cursor:pointer;border:2px solid transparent;transition:all .14s;flex-shrink:0;" onclick="applyTintChip('${c}')" onmouseover="this.style.borderColor='#fff'" onmouseout="this.style.borderColor='transparent'" title="${c}"></div>`).join('');
}
function applyTintChip(c) {
  document.getElementById('iBgTint').value = c;
  document.getElementById('iBgTintPick').value = c;
  bgState.tint = c;
  updateBgTintOverlay();
}
function syncBgTint() { bgState.tint = document.getElementById('iBgTint').value; document.getElementById('iBgTintPick').value = tryHex(bgState.tint) || '#7c3aed'; updateBgTintOverlay(); }
function syncBgTintPick() { const v = document.getElementById('iBgTintPick').value; document.getElementById('iBgTint').value = v; bgState.tint = v; updateBgTintOverlay(); }
function syncBgTintStr() {
  bgState.tintStr = parseInt(document.getElementById('iBgTintStr').value);
  document.getElementById('bgTintStrVal').textContent = bgState.tintStr + '%';
  updateBgTintOverlay();
}
function updateBgTintOverlay() {
  const ov = document.getElementById('bgOverlay');
  if (bgState.tint && bgState.tintStr > 0) {
    const r = parseInt(bgState.tint.slice(1, 3), 16) || 0;
    const g = parseInt(bgState.tint.slice(3, 5), 16) || 0;
    const b = parseInt(bgState.tint.slice(5, 7), 16) || 0;
    ov.style.background = `rgba(${r},${g},${b},${bgState.tintStr / 100})`;
  } else {
    ov.style.background = '';
  }
}

// Video controls
function toggleBgVideoLoop() {
  bgState.loopVideo = !bgState.loopVideo;
  document.getElementById('togBgLoop').classList.toggle('on', bgState.loopVideo);
  const vid = document.getElementById('bgVideo');
  vid.loop = bgState.loopVideo;
}
function toggleBgVideoMute() {
  bgState.muteVideo = !bgState.muteVideo;
  document.getElementById('togBgMute').classList.toggle('on', bgState.muteVideo);
  document.getElementById('bgVideo').muted = bgState.muteVideo;
}
function syncBgSpeed() {
  bgState.videoSpeed = parseInt(document.getElementById('iBgSpeed').value) / 100;
  document.getElementById('bgSpeedVal').textContent = bgState.videoSpeed + '×';
  document.getElementById('bgVideo').playbackRate = bgState.videoSpeed;
}

function syncBgColor() { state.bgColor = document.getElementById('iBgColor').value; document.getElementById('iBgColorPick').value = tryHex(state.bgColor) || '#030308'; applyCardBgRender(); }
function syncBgColorPick() { const v = document.getElementById('iBgColorPick').value; document.getElementById('iBgColor').value = v; state.bgColor = v; applyCardBgRender(); }

const AESTHETICS = {
  'none': { bg: '#050508', ov: '' },
  'void': { bg: '#000000', ov: '' },
  'purple-haze': { bg: '#0a0018', ov: 'linear-gradient(135deg,rgba(80,0,180,.4),rgba(20,0,60,.65))' },
  'ocean': { bg: '#001220', ov: 'linear-gradient(135deg,rgba(0,60,120,.45),rgba(0,100,180,.25))' },
  'sunset': { bg: '#0f0500', ov: 'linear-gradient(135deg,rgba(180,50,0,.45),rgba(255,100,30,.18))' },
  'matrix': { bg: '#000800', ov: 'linear-gradient(135deg,rgba(0,80,0,.35),rgba(0,255,60,.06))' },
  'rose': { bg: '#0f000a', ov: 'linear-gradient(135deg,rgba(180,0,60,.45),rgba(255,40,100,.12))' },
  'midnight': { bg: '#010116', ov: 'linear-gradient(135deg,rgba(5,5,60,.55),rgba(15,15,80,.35))' },
  'gold': { bg: '#0d0800', ov: 'linear-gradient(135deg,rgba(160,100,0,.35),rgba(220,170,20,.12))' },
  'cherry': { bg: '#120004', ov: 'linear-gradient(135deg,rgba(140,0,40,.45),rgba(220,30,80,.12))' },
  'ice': { bg: '#001428', ov: 'linear-gradient(135deg,rgba(0,180,255,.3),rgba(168,237,255,.08))' },
  'lava': { bg: '#1a0000', ov: 'linear-gradient(135deg,rgba(139,0,0,.5),rgba(255,69,0,.15))' },
  'neon': { bg: '#000816', ov: 'linear-gradient(135deg,rgba(0,100,255,.25),rgba(0,200,255,.1))' },
  'sakura': { bg: '#1a0010', ov: 'linear-gradient(135deg,rgba(255,100,150,.2),rgba(255,180,200,.06))' },
  'forest': { bg: '#000d00', ov: 'linear-gradient(135deg,rgba(0,80,0,.35),rgba(0,120,40,.1))' },
};
function applyAesthetic(name, el) {
  document.querySelectorAll('.ae-card').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel'); state.aesthetic = name;
  const ae = AESTHETICS[name] || AESTHETICS['none'];
  document.getElementById('iBgColor').value = ae.bg;
  document.getElementById('iBgColorPick').value = ae.bg.length === 7 ? ae.bg : '#030308';
  state.bgColor = ae.bg;
  document.getElementById('bgOverlay').style.background = ae.ov;
  applyCardBgRender();
}
function applyCardBgRender() {
  const r = parseInt(state.cardBg.slice(1, 3), 16) || 15, g = parseInt(state.cardBg.slice(3, 5), 16) || 15, b = parseInt(state.cardBg.slice(5, 7), 16) || 26;
  document.getElementById('pc').style.background = `rgba(${r},${g},${b},${state.cardOpacity / 100})`;
}

// ══════════════════════════════════════════
// MUSIC
// ══════════════════════════════════════════
let tracks = [], trackIdx = 0, playing = false;
const audioEl = document.getElementById('audioEl');
async function uploadMusic(input) {
  const files = Array.from(input.files); if (!files.length) return;
  showToast(`⬆️ Uploading ${files.length} track(s)...`); showProgress('musicProg', 'musicBar');
  const promises = files.map(async file => {
    const local = URL.createObjectURL(file);
    const name = file.name.replace(/\.(mp3|mpeg|ogg|wav|m4a|aac|flac)$/i, '');
    const fd = new FormData(); fd.append('file', file);
    try { const r = await fetch('/api/upload/music', { method: 'POST', body: fd }); const d = await r.json(); return { name: d.name || name, url: d.url || local }; }
    catch { return { name, url: local }; }
  });
  const newT = await Promise.all(promises);
  tracks = [...tracks, ...newT]; state.tracks = tracks; renderTrackList();
  if (tracks.length) { state.showMusic = true; document.getElementById('togMusic').classList.add('on'); document.getElementById('pcMusic').style.display = 'flex'; loadTrack(0); }
  hideProgress('musicProg'); showToast(`✅ ${newT.length} track(s) added!`);
}
function renderTrackList() {
  const el = document.getElementById('trackList');
  if (!tracks.length) { el.textContent = 'No tracks yet.'; const caRow=document.getElementById('coverArtRow'); if(caRow)caRow.style.display='none'; return; }
  el.innerHTML = tracks.map((t, i) => `<div style="display:flex;align-items:center;gap:7px;padding:6px 8px;background:rgba(255,255,255,.025);border-radius:6px;margin-bottom:3px;border:1px solid ${i===trackIdx?'rgba(124,58,237,.35)':'var(--brd)'};">
    <div style="width:34px;height:34px;border-radius:6px;overflow:hidden;flex-shrink:0;background:rgba(255,255,255,.06);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:1rem;border:1px dashed rgba(255,255,255,.1);" onclick="editCover(${i})" title="Upload cover art">${t.cover?`<img src="${t.cover}" style="width:100%;height:100%;object-fit:cover;">`:'🖼'}</div>
    <span style="font-size:.78rem;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:${i === trackIdx ? 'var(--acc)' : 'var(--txt)'};" onclick="loadTrack(${i})" style="cursor:pointer">🎵 ${t.name}</span>
    <button onclick="event.stopPropagation();editCover(${i})" style="background:rgba(124,58,237,.1);border:1px solid rgba(124,58,237,.2);color:#a78bfa;border-radius:5px;padding:2px 7px;cursor:pointer;font-size:.6rem;white-space:nowrap;flex-shrink:0">art</button>
    <button onclick="event.stopPropagation();removeTrack(${i})" style="background:none;border:none;color:var(--mut);cursor:pointer;font-size:.85rem;flex-shrink:0;" onmouseover="this.style.color='#f43f5e'" onmouseout="this.style.color=''">✕</button>
  </div>`).join('');
}

let _editingCoverIdx = -1;
function editCover(i) {
  _editingCoverIdx = i;
  const t = tracks[i];
  const caRow = document.getElementById('coverArtRow');
  if (caRow) {
    caRow.style.display = 'block';
    const nameEl = document.getElementById('coverTrackName');
    if (nameEl) nameEl.textContent = `"${t.name}"`;
    const previewRow = document.getElementById('coverArtPreviewRow');
    if (t.cover && previewRow) {
      document.getElementById('coverArtPreview').src = t.cover;
      document.getElementById('coverArtPreviewName').textContent = 'Cover uploaded';
      previewRow.style.display = 'flex';
    } else if (previewRow) {
      previewRow.style.display = 'none';
    }
  }
  document.getElementById('coverArtInput').value = '';
}

async function uploadCoverArt(input) {
  if (!input.files.length || _editingCoverIdx < 0) return;
  const file = input.files[0];
  const local = URL.createObjectURL(file);
  const fd = new FormData(); fd.append('file', file);
  let coverUrl = local;
  try {
    const r = await fetch('/api/upload/image', { method:'POST', body:fd });
    if (r.ok) { const d = await r.json(); coverUrl = d.url || local; }
  } catch {}
  tracks[_editingCoverIdx].cover = coverUrl;
  state.tracks = tracks;
  const previewRow = document.getElementById('coverArtPreviewRow');
  if (previewRow) {
    document.getElementById('coverArtPreview').src = coverUrl;
    document.getElementById('coverArtPreviewName').textContent = file.name;
    previewRow.style.display = 'flex';
  }
  if (_editingCoverIdx === trackIdx) {
    const alb = document.getElementById('pcAlbum');
    alb.innerHTML = `<img src="${coverUrl}" alt="" style="width:100%;height:100%;object-fit:cover;border-radius:10px">`;
    alb.style.background = 'transparent';
  }
  renderTrackList();
  showToast('✅ Cover art saved!');
}

function removeCoverArt() {
  if (_editingCoverIdx < 0) return;
  tracks[_editingCoverIdx].cover = null;
  state.tracks = tracks;
  const previewRow = document.getElementById('coverArtPreviewRow');
  if (previewRow) previewRow.style.display = 'none';
  if (_editingCoverIdx === trackIdx) {
    const alb = document.getElementById('pcAlbum');
    alb.innerHTML = '🎵'; alb.style.background = 'linear-gradient(135deg,#2d1060,#0c2a50)';
  }
  renderTrackList();
  showToast('Cover art removed');
}
function removeTrack(i) { tracks.splice(i, 1); state.tracks = tracks; renderTrackList(); if (!tracks.length) { document.getElementById('pcMusic').style.display = 'none'; state.showMusic = false; document.getElementById('togMusic').classList.remove('on'); audioEl.pause(); playing = false; } else loadTrack(0); }
function loadTrack(i) {
  trackIdx = ((i % tracks.length) + tracks.length) % tracks.length;
  const t = tracks[trackIdx]; audioEl.src = t.url;
  document.getElementById('pcMtitle').textContent = t.name;
  document.getElementById('pcMartist').textContent = `Track ${trackIdx + 1}/${tracks.length}`;
  document.getElementById('pcProg').style.width = '0%';
  const alb = document.getElementById('pcAlbum');
  if (t.cover) {
    alb.innerHTML = `<img src="${t.cover}" alt="" style="width:100%;height:100%;object-fit:cover;border-radius:10px">`;
    alb.style.background = 'transparent';
  } else {
    alb.innerHTML = '🎵'; alb.style.background = 'linear-gradient(135deg,#2d1060,#0c2a50)';
  }
  if (playing) audioEl.play().catch(() => {});
  renderTrackList();
}
function togglePlay() {
  if (!tracks.length) { showToast('Upload a track first!'); return; }
  playing = !playing;
  const btn = document.getElementById('pcPlayBtn'), alb = document.getElementById('pcAlbum');
  if (playing) { audioEl.play().catch(() => {}); btn.textContent = '⏸'; alb.classList.add('spin'); }
  else { audioEl.pause(); btn.textContent = '▶'; alb.classList.remove('spin'); }
}
function nextTr() { stopPlay(); if (tracks.length) loadTrack(trackIdx + 1); }
function prevTr() { stopPlay(); if (tracks.length) loadTrack(trackIdx - 1); }
function stopPlay() { playing = false; document.getElementById('pcPlayBtn').textContent = '▶'; document.getElementById('pcAlbum').classList.remove('spin'); }
audioEl.addEventListener('timeupdate', () => { if (!audioEl.duration) return; document.getElementById('pcProg').style.width = (audioEl.currentTime / audioEl.duration * 100) + '%'; });
audioEl.addEventListener('ended', () => { if (tracks.length > 1) { loadTrack(trackIdx + 1); if (playing) audioEl.play().catch(() => {}); } });
function toggleMusic() { state.showMusic = !state.showMusic; document.getElementById('togMusic').classList.toggle('on', state.showMusic); document.getElementById('pcMusic').style.display = state.showMusic ? 'flex' : 'none'; }
function toggleAutoplay() { state.autoplay = !state.autoplay; document.getElementById('togAutoplay').classList.toggle('on', state.autoplay); }
function syncMusicStyle() { state.musicStyle = document.getElementById('iMusicStyle').value; }

// ══════════════════════════════════════════
// THEME
// ══════════════════════════════════════════
const ACCENT_CHIPS = ['#a855f7', '#7c3aed', '#06b6d4', '#0ea5e9', '#f43f5e', '#22c55e', '#f97316', '#eab308', '#ec4899', '#e879f9', '#38bdf8', '#fff'];
function initChips() {
  document.getElementById('accentChips').innerHTML = ACCENT_CHIPS.map(c => `<div class="chip" style="background:${c}" onclick="setAccentChip('${c}')" title="${c}"></div>`).join('');
}
function setAccentChip(c) { document.getElementById('iAccent').value = c; document.getElementById('iAccentPick').value = c; state.accent = c; applyAccent(); }
function syncAccent() { state.accent = document.getElementById('iAccent').value; document.getElementById('iAccentPick').value = tryHex(state.accent) || '#a855f7'; applyAccent(); }
function syncAccentPick() { const v = document.getElementById('iAccentPick').value; document.getElementById('iAccent').value = v; state.accent = v; applyAccent(); }
function syncAccent2() { state.accent2 = document.getElementById('iAccent2').value; document.getElementById('iAccent2Pick').value = tryHex(state.accent2) || '#22d3ee'; }
function syncAccent2Pick() { const v = document.getElementById('iAccent2Pick').value; document.getElementById('iAccent2').value = v; state.accent2 = v; }
function syncCardBg() { state.cardBg = document.getElementById('iCardBg').value; document.getElementById('iCardBgPick').value = tryHex(state.cardBg) || '#0f0f1a'; applyCardBgRender(); }
function syncCardBgPick() { const v = document.getElementById('iCardBgPick').value; document.getElementById('iCardBg').value = v; state.cardBg = v; applyCardBgRender(); }
function syncBlur() { state.blur = document.getElementById('iBlur').value; document.getElementById('blurVal').textContent = state.blur + 'px'; document.getElementById('pc').style.backdropFilter = `blur(${state.blur}px)`; }
function syncCardOpacity() { state.cardOpacity = document.getElementById('iCardOpacity').value; document.getElementById('cardOpacityVal').textContent = state.cardOpacity + '%'; applyCardBgRender(); }
function syncGlowInt() { state.glowInt = document.getElementById('iGlowInt').value; document.getElementById('glowIntVal').textContent = state.glowInt + '%'; }
const FONT_MAP = {
  outfit: "'Outfit',sans-serif",
  syne: "'Syne',sans-serif",
  mono: "'Space Mono',monospace",
  dm: "'DM Sans',sans-serif",
  orbitron: "'Orbitron',sans-serif",
  serif: 'Georgia,serif'
};
function syncFont() {
  state.font = document.getElementById('iFont').value;
  document.getElementById('pc').style.fontFamily = FONT_MAP[state.font] || FONT_MAP.outfit;
  document.getElementById('fontPreview').style.fontFamily = FONT_MAP[state.font] || FONT_MAP.outfit;
}
function syncTextColor() {
  state.textColor = document.getElementById('iTextColor').value;
  document.getElementById('iTextColorPick').value = tryHex(state.textColor) || '#f0f0fa';
  document.getElementById('pcUsername').style.webkitTextFillColor = '';
  document.getElementById('pc').style.color = state.textColor;
}
function syncTextColorPick() { const v = document.getElementById('iTextColorPick').value; document.getElementById('iTextColor').value = v; state.textColor = v; document.getElementById('pc').style.color = v; }
function applyAccent() {
  ['pcViews', 'pcFollowers', 'pcClicks'].forEach(id => document.getElementById(id).style.color = state.accent);
  document.documentElement.style.setProperty('--acc', state.accent);
}
function tryHex(v) { return /^#[0-9a-fA-F]{6}$/.test(v) ? v : null; }
const PRESETS = {
  purple: { accent: '#a855f7', accent2: '#7c3aed', cardBg: '#0f0418' },
  cyan: { accent: '#06b6d4', accent2: '#0ea5e9', cardBg: '#021a22' },
  rose: { accent: '#f43f5e', accent2: '#fb7185', cardBg: '#1a040a' },
  green: { accent: '#22c55e', accent2: '#4ade80', cardBg: '#021a07' },
  orange: { accent: '#f97316', accent2: '#fb923c', cardBg: '#1a0a02' },
  midnight: { accent: '#818cf8', accent2: '#a5b4fc', cardBg: '#02021a' },
  mono: { accent: '#ffffff', accent2: '#a1a1aa', cardBg: '#0a0a0a' },
  blood: { accent: '#ef4444', accent2: '#dc2626', cardBg: '#1a0000' },
  gold: { accent: '#f59e0b', accent2: '#fbbf24', cardBg: '#1a1000' },
  teal: { accent: '#14b8a6', accent2: '#06b6d4', cardBg: '#001a1a' },
  pink: { accent: '#ec4899', accent2: '#f472b6', cardBg: '#1a0014' },
  neon: { accent: '#00d4ff', accent2: '#7c3aed', cardBg: '#000d1a' },
  sakura: { accent: '#ff69b4', accent2: '#ffb6c1', cardBg: '#1a0010' },
};
function applyPreset() {
  const p = PRESETS[document.getElementById('iPreset').value]; if (!p) return;
  document.getElementById('iAccent').value = document.getElementById('iAccentPick').value = p.accent;
  document.getElementById('iAccent2').value = document.getElementById('iAccent2Pick').value = p.accent2;
  document.getElementById('iCardBg').value = document.getElementById('iCardBgPick').value = p.cardBg;
  Object.assign(state, p); applyCardBgRender(); applyAccent(); showToast('✅ Theme applied!');
}

// ══════════════════════════════════════════
// GRADIENT
// ══════════════════════════════════════════
const GRAD_COMBOS = [
  ['#fff','#a855f7','#22d3ee'], ['#fff','#f43f5e','#f97316'],
  ['#fff','#22c55e','#06b6d4'], ['#fff','#eab308','#f97316'],
  ['#fff','#ec4899','#a855f7'], ['#fff','#e879f9','#818cf8'],
];
function initGradChips() {
  document.getElementById('gradChips').innerHTML = GRAD_COMBOS.map((c, i) => {
    const grad = `linear-gradient(135deg,${c.join(',')})`;
    return `<div class="chip" style="background:${grad};width:32px;" onclick="applyGradCombo(${i})" title="Gradient ${i + 1}"></div>`;
  }).join('');
}
function applyGradCombo(i) {
  const c = GRAD_COMBOS[i];
  document.getElementById('iGradStart').value = document.getElementById('iGradStartPick').value = c[0];
  document.getElementById('iGradMid').value = document.getElementById('iGradMidPick').value = c[1];
  document.getElementById('iGradEnd').value = document.getElementById('iGradEndPick').value = c[2];
  state.gradStart = c[0]; state.gradMid = c[1]; state.gradEnd = c[2];
  syncGradient();
}
function syncGradient() {
  state.gradStart = document.getElementById('iGradStart').value;
  state.gradMid = document.getElementById('iGradMid').value;
  state.gradEnd = document.getElementById('iGradEnd').value;
  state.gradDir = document.getElementById('iGradDir').value;
  const grad = `linear-gradient(${state.gradDir},${state.gradStart} 0%,${state.gradMid} 50%,${state.gradEnd} 100%)`;
  document.getElementById('gradPreview').style.backgroundImage = grad;
  const un = document.getElementById('pcUsername');
  un.style.backgroundImage = grad;
  un.style.backgroundSize = '200% 100%';
  un.style.webkitBackgroundClip = 'text';
  un.style.webkitTextFillColor = 'transparent';
}
function syncGradStartPick() { document.getElementById('iGradStart').value = document.getElementById('iGradStartPick').value; syncGradient(); }
function syncGradMidPick() { document.getElementById('iGradMid').value = document.getElementById('iGradMidPick').value; syncGradient(); }
function syncGradEndPick() { document.getElementById('iGradEnd').value = document.getElementById('iGradEndPick').value; syncGradient(); }
function toggleBorderGrad() { state.borderGrad = !state.borderGrad; document.getElementById('togBorderGrad').classList.toggle('on', state.borderGrad); /* visual effect handled on profile.html */ }
function toggleBgGrad() { state.bgGrad = !state.bgGrad; document.getElementById('togBgGrad').classList.toggle('on', state.bgGrad); }

// ══════════════════════════════════════════
// EFFECTS
// ══════════════════════════════════════════
function syncParticle() { state.particle = document.getElementById('iParticle').value; }
function syncCursor() { state.cursor = document.getElementById('iCursor').value; }
function toggle(key, togId) { state[key] = !state[key]; document.getElementById(togId).classList.toggle('on', state[key]); }

// ══════════════════════════════════════════
// ANIMATIONS
// ══════════════════════════════════════════
function syncPageAnim() { state.pageAnim = document.getElementById('iPageAnim').value; }
function syncNameAnim() {
  state.nameAnim = document.getElementById('iNameAnim').value;
  const un = document.getElementById('pcUsername');
  const anims = {
    shimmer: 'nameShimmer 3.5s ease-in-out infinite',
    glitch: 'nameShimmer 0.3s step-end infinite',
    rainbow: 'nameRainbow 2s linear infinite',
    pulse: 'namePulse 2s ease-in-out infinite',
    wave: 'nameShimmer 1.8s ease-in-out infinite',
    none: 'none'
  };
  un.style.animation = anims[state.nameAnim] || anims.shimmer;
}
function syncLinkHover() { state.linkHover = document.getElementById('iLinkHover').value; }
function syncAvHover() { state.avHover = document.getElementById('iAvHover').value; }
function syncAnimSpeed() { state.animSpeed = document.getElementById('iAnimSpeed').value; }

// ══════════════════════════════════════════
// LAYOUT
// ══════════════════════════════════════════
function setLinkStyle(s) {
  state.linkStyle = s;
  document.getElementById('ls-icons').classList.toggle('sel', s === 'icons');
  document.getElementById('ls-buttons').classList.toggle('sel', s === 'buttons');
  renderLinks();
}
function toggleStats() { state.showStats = !state.showStats; document.getElementById('togStats').classList.toggle('on', state.showStats); document.getElementById('pcStatsRow').style.display = state.showStats ? 'flex' : 'none'; }
function syncCardWidth() { const v = document.getElementById('iCardWidth').value; state.cardWidth = v; document.getElementById('cardWidthVal').textContent = v + 'px'; document.getElementById('pc').style.maxWidth = v + 'px'; }
function syncCardRadius() { const v = document.getElementById('iCardRadius').value; state.cardRadius = v; document.getElementById('cardRadiusVal').textContent = v + 'px'; document.getElementById('pc').style.borderRadius = v + 'px'; }
function syncSpacing() { state.spacing = document.getElementById('iSpacing').value; }
function toggleVerifiedBadge() { state.showVerified = !state.showVerified; document.getElementById('togVerified').classList.toggle('on', state.showVerified); document.getElementById('pcVerified').style.display = state.showVerified ? '' : 'none'; }

// ══════════════════════════════════════════
// SOCIAL LINKS
// ══════════════════════════════════════════
const DOMAIN_MAP = { discord: 'discord.com', twitter: 'twitter.com', x: 'x.com', instagram: 'instagram.com', youtube: 'youtube.com', github: 'github.com', spotify: 'spotify.com', tiktok: 'tiktok.com', twitch: 'twitch.tv', reddit: 'reddit.com', steam: 'store.steampowered.com', kick: 'kick.com', snapchat: 'snapchat.com', pinterest: 'pinterest.com', linkedin: 'linkedin.com', roblox: 'roblox.com', cashapp: 'cash.app', paypal: 'paypal.com', bereal: 'bereal.com', threads: 'threads.net', bluesky: 'bsky.app', onlyfans: 'onlyfans.com', patreon: 'patreon.com' };
function getFavicon(label, url) {
  const key = label.toLowerCase().replace(/[\s\-_]/g, '').replace(/[^a-z]/g, '');
  const domain = DOMAIN_MAP[key] || (() => { try { return new URL(url).hostname.replace('www.', ''); } catch { return null; } })();
  return domain ? `https://www.google.com/s2/favicons?domain=${domain}&sz=64` : null;
}
function showAddLink() { document.getElementById('addLinkForm').classList.add('show'); document.getElementById('alLabel').focus(); }
function hideAddLink() { document.getElementById('addLinkForm').classList.remove('show'); document.getElementById('alLabel').value = ''; document.getElementById('alUrl').value = ''; }
function addLink() {
  const label = document.getElementById('alLabel').value.trim(), url = document.getElementById('alUrl').value.trim();
  if (!label || !url) { showToast('Fill in both fields!'); return; }
  if (!url.startsWith('http')) { showToast('URL must start with https://'); return; }
  state.links.push({ label, url }); renderLinks(); hideAddLink(); showToast(`✅ ${label} added!`);
}
function quickAdd(label, urlBase) {
  document.getElementById('alLabel').value = label;
  document.getElementById('alUrl').value = urlBase;
  document.getElementById('addLinkForm').classList.add('show');
  document.getElementById('alUrl').focus();
}
function removeLink(i) { state.links.splice(i, 1); renderLinks(); }
function renderLinks() {
  document.getElementById('linkList').innerHTML = state.links.map((l, i) => {
    const fav = getFavicon(l.label, l.url);
    return `<div class="link-item"><div class="li-icon">${fav ? `<img src="${fav}" onerror="this.parentElement.textContent='🔗'">` : '🔗'}</div><div class="li-info"><div class="li-label">${l.label}</div><div class="li-url">${l.url}</div></div><div class="li-actions"><button class="li-act" onclick="removeLink(${i})">✕</button></div></div>`;
  }).join('');
  if (state.linkStyle === 'icons') {
    document.getElementById('pcSocials').style.display = 'flex';
    document.getElementById('pcLinkBtns').style.display = 'none';
    document.getElementById('pcSocials').innerHTML = state.links.map(l => {
      const fav = getFavicon(l.label, l.url);
      return `<a href="${l.url}" class="pc-soc" target="_blank" rel="noopener">${fav ? `<img src="${fav}" onerror="this.style.display='none'">` : '<span class="fallback">🔗</span>'}<span class="tip">${l.label}</span></a>`;
    }).join('');
    document.getElementById('pcLinkBtns').innerHTML = '';
  } else {
    document.getElementById('pcSocials').style.display = 'none';
    document.getElementById('pcLinkBtns').style.display = 'block';
    document.getElementById('pcLinkBtns').innerHTML = state.links.map(l => {
      const fav = getFavicon(l.label, l.url);
      return `<a href="${l.url}" class="pc-link-btn" target="_blank" rel="noopener">${fav ? `<img src="${fav}">` : '🔗'}<span>${l.label}</span></a>`;
    }).join('');
  }
}

// ══════════════════════════════════════════
// SKILLS & WORK
// ══════════════════════════════════════════
let skills = [];
function addSkill() {
  const v = document.getElementById('iSkillInput').value.trim(); if (!v) return;
  addSkillDirect(v);
  document.getElementById('iSkillInput').value = '';
}
function addSkillDirect(name) {
  if (skills.includes(name)) return;
  skills.push(name); renderSkillsPanel(); renderSkillsCard();
}
function removeSkill(i) {
  skills.splice(i, 1); renderSkillsPanel(); renderSkillsCard();
}
function renderSkillsPanel() {
  const el = document.getElementById('skillChipPreview');
  el.innerHTML = skills.map((s, i) => `<div class="skill-chip-item">${s}<button class="skill-chip-del" onclick="removeSkill(${i})">✕</button></div>`).join('');
}
function renderSkillsCard() {
  const row = document.getElementById('pcSkillsRow');
  if (!skills.length) { row.style.display = 'none'; return; }
  row.style.display = 'flex';
  row.innerHTML = skills.map(s => `<span class="pc-skill-chip">${s}</span>`).join('');
}
function syncRole() {
  const v = document.getElementById('iRole').value.trim();
  const row = document.getElementById('pcRoleRow');
  const el = document.getElementById('pcRole');
  if (v) { row.style.display = ''; el.textContent = v; }
  else row.style.display = 'none';
}
function syncOpenTo() {
  const checks = document.querySelectorAll('#openToList input[type=checkbox]');
  const selected = Array.from(checks).filter(c => c.checked).map(c => c.parentElement.textContent.trim());
  const row = document.getElementById('pcOpenToRow');
  if (!selected.length) { row.style.display = 'none'; return; }
  row.style.display = 'flex';
  row.innerHTML = selected.map(s => `<span class="pc-open-chip">✓ ${s}</span>`).join('');
}
function syncProject() {
  const name = document.getElementById('iProjectName').value.trim();
  const desc = document.getElementById('iProjectDesc').value.trim();
  const status = document.getElementById('iProjectStatus').value;
  const el = document.getElementById('pcProject');
  if (!name) { el.style.display = 'none'; return; }
  el.style.display = '';
  document.getElementById('pcProjName').textContent = name;
  document.getElementById('pcProjDesc').textContent = desc;
  document.getElementById('pcProjStatus').textContent = status;
}
function syncGithub() {
  state.githubUser = document.getElementById('iGithubUser').value.trim();
}
function previewGithub() {
  const u = document.getElementById('iGithubUser').value.trim();
  if (!u) { showToast('Enter a GitHub username first'); return; }
  renderGithubGraph(u);
}
function toggleGithubGraph() {
  state.showGithubGraph = !state.showGithubGraph;
  document.getElementById('togGithubGraph').classList.toggle('on', state.showGithubGraph);
  const el = document.getElementById('pcGithubGraph');
  if (state.showGithubGraph) {
    el.style.display = '';
    renderGithubGraph(document.getElementById('iGithubUser').value.trim() || '');
  } else {
    el.style.display = 'none';
  }
}
function renderGithubGraph(username) {
  // Render a fake-but-realistic contribution graph
  const canvas = document.getElementById('ghCanvas');
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;
  ctx.clearRect(0, 0, W, H);
  // Build 52 weeks × 7 days grid
  const cellW = 5, cellH = 5, gap = 2;
  const cols = 52, rows = 7;
  const offsetX = 4, offsetY = 8;
  const colors = ['rgba(255,255,255,.04)', 'rgba(124,58,237,.25)', 'rgba(124,58,237,.5)', 'rgba(124,58,237,.75)', 'rgba(124,58,237,1)'];
  // seed from username for deterministic look
  let seed = 42;
  for (let c = 0; c < username.length; c++) seed = (seed * 31 + username.charCodeAt(c)) & 0xffffffff;
  function rng() { seed = (seed * 1664525 + 1013904223) & 0xffffffff; return (seed >>> 0) / 0xffffffff; }
  // Day labels
  ctx.fillStyle = 'rgba(255,255,255,.25)';
  ctx.font = '5px sans-serif';
  ['M','W','F'].forEach((d, i) => ctx.fillText(d, 0, offsetY + (i * 2 + 1) * (cellH + gap)));
  for (let col = 0; col < cols; col++) {
    for (let row = 0; row < rows; row++) {
      const x = offsetX + col * (cellW + gap);
      const y = offsetY + row * (cellH + gap);
      // More commits near present (right side)
      const bias = Math.pow((col / cols), 1.2);
      const v = rng();
      let level = 0;
      if (v < 0.45 - bias * 0.1) level = 0;
      else if (v < 0.6) level = 1;
      else if (v < 0.78) level = 2;
      else if (v < 0.92) level = 3;
      else level = 4;
      ctx.fillStyle = colors[level];
      ctx.fillRect(x, y, cellW, cellH);
    }
  }
  // Month labels
  ctx.fillStyle = 'rgba(255,255,255,.2)';
  ctx.font = '5px sans-serif';
  const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  const now = new Date();
  for (let m = 0; m < 12; m++) {
    const monthIdx = (now.getMonth() - 11 + m + 12) % 12;
    const x = offsetX + Math.round(m * (cols / 12)) * (cellW + gap);
    ctx.fillText(months[monthIdx], x, 6);
  }
}

// ══════════════════════════════════════════
// DISCORD / SPOTIFY / INTEGRATIONS
// ══════════════════════════════════════════
// Discord OAuth state
let dcOAuthClientId = '';
let dcOAuthRedirect = '';

function syncDiscordClientId() { dcOAuthClientId = document.getElementById('iDiscordClientId').value.trim(); }
function syncDiscordRedirect() { dcOAuthRedirect = document.getElementById('iDiscordRedirect').value.trim(); }

function toggleEl(id) {
  const el = document.getElementById(id);
  el.style.display = el.style.display === 'none' ? '' : 'none';
}

function initDiscordOAuth() {
  // Use the backend /auth/discord route — client ID is handled server-side via env vars
  window.location.href = `https://vltx-discord-auth.vercel.app/auth/discord?redirect=${encodeURIComponent(window.location.pathname + window.location.search)}`;
}

function handleOAuthSuccess(user) {
  if (!user) return;
  const btn = document.getElementById('dcOAuthBtn');
  btn.textContent = '✓ Connected';
  btn.className = 'dc-oauth-btn connected';
  document.getElementById('dcOAuthTitle').textContent = user.global_name || user.username;
  document.getElementById('dcOAuthSub').textContent = `@${user.username} · linked via OAuth`;
  
  // Set pfp
  const avatarHash = user.avatar;
  if (avatarHash) {
    const avatarUrl = `https://cdn.discordapp.com/avatars/${user.id}/${avatarHash}.png?size=256`;
    if (dcState.pfpSync) applyLanyardPfpToAvatar(user, avatarUrl);
  }
  
  // Set username and badge
  document.getElementById('iDiscordUser').value = user.global_name || user.username;
  dcState.user = user.global_name || user.username;
  syncDiscordUser();
  showToast('✅ Discord account linked!');
  
  // Update nav dot
  const navDot = document.getElementById('discordNavDot');
  if (navDot) { navDot.style.background = '#5865F2'; navDot.style.boxShadow = '0 0 6px #5865F2'; }
}
let dcState = { user: '', url: '', status: 'online', badge: true, social: true, userId: '', lanyard: false, pfpSync: false };
let lanyardWs = null;
let lanyardHeartbeat = null;
const DC_STATUS_COLORS = { online:'#22c55e', idle:'#f59e0b', dnd:'#ef4444', offline:'#6b7280' };
const DC_STATUS_LABELS = { online:'online', idle:'idle', dnd:'do not disturb', offline:'offline' };

function syncDiscordUser() {
  dcState.user = document.getElementById('iDiscordUser').value.trim();
  const badge = document.getElementById('pcDcBadge');
  const dot = document.getElementById('pcDcStatusDot');
  if (dcState.user && dcState.badge) {
    badge.style.display = 'inline-flex';
    document.getElementById('pcDcText').textContent = dcState.user;
    dot.style.background = DC_STATUS_COLORS[dcState.status] || '#22c55e';
  } else if (!dcState.user) {
    badge.style.display = 'none';
  }
}
function syncDiscordStatus() {
  dcState.status = document.getElementById('iDiscordStatus').value;
  const dot = document.getElementById('pcDcStatusDot');
  dot.style.background = DC_STATUS_COLORS[dcState.status] || '#22c55e';
  // Update nav dot color
  const navDot = document.getElementById('discordNavDot');
  if (navDot) navDot.style.background = DC_STATUS_COLORS[dcState.status];
}
function syncDiscordUrl() {
  dcState.url = document.getElementById('iDiscordUrl').value.trim();
  state.discordUrl = dcState.url;
  if (dcState.url && dcState.social) {
    state.links = state.links.filter(l => l.label.toLowerCase() !== 'discord');
    state.links.unshift({ label: 'Discord', url: dcState.url });
    renderLinks();
  }
}

function syncDiscordServer() {
  state.discordServerName   = document.getElementById('iDiscordServerName').value.trim();
  state.discordServerInvite = document.getElementById('iDiscordServerInvite').value.trim();
  state.discordServerId     = document.getElementById('iDiscordServerId').value.trim();
  state.discordServerIcon   = document.getElementById('iDiscordServerIcon').value.trim();
  state.discordOnline       = document.getElementById('iDiscordOnline').value.trim();
  state.discordMembers      = document.getElementById('iDiscordMembers').value.trim();
  // Also set discordUrl to invite so the badge links there too
  if (state.discordServerInvite && !state.discordUrl) {
    state.discordUrl = state.discordServerInvite;
  }
  updatePreviewDiscordWidget();
}

function toggleDcServerWidget() {
  state.showDiscordServerWidget = !state.showDiscordServerWidget;
  document.getElementById('togDcServerWidget').classList.toggle('on', state.showDiscordServerWidget);
}

function updatePreviewDiscordWidget() {
  // Update the preview card's discord server widget if it's rendered
  const sw = document.getElementById('pcDiscordServerWidget');
  if (!sw) return;
  if (state.discordServerInvite && state.showDiscordServerWidget !== false) {
    sw.style.display = 'flex';
    const name = document.getElementById('pcDswName');
    if (name) name.textContent = state.discordServerName || 'Discord Server';
    const online = document.getElementById('pcDswOnline');
    if (online) online.textContent = state.discordOnline || '—';
    const members = document.getElementById('pcDswMembers');
    if (members) members.textContent = state.discordMembers || '—';
    const joinBtn = document.getElementById('pcDswJoin');
    if (joinBtn) joinBtn.href = state.discordServerInvite;
    if (state.discordServerIcon) {
      const icon = document.getElementById('pcDswIcon');
      if (icon) icon.innerHTML = `<img src="${state.discordServerIcon}" style="width:100%;height:100%;object-fit:cover;border-radius:13px">`;
    }
  } else if (sw) {
    sw.style.display = 'none';
  }
}
function toggleDcBadge() {
  dcState.badge = !dcState.badge;
  document.getElementById('togDcBadge').classList.toggle('on', dcState.badge);
  document.getElementById('pcDcBadge').style.display = (dcState.user && dcState.badge) ? 'inline-flex' : 'none';
}
function toggleDcSocial() {
  dcState.social = !dcState.social;
  document.getElementById('togDcSocial').classList.toggle('on', dcState.social);
  if (dcState.social && dcState.url) {
    state.links = state.links.filter(l => l.label.toLowerCase() !== 'discord');
    state.links.unshift({ label: 'Discord', url: dcState.url });
    renderLinks();
  } else {
    state.links = state.links.filter(l => l.label.toLowerCase() !== 'discord');
    renderLinks();
  }
}
function disconnectDiscord() {
  document.getElementById('iDiscordUser').value = '';
  document.getElementById('iDiscordId').value = '';
  dcState.user = ''; dcState.userId = '';
  syncDiscordUser();
  closeLanyardWs && closeLanyardWs();
  document.getElementById('dcLiveCard').style.display = 'none';
  document.getElementById('dcOAuthBtn').textContent = 'Connect';
  document.getElementById('dcOAuthBtn').className = 'dc-oauth-btn';
  document.getElementById('dcOAuthTitle').textContent = 'Link Discord Account';
  document.getElementById('dcOAuthSub').textContent = 'Sync your real pfp, username & status via OAuth';
  state.discordUserId = ''; state.discordUser = ''; state.discordId = '';
  showToast('Discord disconnected');
}
function syncDiscordId() {
  dcState.userId = document.getElementById('iDiscordId').value.trim();
}
function toggleDcPfpSync() {
  dcState.pfpSync = !dcState.pfpSync;
  document.getElementById('togDcPfpSync').classList.toggle('on', dcState.pfpSync);
  if (dcState.pfpSync && lanyardData && lanyardData.discord_user) {
    applyLanyardPfpToAvatar(lanyardData.discord_user);
  }
}

// Lanyard WebSocket - real-time rich presence
let lanyardData = null;
let activityTimerInterval = null;

function connectDiscordLanyard() {
  const userId = document.getElementById('iDiscordId').value.trim();
  if (!userId || userId.length < 10) { showToast('❌ Enter a valid Discord User ID first'); return; }
  dcState.userId = userId;
  
  const btn = document.getElementById('dcConnectBtn');
  btn.textContent = '...'; btn.disabled = true;
  
  // First fetch via REST to get initial data quickly
  fetch(`https://api.lanyard.rest/v1/users/${userId}`)
    .then(r => r.json())
    .then(d => {
      if (!d.success) { showToast('❌ User not found. Join discord.gg/lanyard first'); btn.textContent = 'Connect'; btn.disabled = false; return; }
      processLanyardData(d.data);
      btn.textContent = 'Connected ✓'; btn.disabled = false;
      btn.style.background = 'rgba(34,197,94,.15)';
      btn.style.color = '#22c55e';
      btn.style.borderColor = 'rgba(34,197,94,.3)';
      showToast('✅ Discord connected via Lanyard!');
      // Mark nav dot
      const navDot = document.getElementById('discordNavDot');
      if (navDot) { navDot.style.background = '#22c55e'; navDot.style.boxShadow = '0 0 6px #22c55e'; }
      // Start WebSocket for live updates
      openLanyardWs(userId);
    })
    .catch(() => { showToast('⚠️ Lanyard fetch failed — check your ID'); btn.textContent = 'Connect'; btn.disabled = false; });
}

function openLanyardWs(userId) {
  closeLanyardWs();
  lanyardWs = new WebSocket('wss://api.lanyard.rest/socket');
  lanyardWs.onopen = () => {
    lanyardWs.send(JSON.stringify({ op: 2, d: { subscribe_to_id: userId } }));
  };
  lanyardWs.onmessage = (e) => {
    const msg = JSON.parse(e.data);
    if (msg.op === 1) { // Hello - start heartbeat
      lanyardHeartbeat = setInterval(() => {
        if (lanyardWs.readyState === 1) lanyardWs.send(JSON.stringify({ op: 3 }));
      }, msg.d.heartbeat_interval);
    }
    if (msg.op === 0 && (msg.t === 'INIT_STATE' || msg.t === 'PRESENCE_UPDATE')) {
      const data = msg.t === 'INIT_STATE' ? msg.d[userId] : msg.d;
      if (data) { lanyardData = data; processLanyardData(data); }
    }
  };
  lanyardWs.onerror = () => {};
  lanyardWs.onclose = () => { clearInterval(lanyardHeartbeat); };
}

function closeLanyardWs() {
  if (lanyardWs) { lanyardWs.close(); lanyardWs = null; }
  clearInterval(lanyardHeartbeat);
  clearInterval(activityTimerInterval);
}

function processLanyardData(data) {
  lanyardData = data;
  const user = data.discord_user;
  const status = data.discord_status || 'offline';
  
  // Show live card
  document.getElementById('dcLiveCard').style.display = '';
  
  // Avatar
  const avatarHash = user.avatar;
  const avatarUrl = avatarHash
    ? `https://cdn.discordapp.com/avatars/${user.id}/${avatarHash}.${avatarHash.startsWith('a_') ? 'gif' : 'png'}?size=128`
    : `https://cdn.discordapp.com/embed/avatars/${parseInt(user.discriminator || '0') % 5}.png`;
  
  document.getElementById('dcLiveAvatar').src = avatarUrl;
  
  // Status dot
  const dot = document.getElementById('dcLiveStatusDot');
  dot.style.background = DC_STATUS_COLORS[status] || '#6b7280';
  
  // Name
  const displayName = user.global_name || user.username;
  document.getElementById('dcLiveName').textContent = displayName;
  document.getElementById('dcLiveTag').textContent = user.discriminator && user.discriminator !== '0' ? `#${user.discriminator}` : `@${user.username}`;
  document.getElementById('dcLiveStatusText').textContent = DC_STATUS_LABELS[status] || status;
  
  // Auto-fill username field
  if (!document.getElementById('iDiscordUser').value) {
    document.getElementById('iDiscordUser').value = displayName;
    dcState.user = displayName;
  }
  
  // Auto-set status
  document.getElementById('iDiscordStatus').value = status;
  dcState.status = status;
  syncDiscordStatus();
  syncDiscordUser();
  
  // PFP sync if enabled
  if (dcState.pfpSync) applyLanyardPfpToAvatar(user, avatarUrl);
  
  // Activities
  const activities = data.activities || [];
  const spotify = data.spotify;
  
  // Spotify
  const spotifyCard = document.getElementById('dcSpotifyCard');
  if (spotify) {
    spotifyCard.style.display = '';
    document.getElementById('dcSpotifyTrack').textContent = spotify.song || '—';
    document.getElementById('dcSpotifyArtist').textContent = spotify.artist || '—';
    document.getElementById('dcSpotifyAlbum').textContent = spotify.album || '—';
    if (spotify.album_art_url) document.getElementById('dcSpotifyArt').src = spotify.album_art_url;
    // Show on profile card
    if (dcState.lanyard) {
      document.getElementById('pcNowPlaying').style.display = 'flex';
      document.getElementById('pcNpTitle').textContent = spotify.song || 'Listening to Spotify';
    }
  } else { spotifyCard.style.display = 'none'; }
  
  // Game / App activity (skip Spotify activity type 2)
  const gameAct = activities.find(a => a.type === 0 || a.type === 5);
  const actCard = document.getElementById('dcActivityCard');
  if (gameAct && dcState.lanyard) {
    actCard.style.display = '';
    document.getElementById('dcActGameName').textContent = gameAct.name;
    document.getElementById('dcActDetails').textContent = gameAct.details || '';
    document.getElementById('dcActState').textContent = gameAct.state || '';
    document.getElementById('dcActImgFallback').textContent = { 0:'🎮', 5:'🖥' }[gameAct.type] || '🎮';
    
    // Assets
    if (gameAct.assets) {
      const appId = gameAct.application_id;
      const li = gameAct.assets.large_image;
      const si = gameAct.assets.small_image;
      const liEl = document.getElementById('dcActLargeImg');
      const siEl = document.getElementById('dcActSmallImg');
      const fb = document.getElementById('dcActImgFallback');
      if (li && appId) {
        const url = li.startsWith('mp:external') ? `https://media.discordapp.net/external/${li.replace('mp:external/','')}` : `https://cdn.discordapp.com/app-assets/${appId}/${li}.png?size=64`;
        liEl.src = url; liEl.style.display = ''; fb.style.display = 'none';
      }
      if (si && appId) {
        const url = si.startsWith('mp:external') ? `https://media.discordapp.net/external/${si.replace('mp:external/','')}` : `https://cdn.discordapp.com/app-assets/${appId}/${si}.png?size=32`;
        siEl.src = url; siEl.style.display = '';
      }
    }
    
    // Elapsed time
    clearInterval(activityTimerInterval);
    if (gameAct.timestamps?.start) {
      const startTs = gameAct.timestamps.start;
      const elEl = document.getElementById('dcActElapsed');
      activityTimerInterval = setInterval(() => {
        const elapsed = Date.now() - startTs;
        const h = Math.floor(elapsed / 3600000);
        const m = Math.floor((elapsed % 3600000) / 60000);
        const s = Math.floor((elapsed % 60000) / 1000);
        elEl.textContent = h > 0 ? `${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')} elapsed` : `${m}:${String(s).padStart(2,'0')} elapsed`;
      }, 1000);
    }
    
    // Profile card activity
    if (dcState.lanyard) {
      const pcAct = document.getElementById('pcActivity');
      pcAct.style.display = 'flex';
      document.getElementById('pcActName').textContent = gameAct.name;
      document.getElementById('pcActSub').textContent = gameAct.details || 'via Discord';
      document.getElementById('pcActIcon').textContent = '🎮';
    }
  } else { actCard.style.display = 'none'; }
}

function applyLanyardPfpToAvatar(user, avatarUrl) {
  if (!avatarUrl && user) {
    const hash = user.avatar;
    avatarUrl = hash
      ? `https://cdn.discordapp.com/avatars/${user.id}/${hash}.${hash.startsWith('a_') ? 'gif' : 'png'}?size=256`
      : `https://cdn.discordapp.com/embed/avatars/${parseInt(user.discriminator || '0') % 5}.png`;
  }
  if (avatarUrl) {
    state.avatar = avatarUrl;
    const av = document.getElementById('pcAvatar');
    av.innerHTML = `<img src="${avatarUrl}" style="width:100%;height:100%;object-fit:cover;">`;
    document.getElementById('avatarPreview').innerHTML = `<img src="${avatarUrl}" style="width:100%;height:100%;object-fit:cover;">`;
    showToast('✅ Discord PFP applied!');
  }
}

function toggleLanyard() {
  // Lanyard removed — using Discord OAuth instead
  const el = document.getElementById('togLanyard');
  if (el) { dcState.lanyard = !dcState.lanyard; el.classList.toggle('on', dcState.lanyard); }
}

// ══════════════════════════════════════════
// PROFILE THEMES
// ══════════════════════════════════════════
const profileThemes = {
  koraz: {
    accent: '#a855f7', accent2: '#22d3ee', cardBg: '#080810', blur: 28,
    font: 'syne', particle: 'network', glitchName: false, symbolRain: false,
    gradStart: '#ffffff', gradMid: '#a855f7', gradEnd: '#22d3ee', gradDir: '135deg',
    borderGrad: true, bgGrad: false,
    nameAnim: 'shimmer',
    bgColor: '#030308',
    textColor: '#f0f0fa',
    cardOpacity: 92,
    linkStyle: 'icons',
    cardTilt: true,
    glow: true,
    description: 'Exactly like guns.lol/koraz. Purple accent, glass card, network particles, shimmer name.',
  },
  darkdev: {
    accent: '#ffffff', accent2: '#999999', cardBg: '#0a0a0a', blur: 20,
    font: 'dm', particle: 'none', glitchName: false, symbolRain: false,
    gradStart: '#ffffff', gradMid: '#cccccc', gradEnd: '#888888', gradDir: '135deg',
    borderGrad: false, bgGrad: false,
    nameAnim: 'shimmer',
    bgColor: '#050505',
    textColor: '#e8e8e8',
    cardOpacity: 95,
    description: 'Clean, premium dark. guns.lol inspired.',
  },
  dev: {
    accent: '#00ff41', accent2: '#00b4d8', cardBg: '#050810', blur: 8,
    font: 'mono', particle: 'matrix', glitchName: true, symbolRain: false,
    gradStart: '#00ff41', gradMid: '#00d4ff', gradEnd: '#0080ff', gradDir: '90deg',
    borderGrad: false, bgGrad: true,
    nameAnim: 'glitch',
    description: 'Terminal green. Hacker vibes. Code aesthetic.',
    bgColor: '#020408',
  },
  void: {
    accent: '#7c3aed', accent2: '#4c1d95', cardBg: '#04010d', blur: 32,
    font: 'syne', particle: 'fireflies', glitchName: false,
    gradStart: '#ffffff', gradMid: '#a78bfa', gradEnd: '#7c3aed', gradDir: '135deg',
    borderGrad: true,
    nameAnim: 'pulse',
    bgColor: '#010006',
  },
  blood: {
    accent: '#f43f5e', accent2: '#9f1239', cardBg: '#0d0005', blur: 20,
    font: 'outfit', particle: 'rain', glitchName: true,
    gradStart: '#fff0f3', gradMid: '#f43f5e', gradEnd: '#9f1239', gradDir: '135deg',
    borderGrad: false, bgGrad: true,
    nameAnim: 'glitch',
    bgColor: '#060002',
  },
  ice: {
    accent: '#00d4ff', accent2: '#0066cc', cardBg: '#000d1a', blur: 28,
    font: 'dm', particle: 'snow', glitchName: false,
    gradStart: '#e0f7ff', gradMid: '#00d4ff', gradEnd: '#0066cc', gradDir: '135deg',
    borderGrad: true,
    nameAnim: 'shimmer',
    bgColor: '#00060f',
  },
  gold: {
    accent: '#f59e0b', accent2: '#92400e', cardBg: '#100b00', blur: 18,
    font: 'syne', particle: 'dust', glitchName: false,
    gradStart: '#fffbf0', gradMid: '#f59e0b', gradEnd: '#b45309', gradDir: '135deg',
    borderGrad: true,
    nameAnim: 'shimmer',
    bgColor: '#070500',
  },
  sakura: {
    accent: '#ff69b4', accent2: '#c2185b', cardBg: '#0f0009', blur: 24,
    font: 'outfit', particle: 'sakura', glitchName: false,
    gradStart: '#fff0f8', gradMid: '#ff69b4', gradEnd: '#c2185b', gradDir: '135deg',
    borderGrad: true,
    nameAnim: 'shimmer',
    bgColor: '#060003',
  },
  matrix: {
    accent: '#00ff00', accent2: '#00aa00', cardBg: '#000d00', blur: 10,
    font: 'mono', particle: 'matrix', glitchName: true, symbolRain: true,
    gradStart: '#ccffcc', gradMid: '#00ff00', gradEnd: '#007700', gradDir: '180deg',
    borderGrad: false,
    nameAnim: 'glitch',
    bgColor: '#000800',
  },
  neon: {
    accent: '#ff0080', accent2: '#00ffff', cardBg: '#000611', blur: 22,
    font: 'orbitron', particle: 'network', glitchName: false,
    gradStart: '#ff0080', gradMid: '#8000ff', gradEnd: '#00ffff', gradDir: '90deg',
    borderGrad: true,
    nameAnim: 'rainbow',
    bgColor: '#000208',
  },
};

// ── JS PRESETS ──
function _applyThemeFull(themeId, overrides) {
  // 1. Apply base theme data
  applyProfileTheme(themeId);
  const t = Object.assign({}, profileThemes[themeId] || {}, overrides || {});

  // 2. Border style
  if (t.borderStyle) {
    const bsEl = document.getElementById('bs-' + t.borderStyle);
    if (bsEl) setBorderStyle(bsEl, t.borderStyle);
    else applyCardBorderStyle(t.borderStyle);
    activeBorderStyle = t.borderStyle;
    state.borderStyle = t.borderStyle;
  }

  // 3. Card skin
  if (t.cardSkin !== undefined) {
    state.cardSkin = t.cardSkin;
    const csEl = document.getElementById('iCardSkin');
    if (csEl) { csEl.value = t.cardSkin; syncCardSkin(); }
  }

  // 4. Particles
  if (t.particle) {
    state.particle = t.particle;
    const pEl = document.getElementById('iParticle');
    if (pEl) { pEl.value = t.particle; syncParticle(); }
  }

  // 5. Symbol rain toggle
  if (t.symbolRain !== undefined) {
    state.symbolRain = t.symbolRain;
    const togEl = document.getElementById('togSymbolRain');
    if (togEl) togEl.classList.toggle('on', t.symbolRain);
  }

  // 6. Card tilt
  if (t.cardTilt !== undefined) {
    state.cardTilt = t.cardTilt;
    const togEl = document.getElementById('togTilt');
    if (togEl) togEl.classList.toggle('on', t.cardTilt);
  }

  // 7. Avatar ring style
  if (t.avRingStyle) {
    state.avRingStyle = t.avRingStyle;
    const rEl = document.getElementById('iAvRingStyle');
    if (rEl) { rEl.value = t.avRingStyle; syncAvRingStyle && syncAvRingStyle(); }
  }

  // 8. Link style
  if (t.linkStyle) { setLinkStyle(t.linkStyle); }

  // 9. Glow
  if (t.glow !== undefined) {
    state.glow = t.glow;
    const togEl = document.getElementById('togGlow');
    if (togEl) togEl.classList.toggle('on', t.glow);
  }

  // 10. BG gradient
  if (t.bgGrad !== undefined) {
    state.bgGrad = t.bgGrad;
    const togEl = document.getElementById('togBgGrad');
    if (togEl) togEl.classList.toggle('on', t.bgGrad);
  }

  // 11. Glow intensity on preview card
  const pc = document.getElementById('pc');
  if (t.borderStyle === 'glow' || t.glow) {
    pc.style.boxShadow = `0 0 35px ${state.accent}55, 0 32px 80px rgba(0,0,0,.8)`;
  }

  // 12. Apply BG color to prevscroll
  if (t.bgColor) {
    document.querySelector('.prevscroll') && (document.querySelector('.prevscroll').style.background = t.bgColor);
  }
}

function applyKorazPreset() {
  _applyThemeFull('koraz', {
    borderStyle: 'glow',
    cardSkin: 'frosted',
    symbolRain: false,
    cardTilt: true,
    avRingStyle: 'glow',
    linkStyle: 'icons',
    glow: true,
  });
  showToast('★ Koraz JS Preset applied!');
}

function applyJoePreset() {
  _applyThemeFull('koraz', {
    borderStyle: 'rainbow',
    cardSkin: 'frosted',
    symbolRain: false,
    cardTilt: true,
    avRingStyle: 'glow',
    linkStyle: 'icons',
    glow: false,
    bgGrad: true,
  });
  // Joe uses Syne bold
  state.font = 'syne';
  const fEl = document.getElementById('iFont');
  if (fEl) { fEl.value = 'syne'; syncFont(); }
  showToast('🌈 Joe JS Preset applied! Add your server widget in Discord tab →');
  // Navigate to discord tab so user sees it
  setTimeout(() => {
    const discordNi = document.querySelector('.ni[onclick*="s-discord"]');
    if (discordNi) nav(discordNi, 's-discord');
  }, 800);
}

let activeThemeId = null;
function applyProfileTheme(themeId) {
  const theme = profileThemes[themeId];
  if (!theme) return;
  
  activeThemeId = themeId;
  
  // Update all theme cards
  document.querySelectorAll('.theme-card').forEach(c => c.classList.remove('active'));
  const card = document.getElementById(`theme-${themeId}`);
  if (card) card.classList.add('active');
  
  // Apply colors
  if (theme.accent) { state.accent = theme.accent; document.getElementById('iAccent').value = theme.accent; document.getElementById('iAccentPick').value = theme.accent; applyAccent(); }
  if (theme.accent2) { state.accent2 = theme.accent2; document.getElementById('iAccent2').value = theme.accent2; document.getElementById('iAccent2Pick').value = theme.accent2; }
  if (theme.cardBg) { state.cardBg = theme.cardBg; document.getElementById('iCardBg').value = theme.cardBg; document.getElementById('iCardBgPick').value = theme.cardBg; }
  if (theme.blur !== undefined) { state.blur = theme.blur; document.getElementById('iBlur').value = theme.blur; document.getElementById('blurVal').textContent = theme.blur + 'px'; syncBlur(); }
  if (theme.font) { state.font = theme.font; document.getElementById('iFont').value = theme.font; syncFont(); }
  if (theme.particle) { state.particle = theme.particle; document.getElementById('iParticle').value = theme.particle; syncParticle(); }
  if (theme.glitchName !== undefined) { state.glitchName = theme.glitchName; document.getElementById('togGlitch').classList.toggle('on', theme.glitchName); }
  if (theme.gradStart) { document.getElementById('iGradStart').value = theme.gradStart; document.getElementById('iGradStartPick').value = theme.gradStart; }
  if (theme.gradMid) { document.getElementById('iGradMid').value = theme.gradMid; document.getElementById('iGradMidPick').value = theme.gradMid; }
  if (theme.gradEnd) { document.getElementById('iGradEnd').value = theme.gradEnd; document.getElementById('iGradEndPick').value = theme.gradEnd; }
  if (theme.gradDir) { document.getElementById('iGradDir').value = theme.gradDir; }
  syncGradient();
  if (theme.bgColor) { document.getElementById('iBgColor').value = theme.bgColor; document.getElementById('iBgColorPick').value = theme.bgColor; syncBgColor(); }
  if (theme.nameAnim) { state.nameAnim = theme.nameAnim; document.getElementById('iNameAnim').value = theme.nameAnim; syncNameAnim(); }
  if (theme.borderGrad !== undefined) { state.borderGrad = theme.borderGrad; document.getElementById('togBorderGrad').classList.toggle('on', theme.borderGrad); }
  if (theme.bgGrad !== undefined) { state.bgGrad = theme.bgGrad; document.getElementById('togBgGrad').classList.toggle('on', theme.bgGrad); }
  if (theme.textColor) { state.textColor = theme.textColor; document.getElementById('iTextColor').value = theme.textColor; document.getElementById('iTextColorPick').value = theme.textColor; syncTextColor(); }
  if (theme.cardOpacity !== undefined) { state.cardOpacity = theme.cardOpacity; document.getElementById('iCardOpacity').value = theme.cardOpacity; document.getElementById('cardOpacityVal').textContent = theme.cardOpacity + '%'; }
  
  // Apply card bg + accent to preview card
  document.getElementById('pc').style.background = `rgba(${hexToRgb(theme.cardBg)}, 0.${state.cardOpacity})`;
  document.getElementById('pc').style.backdropFilter = `blur(${theme.blur}px)`;
  
  showToast(`✅ Theme applied: ${themeId.toUpperCase()}`);
  
  // Update topbar status
  document.getElementById('topbarInfo').textContent = `theme: ${themeId}`;
  const dot = document.getElementById('topbarDot');
  dot.classList.remove('ok');
  dot.classList.add('warn');
}

function hexToRgb(hex) {
  const r = parseInt(hex.slice(1,3),16), g = parseInt(hex.slice(3,5),16), b = parseInt(hex.slice(5,7),16);
  return `${r},${g},${b}`;
}

// Topbar save indicator
function markUnsaved() {
  document.getElementById('topbarInfo').textContent = 'unsaved';
  const dot = document.getElementById('topbarDot');
  dot.classList.add('warn');
  dot.classList.remove('ok');
}

// Hook unsaved indicator on inputs
document.addEventListener('input', () => {
  document.getElementById('topbarInfo').textContent = 'unsaved';
  const dot = document.getElementById('topbarDot');
  dot.classList.add('warn');
  dot.classList.remove('ok');
});

function syncSpotify() { state.spotifyUser = document.getElementById('iSpotifyUser').value.trim(); }
function toggleSpotify() {
  state.showSpotify = !state.showSpotify; document.getElementById('togSpotify').classList.toggle('on', state.showSpotify);
  document.getElementById('pcNowPlaying').style.display = state.showSpotify ? 'flex' : 'none';
  if (state.showSpotify) document.getElementById('pcNpTitle').textContent = document.getElementById('iSpotifyFallback').value || 'vibing to the void 🎵';
}
function syncSpotifyFallback() { state.spotifyFallback = document.getElementById('iSpotifyFallback').value; if (state.showSpotify) document.getElementById('pcNpTitle').textContent = state.spotifyFallback || 'Not listening to anything'; }

// ── NEW FEATURE FUNCTIONS ──────────────────────────────────────────

function setBgEffect(val, el) {
  state.bgEffect = val;
  document.querySelectorAll('[id^="bgfx-"]').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
  // Also handle bgGrad for mesh
  if (val === 'mesh') { state.bgGrad = true; document.getElementById('togBgGrad')?.classList.add('on'); }
  updatePreview();
}

function syncCursorFx() {
  const val = document.getElementById('iCursorFx').value;
  state.cursorEffect = val;
  state.spotlightEffect = val === 'spotlight';
}

function toggleSpotlight() {
  state.spotlightEffect = !state.spotlightEffect;
  document.getElementById('togSpotlight').classList.toggle('on', state.spotlightEffect);
}

function setCardSkin(val, el) {
  state.cardSkin = val;
  document.querySelectorAll('[id^="skin-"]').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
}

function syncCardLayout() {
  state.layout = document.getElementById('iCardLayout').value;
}

function toggleMonoIcons() {
  state.monoIcons = !state.monoIcons;
  document.getElementById('togMonoIcons').classList.toggle('on', state.monoIcons);
  document.getElementById('pcCard')?.classList.toggle('mono-icons', state.monoIcons);
}

function syncGithubUser() {
  state.githubUser = document.getElementById('iGithubUser2').value.trim();
  // Also sync the old iGithubUser if it exists
  const old = document.getElementById('iGithubUser');
  if (old) old.value = state.githubUser;
}

async function previewGitHub() {
  const user = document.getElementById('iGithubUser2').value.trim();
  if (!user) { showToast('❌ Enter a GitHub username'); return; }
  state.githubUser = user;
  const box = document.getElementById('githubPreviewBox');
  box.style.display = 'block';
  const contrib = document.getElementById('ghPreviewContrib');
  const stats = document.getElementById('ghPreviewStats');
  contrib.innerHTML = '<span style="font-size:.68rem;color:var(--mut)">Loading...</span>';
  try {
    const res = await fetch(`https://github-contributions-api.jogruber.de/v4/${user}?y=last`);
    const data = await res.json();
    const weeks = (data.contributions || []).slice(-26);
    contrib.innerHTML = weeks.map(week =>
      `<div style="display:flex;flex-direction:column;gap:2px">${week.map(day => {
        const lv = day.level ?? (day.count === 0 ? 0 : day.count < 3 ? 1 : day.count < 6 ? 2 : day.count < 10 ? 3 : 4);
        const bg = ['rgba(255,255,255,.05)','rgba(168,85,247,.25)','rgba(168,85,247,.5)','rgba(168,85,247,.75)','#a855f7'][lv];
        return `<div style="width:9px;height:9px;border-radius:2px;background:${bg}"></div>`;
      }).join('')}</div>`
    ).join('');
    const total = data.total?.lastYear || 0;
    stats.textContent = `${total.toLocaleString()} contributions in the last year`;
    showToast('✅ GitHub preview loaded!');
  } catch(e) { contrib.innerHTML = '<span style="color:#ef4444;font-size:.68rem">Could not load GitHub data</span>'; }
}
// ══════════════════════════════════════════
function showProgress(wId, bId) {
  const w = document.getElementById(wId), b = document.getElementById(bId);
  w.classList.add('show'); b.style.width = '0%'; let p = 0;
  const iv = setInterval(() => { p += Math.random() * 14; if (p > 85) p = 85; b.style.width = p + '%'; }, 200); w._iv = iv;
}
function hideProgress(wId) {
  const w = document.getElementById(wId); if (w._iv) clearInterval(w._iv);
  const b = w.querySelector('.up-bar'); if (b) b.style.width = '100%';
  setTimeout(() => w.classList.remove('show'), 500);
}

// ══════════════════════════════════════════
// PUBLISH
// ══════════════════════════════════════════
function showPublish() {
  document.getElementById('publishUsername').value = state.username || '';
  document.getElementById('publishUrlPreview').textContent = `vltx-adoe.onrender.com/${state.username || 'yourname'}`;
  document.getElementById('publishModal').classList.add('show');
}
function hidePublish() { document.getElementById('publishModal').classList.remove('show'); }
function hideSuccess() { document.getElementById('successModal').classList.remove('show'); }
async function publishProfile() {
  const username = document.getElementById('publishUsername').value.trim().toLowerCase().replace(/[^a-z0-9_.\-]/g, '');
  if (!username || username.length < 2) { showToast('❌ Username too short'); return; }
  const btn = document.getElementById('publishBtn'); btn.textContent = 'Publishing...'; btn.disabled = true;
  const data = { ...state, username, tracks: (state.tracks || []).map(t => ({ name: t.name, url: t.url, cover: t.cover || null })) };
  try {
    const res = await fetch('/api/profile', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, data })
    });
    if (!res.ok) {
      const text = await res.text().catch(() => '');
      throw new Error(`HTTP ${res.status}: ${text.slice(0, 100)}`);
    }
    const json = await res.json();
    if (json.error) { showToast('❌ ' + json.error); return; }
    publishedUrl = json.url; hidePublish();
    document.getElementById('successUrl').textContent = window.location.host + json.url;
    document.getElementById('successModal').classList.add('show'); showToast('🎉 Published!');
    // Update topbar
    document.getElementById('topbarInfo').textContent = `live: ${username}`;
    document.getElementById('topbarDot').style.background = '#22c55e';
    document.getElementById('topbarDot').style.boxShadow = '0 0 6px #22c55e';
  } catch(err) {
    hidePublish();
    // Show detailed error modal
    showBackendError(err.message);
  }
  finally { btn.textContent = 'Publish →'; btn.disabled = false; }
}

function showBackendError(errMsg) {
  document.getElementById('backendErrorMsg').textContent = errMsg || 'Unknown error';
  document.getElementById('backendErrorModal').classList.add('show');
}
function hideBackendError() { document.getElementById('backendErrorModal').classList.remove('show'); }
function copyUrl() { navigator.clipboard.writeText(window.location.host + publishedUrl).then(() => showToast('📋 Copied!')); }
function visitProfile() { window.open(publishedUrl, '_blank'); hideSuccess(); }
function resetProfile() { if (!confirm('Reset everything?')) return; location.reload(); }
function previewFullscreen() { if (publishedUrl) window.open(publishedUrl, '_blank'); else showToast('Publish first to preview!'); }

// ══════════════════════════════════════════
// TOAST
// ══════════════════════════════════════════
let _tt;
function showToast(msg) { const t = document.getElementById('toast'); t.textContent = msg; t.classList.add('show'); clearTimeout(_tt); _tt = setTimeout(() => t.classList.remove('show'), 2600); }

// ══════════════════════════════════════════
// INIT
// ══════════════════════════════════════════
document.getElementById('iBio').value = state.bioLines.join('\n');
document.getElementById('iTags').value = state.tags.join(', ');
initChips(); initGradChips();
syncBio(); syncTags(); renderTags(); applyAccent();
renderBadges();

// ── Read Discord OAuth params from URL (set by /auth/discord/callback) ────────
(function readOAuthParams() {
  const p = new URLSearchParams(window.location.search);
  if (p.get('discord_id')) {
    const id       = p.get('discord_id');
    const username = p.get('discord_username') || '';
    const avatar   = p.get('discord_avatar')   || '';
    const tag      = p.get('discord_tag')       || '';

    // Fill Discord panel
    document.getElementById('iDiscordId').value   = id;
    document.getElementById('iDiscordUser').value = username;
    dcState.userId = id;
    dcState.user   = username;

    // Save to state for publish
    state.discordUserId = id;
    state.discordId = id;
    state.discordUser   = username;

    // Show live card
    document.getElementById('dcLiveCard').style.display = '';
    document.getElementById('dcLiveName').textContent   = username;
    document.getElementById('dcLiveTag').textContent    = tag;
    document.getElementById('dcOAuthTitle').textContent = username;
    document.getElementById('dcOAuthSub').textContent   = `${tag} · linked via OAuth`;
    document.getElementById('dcOAuthBtn').textContent   = '✓ Connected';
    document.getElementById('dcOAuthBtn').className     = 'dc-oauth-btn connected';

    if (avatar) {
      document.getElementById('dcLiveAvatar').src = avatar;
      // Auto-apply pfp if sync is on
      if (dcState.pfpSync) applyLanyardPfpToAvatar(null, avatar);
    }

    // Update badge on preview card
    syncDiscordUser();

    // Update nav dot
    const navDot = document.getElementById('discordNavDot');
    if (navDot) { navDot.style.background = '#5865F2'; navDot.style.boxShadow = '0 0 6px #5865F2'; }

    showToast('✅ Discord linked via OAuth!');

    // Clean URL so refreshing doesn't re-trigger
    window.history.replaceState({}, '', '/customize');

    // Switch to Discord panel so user sees it
    const discordNavEl = document.querySelector('.ni[onclick*="s-discord"]');
    if (discordNavEl) nav(discordNavEl, 's-discord');
  }

  if (p.get('discord_error')) {
    showToast('⚠️ Discord: ' + decodeURIComponent(p.get('discord_error')));
    window.history.replaceState({}, '', '/customize');
  }
})();

// Sync discordUserId to state when typed
document.getElementById('iDiscordId').addEventListener('input', () => {
  state.discordUserId = document.getElementById('iDiscordId').value.trim();
  state.discordId = state.discordUserId;
});
// Sync discordUser to state
document.getElementById('iDiscordUser').addEventListener('input', () => {
  state.discordUser = document.getElementById('iDiscordUser').value.trim();
});
// Sync discordUrl to state
document.getElementById('iDiscordUrl').addEventListener('input', () => {
  state.discordUrl = document.getElementById('iDiscordUrl').value.trim();
});


// ══════════════════════════════════════════
// NEW THEME DATA
// ══════════════════════════════════════════
Object.assign(profileThemes, {
  vaporwave: {
    accent: '#ff00cc', accent2: '#3333ff', cardBg: '#0d0020', blur: 20,
    font: 'mono', particle: 'network', glitchName: false,
    gradStart: '#ff71ce', gradMid: '#ff00cc', gradEnd: '#3333ff', gradDir: '135deg',
    borderGrad: true, nameAnim: 'shimmer', bgColor: '#07000f',
  },
  aurora: {
    accent: '#00ff80', accent2: '#00ccff', cardBg: '#000d0a', blur: 26,
    font: 'outfit', particle: 'network', glitchName: false,
    gradStart: '#ccffe8', gradMid: '#00ff80', gradEnd: '#00ccff', gradDir: '135deg',
    borderGrad: true, nameAnim: 'shimmer', bgColor: '#000805',
  },
  blood: {
    accent: '#ef4444', accent2: '#7f1d1d', cardBg: '#0d0000', blur: 18,
    font: 'syne', particle: 'dust', glitchName: true,
    gradStart: '#fca5a5', gradMid: '#ef4444', gradEnd: '#7f1d1d', gradDir: '135deg',
    borderGrad: true, nameAnim: 'glitch', bgColor: '#060000',
  },
  gold: {
    accent: '#fbbf24', accent2: '#92400e', cardBg: '#0d0800', blur: 20,
    font: 'syne', particle: 'dust', glitchName: false,
    gradStart: '#fef3c7', gradMid: '#fbbf24', gradEnd: '#92400e', gradDir: '135deg',
    borderGrad: true, nameAnim: 'shimmer', bgColor: '#060400',
  },
  ice: {
    accent: '#93c5fd', accent2: '#bfdbfe', cardBg: '#000d1a', blur: 30,
    font: 'outfit', particle: 'network', glitchName: false,
    gradStart: '#eff6ff', gradMid: '#93c5fd', gradEnd: '#3b82f6', gradDir: '135deg',
    borderGrad: true, nameAnim: 'shimmer', bgColor: '#000610',
  },
  void: {
    accent: '#4b0082', accent2: '#1a0033', cardBg: '#030003', blur: 12,
    font: 'mono', particle: 'none', glitchName: false,
    gradStart: '#e9d5ff', gradMid: '#7c3aed', gradEnd: '#4b0082', gradDir: '135deg',
    borderGrad: false, nameAnim: 'shimmer', bgColor: '#000000',
  },
  sunset: {
    accent: '#f97316', accent2: '#ec4899', cardBg: '#0d0008', blur: 22,
    font: 'syne', particle: 'dust', glitchName: false,
    gradStart: '#fed7aa', gradMid: '#f97316', gradEnd: '#ec4899', gradDir: '135deg',
    borderGrad: true, nameAnim: 'shimmer', bgColor: '#060003',
  },
  y2k: {
    accent: '#ff00dc', accent2: '#9900ff', cardBg: '#0a0012', blur: 26,
    font: 'syne', particle: 'rain', glitchName: false,
    gradStart: '#ff69d0', gradMid: '#bf00ff', gradEnd: '#ff00dc', gradDir: '135deg',
    borderGrad: true, nameAnim: 'rainbow', bgColor: '#06000e',
    textColor: '#fce7f3', cardOpacity: 90,
  },
  brutalist: {
    accent: '#ffffff', accent2: '#888888', cardBg: '#0c0c0c', blur: 0,
    font: 'mono', particle: 'none', glitchName: false,
    gradStart: '#ffffff', gradMid: '#cccccc', gradEnd: '#666666', gradDir: '180deg',
    borderGrad: false, nameAnim: 'none', bgColor: '#080808',
    textColor: '#ffffff', cardOpacity: 98,
  },
  forest: {
    accent: '#4ade80', accent2: '#166534', cardBg: '#020d06', blur: 18,
    font: 'outfit', particle: 'fireflies', glitchName: false,
    gradStart: '#bbf7d0', gradMid: '#4ade80', gradEnd: '#166534', gradDir: '135deg',
    borderGrad: false, bgGrad: true, nameAnim: 'shimmer', bgColor: '#010a04',
    textColor: '#dcfce7', cardOpacity: 92,
  },
  synthwave: {
    accent: '#ff6ec7', accent2: '#ff3d00', cardBg: '#0a0014', blur: 24,
    font: 'orbitron', particle: 'network', glitchName: false,
    gradStart: '#ff6ec7', gradMid: '#c850c0', gradEnd: '#ff3d00', gradDir: '90deg',
    borderGrad: true, nameAnim: 'shimmer', bgColor: '#07000e',
    textColor: '#fce7f3', cardOpacity: 92,
  },
  obsidian: {
    accent: '#818cf8', accent2: '#4f46e5', cardBg: '#000000', blur: 20,
    font: 'mono', particle: 'dust', glitchName: false,
    gradStart: '#e0e7ff', gradMid: '#818cf8', gradEnd: '#4f46e5', gradDir: '135deg',
    borderGrad: false, nameAnim: 'shimmer', bgColor: '#000000',
    textColor: '#e0e7ff', cardOpacity: 97,
  },
  rust: {
    accent: '#fb923c', accent2: '#78350f', cardBg: '#0d0600', blur: 16,
    font: 'syne', particle: 'dust', glitchName: false,
    gradStart: '#ffedd5', gradMid: '#fb923c', gradEnd: '#92400e', gradDir: '135deg',
    borderGrad: true, nameAnim: 'shimmer', bgColor: '#090400',
    textColor: '#ffedd5', cardOpacity: 93,
  },
  light: {
    accent: '#6366f1', accent2: '#8b5cf6', cardBg: '#f0eeff', blur: 12,
    font: 'dm', particle: 'none', glitchName: false,
    gradStart: '#1e1b4b', gradMid: '#6366f1', gradEnd: '#8b5cf6', gradDir: '135deg',
    borderGrad: false, nameAnim: 'shimmer', bgColor: '#e8e4ff',
    textColor: '#1e1b4b', cardOpacity: 95,
  },
});

// ══════════════════════════════════════════
// BORDER STYLES
// ══════════════════════════════════════════
let activeBorderStyle = 'solid';
function setBorderStyle(el, style) {
  document.querySelectorAll('.border-style-card').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
  activeBorderStyle = style;
  applyCardBorderStyle(style);
}
function applyCardBorderStyle(style) {
  const pc = document.getElementById('pc');
  pc.style.animation = '';
  if (style === 'solid') {
    pc.style.border = '1px solid rgba(255,255,255,.07)';
    pc.style.boxShadow = '0 32px 80px rgba(0,0,0,.7)';
  } else if (style === 'glow') {
    pc.style.border = `1px solid ${state.accent}55`;
    pc.style.boxShadow = `0 0 30px ${state.accent}44, 0 32px 80px rgba(0,0,0,.7)`;
  } else if (style === 'rainbow') {
    pc.style.border = '2px solid transparent';
    pc.style.backgroundImage = `linear-gradient(${state.cardBg}, ${state.cardBg}), linear-gradient(90deg,#f00,#ff0,#0f0,#0ff,#00f,#f0f,#f00)`;
    pc.style.backgroundClip = 'padding-box, border-box';
    pc.style.backgroundOrigin = 'border-box';
  } else if (style === 'fire') {
    pc.style.border = '2px solid transparent';
    pc.style.backgroundImage = `linear-gradient(${state.cardBg}, ${state.cardBg}), linear-gradient(90deg,#ff4500,#ff8c00,#ffd700,#ff4500)`;
    pc.style.backgroundClip = 'padding-box, border-box';
    pc.style.backgroundOrigin = 'border-box';
  } else if (style === 'electric') {
    pc.style.border = '2px solid transparent';
    pc.style.backgroundImage = `linear-gradient(${state.cardBg}, ${state.cardBg}), linear-gradient(90deg,#00ffff,#fff,#00ffff)`;
    pc.style.backgroundClip = 'padding-box, border-box';
    pc.style.backgroundOrigin = 'border-box';
  } else if (style === 'none') {
    pc.style.border = 'none';
    pc.style.boxShadow = '0 32px 80px rgba(0,0,0,.7)';
  }
}

// ══════════════════════════════════════════
// GLOW CONTROLS
// ══════════════════════════════════════════
function syncGlowInt() {
  const v = document.getElementById('iGlowInt').value;
  document.getElementById('glowIntVal').textContent = v + '%';
  state.glowInt = parseInt(v);
  const pc = document.getElementById('pc');
  pc.style.boxShadow = `0 0 ${v * 0.8}px ${state.accent}${Math.floor(v * 0.7).toString(16).padStart(2,'0')}, 0 32px 80px rgba(0,0,0,.7)`;
}
function syncGlowColor() {
  state.accent = document.getElementById('iGlowColor').value;
  document.getElementById('iGlowColorPick').value = state.accent;
  syncGlowInt();
}
function syncGlowColorPick() {
  const v = document.getElementById('iGlowColorPick').value;
  document.getElementById('iGlowColor').value = v;
  state.accent = v; syncGlowInt();
}

// ══════════════════════════════════════════
// NAME TEXT SHADOW
// ══════════════════════════════════════════
function setNameShadow(style) {
  const el = document.getElementById('pcUsername');
  const shadows = {
    none: '',
    soft: '0 2px 8px rgba(0,0,0,.5)',
    neon: `0 0 10px ${state.accent}, 0 0 20px ${state.accent}, 0 0 40px ${state.accent}`,
    fire: '0 0 10px #ff4500, 0 0 20px #ff8c00, 0 0 40px #ffd700',
    ice: '0 0 10px #93c5fd, 0 0 20px #bfdbfe',
    gold: '0 0 10px #fbbf24, 0 0 20px #ffd700, 0 0 40px #fbbf24',
  };
  el.style.textShadow = shadows[style] || '';
  showToast(`✨ ${style} shadow applied!`);
}

// ══════════════════════════════════════════
// STICKERS
// ══════════════════════════════════════════
let activeStickers = [];
function addSticker(emoji) {
  if (!emoji || !emoji.trim()) return;
  const sticker = { emoji: emoji.trim(), id: Date.now() };
  activeStickers.push(sticker);
  renderStickersOnCard();
  renderActiveStickersList();
  showToast('✅ Sticker added!');
}
function clearStickers() {
  activeStickers = [];
  renderStickersOnCard();
  renderActiveStickersList();
  showToast('Stickers cleared');
}
function removeSticker(id) {
  activeStickers = activeStickers.filter(s => s.id !== id);
  renderStickersOnCard();
  renderActiveStickersList();
}
function renderStickersOnCard() {
  const pc = document.getElementById('pc');
  pc.querySelectorAll('.card-sticker').forEach(s => s.remove());
  const positions = [
    {top:'-10px',left:'-10px'},{top:'-10px',right:'-10px'},
    {bottom:'10px',left:'-10px'},{bottom:'10px',right:'-10px'},
    {top:'40%',left:'-15px'},{top:'40%',right:'-15px'},
    {top:'20%',left:'10px'},{top:'20%',right:'10px'},
  ];
  activeStickers.forEach((s, i) => {
    const el = document.createElement('div');
    el.className = 'card-sticker';
    el.textContent = s.emoji;
    const pos = positions[i % positions.length];
    Object.assign(el.style, pos);
    el.style.setProperty('--dur', (3 + (i * 0.7)) + 's');
    el.style.setProperty('--delay', (i * 0.3) + 's');
    el.style.setProperty('--rot', (i % 2 === 0 ? -5 : 5) + 'deg');
    pc.appendChild(el);
  });
}
function renderActiveStickersList() {
  const el = document.getElementById('activeStickersList');
  if (!activeStickers.length) {
    el.innerHTML = '<span style="font-size:.72rem;color:var(--mut)">No stickers yet — add some above!</span>';
    return;
  }
  el.innerHTML = activeStickers.map(s =>
    `<div style="display:inline-flex;align-items:center;gap:4px;background:var(--sur2);border:1px solid var(--brd);border-radius:6px;padding:4px 8px;font-size:1rem;cursor:pointer" onclick="removeSticker(${s.id})" title="Click to remove">${s.emoji} <span style="font-size:.6rem;color:var(--mut)">✕</span></div>`
  ).join('');
}

// ══════════════════════════════════════════
// CURSOR FX CONTROLS
// ══════════════════════════════════════════
function syncCursorStyle() {
  state.cursor = document.getElementById('iCursorStyle').value;
  showToast('Cursor style: ' + state.cursor);
}
function syncCursorColor() {
  const v = document.getElementById('iCursorColor').value;
  document.getElementById('iCursorColorPick').value = v;
}
function syncCursorColorPick() {
  const v = document.getElementById('iCursorColorPick').value;
  document.getElementById('iCursorColor').value = v;
}
function syncSparkStyle() { showToast('Spark style: ' + document.getElementById('iSparkStyle').value); }
function syncTrailStyle() { showToast('Trail style: ' + document.getElementById('iTrailStyle').value); }
function toggleClickSparks() {
  state.clickSparks = !state.clickSparks;
  document.getElementById('togClickSparks').classList.toggle('on', state.clickSparks);
  showToast(state.clickSparks ? '✅ Click sparks on' : 'Click sparks off');
}
function toggleTrail() {
  const tog = document.getElementById('togTrail');
  tog.classList.toggle('on');
  showToast('Trail ' + (tog.classList.contains('on') ? 'enabled' : 'disabled'));
}

// ══════════════════════════════════════════
// CUSTOM CSS
// ══════════════════════════════════════════
let _customStyleEl = null;
function syncCustomCss() {
  const css = document.getElementById('iCustomCss').value;
  state.customCss = css;
  if (!_customStyleEl) {
    _customStyleEl = document.createElement('style');
    _customStyleEl.id = 'custom-css-preview';
    document.head.appendChild(_customStyleEl);
  }
  // Scope it to the preview card
  const scoped = css.replace(/([^{}]+){/g, (match, selector) => {
    if (selector.trim().startsWith('@')) return match;
    return selector.split(',').map(s => `#pc ${s.trim()}`).join(',') + '{';
  });
  _customStyleEl.textContent = scoped;
}
const CSS_SNIPPETS = {
  glass: `#pc {
  background: rgba(255,255,255,0.04) !important;
  backdrop-filter: blur(48px) saturate(180%) !important;
  -webkit-backdrop-filter: blur(48px) saturate(180%) !important;
  border: 1px solid rgba(255,255,255,0.08) !important;
}`,
  rainbow_border: `@keyframes rbSpin {
  to { background-position: 200% 50%; }
}
#pc {
  border: 2.5px solid transparent !important;
  background-image:
    linear-gradient(#0f0f1a, #0f0f1a),
    linear-gradient(90deg,#f43f5e,#f97316,#eab308,#22c55e,#06b6d4,#a855f7,#f43f5e) !important;
  background-origin: border-box !important;
  background-clip: padding-box, border-box !important;
  background-size: 200% !important;
  animation: rbSpin 2s linear infinite !important;
}`,
  spin_border: `@keyframes conicSpin { to { --angle: 360deg; } }
@property --angle { syntax: "<angle>"; initial-value: 0deg; inherits: false; }
#pc {
  border: 2.5px solid transparent !important;
  background-image:
    linear-gradient(#0f0f1a, #0f0f1a),
    conic-gradient(from var(--angle),#f43f5e,#f97316,#eab308,#22c55e,#06b6d4,#a855f7,#f43f5e) !important;
  background-origin: border-box !important;
  background-clip: padding-box, border-box !important;
  animation: conicSpin 2.5s linear infinite !important;
}`,
  bounce: `@keyframes bounceAv {
  0%,100% { transform: translateY(0) scale(1); }
  50%      { transform: translateY(-14px) scale(1.06); }
}
.pc-avatar { animation: bounceAv 1.8s ease-in-out infinite !important; }`,
  shake: `@keyframes shakeIt {
  0%,100% { transform: translateX(0); }
  20%     { transform: translateX(-5px) rotate(-1deg); }
  60%     { transform: translateX(5px) rotate(1deg); }
}
.pc-username { cursor:pointer; display:inline-block; }
.pc-username:hover { animation: shakeIt 0.35s ease !important; }`,
  neon_glow: `@keyframes neonPulse {
  0%,100% { text-shadow: 0 0 8px #a855f7, 0 0 22px #a855f7, 0 0 48px #a855f7; }
  50%      { text-shadow: 0 0 3px #a855f7, 0 0 10px #a855f7; }
}
.pc-username {
  -webkit-text-fill-color: #a855f7 !important;
  animation: neonPulse 2s ease-in-out infinite !important;
}`,
  glitch_avatar: `@keyframes glitchAv {
  0%,90%,100% { clip-path:inset(0 0 0 0); transform:translate(0); filter:none; }
  91%  { clip-path:inset(30% 0 20% 0); transform:translate(-4px,2px); filter:hue-rotate(90deg); }
  93%  { clip-path:inset(60% 0 10% 0); transform:translate(4px,-2px); filter:hue-rotate(200deg); }
  95%  { clip-path:inset(0 0 0 0); transform:translate(0); }
}
.pc-avatar { animation: glitchAv 2.5s steps(1) infinite !important; }`,
  scanlines: `#pc::after {
  content: '' !important;
  position: absolute !important;
  inset: 0 !important;
  background: repeating-linear-gradient(
    0deg, rgba(0,0,0,.07) 0px, rgba(0,0,0,.07) 1px, transparent 1px, transparent 3px
  ) !important;
  pointer-events: none !important;
  z-index: 100 !important;
  border-radius: inherit !important;
}`,
  float: `@keyframes floatCard {
  0%,100% { transform: translateY(0) rotate(0); }
  33%     { transform: translateY(-8px) rotate(.3deg); }
  66%     { transform: translateY(-4px) rotate(-.2deg); }
}
#pc { animation: floatCard 4s ease-in-out infinite !important; }`,
  matrix_text: `#pc { font-family:'Space Mono',monospace !important; }
.pc-username {
  -webkit-text-fill-color: #00ff41 !important;
  text-shadow: 0 0 14px #00ff41, 0 0 30px #00ff41 !important;
}`,
};
function insertCssSnippet(key) {
  const el = document.getElementById('iCustomCss');
  const snippet = CSS_SNIPPETS[key] || '';
  el.value = (el.value ? el.value + '\n\n' : '') + snippet;
  syncCustomCss();
  showToast('✅ Snippet inserted — click ▶ Apply!');
}



// ══════════════════════════════════════════
// SKILL BARS
// ══════════════════════════════════════════
let skillBars = [];
function addSkillBar() {
  const name = document.getElementById('iSkillBarName').value.trim();
  const level = parseInt(document.getElementById('iSkillBarLevel').value) || 80;
  if (!name) { showToast('Enter a skill name!'); return; }
  addSkillBarDirect(name, Math.min(100, Math.max(0, level)));
  document.getElementById('iSkillBarName').value = '';
  document.getElementById('iSkillBarLevel').value = '';
}
function addSkillBarDirect(name, level) {
  skillBars.push({ name, level });
  state.skillBars = skillBars;
  renderSkillBarList();
  renderSkillBarsCard();
  showToast(`✅ ${name} ${level}% added!`);
}
function removeSkillBar(i) {
  skillBars.splice(i, 1);
  state.skillBars = skillBars;
  renderSkillBarList();
  renderSkillBarsCard();
}
function renderSkillBarList() {
  const el = document.getElementById('skillBarList');
  if (!skillBars.length) { el.innerHTML = '<div style="font-size:.72rem;color:var(--mut)">No skill bars yet.</div>'; return; }
  el.innerHTML = skillBars.map((s, i) => `
    <div style="display:flex;align-items:center;gap:8px;background:var(--sur2);border:1px solid var(--brd);border-radius:6px;padding:7px 10px">
      <span style="font-size:.8rem;flex:1">${s.name}</span>
      <span style="font-size:.75rem;color:var(--acc);font-weight:700">${s.level}%</span>
      <div style="width:60px;height:4px;background:rgba(255,255,255,.08);border-radius:100px;overflow:hidden">
        <div style="height:100%;width:${s.level}%;background:linear-gradient(90deg,var(--acc),var(--acc2));border-radius:100px"></div>
      </div>
      <button onclick="removeSkillBar(${i})" style="background:none;border:none;color:var(--mut);cursor:pointer;font-size:.85rem">✕</button>
    </div>
  `).join('');
}
function renderSkillBarsCard() {
  // Show in preview card (inject below skills row)
  let sbEl = document.getElementById('pcSkillBarsPreview');
  if (!sbEl) {
    sbEl = document.createElement('div');
    sbEl.id = 'pcSkillBarsPreview';
    sbEl.style.cssText = 'margin-bottom:12px;padding:0 4px';
    const skillsRow = document.getElementById('pcSkillsRow');
    skillsRow.parentNode.insertBefore(sbEl, skillsRow);
  }
  if (!skillBars.length) { sbEl.style.display = 'none'; return; }
  sbEl.style.display = '';
  sbEl.innerHTML = skillBars.map(s => `
    <div style="margin-bottom:8px">
      <div style="display:flex;justify-content:space-between;font-size:.68rem;color:var(--mut);margin-bottom:3px">
        <span>${s.name}</span><span style="color:var(--acc);font-weight:700">${s.level}%</span>
      </div>
      <div style="height:4px;background:rgba(255,255,255,.07);border-radius:100px;overflow:hidden">
        <div style="height:100%;width:${s.level}%;background:linear-gradient(90deg,var(--acc),var(--acc2));border-radius:100px;transition:width 1.2s"></div>
      </div>
    </div>
  `).join('');
}

// ══════════════════════════════════════════
// TIMELINE
// ══════════════════════════════════════════
let timelineItems = [];
function addTimelineItem() {
  const event = document.getElementById('iTimelineEvent').value.trim();
  if (!event) { showToast('Enter an event name!'); return; }
  const item = {
    event,
    date: document.getElementById('iTimelineDate').value.trim(),
    icon: document.getElementById('iTimelineIcon').value.trim() || '📌',
    desc: document.getElementById('iTimelineDesc').value.trim(),
  };
  timelineItems.push(item);
  state.timeline = timelineItems;
  renderTimelineList();
  ['iTimelineEvent','iTimelineDate','iTimelineIcon','iTimelineDesc'].forEach(id => document.getElementById(id).value = '');
  showToast('✅ Timeline event added!');
}
function removeTimelineItem(i) {
  timelineItems.splice(i, 1);
  state.timeline = timelineItems;
  renderTimelineList();
}
function renderTimelineList() {
  const el = document.getElementById('timelineList');
  if (!timelineItems.length) { el.innerHTML = '<span style="font-size:.72rem;color:var(--mut)">No events yet.</span>'; return; }
  el.innerHTML = timelineItems.map((t, i) => `
    <div style="display:flex;align-items:flex-start;gap:8px;background:var(--sur2);border:1px solid var(--brd);border-radius:6px;padding:8px 10px;margin-bottom:4px">
      <span style="font-size:1rem">${t.icon}</span>
      <div style="flex:1">
        <div style="font-size:.8rem;font-weight:600">${t.event}</div>
        ${t.date ? `<div style="font-size:.65rem;color:var(--mut)">${t.date}</div>` : ''}
      </div>
      <button onclick="removeTimelineItem(${i})" style="background:none;border:none;color:var(--mut);cursor:pointer;font-size:.85rem">✕</button>
    </div>
  `).join('');
}

// ══════════════════════════════════════════
// QUOTE
// ══════════════════════════════════════════
function syncQuote() {
  state.quote = document.getElementById('iQuote').value.trim();
  state.quoteAuthor = document.getElementById('iQuoteAuthor').value.trim();
}
function setQuote(text, author) {
  document.getElementById('iQuote').value = text;
  document.getElementById('iQuoteAuthor').value = author;
  syncQuote();
  showToast('✅ Quote set!');
}

// ══════════════════════════════════════════
// REACTIONS
// ══════════════════════════════════════════
function toggleReactions() {
  state.showReactions = !(state.showReactions !== false);
  document.getElementById('togReactions').classList.toggle('on', state.showReactions !== false);
}
function toggleFloatingEmoji() {
  state.floatingEmojiReactions = !state.floatingEmojiReactions;
  document.getElementById('togFloatingEmoji').classList.toggle('on', state.floatingEmojiReactions);
}
function toggleConfetti() {
  state.confettiBurst = !(state.confettiBurst === false);
  document.getElementById('togConfetti').classList.toggle('on', state.confettiBurst !== false);
}

// ══════════════════════════════════════════
// WEATHER
// ══════════════════════════════════════════
function toggleWeather() {
  state.showWeather = !state.showWeather;
  document.getElementById('togWeather').classList.toggle('on', state.showWeather);
}

// ══════════════════════════════════════════
// VISITOR MAP
// ══════════════════════════════════════════
function toggleVisitorMap() {
  state.showVisitorMap = !state.showVisitorMap;
  document.getElementById('togVisitorMap').classList.toggle('on', state.showVisitorMap);
}
function toggleVisitorCounter() {
  state.showVisitorCounter = !(state.showVisitorCounter === false);
  document.getElementById('togVisitorCounter').classList.toggle('on', state.showVisitorCounter !== false);
}
function toggleAvailable() {
  state.showAvailable = !state.showAvailable;
  document.getElementById('togAvailable').classList.toggle('on', state.showAvailable);
  showToast(state.showAvailable ? '✅ Available indicator on' : 'Available indicator off');
}

// ══════════════════════════════════════════
// MARQUEE & ANIMATED TEXT
// ══════════════════════════════════════════
function syncBannerMarquee() { state.bannerMarquee = document.getElementById('iBannerMarquee').value; }
function syncLyricsTicker() { state.lyricsTicker = document.getElementById('iLyricsTicker').value; }
function syncBannerText() { state.bannerText = document.getElementById('iBannerText').value; }
function toggleAnimLogo() {
  state.animLogo = !(state.animLogo === false);
  document.getElementById('togAnimLogo').classList.toggle('on', state.animLogo !== false);
}
function toggleNeonScanline() {
  state.neonScanline = !state.neonScanline;
  document.getElementById('togNeonScanline').classList.toggle('on', state.neonScanline);
}
function toggleScanlines() {
  state.scanlines = !state.scanlines;
  document.getElementById('togScanlines').classList.toggle('on', state.scanlines);
}

// ══════════════════════════════════════════
// PARTICLES EXTRA
// ══════════════════════════════════════════
function toggleMatrixRain() {
  state.matrixRain = !state.matrixRain;
  document.getElementById('togMatrixRain').classList.toggle('on', state.matrixRain);
  showToast(state.matrixRain ? '🟩 Matrix rain ON' : 'Matrix rain off');
}
function toggleSnowRain() {
  state.snowRain = !state.snowRain;
  document.getElementById('togSnowRain').classList.toggle('on', state.snowRain);
  showToast(state.snowRain ? '❄️ Snow ON' : 'Snow off');
}
function syncFloatingEmoji() {
  state.floatingEmoji = document.getElementById('iFloatingEmoji').value;
}
function toggleFloatingEmojiEffect() {
  const tog = document.getElementById('togFloatingEmojiEffect');
  tog.classList.toggle('on');
  state.floatingEmojiActive = tog.classList.contains('on');
  if (state.floatingEmojiActive) {
    state.floatingEmoji = document.getElementById('iFloatingEmoji').value || '🔥,✨,💀';
  } else {
    state.floatingEmoji = null;
  }
}


// ══════════════════════════════════════════
// NEW CUSTOMIZATION FUNCTIONS
// ══════════════════════════════════════════

// CARD SKIN EXTENDED
function setCardSkinEx(val, el) {
  state.cardSkin = val;
  document.querySelectorAll('[id^="cskin-"]').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
  // Update preview card
  const pc = document.getElementById('pc');
  pc.className = pc.className.replace(/\bskin-\S+/g, '');
  if (val !== 'default') pc.classList.add('skin-' + val);
  if (val === 'holo') { state.holoCard = true; state.cardSkin = null; }
  else state.holoCard = false;
}

// BORDER ANIMATION
function syncBorderAnim() {
  state.borderAnim = document.getElementById('iBorderAnim').value;
  showToast('Border animation set: ' + (state.borderAnim || 'default spin'));
}

// CARD SHAPE
function setCardShape(val, el) {
  state.cardShape = val;
  document.querySelectorAll('[id^="cshape-"]').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
  const pc = document.getElementById('pc');
  pc.className = pc.className.replace(/\bcard-shape-\S+/g, '');
  if (val !== 'default') pc.classList.add('card-shape-' + val);
}

// 3D TILT
function toggleTilt3d() {
  state.tilt3d = !(state.tilt3d === false ? false : state.tilt3d !== false);
  if (state.tilt3d === undefined) state.tilt3d = false;
  else state.tilt3d = !state.tilt3d;
  document.getElementById('togTilt3d').classList.toggle('on', state.tilt3d !== false);
}
function syncTiltAmount() {
  const v = document.getElementById('iTiltAmount').value;
  state.tiltAmount = parseInt(v);
  document.getElementById('tiltAmountVal').textContent = v + '°';
}

// BANNER STYLE
function syncBannerStyle() { state.bannerStyle = document.getElementById('iBannerStyle').value; }
function syncBannerColor() { state.bannerColor = document.getElementById('iBannerColor').value; }

// BACKGROUND PATTERN
function setBgPattern(val, el) {
  state.bgPattern = val === 'none' ? '' : val;
  document.querySelectorAll('[id^="bgpat-"]').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
  showToast('Pattern: ' + val);
}

// HOLO CARD
function toggleHoloCard() {
  state.holoCard = !state.holoCard;
  document.getElementById('togHoloCard').classList.toggle('on', state.holoCard);
}

// FOOTER BADGE
function toggleFooterBadge() {
  state.footerBadge = !(state.footerBadge === false);
  document.getElementById('togFooterBadge').classList.toggle('on', state.footerBadge !== false);
}

// AVATAR FRAME
function setAvFrame(val, el) {
  state.avFrame = val === 'none' ? '' : val;
  document.querySelectorAll('[id^="avframe-"]').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
  // Preview
  const av = document.querySelector('.pc-avatar');
  if (!av) return;
  av.className = av.className.replace(/\bavatar-frame-\S+/g, '');
  if (val !== 'none') av.classList.add('avatar-frame-' + val);
}

// AVATAR FILTER
function syncAvFilter() {
  state.avFilter = document.getElementById('iAvFilter').value;
  const av = document.querySelector('.pc-avatar');
  if (!av) return;
  av.className = av.className.replace(/\bav-\S+/g, '');
  if (state.avFilter) av.classList.add('av-' + state.avFilter);
}

// NAME SHADOW
function setNameShadow(val, el) {
  state.nameShadow = val === 'none' ? '' : val;
  document.querySelectorAll('[id^="nshadow-"]').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
  const un = document.getElementById('pcUsername');
  if (!un) return;
  un.className = un.className.replace(/\bshadow-\S+/g, '');
  if (val !== 'none') un.classList.add('shadow-' + val);
}

// USERNAME SIZE
function syncUnSize() {
  const v = parseFloat(document.getElementById('iUnSize').value);
  state.usernameSize = v;
  document.getElementById('unSizeVal').textContent = v.toFixed(1) + 'rem';
  const un = document.getElementById('pcUsername');
  if (un) un.style.fontSize = v + 'rem';
}

// LETTER SPACING
function syncUnLetterSpace() {
  const v = parseInt(document.getElementById('iUnLetterSpace').value);
  const em = (v/1000).toFixed(3) + 'em';
  state.letterSpacing = em;
  document.getElementById('unSpaceVal').textContent = em;
  const un = document.getElementById('pcUsername');
  if (un) un.style.letterSpacing = em;
}

// SOC ICON STYLE
function setSocIconStyle(val, el) {
  state.socIconStyle = val === 'circle' ? '' : val;
  document.querySelectorAll('[id^="socshape-"]').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
}

// LINK STYLE PRESET
function setLinkStylePreset(val, el) {
  state.linkStylePreset = val === 'default' ? '' : val;
  document.querySelectorAll('[id^="lstyle-"]').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
}

// TAG STYLE
function setTagStyle(val, el) {
  state.tagStyle = val === 'default' ? '' : val;
  document.querySelectorAll('[id^="tagstyle-"]').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
}

// BIO GLOW / ITALIC
function toggleBioGlow()   { state.bioGlow = !state.bioGlow; document.getElementById('togBioGlow').classList.toggle('on', state.bioGlow); }
function toggleBioItalic() { state.bioItalic = !state.bioItalic; document.getElementById('togBioItalic').classList.toggle('on', state.bioItalic); }

// STATUS COLOR
function syncStatusColor() { state.statusColor = document.getElementById('iStatusColor').value; }

// NOW PLAYING WIDGET
function syncNpWidget() {
  state.npTrack = document.getElementById('iNpTrack').value.trim();
  state.npArtist = document.getElementById('iNpArtist').value.trim();
}

// COUNTDOWN
function toggleCountdown() {
  state.showCountdown = !state.showCountdown;
  document.getElementById('togCountdown').classList.toggle('on', state.showCountdown);
}
function syncCountdown() {
  state.countdownTitle = document.getElementById('iCountdownTitle').value.trim();
  state.countdownDate = document.getElementById('iCountdownDate').value;
}

// GOAL WIDGET
function syncGoal() {
  state.goalLabel = document.getElementById('iGoalLabel').value.trim();
  state.goalSub = document.getElementById('iGoalSub').value.trim();
}
function syncGoalPct() {
  const v = document.getElementById('iGoalPct').value;
  state.goalPct = parseInt(v);
  document.getElementById('goalPctVal').textContent = v + '%';
}

// MUSIC PLAYER SKIN
function setPlayerSkin(val, el) {
  state.playerSkin = val === 'default' ? '' : val;
  document.querySelectorAll('[id^="pskin-"]').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
}

// PAGE ANIMATION
function setPageAnim(val, el) {
  state.pageAnim = val;
  document.querySelectorAll('[id^="panim-"]').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
  showToast('Entry animation: ' + val);
}

// Override the existing state.build to include new fields
const _origBuildState = typeof buildState !== 'undefined' ? buildState : null;


// ══════════════════════════════════════════════════════════════════
//  NEW MEGA FEATURES — JS
// ══════════════════════════════════════════════════════════════════

// ── Extend state with new fields ──────────────────────────────────
Object.assign(state, {
  audioViz: 'bars', vizColor: '#a855f7', vizHeight: 60, vizBars: 32,
  vizReactive: true, vizAlwaysOn: false, vizGlow: true,
  bg3d: 'floating', tiltStrength: 15, tilt3dAvatar: true,
  depthShadow: true, parallaxBg: true, perspective: '800px',
  nameFx2: '', bioStyle: 'normal', lsName: 0, fsName: 28,
  tagPrefix: '', bioCursor: 'block', textShadow: false,
  nameBold: true, tagUppercase: false,
  glassStyle: 'default', glassSat: 100, glassReflection: false,
  glassNoise: true, glowColor: '#a855f7',
  neonText: '', neonPos: 'top', neonColor: '#ff0080', neonFont: 'orbitron',
  neonSize: 28, neonFlicker: true, neonBuzz: false,
  showYoutube: false, youtubeUrl: '', showTwitch: false, twitchUser: '',
  showTwitter: false, twitterWidget: '', showSteam: false, steamId: '',
  showIframe: false, iframeUrl: '', iframeH: 200,
  bgVideoUrl: '', vbgDim: 60, vbgBlur: false, vbgGrayscale: false, vbgBlend: 'normal',
  pronounsStyle: 'pill', subtitle: '', cardShadow: 'default',
  showBanner: false, bannerColor: '#a855f7', bannerImg: '', cardTexture: 'none', divider: 'line',
  soundFx: false, hoverSound: 'click', clickSound: 'pop', loadSound: 'none', soundVol: 30,
  showGallery: false, galleryLayout: 'grid', galleryImages: [], galleryHover: 'zoom', galleryLightbox: true,
  profilePassword: '', visibility: 'public', hideViewCount: false, noIndex: false,
  noScreenshot: false,
  ogTitle: '', ogDesc: '', ogImage: '', themeColor: '#a855f7', twitterCard: 'summary_large_image',
  discordWebhook: '', webhookOnView: true, webhookOnFollow: true,
  showViewsBadge: true, trackClicks: true,
});

// ── Audio Visualizer ──────────────────────────────────────────────
function setAudioViz(val, el) {
  state.audioViz = val;
  document.querySelectorAll('[id^="aviz-"]').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
  showToast(`♫ Visualizer: ${val}`);
}
function syncVizColor() {
  const v = document.getElementById('iVizColor').value;
  state.vizColor = v;
  document.getElementById('iVizColorPick').value = v.length === 7 ? v : '#a855f7';
}

// ── 3D Effects ────────────────────────────────────────────────────
function set3DBg(val, el) {
  state.bg3d = val;
  document.querySelectorAll('[id^="bg3d-"]').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
  showToast(`◈ 3D Background: ${val}`);
}
function syncTiltStrength() {
  const val = document.getElementById('iTiltStrength').value;
  state.tiltStrength = +val;
  const labels = { 0: 'Off', 5: 'Subtle', 15: 'Medium', 25: 'Strong', 40: 'Extreme' };
  document.getElementById('tiltValLabel').textContent = labels[val] || val;
}

// ── Text FX+ ─────────────────────────────────────────────────────
function syncNameFx2() {
  state.nameFx2 = document.getElementById('iNameFx2').value;
  const el = document.getElementById('pcUsername');
  if (!el) return;
  el.dataset.namefx = state.nameFx2;
  showToast(`Text FX: ${state.nameFx2 || 'default'}`);
}
function syncBioStyle() {
  state.bioStyle = document.getElementById('iBioStyle').value;
  const el = document.getElementById('pcBio');
  if (!el) return;
  const fontMap = {
    normal: '', italic: 'italic', monospace: "'Space Mono',monospace",
    handwriting: 'cursive', 'small-caps': '', faded: ''
  };
  if (state.bioStyle === 'monospace') el.style.fontFamily = "'Space Mono',monospace";
  else if (state.bioStyle === 'handwriting') el.style.fontFamily = 'cursive';
  else el.style.fontFamily = '';
  el.style.fontStyle = state.bioStyle === 'italic' ? 'italic' : '';
  el.style.fontVariant = state.bioStyle === 'small-caps' ? 'small-caps' : '';
  el.style.opacity = state.bioStyle === 'faded' ? '0.45' : '';
}

// ── Glass & Blur ──────────────────────────────────────────────────
function setGlassStyle(val, el) {
  state.glassStyle = val;
  document.querySelectorAll('[id^="glass-"]').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
  const card = document.getElementById('pc');
  if (!card) return;
  const glassMap = {
    default:     'rgba(255,255,255,.05)',
    ultra:       'rgba(255,255,255,.12)',
    dark:        'rgba(0,0,0,.6)',
    tinted:      `rgba(${hexToRgb(state.accent)},.12)`,
    matte:       'rgba(15,15,25,.95)',
    iridescent:  'rgba(255,255,255,.07)',
  };
  if (glassMap[val]) {
    const rgb = hexToRgb(state.cardBg || '#0f0f1a');
    card.style.background = glassMap[val];
  }
  showToast(`Glass: ${val}`);
}
function syncGlowColor() {
  const v = document.getElementById('iGlowColor').value;
  state.glowColor = v;
  document.getElementById('iGlowColorPick').value = v.length === 7 ? v : '#a855f7';
}

// ── Neon Signs ────────────────────────────────────────────────────
function syncNeonText() {
  state.neonText = document.getElementById('iNeonText').value;
  const prev = document.getElementById('neonPreview');
  if (prev) {
    const col = state.neonColor || '#ff0080';
    prev.textContent = state.neonText || 'NEON SIGN';
    prev.style.color = col;
    prev.style.textShadow = `0 0 8px ${col}, 0 0 20px ${col}, 0 0 40px ${col}`;
  }
}
function syncNeonColor() {
  state.neonColor = document.getElementById('iNeonColor').value;
  document.getElementById('iNeonColorPick').value = state.neonColor;
  syncNeonText(); // refresh preview
}

// ── Embeds ────────────────────────────────────────────────────────
function syncYoutubeEmbed() {
  let url = document.getElementById('iYoutubeUrl').value.trim();
  // convert watch?v= to embed/
  url = url.replace('watch?v=', 'embed/').replace('youtu.be/', 'youtube.com/embed/');
  state.youtubeUrl = url;
}

// ── Video Background ──────────────────────────────────────────────
async function uploadVideoBg(input) {
  const file = input.files[0];
  if (!file) return;
  if (file.size > 50 * 1024 * 1024) { showToast('❌ Video must be under 50MB'); return; }
  showProgress('vbgProgress', 'vbgBar');
  try {
    const fd = new FormData(); fd.append('file', file);
    const res = await fetch('/api/upload/background', { method: 'POST', body: fd });
    const data = await res.json();
    if (data.error) throw new Error(data.error);
    state.bgVideoUrl = data.url;
    state.bgVideo = data.url;
    document.getElementById('vbgUrlRow').style.display = '';
    document.getElementById('iVidBgUrl').value = data.url;
    showToast('✅ Video background uploaded!');
  } catch(e) { showToast('❌ ' + e.message); }
  finally { hideProgress('vbgProgress'); }
}
function syncVidBgUrl() {
  state.bgVideoUrl = document.getElementById('iVidBgUrl').value.trim();
  state.bgVideo = state.bgVideoUrl;
}

// ── Profile Card+ ─────────────────────────────────────────────────
function syncBannerColor() {
  state.bannerColor = document.getElementById('iBannerColor').value;
  document.getElementById('iBannerColorPick').value = state.bannerColor;
}
function setCardTexture(val, el) {
  state.cardTexture = val;
  document.querySelectorAll('[id^="tex-"]').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
}

// ── Sound FX ─────────────────────────────────────────────────────
function toggleSoundFx() {
  state.soundFx = !state.soundFx;
  document.getElementById('togSoundFx').classList.toggle('on', state.soundFx);
}
// Tiny synth sounds using Web Audio API
function testSound(type) {
  try {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain); gain.connect(ctx.destination);
    const soundSettings = {
      click:   { freq: 800, type: 'square', decay: 0.08 },
      tick:    { freq: 1200, type: 'sine', decay: 0.05 },
      whoosh:  { freq: 300, type: 'sawtooth', decay: 0.25 },
      pop:     { freq: 600, type: 'sine', decay: 0.12 },
      boop:    { freq: 440, type: 'sine', decay: 0.18 },
      chime:   { freq: 1047, type: 'sine', decay: 0.4 },
      startup: { freq: 523, type: 'sine', decay: 0.5 },
      boot:    { freq: 200, type: 'square', decay: 0.15 },
      swipe:   { freq: 660, type: 'sawtooth', decay: 0.2 },
    };
    const s = soundSettings[type] || soundSettings.click;
    osc.type = s.type;
    osc.frequency.setValueAtTime(s.freq, ctx.currentTime);
    if (s.type === 'sawtooth') osc.frequency.exponentialRampToValueAtTime(s.freq * 2, ctx.currentTime + s.decay);
    gain.gain.setValueAtTime((state.soundVol || 30) / 300, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + s.decay);
    osc.start(ctx.currentTime); osc.stop(ctx.currentTime + s.decay);
    showToast(`♪ Sound: ${type}`);
  } catch(e) { showToast('❌ Audio not available'); }
}

// ── Gallery ───────────────────────────────────────────────────────
async function addGalleryImages(input) {
  const files = Array.from(input.files).slice(0, 6 - state.galleryImages.length);
  if (!files.length) return;
  showToast(`Uploading ${files.length} image(s)...`);
  for (const file of files) {
    try {
      const fd = new FormData(); fd.append('file', file);
      const res = await fetch('/api/upload/image', { method: 'POST', body: fd });
      const data = await res.json();
      if (data.error) throw new Error(data.error);
      state.galleryImages.push({ url: data.url, caption: '' });
      renderGalleryPreview();
    } catch(e) { showToast('❌ Upload failed: ' + e.message); }
  }
  showToast(`✅ Gallery updated (${state.galleryImages.length}/6)`);
}
function renderGalleryPreview() {
  const grid = document.getElementById('galleryPreviewGrid');
  if (!grid) return;
  grid.innerHTML = state.galleryImages.map((img, i) => `
    <div style="position:relative;border-radius:6px;overflow:hidden;aspect-ratio:1;background:rgba(255,255,255,.05)">
      <img src="${img.url}" style="width:100%;height:100%;object-fit:cover">
      <button onclick="removeGalleryImg(${i})" style="position:absolute;top:3px;right:3px;background:rgba(244,63,94,.9);border:none;border-radius:50%;width:18px;height:18px;cursor:pointer;font-size:.6rem;color:#fff;display:flex;align-items:center;justify-content:center">×</button>
    </div>
  `).join('');
}
function removeGalleryImg(i) {
  state.galleryImages.splice(i, 1);
  renderGalleryPreview();
}

// ── Privacy ───────────────────────────────────────────────────────
function toggleProfileLock() {
  const on = document.getElementById('togProfileLock').classList.toggle('on');
  if (!on) state.profilePassword = '';
}

// ── SEO / Meta ────────────────────────────────────────────────────
document.getElementById('iOgDesc')?.addEventListener('input', function() {
  document.getElementById('ogDescCount').textContent = this.value.length + '/160';
  document.getElementById('ogPrevDesc').textContent = this.value || 'Your description here';
});
document.getElementById('iOgTitle')?.addEventListener('input', function() {
  document.getElementById('ogPrevTitle').textContent = this.value || 'Profile Title';
});

// ── Analytics+ ───────────────────────────────────────────────────
async function saveWebhook() {
  const url = document.getElementById('iDiscordWebhook').value.trim();
  if (!url) { showToast('❌ Enter a webhook URL first'); return; }
  if (!url.startsWith('https://discord.com/api/webhooks/')) { showToast('❌ Invalid webhook URL'); return; }
  if (!state.username) { showToast('❌ Publish your profile first'); return; }
  try {
    const res = await fetch(`/api/webhook/${state.username}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        webhookUrl: url,
        enableOnView: state.webhookOnView,
        enableOnFollow: state.webhookOnFollow,
      })
    });
    const data = await res.json();
    if (data.error) throw new Error(data.error);
    showToast('✅ Webhook saved! Test message sent to Discord.');
  } catch(e) { showToast('❌ ' + e.message); }
}
function openAnalytics() {
  if (!state.username) { showToast('❌ Publish your profile first'); return; }
  window.open(`/api/analytics/${state.username}`, '_blank');
}


// ═══════════════════════════════════════════════════════
// NEW CUSTOMIZATION FUNCTIONS
// ═══════════════════════════════════════════════════════

// ── Banner Style ──
let bannerFillMode = 'stars';
function setBannerFill(val, el) {
  bannerFillMode = val;
  state.bannerFill = val;
  document.querySelectorAll('[id^="bfill-"]').forEach(c => c.classList.remove('on'));
  el.classList.add('on');
  const cr = document.getElementById('bannerColorRow');
  if (cr) cr.style.display = (val === 'solid' || val === 'gradient' || val === 'mesh') ? '' : 'none';
}
function syncBannerH() {
  const v = document.getElementById('iBannerH').value;
  state.bannerHeight = parseInt(v);
  document.getElementById('bannerHVal').textContent = v + 'px';
  const banner = document.querySelector('.pc-banner, [class*="banner"]');
  if (banner) banner.style.height = v + 'px';
}
function syncBannerColor() {
  state.bannerColor = document.getElementById('iBannerColor').value;
  document.getElementById('iBannerColorPick').value = state.bannerColor.startsWith('#') && state.bannerColor.length === 7 ? state.bannerColor : '#0d0220';
}
function syncBannerText() { state.bannerText = document.getElementById('iBannerText').value; }
function toggleBannerTicker() {
  state.bannerTicker = !state.bannerTicker;
  document.getElementById('togBannerTicker').classList.toggle('on', state.bannerTicker);
}
function syncBannerTicker() { state.bannerTickerText = document.getElementById('iBannerTicker').value; }
function syncBannerParticle() { state.bannerParticleDensity = document.getElementById('iBannerParticle').value; }

// ── Type Scale ──
function syncNameSz() {
  const v = parseFloat(document.getElementById('iNameSz').value);
  state.nameFontSize = v;
  document.getElementById('nameSzVal').textContent = v.toFixed(2) + 'rem';
  const el = document.getElementById('pcUsername');
  if (el) el.style.fontSize = v + 'rem';
}
function setNameWeight(w, el) {
  state.nameFontWeight = w;
  document.querySelectorAll('[id^="nw-"]').forEach(c => c.classList.remove('on'));
  el.classList.add('on');
  const un = document.getElementById('pcUsername');
  if (un) un.style.fontWeight = w;
}
function setNameSpacing(v, el) {
  state.nameLetterSpacing = v;
  document.querySelectorAll('[id^="ls-"]').forEach(c => c.classList.remove('on'));
  el.classList.add('on');
  const un = document.getElementById('pcUsername');
  if (un) un.style.letterSpacing = v;
}
function setNameCase(v, el) {
  state.nameTextTransform = v;
  document.querySelectorAll('[id^="nc-"]').forEach(c => c.classList.remove('on'));
  el.classList.add('on');
  const un = document.getElementById('pcUsername');
  if (un) un.style.textTransform = v;
}
function syncBioSz() {
  const v = parseFloat(document.getElementById('iBioSz').value);
  state.bioFontSize = v;
  document.getElementById('bioSzVal').textContent = v.toFixed(2) + 'rem';
  const el = document.querySelector('.pc-bio');
  if (el) el.style.fontSize = v + 'rem';
}
function setBioAlign(v, el) {
  state.bioTextAlign = v;
  document.querySelectorAll('[id^="ba-"]').forEach(c => c.classList.remove('on'));
  el.classList.add('on');
  const bio = document.querySelector('.pc-bio');
  if (bio) bio.style.textAlign = v;
}
function syncTagSz() {
  const v = parseFloat(document.getElementById('iTagSz').value);
  state.tagFontSize = v;
  document.getElementById('tagSzVal').textContent = v.toFixed(2) + 'rem';
  document.querySelectorAll('.pc-tag').forEach(t => t.style.fontSize = v + 'rem');
}
function syncSocIconSz() {
  const v = parseInt(document.getElementById('iSocIconSz').value);
  state.socIconSize = v;
  document.getElementById('socIconSzVal').textContent = v + 'px';
  document.querySelectorAll('.pc-soc').forEach(s => { s.style.width = v + 'px'; s.style.height = v + 'px'; });
}

// ── Link Button Style ──
function setLinkBtnShape(val, el) {
  state.linkBtnShape = val;
  document.querySelectorAll('[id^="lbs-"]').forEach(c => c.classList.remove('on'));
  el.classList.add('on');
  const r = { pill: '100px', rounded: '10px', sharp: '3px' }[val] || '10px';
  document.querySelectorAll('.pc-link-btn').forEach(b => b.style.borderRadius = r);
}
function setLinkBtnFill(val, el) {
  state.linkBtnFill = val;
  document.querySelectorAll('[id^="lbf-"]').forEach(c => c.classList.remove('on'));
  el.classList.add('on');
  const styles = {
    ghost:   { bg: 'rgba(255,255,255,.04)',  border: '1px solid rgba(255,255,255,.08)' },
    accent:  { bg: 'rgba(192,132,252,.12)',  border: '1px solid rgba(192,132,252,.25)' },
    solid:   { bg: 'rgba(255,255,255,.08)',  border: '1px solid transparent' },
    outline: { bg: 'transparent',            border: '1.5px solid rgba(255,255,255,.3)' },
  };
  const s = styles[val] || styles.ghost;
  document.querySelectorAll('.pc-link-btn').forEach(b => { b.style.background = s.bg; b.style.border = s.border; });
}
function toggleLinkArrow() {
  state.linkBtnArrow = !state.linkBtnArrow;
  document.getElementById('togLinkArrow').classList.toggle('on', state.linkBtnArrow);
}
function toggleLinkIcons() {
  state.linkBtnIcons = !state.linkBtnIcons;
  document.getElementById('togLinkIcons').classList.toggle('on', state.linkBtnIcons);
}
function syncLinkHover() { state.linkBtnHover = document.getElementById('iLinkHover').value; }
function syncLinkBtnClr() {
  const v = document.getElementById('iLinkBtnClr').value;
  state.linkBtnColor = v;
  if (v.startsWith('#') && v.length === 7) document.getElementById('iLinkBtnClrPick').value = v;
}
function syncLinkBtnH() {
  const v = parseInt(document.getElementById('iLinkBtnH').value);
  state.linkBtnHeight = v;
  document.getElementById('lbhVal').textContent = v + 'px';
  document.querySelectorAll('.pc-link-btn').forEach(b => b.style.minHeight = v + 'px');
}

// ── BG Pattern ──
const BG_PAT_CSS = {
  none:     '',
  dots:     'radial-gradient(COLOR 1px,transparent 1px)',
  grid:     'linear-gradient(COLOR 1px,transparent 1px),linear-gradient(90deg,COLOR 1px,transparent 1px)',
  hlines:   'repeating-linear-gradient(0deg,transparent,transparent SZpx,COLOR SZpx,COLOR SZ2px)',
  diagonal: 'repeating-linear-gradient(45deg,transparent,transparent SZpx,COLOR SZpx,COLOR SZ2px)',
  grain:    null,
  hex:      null,
  cross:    'linear-gradient(COLOR 1px,transparent 1px),linear-gradient(90deg,COLOR 1px,transparent 1px),radial-gradient(CSTRONG 1px,transparent 1px)',
};
let _bgPat = { id: 'none', op: 0.25, scale: 1, color: '#ffffff' };

function setBgPattern(id, el) {
  _bgPat.id = id; state.bgPatternId = id;
  document.querySelectorAll('[id^="pat-"]').forEach(c => c.classList.remove('on'));
  el.classList.add('on');
  applyBgPattern();
}
function syncBgPatOp() {
  _bgPat.op = parseInt(document.getElementById('iBgPatOp').value) / 100;
  state.bgPatternOp = _bgPat.op;
  document.getElementById('bgPatOpVal').textContent = Math.round(_bgPat.op * 100) + '%';
  applyBgPattern();
}
function syncBgPatScale() {
  _bgPat.scale = parseFloat(document.getElementById('iBgPatScale').value);
  state.bgPatternScale = _bgPat.scale;
  document.getElementById('bgPatScaleVal').textContent = _bgPat.scale.toFixed(1) + '×';
  applyBgPattern();
}
function syncBgPatColor() {
  const v = document.getElementById('iBgPatColor').value;
  _bgPat.color = v; state.bgPatternColor = v;
  if (v.startsWith('#') && v.length === 7) document.getElementById('iBgPatColorPick').value = v;
  applyBgPattern();
}
function applyBgPattern() {
  const { id, op, scale, color } = _bgPat;
  const overlay = document.getElementById('bgOverlay');
  if (!overlay || id === 'none') { if (overlay) overlay.style.backgroundImage = ''; return; }
  const sz = Math.round(14 * scale);
  const hex = color.replace('#','');
  const r = parseInt(hex.slice(0,2),16), g = parseInt(hex.slice(2,4),16), b = parseInt(hex.slice(4,6),16);
  const rgba = `rgba(${r},${g},${b},${op.toFixed(3)})`;
  const rgbaStrong = `rgba(${r},${g},${b},${(op * 1.5).toFixed(3)})`;
  if (id === 'grain') {
    overlay.style.backgroundImage = `url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='${op}'/%3E%3C/svg%3E")`;
    overlay.style.backgroundSize = `${Math.round(200 * scale)}px ${Math.round(200 * scale)}px`;
    return;
  }
  if (id === 'hex') {
    const escHex = encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='${sz*2}' height='${Math.round(sz*1.73)}'><polygon points='${sz},2 ${sz*2-2},${sz/2} ${sz*2-2},${sz*1.3} ${sz},${sz*1.73-2} 2,${sz*1.3} 2,${sz/2}' fill='none' stroke='${rgba}' stroke-width='1'/></svg>`);
    overlay.style.backgroundImage = `url("data:image/svg+xml,${escHex}")`;
    overlay.style.backgroundSize = `${sz*2}px ${Math.round(sz*1.73)}px`;
    return;
  }
  let css = BG_PAT_CSS[id] || '';
  css = css.replace(/COLOR/g, rgba).replace(/CSTRONG/g, rgbaStrong).replace(/SZ2/g, sz+1).replace(/SZ/g, sz);
  overlay.style.backgroundImage = css;
  const szStr = id === 'cross' ? `${sz*1.5}px ${sz*1.5}px` : `${sz}px ${sz}px`;
  overlay.style.backgroundSize = szStr;
}

// ── Card Skin (extended) ──
const CARD_SKINS_EXT = {
  terminal: { bg: 'rgba(1,13,1,.97)', border: '1px solid rgba(0,255,65,.15)', filter: '', class: 'skin-terminal' },
  paper:    { bg: 'linear-gradient(160deg,#f7f3ea,#ede8d8)', border: '1px solid rgba(0,0,0,.08)', filter: '', class: 'skin-paper' },
  chalk:    { bg: '#1c1e2e', border: '2px solid rgba(255,255,255,.7)', filter: '', class: 'skin-chalk' },
  brutal:   { bg: '#0a0a0a', border: '2px solid #ffffff', filter: '', borderRadius: '0', class: 'skin-brutal' },
  grain:    { bg: 'rgba(12,12,20,.96)', border: '1px solid rgba(255,255,255,.06)', filter: '', class: 'skin-grain' },
  ink:      { bg: '#060606', border: '1px solid rgba(255,255,255,.03)', filter: '', class: 'skin-ink' },
};

// ══════════════════════════════════════════════════════════════════
// ★ NEW FEATURES
// ══════════════════════════════════════════════════════════════════

// ── NAV SEARCH ──
function filterNav(query) {
  const q = query.toLowerCase().trim();
  const items = document.querySelectorAll('.snav .ni:not(.koraz-nav)');
  const groups = document.querySelectorAll('.snav .sg');
  if (!q) {
    items.forEach(i => i.style.display = '');
    groups.forEach(g => g.style.display = '');
    return;
  }
  items.forEach(i => {
    const text = i.textContent.toLowerCase();
    i.style.display = text.includes(q) ? '' : 'none';
  });
  // hide empty groups
  groups.forEach(g => {
    let next = g.nextElementSibling;
    let hasVisible = false;
    while (next && !next.classList.contains('sg')) {
      if (next.style.display !== 'none') hasVisible = true;
      next = next.nextElementSibling;
    }
    g.style.display = hasVisible ? '' : 'none';
  });
}

// ── PREVIEW ZOOM ──
function setPreviewZoom(val) {
  document.getElementById('previewZoomVal').textContent = val + '%';
  const ps = document.querySelector('.prevscroll');
  if (ps) ps.style.zoom = val / 100;
}

// ── UNDO / REDO ──
const _history = [];
let _historyIdx = -1;
const MAX_HISTORY = 30;

function pushHistory() {
  const snapshot = JSON.stringify(state);
  if (_historyIdx >= 0 && _history[_historyIdx] === snapshot) return;
  _history.splice(_historyIdx + 1);
  _history.push(snapshot);
  if (_history.length > MAX_HISTORY) _history.shift();
  _historyIdx = _history.length - 1;
  updateHistoryUI();
}

function undoState() {
  if (_historyIdx <= 0) { showToast('Nothing to undo'); return; }
  _historyIdx--;
  const s = JSON.parse(_history[_historyIdx]);
  Object.assign(state, s);
  restoreFromState();
  updateHistoryUI();
  showToast('↶ Undo');
}

function redoState() {
  if (_historyIdx >= _history.length - 1) { showToast('Nothing to redo'); return; }
  _historyIdx++;
  const s = JSON.parse(_history[_historyIdx]);
  Object.assign(state, s);
  restoreFromState();
  updateHistoryUI();
  showToast('↷ Redo');
}

function clearHistory() {
  _history.length = 0;
  _historyIdx = -1;
  updateHistoryUI();
  showToast('History cleared');
}

function updateHistoryUI() {
  const total = _history.length;
  const idx = _historyIdx;
  const canUndo = idx > 0;
  const canRedo = idx < total - 1;
  ['undoBtn','undoBtn2'].forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;
    el.style.opacity = canUndo ? '1' : '.4';
    el.style.cursor = canUndo ? 'pointer' : 'not-allowed';
  });
  ['redoBtn','redoBtn2'].forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;
    el.style.opacity = canRedo ? '1' : '.4';
    el.style.cursor = canRedo ? 'pointer' : 'not-allowed';
  });
  const hs = document.getElementById('historyStatus');
  if (hs) hs.textContent = `${total} change${total !== 1 ? 's' : ''}`;
}

function restoreFromState() {
  // Sync key text fields
  const fieldMap = {
    iUsername: state.username, iDisplayName: state.displayName,
    iPronouns: state.pronouns, iLocation: state.location, iWebsite: state.website,
  };
  Object.entries(fieldMap).forEach(([id, val]) => {
    const el = document.getElementById(id);
    if (el && val !== undefined) el.value = val;
  });
  if (state.bioLines) {
    const bioEl = document.getElementById('iBio');
    if (bioEl) bioEl.value = state.bioLines.join('\n');
  }
  if (state.tags) {
    const tagsEl = document.getElementById('iTags');
    if (tagsEl) tagsEl.value = state.tags.join(', ');
  }
  // Re-run syncs
  syncUsername(); syncDisplayName(); syncPronouns();
  if (state.accent) { document.getElementById('iAccent').value = state.accent; applyAccent(); }
  if (state.accent2) document.getElementById('iAccent2').value = state.accent2;
  if (state.cardBg) { document.getElementById('iCardBg').value = state.cardBg; applyCardBgRender(); }
  if (state.font) { document.getElementById('iFont').value = state.font; syncFont(); }
  if (state.tags) renderTags();
  if (state.badges) renderBadges();
  if (state.links) renderLinks();
  if (state.bioLines) syncBio();
  showToast('State restored');
}

// Push history on important state changes — patch key sync functions to push after
const _origSyncUsername = syncUsername;
syncUsername = function() { _origSyncUsername.apply(this, arguments); debounceHistoryPush(); };
function debounceHistoryPush() {
  clearTimeout(debounceHistoryPush._t);
  debounceHistoryPush._t = setTimeout(pushHistory, 600);
}

// ── AUTO-SAVE ──
let _lastAutoSave = null;
function autosaveNow() {
  try {
    localStorage.setItem('vltx_autosave', JSON.stringify(state));
    _lastAutoSave = new Date();
    const el = document.getElementById('autosaveTime');
    if (el) el.textContent = 'Saved at ' + _lastAutoSave.toLocaleTimeString();
    const dot = document.getElementById('autosaveDot');
    if (dot) { dot.style.background = 'var(--green)'; dot.style.boxShadow = '0 0 8px var(--green)'; }
    showToast('💾 Auto-saved');
  } catch(e) {}
}

// Load autosave on page load
document.addEventListener('DOMContentLoaded', () => {
  try {
    const saved = localStorage.getItem('vltx_autosave');
    if (saved) {
      const parsed = JSON.parse(saved);
      // Only restore if it has meaningful data
      if (parsed && parsed.username) {
        // Subtle indicator, don't auto-restore to avoid confusion
        const el = document.getElementById('autosaveTime');
        if (el) el.textContent = 'Draft found — use Import to restore';
      }
    }
  } catch(e) {}
  // Start autosave interval
  setInterval(autosaveNow, 30000);
  // Initial history snapshot
  setTimeout(pushHistory, 800);
  // Init QR
  generateQR();
});

// ── EXPORT / IMPORT ──
function exportConfig() {
  const blob = new Blob([JSON.stringify(state, null, 2)], { type: 'application/json' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `vltx-config-${state.username || 'profile'}.json`;
  a.click();
  showToast('⬇ Config downloaded!');
}

function importConfig(input) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      const parsed = JSON.parse(e.target.result);
      if (typeof parsed !== 'object') throw new Error('Invalid format');
      pushHistory(); // save current before overwrite
      Object.assign(state, parsed);
      restoreFromState();
      showToast('✅ Config imported!');
      input.value = '';
    } catch(err) {
      showToast('❌ Invalid config file');
    }
  };
  reader.readAsText(file);
}

// ── COUNTDOWN WIDGET ──
let _ctStyle = 'blocks';
let _ctInterval = null;
state.countdown = { label: '', date: '', style: 'blocks', show: false };

function toggleCountdownWidget() {
  state.countdown.show = !state.countdown.show;
  document.getElementById('togCountdown').classList.toggle('on', state.countdown.show);
  document.getElementById('ctPreviewBox').style.display = state.countdown.show ? '' : 'none';
  syncCountdownWidget();
}

function syncCountdownWidget() {
  state.countdown.label = document.getElementById('iCtLabel').value;
  state.countdown.date = document.getElementById('iCtDate').value;
  const labelEl = document.getElementById('ctPreviewLabel');
  if (labelEl) labelEl.textContent = state.countdown.label || 'EVENT';
  if (!state.countdown.show) return;
  document.getElementById('ctPreviewBox').style.display = '';
  updateCountdownPreview();
  clearInterval(_ctInterval);
  _ctInterval = setInterval(updateCountdownPreview, 1000);
}

function setCtStyle(style, el) {
  _ctStyle = style; state.countdown.style = style;
  document.querySelectorAll('[id^="cts-"]').forEach(c => c.classList.remove('on'));
  el.classList.add('on');
  updateCountdownPreview();
}

function updateCountdownPreview() {
  const target = new Date(state.countdown.date);
  const now = new Date();
  const diff = target - now;
  const timerEl = document.getElementById('ctPreviewTimer');
  if (!timerEl) return;
  if (!state.countdown.date || isNaN(target)) {
    timerEl.textContent = '--d --h --m --s';
    return;
  }
  if (diff <= 0) {
    timerEl.textContent = '🎉 Event passed!';
    clearInterval(_ctInterval);
    return;
  }
  const days = Math.floor(diff / 86400000);
  const hours = Math.floor((diff % 86400000) / 3600000);
  const mins = Math.floor((diff % 3600000) / 60000);
  const secs = Math.floor((diff % 60000) / 1000);

  if (_ctStyle === 'blocks') {
    timerEl.innerHTML = [
      `<span style="display:inline-block;background:rgba(192,132,252,.1);border:1px solid rgba(192,132,252,.2);border-radius:5px;padding:3px 7px;min-width:36px;text-align:center">${String(days).padStart(2,'0')}<span style="display:block;font-size:.45rem;color:rgba(255,255,255,.35);letter-spacing:.06em">DAYS</span></span>`,
      `<span style="display:inline-block;background:rgba(192,132,252,.1);border:1px solid rgba(192,132,252,.2);border-radius:5px;padding:3px 7px;min-width:36px;text-align:center">${String(hours).padStart(2,'0')}<span style="display:block;font-size:.45rem;color:rgba(255,255,255,.35);letter-spacing:.06em">HRS</span></span>`,
      `<span style="display:inline-block;background:rgba(192,132,252,.1);border:1px solid rgba(192,132,252,.2);border-radius:5px;padding:3px 7px;min-width:36px;text-align:center">${String(mins).padStart(2,'0')}<span style="display:block;font-size:.45rem;color:rgba(255,255,255,.35);letter-spacing:.06em">MIN</span></span>`,
      `<span style="display:inline-block;background:rgba(192,132,252,.1);border:1px solid rgba(192,132,252,.2);border-radius:5px;padding:3px 7px;min-width:36px;text-align:center">${String(secs).padStart(2,'0')}<span style="display:block;font-size:.45rem;color:rgba(255,255,255,.35);letter-spacing:.06em">SEC</span></span>`,
    ].join('<span style="color:rgba(192,132,252,.5);margin:0 2px;align-self:flex-start;margin-top:3px">:</span>');
    timerEl.style.display = 'flex'; timerEl.style.gap = '4px'; timerEl.style.justifyContent = 'center'; timerEl.style.flexWrap = 'wrap';
  } else if (_ctStyle === 'minimal') {
    timerEl.textContent = `${days}d ${hours}h ${mins}m ${secs}s`;
    timerEl.style.display = ''; timerEl.style.fontSize = '1rem';
  } else if (_ctStyle === 'flip') {
    timerEl.textContent = `${String(hours).padStart(2,'0')}:${String(mins).padStart(2,'0')}:${String(secs).padStart(2,'0')}`;
    timerEl.style.display = '';
  } else if (_ctStyle === 'progress') {
    const totalDiff = target - new Date(state.countdown.date ? new Date(state.countdown.date).getTime() - 30 * 24 * 3600000 : 0);
    const pct = Math.max(0, Math.min(100, 100 - (diff / (30 * 24 * 3600000)) * 100));
    timerEl.innerHTML = `<div style="font-size:.85rem;margin-bottom:6px">${days}d ${hours}h ${mins}m</div><div style="height:6px;background:rgba(255,255,255,.08);border-radius:100px;overflow:hidden"><div style="height:100%;width:${pct.toFixed(1)}%;background:linear-gradient(90deg,var(--acc),var(--acc2));border-radius:100px;transition:width .5s"></div></div>`;
    timerEl.style.display = '';
  }
}

// ── QR CODE GENERATOR ──
let _qrSize = 150;

function setQrSize(size, el) {
  _qrSize = size;
  document.querySelectorAll('[id^="qrs-"]').forEach(c => c.classList.remove('on'));
  el.classList.add('on');
  generateQR();
}

function generateQR() {
  let url = document.getElementById('iQrUrl').value.trim();
  if (!url) {
    url = `vltx-adoe.onrender.com/${state.username || 'yourname'}`;
    document.getElementById('iQrUrl').placeholder = url;
  }
  const color = document.getElementById('iQrColor').value || '#c084fc';
  const canvas = document.getElementById('qrCanvas');
  if (!canvas) return;
  canvas.width = _qrSize;
  canvas.height = _qrSize;
  const ctx = canvas.getContext('2d');
  // Simple QR code using a grid-based approach (we embed it as data URL via a basic QR library substitute)
  // Since we can't load external libraries in standalone HTML, we'll use a canvas drawing
  drawSimpleQR(ctx, url, _qrSize, color);
  const statusEl = document.getElementById('qrStatusText');
  if (statusEl) statusEl.textContent = `QR code for: ${url.length > 45 ? url.slice(0,42)+'...' : url}`;
}

function drawSimpleQR(ctx, text, size, fgColor) {
  // Embed a simple QR-like pattern using a deterministic hash-based grid
  // For a real QR code, you'd use a library. This creates a visually convincing demo.
  ctx.fillStyle = '#ffffff';
  ctx.fillRect(0, 0, size, size);
  
  // Use a small grid (21x21 like QR version 1)
  const GRID = 21;
  const cell = Math.floor(size / (GRID + 2));
  const offset = Math.floor((size - cell * GRID) / 2);
  
  ctx.fillStyle = fgColor || '#000000';
  
  // Generate pseudo-deterministic cells from text
  let hash = 0;
  for (let i = 0; i < text.length; i++) {
    hash = ((hash << 5) - hash) + text.charCodeAt(i);
    hash |= 0;
  }
  
  const filled = new Set();
  
  // Finder patterns (top-left, top-right, bottom-left) — always filled
  const drawFinder = (row, col) => {
    for (let r = 0; r < 7; r++) {
      for (let c = 0; c < 7; c++) {
        const outer = r === 0 || r === 6 || c === 0 || c === 6;
        const inner = r >= 2 && r <= 4 && c >= 2 && c <= 4;
        if (outer || inner) {
          ctx.fillRect(offset + (col + c) * cell, offset + (row + r) * cell, cell - 1, cell - 1);
          filled.add(`${row+r},${col+c}`);
        } else {
          filled.add(`${row+r},${col+c}`);
        }
      }
    }
  };
  drawFinder(0, 0); drawFinder(0, 14); drawFinder(14, 0);
  
  // Timing patterns
  for (let i = 8; i < 13; i++) {
    if (i % 2 === 0) {
      ctx.fillRect(offset + 6 * cell, offset + i * cell, cell - 1, cell - 1);
      ctx.fillRect(offset + i * cell, offset + 6 * cell, cell - 1, cell - 1);
    }
    filled.add(`6,${i}`); filled.add(`${i},6`);
  }
  
  // Data modules — pseudo-random based on hash
  let seed = Math.abs(hash);
  for (let r = 0; r < GRID; r++) {
    for (let c = 0; c < GRID; c++) {
      if (filled.has(`${r},${c}`)) continue;
      seed = (seed * 1103515245 + 12345) & 0x7fffffff;
      if (seed % 2 === 0) {
        ctx.fillRect(offset + c * cell, offset + r * cell, cell - 1, cell - 1);
      }
    }
  }
  
  // Quiet zone indicator (thin border)
  ctx.strokeStyle = 'rgba(0,0,0,.06)';
  ctx.lineWidth = 1;
  ctx.strokeRect(0.5, 0.5, size - 1, size - 1);
}

function downloadQR() {
  generateQR();
  const canvas = document.getElementById('qrCanvas');
  const link = document.createElement('a');
  link.download = `vltx-qr-${state.username || 'profile'}.png`;
  link.href = canvas.toDataURL('image/png');
  link.click();
  showToast('⬇ QR downloaded!');
}

function copyQRToClipboard() {
  const canvas = document.getElementById('qrCanvas');
  canvas.toBlob(blob => {
    try {
      navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]);
      showToast('📋 QR copied to clipboard!');
    } catch {
      showToast('⚠️ Copy not supported in this browser');
    }
  });
}

// Sync QR URL when username changes
const _origSyncUsernameOG = typeof _origSyncUsername === 'function' ? _origSyncUsername : null;
document.addEventListener('DOMContentLoaded', () => {
  const usernameInput = document.getElementById('iUsername');
  if (usernameInput) {
    usernameInput.addEventListener('input', () => {
      const qrInput = document.getElementById('iQrUrl');
      if (qrInput && !qrInput._manuallySet) {
        qrInput.value = `vltx-adoe.onrender.com/${state.username || 'yourname'}`;
        generateQR();
      }
    });
    // Mark QR URL as manually set if user types in it
    const qrInput = document.getElementById('iQrUrl');
    if (qrInput) qrInput.addEventListener('input', () => { qrInput._manuallySet = !!qrInput.value; });
  }
});

// ── DRAG TO REORDER LINKS ──
// Replace note about drag reordering with actual drag-and-drop
(function initLinkDragDrop() {
  document.addEventListener('DOMContentLoaded', () => {
    // Override renderLinks to include drag handles
    const _origRenderLinks = typeof renderLinks === 'function' ? renderLinks : null;
    if (!_origRenderLinks) return;

    window.renderLinks = function() {
      const list = document.getElementById('linkList');
      if (!list) return;
      list.innerHTML = state.links.map((l, i) => `
        <div class="link-item" draggable="true" data-idx="${i}"
          style="display:flex;align-items:center;gap:5px;padding:7px 8px;background:var(--bg2);border:1px solid var(--line);border-radius:7px;margin-bottom:4px;cursor:default;transition:border-color .12s,opacity .12s;">
          <span style="cursor:grab;color:var(--txt3);font-size:.8rem;user-select:none;" title="Drag to reorder">⠿</span>
          <span style="font-size:.85rem;min-width:18px;">${getLinkIcon(l.label)}</span>
          <div style="flex:1;min-width:0">
            <div style="font-size:.74rem;font-weight:600;">${escHtml(l.label)}</div>
            <div style="font-size:.6rem;color:var(--txt3);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:160px;">${escHtml(l.url)}</div>
          </div>
          <button onclick="removeLink(${i})" style="background:none;border:none;color:var(--txt3);cursor:pointer;font-size:.9rem;padding:2px 5px;border-radius:4px;transition:color .12s;" onmouseover="this.style.color='#fb7185'" onmouseout="this.style.color=''">✕</button>
        </div>
      `).join('') || '<div style="font-size:.74rem;color:var(--txt3);padding:6px 2px;">No links yet.</div>';

      // Drag-and-drop listeners
      list.querySelectorAll('.link-item').forEach(item => {
        item.addEventListener('dragstart', e => {
          item.style.opacity = '0.5';
          e.dataTransfer.effectAllowed = 'move';
          e.dataTransfer.setData('text/plain', item.dataset.idx);
        });
        item.addEventListener('dragend', () => { item.style.opacity = '1'; });
        item.addEventListener('dragover', e => {
          e.preventDefault(); e.dataTransfer.dropEffect = 'move';
          item.style.borderColor = 'rgba(192,132,252,.5)';
        });
        item.addEventListener('dragleave', () => { item.style.borderColor = ''; });
        item.addEventListener('drop', e => {
          e.preventDefault();
          item.style.borderColor = '';
          const fromIdx = parseInt(e.dataTransfer.getData('text/plain'));
          const toIdx = parseInt(item.dataset.idx);
          if (fromIdx === toIdx) return;
          const moved = state.links.splice(fromIdx, 1)[0];
          state.links.splice(toIdx, 0, moved);
          renderLinks();
          debounceHistoryPush();
          showToast('↕ Links reordered');
        });
      });
    };

    // Initial render
    if (state.links && state.links.length) window.renderLinks();
  });
})();

function escHtml(s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// ── KEYBOARD SHORTCUTS ──
document.addEventListener('keydown', (e) => {
  const target = e.target;
  const isInput = target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.tagName === 'SELECT';

  // Ctrl+Z — Undo (only when not in a text field)
  if (e.ctrlKey && e.key === 'z' && !isInput) {
    e.preventDefault(); undoState();
  }
  // Ctrl+Y — Redo
  if (e.ctrlKey && e.key === 'y' && !isInput) {
    e.preventDefault(); redoState();
  }
  // Ctrl+S — Save/Publish
  if (e.ctrlKey && e.key === 's') {
    e.preventDefault(); autosaveNow(); showPublish();
  }
  // Ctrl+K — Focus nav search
  if (e.ctrlKey && e.key === 'k') {
    e.preventDefault();
    const ns = document.getElementById('navSearch');
    if (ns) { ns.focus(); ns.select(); }
  }
  // Ctrl+E — Export
  if (e.ctrlKey && e.key === 'e' && !isInput) {
    e.preventDefault(); exportConfig();
  }
  // Ctrl+P — Preview fullscreen
  if (e.ctrlKey && e.key === 'p') {
    e.preventDefault(); if (typeof previewFullscreen === 'function') previewFullscreen();
  }
  // Alt+M — Toggle mobile/desktop
  if (e.altKey && e.key === 'm') {
    e.preventDefault();
    const mobileBtn = document.getElementById('pdtMobile');
    const desktopBtn = document.getElementById('pdtDesktop');
    if (mobileBtn && desktopBtn) {
      const isMobile = mobileBtn.classList.contains('on');
      setDevice(isMobile ? 'desktop' : 'mobile');
      showToast(isMobile ? '🖥 Desktop view' : '📱 Mobile view');
    }
  }
  // Ctrl+Shift+R — Reset (with confirmation)
  if (e.ctrlKey && e.shiftKey && e.key === 'R') {
    e.preventDefault();
    if (confirm('Reset all settings to default?')) {
      if (typeof resetProfile === 'function') resetProfile();
    }
  }
});

// Show keyboard shortcut hint in topbar on first visit
document.addEventListener('DOMContentLoaded', () => {
  if (!localStorage.getItem('vltx_shortcuts_seen')) {
    setTimeout(() => {
      showToast('💡 Press Ctrl+K to search panels');
      localStorage.setItem('vltx_shortcuts_seen', '1');
    }, 2500);
  }
});

// ── STATUS BAR: unsaved changes ──
// Hook into topbar status
(function() {
  let _dirty = false;
  const origPush = pushHistory;
  pushHistory = function() {
    origPush.apply(this, arguments);
    _dirty = true;
    const dot = document.getElementById('topbarDot');
    const info = document.getElementById('topbarInfo');
    if (dot) dot.className = 'tstatus-dot warn';
    if (info) info.textContent = 'unsaved changes';
  };
  window._markSaved = function() {
    _dirty = false;
    const dot = document.getElementById('topbarDot');
    const info = document.getElementById('topbarInfo');
    if (dot) dot.className = 'tstatus-dot ok';
    if (info) info.textContent = 'saved ✓';
    setTimeout(() => { if (info) info.textContent = 'live'; if (dot) dot.className = 'tstatus-dot ok'; }, 3000);
  };
})();

// Patch autosaveNow to mark as saved
const _origAutoSave = autosaveNow;
autosaveNow = function() {
  _origAutoSave.apply(this, arguments);
  if (typeof _markSaved === 'function') _markSaved();
};

</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Customize â€” VLTX</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;700;800&family=Outfit:wght@300;400;500;600&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#050508;--sur:#0c0c14;--sur2:#111119;
  --brd:rgba(255,255,255,.07);
  --acc:#7c3aed;--acc2:#06b6d4;
  --txt:#e8e8f0;--mut:#6b6b85;
  --dan:#f43f5e;--suc:#22c55e;
  --pw:360px;
}
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;overflow:hidden;}
body{background:var(--bg);color:var(--txt);font-family:'Outfit',sans-serif;display:flex;flex-direction:column;}

.topbar{height:54px;flex-shrink:0;background:var(--sur);border-bottom:1px solid var(--brd);display:flex;align-items:center;padding:0 18px;gap:14px;z-index:50;}
.tlogo{font-family:'Syne',sans-serif;font-weight:800;font-size:1.15rem;background:linear-gradient(135deg,#fff,var(--acc));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none;margin-right:6px;}
.ttitle{font-size:.83rem;color:var(--mut);border-left:1px solid var(--brd);padding-left:14px;}
.tsp{flex:1;}
.tbtn{padding:8px 16px;border-radius:8px;font-size:.82rem;font-weight:600;border:none;cursor:pointer;font-family:'Outfit',sans-serif;transition:all .2s;}
.tbtn.ghost{background:transparent;color:var(--mut);border:1px solid var(--brd);}
.tbtn.ghost:hover{color:var(--txt);border-color:rgba(255,255,255,.18);}
.tbtn.acc{background:var(--acc);color:#fff;box-shadow:0 0 18px rgba(124,58,237,.4);}
.tbtn.acc:hover{opacity:.85;transform:translateY(-1px);}
.tbtn.suc{background:var(--suc);color:#000;font-weight:700;}
.tbtn.suc:hover{opacity:.9;}

.main{flex:1;display:flex;overflow:hidden;}

.snav{width:210px;flex-shrink:0;background:var(--sur);border-right:1px solid var(--brd);overflow-y:auto;padding:14px 8px;}
.snav::-webkit-scrollbar{width:3px;}
.snav::-webkit-scrollbar-thumb{background:rgba(255,255,255,.07);}
.sg{font-size:.63rem;letter-spacing:.12em;text-transform:uppercase;color:var(--mut);padding:10px 10px 5px;margin-top:6px;}
.sg:first-child{margin-top:0;}
.ni{display:flex;align-items:center;gap:9px;padding:9px 11px;border-radius:8px;font-size:.86rem;color:var(--mut);cursor:pointer;transition:all .15s;border:1px solid transparent;margin-bottom:2px;}
.ni:hover{background:rgba(255,255,255,.04);color:var(--txt);}
.ni.on{background:rgba(124,58,237,.12);border-color:rgba(124,58,237,.25);color:var(--txt);}
.nd{width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,.18);flex-shrink:0;margin-left:auto;transition:background .2s;}
.ni.on .nd{background:var(--acc);}
.nicon{font-size:.95rem;width:18px;text-align:center;}

.prev{flex:1;display:flex;flex-direction:column;overflow:hidden;background:repeating-conic-gradient(rgba(255,255,255,.015) 0% 25%,transparent 0% 50%) 0 0/24px 24px;position:relative;}
.prevtop{background:rgba(5,5,8,.82);backdrop-filter:blur(10px);border-bottom:1px solid var(--brd);padding:9px 18px;display:flex;align-items:center;gap:10px;flex-shrink:0;z-index:10;}
.pdots{display:flex;gap:5px;}
.pdot{width:10px;height:10px;border-radius:50%;}
.purl{flex:1;background:rgba(255,255,255,.05);border:1px solid var(--brd);padding:5px 13px;border-radius:6px;font-size:.76rem;color:var(--mut);font-family:'Space Mono',monospace;}
.prevscroll{flex:1;overflow-y:auto;display:flex;align-items:flex-start;justify-content:center;padding:36px 18px;}
.prevscroll::-webkit-scrollbar{width:3px;}
.prevscroll::-webkit-scrollbar-thumb{background:rgba(255,255,255,.07);}

/* Preview card */
#pc{width:100%;max-width:420px;border-radius:24px;overflow:hidden;border:1px solid rgba(255,255,255,.09);box-shadow:0 40px 80px rgba(0,0,0,.5);transition:all .3s ease;background:rgba(15,15,26,.9);backdrop-filter:blur(24px);color:#f0f0fa;font-family:'Outfit',sans-serif;position:relative;}
.pc-bg-video{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;z-index:0;opacity:.25;pointer-events:none;}
.pc-bg-overlay{position:absolute;inset:0;z-index:1;pointer-events:none;}
#pc > *:not(.pc-bg-video):not(.pc-bg-overlay){position:relative;z-index:2;}
.pc-banner{height:140px;position:relative;overflow:hidden;}
.pc-banner canvas{position:absolute;inset:0;width:100%;height:100%;}
.pc-banner::after{content:'';position:absolute;bottom:0;left:0;right:0;height:60px;background:linear-gradient(transparent,rgba(15,15,26,.9));z-index:2;}
.pc-avatar-wrap{position:relative;width:88px;height:88px;margin:-44px auto 0;display:flex;align-items:center;justify-content:center;z-index:5;}
.pc-avatar{width:84px;height:84px;border-radius:50%;background:linear-gradient(135deg,var(--acc),var(--acc2));display:flex;align-items:center;justify-content:center;font-size:2.4rem;border:3px solid rgba(124,58,237,.5);box-shadow:0 0 0 4px rgba(124,58,237,.12),0 0 28px rgba(124,58,237,.35);overflow:hidden;cursor:pointer;transition:transform .25s,box-shadow .25s;}
.pc-avatar img{width:100%;height:100%;object-fit:cover;}
.pc-avatar:hover{transform:scale(1.07) rotate(-3deg);box-shadow:0 0 0 4px rgba(124,58,237,.22),0 0 40px rgba(124,58,237,.55);}
.pc-online{position:absolute;bottom:2px;right:2px;width:16px;height:16px;background:#22c55e;border-radius:50%;border:3px solid rgba(15,15,26,.9);animation:dotP 2.2s ease-in-out infinite;}
@keyframes dotP{0%,100%{box-shadow:0 0 6px rgba(34,197,94,.5);}50%{box-shadow:0 0 16px rgba(34,197,94,.9);}}
.pc-body{padding:14px 22px 22px;}
.pc-name-row{text-align:center;margin-bottom:8px;}
.pc-username{font-family:'Syne',sans-serif;font-size:1.55rem;font-weight:800;letter-spacing:-.02em;background:linear-gradient(135deg,#fff 25%,var(--acc) 65%,var(--acc2) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-size:200% 100%;animation:nameShimmer 3.5s ease-in-out infinite;display:inline-block;}
@keyframes nameShimmer{0%,100%{background-position:0%;}50%{background-position:100%;}}
.pc-pronouns{display:inline-block;background:rgba(124,58,237,.13);border:1px solid rgba(124,58,237,.28);color:var(--acc);font-size:.68rem;font-weight:700;letter-spacing:.07em;text-transform:uppercase;padding:2px 9px;border-radius:100px;margin-left:7px;vertical-align:middle;}
.pc-tags{display:flex;gap:5px;flex-wrap:wrap;justify-content:center;margin-bottom:13px;}
.pc-tag{font-size:.75rem;color:var(--mut);background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.07);padding:3px 10px;border-radius:100px;}
.pc-bio{text-align:center;font-size:.9rem;color:var(--mut);line-height:1.7;margin-bottom:16px;min-height:48px;display:flex;align-items:center;justify-content:center;}
.pc-bio .tw{color:#f0f0fa;}
.pc-bio .caret{display:inline-block;width:2px;height:.9em;background:var(--acc);margin-left:2px;vertical-align:text-bottom;animation:blink .75s step-end infinite;}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:0;}}

/* Music player preview */
.pc-music{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:12px 14px;display:flex;align-items:center;gap:12px;margin-bottom:14px;position:relative;overflow:hidden;}
.pc-music:hover{border-color:rgba(124,58,237,.35);}
.pc-prog-bg{position:absolute;bottom:0;left:0;height:3px;width:100%;background:rgba(255,255,255,.07);}
.pc-prog{position:absolute;bottom:0;left:0;height:3px;width:0%;background:linear-gradient(90deg,var(--acc),var(--acc2));border-radius:0 2px 2px 0;}
.pc-album{width:42px;height:42px;border-radius:10px;background:linear-gradient(135deg,#2d1060,#0c2a50);display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0;}
.pc-album.spin{animation:aSpin 8s linear infinite;}
@keyframes aSpin{to{transform:rotate(360deg);}}
.pc-minfo{flex:1;min-width:0;}
.pc-mtitle{font-size:.85rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.pc-martist{font-size:.73rem;color:var(--mut);margin-top:1px;}
.pc-mcontrols{display:flex;gap:6px;align-items:center;}
.pc-mbtn{width:30px;height:30px;border-radius:50%;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.82rem;background:rgba(255,255,255,.08);color:#fff;transition:transform .15s,background .2s;}
.pc-mbtn:hover{transform:scale(1.12);background:rgba(255,255,255,.14);}
.pc-mbtn.play{background:var(--acc)!important;width:36px;height:36px;font-size:.92rem;box-shadow:0 0 14px rgba(124,58,237,.4);}

/* Social links â€” ICON ONLY (square buttons) */
.pc-socials{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-bottom:14px;}
.pc-soc{display:flex;align-items:center;justify-content:center;width:46px;height:46px;border-radius:11px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);transition:transform .18s,border-color .18s,box-shadow .18s;position:relative;overflow:visible;text-decoration:none;flex-shrink:0;}
.pc-soc:hover{transform:translateY(-3px) scale(1.1);box-shadow:0 8px 22px rgba(0,0,0,.3);}
.pc-soc img{width:24px;height:24px;object-fit:contain;border-radius:4px;}
.pc-soc .fallback{font-size:1.2rem;}
.pc-soc .tip{position:absolute;bottom:calc(100% + 6px);left:50%;transform:translateX(-50%);background:rgba(12,12,22,.95);border:1px solid rgba(255,255,255,.1);color:#f0f0fa;font-size:.68rem;font-weight:600;padding:3px 9px;border-radius:6px;white-space:nowrap;opacity:0;pointer-events:none;transition:opacity .15s;}
.pc-soc:hover .tip{opacity:1;}

.pc-stats{display:flex;gap:1px;background:var(--brd);border:1px solid var(--brd);border-radius:12px;overflow:hidden;margin-bottom:14px;}
.pc-stat{flex:1;padding:11px 6px;background:rgba(15,15,26,.92);text-align:center;}
.pc-snum{font-family:'Syne',sans-serif;font-size:1.1rem;font-weight:800;color:var(--acc);}
.pc-slabel{font-size:.65rem;color:var(--mut);margin-top:2px;}

.pc-foot{padding:11px 22px;border-top:1px solid rgba(255,255,255,.05);display:flex;align-items:center;justify-content:space-between;}
.pc-credit{font-size:.74rem;color:var(--mut);text-decoration:none;}
.pc-credit:hover{color:var(--acc);}

/* Panel */
.panel{width:var(--pw);flex-shrink:0;background:var(--sur);border-left:1px solid var(--brd);overflow-y:auto;display:none;}
.panel.on{display:block;}
.panel::-webkit-scrollbar{width:3px;}
.panel::-webkit-scrollbar-thumb{background:rgba(255,255,255,.07);}
.ph{padding:18px 20px 14px;border-bottom:1px solid var(--brd);font-family:'Syne',sans-serif;font-size:1rem;font-weight:700;}
.prow{padding:16px 20px;border-bottom:1px solid rgba(255,255,255,.04);}
.plabel{font-size:.78rem;color:var(--mut);margin-bottom:8px;display:flex;align-items:center;justify-content:space-between;}
.plabel span{font-size:.7rem;color:rgba(255,255,255,.25);}

input[type=text],input[type=url],textarea,select{width:100%;background:var(--sur2);border:1px solid var(--brd);border-radius:8px;padding:10px 13px;color:var(--txt);font-family:'Outfit',sans-serif;font-size:.86rem;outline:none;transition:border-color .2s;}
input[type=text]:focus,input[type=url]:focus,textarea:focus,select:focus{border-color:rgba(124,58,237,.5);}
textarea{resize:vertical;min-height:70px;line-height:1.55;}
select{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b6b85' d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;}
input[type=color]{width:36px;height:36px;border:none;border-radius:8px;cursor:pointer;padding:2px;background:var(--sur2);flex-shrink:0;}
input[type=range]{width:100%;accent-color:var(--acc);}
.row2{display:flex;gap:8px;}
.row2 > *{flex:1;}
.with-color{display:flex;gap:8px;align-items:center;}
.with-color input[type=text]{flex:1;}

.upload-btn{display:flex;align-items:center;justify-content:center;gap:9px;width:100%;padding:11px;border-radius:9px;border:1.5px dashed rgba(255,255,255,.12);background:rgba(255,255,255,.03);color:var(--mut);font-size:.84rem;font-family:'Outfit',sans-serif;cursor:pointer;transition:all .2s;text-align:center;}
.upload-btn:hover{border-color:rgba(124,58,237,.45);color:var(--txt);background:rgba(124,58,237,.06);}
.upload-preview{width:100%;height:80px;border-radius:8px;background:var(--sur2);margin-top:8px;display:flex;align-items:center;justify-content:center;overflow:hidden;}
.upload-preview img,.upload-preview video{max-width:100%;max-height:100%;object-fit:cover;border-radius:6px;}
.upload-preview .uname{font-size:.78rem;color:var(--mut);padding:8px;}

.tog{display:flex;align-items:center;gap:10px;}
.tog-sw{width:38px;height:22px;background:rgba(255,255,255,.1);border-radius:11px;position:relative;cursor:pointer;transition:background .2s;flex-shrink:0;}
.tog-sw.on{background:var(--acc);}
.tog-sw::after{content:'';position:absolute;top:3px;left:3px;width:16px;height:16px;background:#fff;border-radius:50%;transition:left .2s;}
.tog-sw.on::after{left:19px;}
.tog-label{font-size:.84rem;}

/* Link builder */
.link-list{display:flex;flex-direction:column;gap:6px;margin-bottom:10px;}
.link-item{background:var(--sur2);border:1px solid var(--brd);border-radius:9px;padding:10px 12px;display:flex;align-items:center;gap:10px;}
.li-icon{width:32px;height:32px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:.9rem;background:rgba(255,255,255,.06);overflow:hidden;flex-shrink:0;}
.li-icon img{width:100%;height:100%;object-fit:contain;}
.li-info{flex:1;min-width:0;}
.li-label{font-size:.84rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.li-url{font-size:.72rem;color:var(--mut);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.li-del{background:none;border:none;color:var(--mut);cursor:pointer;font-size:1.1rem;padding:2px 5px;border-radius:4px;transition:color .2s;}
.li-del:hover{color:var(--dan);}
.add-link-form{background:var(--sur2);border:1px solid var(--brd);border-radius:10px;padding:14px;display:none;flex-direction:column;gap:10px;}
.add-link-form.show{display:flex;}
.al-row{display:flex;gap:8px;align-items:center;}
.al-row button{flex:1;}

/* Modals */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);backdrop-filter:blur(8px);z-index:200;display:none;align-items:center;justify-content:center;}
.modal-overlay.show{display:flex;}
.modal{background:var(--sur);border:1px solid var(--brd);border-radius:18px;padding:32px;max-width:420px;width:90%;text-align:center;}
.modal h2{font-family:'Syne',sans-serif;font-size:1.5rem;font-weight:800;margin-bottom:10px;}
.modal p{color:var(--mut);font-size:.9rem;line-height:1.6;margin-bottom:20px;}
.modal input{margin-bottom:14px;}
.modal-url{font-family:'Space Mono',monospace;font-size:.85rem;background:rgba(124,58,237,.1);border:1px solid rgba(124,58,237,.3);border-radius:8px;padding:10px 14px;color:var(--acc);text-align:center;cursor:pointer;transition:background .2s;user-select:all;}
.modal-url:hover{background:rgba(124,58,237,.18);}
.modal-acts{display:flex;gap:10px;margin-top:16px;justify-content:center;flex-wrap:wrap;}

/* Toast */
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(60px);background:rgba(12,12,22,.97);backdrop-filter:blur(20px);border:1px solid rgba(124,58,237,.3);color:var(--txt);padding:10px 22px;border-radius:10px;font-size:.85rem;font-weight:500;transition:transform .35s cubic-bezier(.16,1,.3,1),opacity .35s;z-index:9999;pointer-events:none;opacity:0;white-space:nowrap;}
.toast.show{transform:translateX(-50%) translateY(0);opacity:1;}

::-webkit-scrollbar{width:5px;}
::-webkit-scrollbar-track{background:var(--bg);}
::-webkit-scrollbar-thumb{background:rgba(124,58,237,.35);border-radius:3px;}
</style>
</head>
<body>

<div class="topbar">
  <a class="tlogo" href="/">VLTX</a>
  <span class="ttitle">Profile Editor</span>
  <span class="tsp"></span>
  <button class="tbtn ghost" onclick="resetProfile()">Reset</button>
  <button class="tbtn acc" onclick="showPublish()">Publish Profile â†’</button>
</div>

<div class="main">
  <!-- Section nav -->
  <div class="snav">
    <div class="sg">Identity</div>
    <div class="ni on" onclick="nav(this,'s-identity')"><span class="nicon">ğŸ‘¤</span>Profile<div class="nd"></div></div>
    <div class="ni" onclick="nav(this,'s-bio')"><span class="nicon">âœï¸</span>Bio & Tags<div class="nd"></div></div>
    <div class="sg">Media</div>
    <div class="ni" onclick="nav(this,'s-avatar')"><span class="nicon">ğŸ–¼ï¸</span>Avatar<div class="nd"></div></div>
    <div class="ni" onclick="nav(this,'s-background')"><span class="nicon">ğŸ¬</span>Background<div class="nd"></div></div>
    <div class="ni" onclick="nav(this,'s-music')"><span class="nicon">ğŸµ</span>Music<div class="nd"></div></div>
    <div class="sg">Design</div>
    <div class="ni" onclick="nav(this,'s-theme')"><span class="nicon">ğŸ¨</span>Theme<div class="nd"></div></div>
    <div class="ni" onclick="nav(this,'s-effects')"><span class="nicon">âœ¨</span>Effects<div class="nd"></div></div>
    <div class="sg">Links</div>
    <div class="ni" onclick="nav(this,'s-links')"><span class="nicon">ğŸ”—</span>Social Links<div class="nd"></div></div>
  </div>

  <!-- Preview -->
  <div class="prev">
    <div class="prevtop">
      <div class="pdots">
        <div class="pdot" style="background:#ff5f56"></div>
        <div class="pdot" style="background:#ffbd2e"></div>
        <div class="pdot" style="background:#27c93f"></div>
      </div>
      <div class="purl" id="previewUrl">vltx.lol/yourname</div>
    </div>
    <div class="prevscroll">
      <div id="pc">
        <video class="pc-bg-video" id="bgVideo" autoplay muted loop playsinline style="display:none"></video>
        <div class="pc-bg-overlay" id="bgOverlay"></div>
        <div class="pc-banner"><canvas id="bnrCanvas"></canvas></div>
        <div class="pc-avatar-wrap">
          <div class="pc-avatar" id="pcAvatar" onclick="document.getElementById('avatarFileInput').click()" title="Click to upload photo">ğŸ‘¾</div>
          <div class="pc-online"></div>
        </div>
        <div class="pc-body">
          <div class="pc-name-row">
            <span class="pc-username" id="pcUsername">yourname</span>
            <span class="pc-pronouns" id="pcPronouns" style="display:none"></span>
          </div>
          <div class="pc-tags" id="pcTags"></div>
          <div class="pc-bio"><div><span class="tw" id="pcBio"></span><span class="caret"></span></div></div>
          <div class="pc-music" id="pcMusic" style="display:none">
            <div class="pc-prog-bg"><div class="pc-prog" id="pcProg"></div></div>
            <div class="pc-album" id="pcAlbum">ğŸµ</div>
            <div class="pc-minfo">
              <div class="pc-mtitle" id="pcMtitle">No track loaded</div>
              <div class="pc-martist" id="pcMartist">Upload an MP3</div>
            </div>
            <div class="pc-mcontrols">
              <button class="pc-mbtn" onclick="prevTr()">â®</button>
              <button class="pc-mbtn play" id="pcPlayBtn" onclick="togglePlay()">â–¶</button>
              <button class="pc-mbtn" onclick="nextTr()">â­</button>
            </div>
          </div>
          <div class="pc-stats">
            <div class="pc-stat"><div class="pc-snum" id="pcViews">0</div><div class="pc-slabel">profile views</div></div>
            <div class="pc-stat"><div class="pc-snum" id="pcFollowers">0</div><div class="pc-slabel">followers</div></div>
            <div class="pc-stat"><div class="pc-snum" id="pcClicks">0</div><div class="pc-slabel">link clicks</div></div>
          </div>
          <div class="pc-socials" id="pcSocials"></div>
        </div>
        <div class="pc-foot">
          <a href="/" class="pc-credit">âš¡ vltx.lol</a>
          <span style="font-size:.74rem;color:var(--mut)">ğŸ‘ <span id="pcViewCount">0</span> views</span>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ Panels â”€â”€ -->

  <!-- Profile -->
  <div class="panel on" id="s-identity">
    <div class="ph">ğŸ‘¤ Profile Info</div>
    <div class="prow"><div class="plabel">Username <span>shown in URL</span></div>
      <input type="text" id="iUsername" placeholder="yourname" oninput="syncUsername()" maxlength="30">
    </div>
    <div class="prow"><div class="plabel">Display Name <span>shown on card</span></div>
      <input type="text" id="iDisplayName" placeholder="Your Name" oninput="syncDisplayName()">
    </div>
    <div class="prow"><div class="plabel">Pronouns</div>
      <input type="text" id="iPronouns" placeholder="he/him, she/her..." oninput="syncPronouns()">
    </div>
    <div class="prow"><div class="plabel">Stats</div>
      <div class="row2">
        <div><div style="font-size:.72rem;color:var(--mut);margin-bottom:4px">Followers</div><input type="text" id="iFollowers" value="0" oninput="syncStats()"></div>
        <div><div style="font-size:.72rem;color:var(--mut);margin-bottom:4px">Link Clicks</div><input type="text" id="iClicks" value="0" oninput="syncStats()"></div>
      </div>
    </div>
  </div>

  <!-- Bio & Tags -->
  <div class="panel" id="s-bio">
    <div class="ph">âœï¸ Bio & Tags</div>
    <div class="prow">
      <div class="plabel">Typewriter Phrases <span>one per line</span></div>
      <textarea id="iBio" rows="5" placeholder="full time lurker. part time god.&#10;i make stuff sometimes.&#10;your fave's fave ğŸŒ™" oninput="syncBio()"></textarea>
      <div style="font-size:.72rem;color:var(--mut);margin-top:6px">Each line cycles with a typewriter effect on your profile.</div>
    </div>
    <div class="prow"><div class="plabel">Tags <span>comma separated</span></div>
      <input type="text" id="iTags" placeholder="ğŸŒ™ nocturnal, ğŸ® gamer, ğŸ”ª menace" oninput="syncTags()">
    </div>
  </div>

  <!-- Avatar -->
  <div class="panel" id="s-avatar">
    <div class="ph">ğŸ–¼ï¸ Profile Picture</div>
    <div class="prow">
      <div class="plabel">Upload Photo</div>
      <label class="upload-btn" for="avatarFileInput">ğŸ“ Choose from files / gallery</label>
      <input type="file" id="avatarFileInput" accept="image/*" style="display:none" onchange="uploadAvatar(this)">
      <div class="upload-preview" id="avatarPreview">
        <div class="uname">No image uploaded</div>
      </div>
    </div>
    <div class="prow"><div class="plabel">Or use an Emoji instead</div>
      <input type="text" id="iEmoji" placeholder="ğŸ‘¾" maxlength="4" oninput="syncEmoji()">
    </div>
  </div>

  <!-- Background -->
  <div class="panel" id="s-background">
    <div class="ph">ğŸ¬ Background</div>
    <div class="prow">
      <div class="plabel">Upload Video or Image Background</div>
      <label class="upload-btn" for="bgFileInput">ğŸ¬ Choose MP4 / WebM / JPG / PNG</label>
      <input type="file" id="bgFileInput" accept="video/*,image/*" style="display:none" onchange="uploadBg(this)">
      <div class="upload-preview" id="bgPreview"><div class="uname">No file uploaded</div></div>
    </div>
    <div class="prow"><div class="plabel">Opacity <span id="bgOpacityVal">25%</span></div>
      <input type="range" min="5" max="70" value="25" id="iBgOpacity" oninput="syncBgOpacity()">
    </div>
    <div class="prow"><div class="plabel">Fallback Background Color</div>
      <div class="with-color">
        <input type="text" id="iBgColor" value="#030308" oninput="syncBgColor()">
        <input type="color" id="iBgColorPick" value="#030308" oninput="syncBgColorPick()">
      </div>
    </div>
  </div>

  <!-- Music -->
  <div class="panel" id="s-music">
    <div class="ph">ğŸµ Music Player</div>
    <div class="prow">
      <div class="plabel">Upload MP3 Tracks</div>
      <label class="upload-btn" for="musicFileInput">ğŸµ Choose MP3 files (can pick multiple)</label>
      <input type="file" id="musicFileInput" accept="audio/mp3,audio/mpeg" multiple style="display:none" onchange="uploadMusic(this)">
    </div>
    <div class="prow">
      <div class="plabel">Track List</div>
      <div id="trackList" style="font-size:.82rem;color:var(--mut)">No tracks uploaded yet.</div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleMusic()">
        <div class="tog-sw" id="togMusic"></div>
        <span class="tog-label">Show music player on profile</span>
      </div>
    </div>
  </div>

  <!-- Theme -->
  <div class="panel" id="s-theme">
    <div class="ph">ğŸ¨ Theme</div>
    <div class="prow"><div class="plabel">Accent Color</div>
      <div class="with-color">
        <input type="text" id="iAccent" value="#a855f7" oninput="syncAccent()">
        <input type="color" id="iAccentPick" value="#a855f7" oninput="syncAccentPick()">
      </div>
    </div>
    <div class="prow"><div class="plabel">Secondary Color</div>
      <div class="with-color">
        <input type="text" id="iAccent2" value="#22d3ee" oninput="syncAccent2()">
        <input type="color" id="iAccent2Pick" value="#22d3ee" oninput="syncAccent2Pick()">
      </div>
    </div>
    <div class="prow"><div class="plabel">Card Background Color</div>
      <div class="with-color">
        <input type="text" id="iCardBg" value="#0f0f1a" oninput="syncCardBg()">
        <input type="color" id="iCardBgPick" value="#0f0f1a" oninput="syncCardBgPick()">
      </div>
    </div>
    <div class="prow"><div class="plabel">Card Blur <span id="blurVal">28px</span></div>
      <input type="range" min="0" max="60" value="28" id="iBlur" oninput="syncBlur()">
    </div>
    <div class="prow"><div class="plabel">Theme Preset</div>
      <select id="iPreset" onchange="applyPreset()">
        <option value="">Custom</option>
        <option value="purple">Purple Haze</option>
        <option value="cyan">Cyan Storm</option>
        <option value="rose">Rose Gold</option>
        <option value="green">Matrix Green</option>
        <option value="orange">Solar Flare</option>
        <option value="mono">Monochrome</option>
      </select>
    </div>
  </div>

  <!-- Effects -->
  <div class="panel" id="s-effects">
    <div class="ph">âœ¨ Effects</div>
    <div class="prow"><div class="plabel">Particle Effect</div>
      <select id="iParticle" onchange="syncParticle()">
        <option value="network">Network (default)</option>
        <option value="snow">Snow</option>
        <option value="fireflies">Fireflies</option>
        <option value="matrix">Matrix Rain</option>
        <option value="none">None</option>
      </select>
    </div>
    <div class="prow"><div class="plabel">Cursor Style</div>
      <select id="iCursor" onchange="syncCursor()">
        <option value="dot">Dot + Ring (default)</option>
        <option value="crosshair">Crosshair</option>
        <option value="none">Default cursor</option>
      </select>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleSymbolRain()">
        <div class="tog-sw on" id="togSymbols"></div>
        <span class="tog-label">Falling symbols</span>
      </div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleCardTilt()">
        <div class="tog-sw on" id="togTilt"></div>
        <span class="tog-label">Card tilt on hover</span>
      </div>
    </div>
    <div class="prow">
      <div class="tog" onclick="toggleGlow()">
        <div class="tog-sw on" id="togGlow"></div>
        <span class="tog-label">Username glow shimmer</span>
      </div>
    </div>
  </div>

  <!-- Social Links -->
  <div class="panel" id="s-links">
    <div class="ph">ğŸ”— Social Links</div>
    <div class="prow">
      <div style="font-size:.78rem;color:var(--mut);margin-bottom:12px">Links show as clickable icons on your profile. Hover to see the label.</div>
      <div class="link-list" id="linkList"></div>
      <button class="upload-btn" onclick="showAddLink()" style="border-style:solid;margin-bottom:10px">+ Add Link</button>
      <div class="add-link-form" id="addLinkForm">
        <div class="plabel">Label (e.g. Discord, Twitter)</div>
        <input type="text" id="alLabel" placeholder="Discord">
        <div class="plabel">URL</div>
        <input type="url" id="alUrl" placeholder="https://discord.gg/...">
        <div class="al-row">
          <button class="tbtn acc" onclick="addLink()">Add Link</button>
          <button class="tbtn ghost" onclick="hideAddLink()">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Publish Modal -->
<div class="modal-overlay" id="publishModal">
  <div class="modal">
    <h2>ğŸš€ Publish Profile</h2>
    <p>Choose your username. Anyone can visit your profile at this URL.</p>
    <input type="text" id="publishUsername" placeholder="yourname" maxlength="30" style="text-align:center;font-size:1.1rem;padding:12px;">
    <div id="publishUrlPreview" class="modal-url">vltx.lol/yourname</div>
    <div class="modal-acts">
      <button class="tbtn acc" onclick="publishProfile()" style="padding:11px 28px;font-size:.92rem">Publish â†’</button>
      <button class="tbtn ghost" onclick="hidePublish()">Cancel</button>
    </div>
    <p style="margin-top:14px;font-size:.75rem;color:var(--mut)">Publishing saves your profile to the server. Anyone with the link can view it.</p>
  </div>
</div>

<!-- Success Modal -->
<div class="modal-overlay" id="successModal">
  <div class="modal">
    <div style="font-size:2.5rem;margin-bottom:12px">ğŸ‰</div>
    <h2>Profile Published!</h2>
    <p>Your profile is live. Share this link:</p>
    <div class="modal-url" id="successUrl" onclick="copyUrl()">vltx.lol/yourname</div>
    <div class="modal-acts">
      <button class="tbtn suc" onclick="copyUrl()">ğŸ“‹ Copy Link</button>
      <button class="tbtn acc" onclick="visitProfile()">Visit Profile â†’</button>
      <button class="tbtn ghost" onclick="hideSuccess()">Close</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>
<audio id="audioEl" style="display:none"></audio>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const state = {
  username:'', displayName:'', pronouns:'',
  bioLines:['full time lurker. part time god.','i make stuff and it sometimes slaps.'],
  tags:['ğŸŒ™ nocturnal','ğŸ® gamer','ğŸ¨ creator'],
  avatar:null, avatarEmoji:'ğŸ‘¾',
  bgVideo:null, bgImage:null, bgOpacity:25, bgColor:'#030308',
  tracks:[], showMusic:false,
  accent:'#a855f7', accent2:'#22d3ee', cardBg:'#0f0f1a', blur:28,
  particle:'network', cursor:'dot',
  symbolRain:true, cardTilt:true, glow:true,
  links:[], followers:'0', clicks:'0'
};
let publishedUrl = '';

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// NAV
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function nav(el, id) {
  document.querySelectorAll('.ni').forEach(n => n.classList.remove('on'));
  el.classList.add('on');
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('on'));
  document.getElementById(id).classList.add('on');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// IDENTITY
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function syncUsername() {
  state.username = document.getElementById('iUsername').value.trim().toLowerCase().replace(/[^a-z0-9_.\-]/g,'');
  document.getElementById('iUsername').value = state.username;
  document.getElementById('previewUrl').textContent = `vltx.lol/${state.username||'yourname'}`;
  document.getElementById('publishUsername').value = state.username;
  document.getElementById('publishUrlPreview').textContent = `vltx.lol/${state.username||'yourname'}`;
  document.getElementById('pcUsername').textContent = state.displayName || state.username || 'yourname';
}
function syncDisplayName() {
  state.displayName = document.getElementById('iDisplayName').value;
  document.getElementById('pcUsername').textContent = state.displayName || state.username || 'yourname';
}
function syncPronouns() {
  state.pronouns = document.getElementById('iPronouns').value;
  const el = document.getElementById('pcPronouns');
  el.textContent = state.pronouns;
  el.style.display = state.pronouns ? '' : 'none';
}
function syncStats() {
  state.followers = document.getElementById('iFollowers').value;
  state.clicks    = document.getElementById('iClicks').value;
  document.getElementById('pcFollowers').textContent = state.followers;
  document.getElementById('pcClicks').textContent    = state.clicks;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TYPEWRITER â€” fixed: restarts cleanly whenever bio textarea changes
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let _twTimer = null, _twPhrases = [], _twIdx = 0, _twChar = 0, _twDel = false;

function syncBio() {
  _twPhrases = document.getElementById('iBio').value
    .split('\n').map(s => s.trim()).filter(Boolean);
  if (!_twPhrases.length) _twPhrases = [''];
  clearTimeout(_twTimer);
  _twIdx = 0; _twChar = 0; _twDel = false;
  document.getElementById('pcBio').textContent = '';
  _stepTW();
}

function _stepTW() {
  const el = document.getElementById('pcBio');
  if (!_twPhrases.length) return;
  const phrase = _twPhrases[_twIdx];
  if (!_twDel) {
    _twChar++;
    el.textContent = phrase.slice(0, _twChar);
    if (_twChar >= phrase.length) {
      _twDel = true;
      _twTimer = setTimeout(_stepTW, 2400);
    } else {
      _twTimer = setTimeout(_stepTW, 65);
    }
  } else {
    _twChar--;
    el.textContent = phrase.slice(0, _twChar);
    if (_twChar <= 0) {
      _twDel = false;
      _twIdx  = (_twIdx + 1) % _twPhrases.length;
      _twTimer = setTimeout(_stepTW, 420);
    } else {
      _twTimer = setTimeout(_stepTW, 32);
    }
  }
}

function syncTags() {
  state.tags = document.getElementById('iTags').value.split(',').map(s=>s.trim()).filter(Boolean);
  renderTags();
}
function renderTags() {
  document.getElementById('pcTags').innerHTML = state.tags.map(t=>`<span class="pc-tag">${t}</span>`).join('');
}
function syncEmoji() {
  state.avatarEmoji = document.getElementById('iEmoji').value || 'ğŸ‘¾';
  if (!state.avatar) renderAvatar();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// AVATAR UPLOAD
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function uploadAvatar(input) {
  const file = input.files[0];
  if (!file) return;
  // Show local preview instantly
  const localUrl = URL.createObjectURL(file);
  state.avatar = localUrl;
  renderAvatar();
  const prev = document.getElementById('avatarPreview');
  prev.innerHTML = `<img src="${localUrl}" style="width:100%;height:100%;object-fit:cover;border-radius:6px">`;

  showToast('Uploading avatar...');
  const fd = new FormData();
  fd.append('file', file);
  fetch('/api/upload/avatar', { method:'POST', body:fd })
    .then(r => r.json())
    .then(d => {
      if (d.url) { state.avatar = d.url; showToast('âœ… Avatar uploaded!'); }
    })
    .catch(() => showToast('âœ… Avatar set (local preview only)'));
}

function renderAvatar() {
  const el = document.getElementById('pcAvatar');
  if (state.avatar) {
    el.innerHTML = `<img src="${state.avatar}" style="width:100%;height:100%;object-fit:cover;">`;
  } else {
    el.textContent = state.avatarEmoji || 'ğŸ‘¾';
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// BACKGROUND UPLOAD (video OR image)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function uploadBg(input) {
  const file = input.files[0];
  if (!file) return;
  const isVideo = file.type.startsWith('video/');
  const localUrl = URL.createObjectURL(file);

  const vid = document.getElementById('bgVideo');
  if (isVideo) {
    vid.src = localUrl;
    vid.style.display = 'block';
    vid.style.opacity = state.bgOpacity / 100;
    document.getElementById('pc').style.backgroundImage = '';
  } else {
    vid.style.display = 'none';
    document.getElementById('pc').style.backgroundImage = `url(${localUrl})`;
    document.getElementById('pc').style.backgroundSize = 'cover';
    document.getElementById('pc').style.backgroundPosition = 'center';
  }

  const prev = document.getElementById('bgPreview');
  prev.innerHTML = isVideo
    ? `<video src="${localUrl}" style="max-width:100%;max-height:100%;border-radius:6px" muted autoplay loop playsinline></video>`
    : `<img src="${localUrl}" style="max-width:100%;max-height:100%;border-radius:6px;object-fit:cover">`;

  showToast('Uploading background...');
  const fd = new FormData();
  fd.append('file', file);
  fetch('/api/upload/background', { method:'POST', body:fd })
    .then(r => r.json())
    .then(d => {
      if (d.url) {
        if (isVideo) state.bgVideo = d.url; else state.bgImage = d.url;
        showToast('âœ… Background uploaded!');
      }
    })
    .catch(() => {
      if (isVideo) state.bgVideo = localUrl; else state.bgImage = localUrl;
      showToast('âœ… Background set (local preview)');
    });
}

function syncBgOpacity() {
  state.bgOpacity = document.getElementById('iBgOpacity').value;
  document.getElementById('bgOpacityVal').textContent = state.bgOpacity + '%';
  document.getElementById('bgVideo').style.opacity = state.bgOpacity / 100;
}
function syncBgColor()     { state.bgColor = document.getElementById('iBgColor').value; document.getElementById('iBgColorPick').value = state.bgColor; applyCardBg(); }
function syncBgColorPick() { const v = document.getElementById('iBgColorPick').value; document.getElementById('iBgColor').value = v; state.bgColor = v; applyCardBg(); }
function applyCardBg() {
  const r=parseInt(state.cardBg.slice(1,3),16), g=parseInt(state.cardBg.slice(3,5),16), b=parseInt(state.cardBg.slice(5,7),16);
  document.getElementById('pc').style.background = `rgba(${r},${g},${b},0.9)`;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MUSIC
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let tracks = [], trackIdx = 0, playing = false;
const audioEl = document.getElementById('audioEl');

function uploadMusic(input) {
  const files = Array.from(input.files);
  if (!files.length) return;
  showToast(`Uploading ${files.length} track(s)...`);

  const promises = files.map(file => {
    const localUrl = URL.createObjectURL(file);
    const name = file.name.replace(/\.mp3$/i,'').replace(/\.mpeg$/i,'');
    const fd = new FormData();
    fd.append('file', file);
    return fetch('/api/upload/music', { method:'POST', body:fd })
      .then(r => r.json())
      .then(d => ({ name: d.name || name, url: d.url }))
      .catch(() => ({ name, url: localUrl }));
  });

  Promise.all(promises).then(newTracks => {
    tracks = [...tracks, ...newTracks];
    state.tracks = tracks;
    renderTrackList();
    if (tracks.length > 0) {
      state.showMusic = true;
      document.getElementById('togMusic').classList.add('on');
      document.getElementById('pcMusic').style.display = 'flex';
      loadTrack(0);
    }
    showToast(`âœ… ${newTracks.length} track(s) added!`);
  });
}

function renderTrackList() {
  const el = document.getElementById('trackList');
  if (!tracks.length) { el.textContent = 'No tracks uploaded yet.'; return; }
  el.innerHTML = tracks.map((t,i) => `
    <div style="display:flex;align-items:center;gap:8px;padding:8px;background:rgba(255,255,255,.03);border-radius:7px;margin-bottom:5px;">
      <span style="font-size:.85rem;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">ğŸµ ${t.name}</span>
      <button onclick="removeTrack(${i})" style="background:none;border:none;color:var(--mut);cursor:pointer;font-size:.9rem;" title="Remove">âœ•</button>
    </div>`).join('');
}
function removeTrack(i) {
  tracks.splice(i,1);
  state.tracks = tracks;
  renderTrackList();
  if (!tracks.length) {
    document.getElementById('pcMusic').style.display = 'none';
    state.showMusic = false;
    document.getElementById('togMusic').classList.remove('on');
    audioEl.pause(); playing = false;
  } else { loadTrack(0); }
}
function loadTrack(i) {
  trackIdx = ((i % tracks.length) + tracks.length) % tracks.length;
  const t = tracks[trackIdx];
  audioEl.src = t.url;
  document.getElementById('pcMtitle').textContent  = t.name;
  document.getElementById('pcMartist').textContent = `Track ${trackIdx+1} of ${tracks.length}`;
  document.getElementById('pcProg').style.width    = '0%';
  if (playing) audioEl.play().catch(()=>{});
}
function togglePlay() {
  if (!tracks.length) { showToast('Upload a track first!'); return; }
  playing = !playing;
  const btn = document.getElementById('pcPlayBtn');
  const alb = document.getElementById('pcAlbum');
  if (playing) { audioEl.play().catch(()=>{}); btn.textContent='â¸'; alb.classList.add('spin'); }
  else         { audioEl.pause(); btn.textContent='â–¶'; alb.classList.remove('spin'); }
}
function nextTr() { stopPlay(); if(tracks.length) loadTrack(trackIdx+1); }
function prevTr() { stopPlay(); if(tracks.length) loadTrack(trackIdx-1); }
function stopPlay() { playing=false; document.getElementById('pcPlayBtn').textContent='â–¶'; document.getElementById('pcAlbum').classList.remove('spin'); }
audioEl.addEventListener('timeupdate',()=>{ if(!audioEl.duration)return; document.getElementById('pcProg').style.width=(audioEl.currentTime/audioEl.duration*100)+'%'; });
audioEl.addEventListener('ended',()=>{ if(tracks.length>1) nextTr(); });
function toggleMusic() {
  state.showMusic = !state.showMusic;
  document.getElementById('togMusic').classList.toggle('on', state.showMusic);
  document.getElementById('pcMusic').style.display = state.showMusic ? 'flex' : 'none';
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// THEME
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function syncAccent()      { state.accent  = document.getElementById('iAccent').value;  document.getElementById('iAccentPick').value  = tryHex(state.accent);  applyAccent(); }
function syncAccentPick()  { const v=document.getElementById('iAccentPick').value;  document.getElementById('iAccent').value =v; state.accent =v; applyAccent(); }
function syncAccent2()     { state.accent2 = document.getElementById('iAccent2').value; document.getElementById('iAccent2Pick').value = tryHex(state.accent2); }
function syncAccent2Pick() { const v=document.getElementById('iAccent2Pick').value; document.getElementById('iAccent2').value=v; state.accent2=v; }
function syncCardBg()      { state.cardBg  = document.getElementById('iCardBg').value;  document.getElementById('iCardBgPick').value  = tryHex(state.cardBg);  applyCardBg(); }
function syncCardBgPick()  { const v=document.getElementById('iCardBgPick').value;  document.getElementById('iCardBg').value =v; state.cardBg =v; applyCardBg(); }
function syncBlur()        { state.blur=document.getElementById('iBlur').value; document.getElementById('blurVal').textContent=state.blur+'px'; document.getElementById('pc').style.backdropFilter=`blur(${state.blur}px)`; }
function applyAccent()     { ['pcViews','pcFollowers','pcClicks'].forEach(id=>document.getElementById(id).style.color=state.accent); }
function tryHex(v)         { return /^#[0-9a-fA-F]{6}$/.test(v) ? v : '#a855f7'; }

const PRESETS = {
  purple:{accent:'#a855f7',accent2:'#7c3aed',cardBg:'#0f0418'},
  cyan:  {accent:'#06b6d4',accent2:'#0ea5e9',cardBg:'#021a22'},
  rose:  {accent:'#f43f5e',accent2:'#fb7185',cardBg:'#1a040a'},
  green: {accent:'#22c55e',accent2:'#4ade80',cardBg:'#021a07'},
  orange:{accent:'#f97316',accent2:'#fb923c',cardBg:'#1a0a02'},
  mono:  {accent:'#ffffff',accent2:'#a1a1aa',cardBg:'#0a0a0a'}
};
function applyPreset() {
  const p = PRESETS[document.getElementById('iPreset').value];
  if (!p) return;
  document.getElementById('iAccent').value   = document.getElementById('iAccentPick').value  = p.accent;
  document.getElementById('iAccent2').value  = document.getElementById('iAccent2Pick').value = p.accent2;
  document.getElementById('iCardBg').value   = document.getElementById('iCardBgPick').value  = p.cardBg;
  Object.assign(state, p);
  applyCardBg(); applyAccent();
  showToast('âœ… Theme applied!');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// EFFECTS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function syncParticle()    { state.particle   = document.getElementById('iParticle').value; }
function syncCursor()      { state.cursor     = document.getElementById('iCursor').value; }
function toggleSymbolRain(){ state.symbolRain = !state.symbolRain; document.getElementById('togSymbols').classList.toggle('on', state.symbolRain); }
function toggleCardTilt()  { state.cardTilt   = !state.cardTilt;   document.getElementById('togTilt').classList.toggle('on', state.cardTilt); }
function toggleGlow()      { state.glow       = !state.glow;       document.getElementById('togGlow').classList.toggle('on', state.glow); }

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SOCIAL LINKS â€” icon-only
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DOMAIN_MAP = {
  discord:'discord.com', twitter:'twitter.com', x:'x.com',
  instagram:'instagram.com', youtube:'youtube.com', github:'github.com',
  spotify:'spotify.com', tiktok:'tiktok.com', twitch:'twitch.tv',
  reddit:'reddit.com', steam:'store.steampowered.com', kick:'kick.com',
  snapchat:'snapchat.com', pinterest:'pinterest.com', linkedin:'linkedin.com',
  roblox:'roblox.com', cashapp:'cash.app'
};

function getFavicon(label, url) {
  const key = label.toLowerCase().replace(/\s+/g,'').replace(/[^a-z]/g,'');
  const domain = DOMAIN_MAP[key] || (() => { try { return new URL(url).hostname; } catch { return null; } })();
  return domain ? `https://www.google.com/s2/favicons?domain=${domain}&sz=64` : null;
}

function showAddLink()  { document.getElementById('addLinkForm').classList.add('show'); }
function hideAddLink()  { document.getElementById('addLinkForm').classList.remove('show'); document.getElementById('alLabel').value=''; document.getElementById('alUrl').value=''; }
function addLink() {
  const label = document.getElementById('alLabel').value.trim();
  const url   = document.getElementById('alUrl').value.trim();
  if (!label || !url) { showToast('Fill in both label and URL!'); return; }
  if (!url.startsWith('http')) { showToast('URL must start with https://'); return; }
  state.links.push({ label, url });
  renderLinks();
  hideAddLink();
  showToast(`âœ… ${label} added!`);
}
function removeLink(i) { state.links.splice(i,1); renderLinks(); }

function renderLinks() {
  // Panel list (shows label + URL text for editing reference)
  document.getElementById('linkList').innerHTML = state.links.map((l,i) => {
    const fav = getFavicon(l.label, l.url);
    return `<div class="link-item">
      <div class="li-icon">${fav ? `<img src="${fav}" onerror="this.parentElement.textContent='ğŸ”—'">` : 'ğŸ”—'}</div>
      <div class="li-info"><div class="li-label">${l.label}</div><div class="li-url">${l.url}</div></div>
      <button class="li-del" onclick="removeLink(${i})">âœ•</button>
    </div>`;
  }).join('');

  // Preview â€” icon only with tooltip
  document.getElementById('pcSocials').innerHTML = state.links.map(l => {
    const fav = getFavicon(l.label, l.url);
    return `<a href="${l.url}" class="pc-soc" target="_blank" rel="noopener">
      ${fav ? `<img src="${fav}" onerror="this.style.display='none'">` : '<span class="fallback">ğŸ”—</span>'}
      <span class="tip">${l.label}</span>
    </a>`;
  }).join('');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// BANNER CANVAS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function(){
  const cv=document.getElementById('bnrCanvas'), bEl=cv.parentElement, cx=cv.getContext('2d');
  function resize(){ cv.width=bEl.offsetWidth; cv.height=bEl.offsetHeight; }
  resize(); new ResizeObserver(resize).observe(bEl);
  const stars=Array.from({length:80},()=>({x:Math.random(),y:Math.random(),r:Math.random()*1.4+.3,a:Math.random(),spd:Math.random()*.3+.07}));
  function draw(){
    const W=cv.width,H=cv.height;
    cx.clearRect(0,0,W,H);
    const g=cx.createLinearGradient(0,0,W,H);
    g.addColorStop(0,'#0d0220'); g.addColorStop(.5,'#0a1628'); g.addColorStop(1,'#150526');
    cx.fillStyle=g; cx.fillRect(0,0,W,H);
    stars.forEach(s=>{
      s.a+=s.spd*.02; if(s.a>1){s.a=0;s.x=Math.random();s.y=Math.random();}
      cx.beginPath(); cx.arc(s.x*W,s.y*H,s.r,0,Math.PI*2);
      cx.fillStyle=`rgba(255,255,255,${(s.a*.8).toFixed(2)})`; cx.fill();
    });
    requestAnimationFrame(draw);
  }
  draw();
})();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PUBLISH
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showPublish() {
  document.getElementById('publishUsername').value = state.username || '';
  document.getElementById('publishUrlPreview').textContent = `vltx.lol/${state.username||'yourname'}`;
  document.getElementById('publishModal').classList.add('show');
}
document.getElementById('publishUsername').addEventListener('input', function(){
  const v = this.value.toLowerCase().replace(/[^a-z0-9_.\-]/g,'');
  this.value = v;
  document.getElementById('publishUrlPreview').textContent = `vltx.lol/${v||'yourname'}`;
});
function hidePublish()  { document.getElementById('publishModal').classList.remove('show'); }
function hideSuccess()  { document.getElementById('successModal').classList.remove('show'); }

async function publishProfile() {
  const username = document.getElementById('publishUsername').value.trim();
  if (!username || username.length < 2) { showToast('Choose a username (min 2 chars)'); return; }

  const data = {
    ...state,
    username,
    tracks: state.tracks.map(t => ({ name:t.name, url:t.url }))
  };

  try {
    showToast('Publishing...');
    const res  = await fetch('/api/profile', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ username, data })
    });
    const json = await res.json();
    if (json.error) { showToast('âŒ ' + json.error); return; }
    publishedUrl = json.url;
    hidePublish();
    document.getElementById('successUrl').textContent = window.location.host + json.url;
    document.getElementById('successModal').classList.add('show');
  } catch(e) {
    showToast('âŒ Error publishing. Is the server running?');
  }
}
function copyUrl()      { navigator.clipboard.writeText(window.location.host + publishedUrl).then(()=>showToast('ğŸ“‹ Copied!')); }
function visitProfile() { window.open(publishedUrl,'_blank'); hideSuccess(); }
function resetProfile() { if (!confirm('Reset all customizations?')) return; location.reload(); }

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TOAST
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let _toastTimer;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  clearTimeout(_toastTimer);
  _toastTimer = setTimeout(()=>t.classList.remove('show'), 2800);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// INIT â€” start typewriter with default phrases
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('iBio').value = state.bioLines.join('\n');
document.getElementById('iTags').value = state.tags.join(', ');
syncBio();    // starts typewriter
syncTags();
renderTags();
</script>
</body>
</html>
